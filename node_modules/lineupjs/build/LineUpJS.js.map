{"version":3,"sources":["webpack://LineUpJS/webpack/universalModuleDefinition","webpack://LineUpJS/webpack/bootstrap","webpack://LineUpJS/./node_modules/tslib/tslib.es6.js","webpack://LineUpJS/./src/model/Column.ts","webpack://LineUpJS/./src/model/annotations.ts","webpack://LineUpJS/./src/model/INumberColumn.ts","webpack://LineUpJS/./src/renderer/utils.ts","webpack://LineUpJS/./node_modules/d3-scale-chromatic/src/colors.js","webpack://LineUpJS/./src/model/NumberColumn.ts","webpack://LineUpJS/./src/model/missing.ts","webpack://LineUpJS/./src/styles/index.ts","webpack://LineUpJS/./src/renderer/interfaces.ts","webpack://LineUpJS/./src/renderer/missing.ts","webpack://LineUpJS/./src/model/Ranking.ts","webpack://LineUpJS/./node_modules/d3-array/src/ascending.js","webpack://LineUpJS/./node_modules/d3-array/src/bisector.js","webpack://LineUpJS/./node_modules/d3-array/src/bisect.js","webpack://LineUpJS/./node_modules/d3-array/src/cross.js","webpack://LineUpJS/./node_modules/d3-array/src/number.js","webpack://LineUpJS/./node_modules/d3-array/src/extent.js","webpack://LineUpJS/./node_modules/d3-array/src/array.js","webpack://LineUpJS/./node_modules/d3-array/src/constant.js","webpack://LineUpJS/./node_modules/d3-array/src/identity.js","webpack://LineUpJS/./node_modules/d3-array/src/range.js","webpack://LineUpJS/./node_modules/d3-array/src/ticks.js","webpack://LineUpJS/./node_modules/d3-array/src/threshold/sturges.js","webpack://LineUpJS/./node_modules/d3-array/src/histogram.js","webpack://LineUpJS/./node_modules/d3-array/src/quantile.js","webpack://LineUpJS/./node_modules/d3-array/src/max.js","webpack://LineUpJS/./node_modules/d3-array/src/mean.js","webpack://LineUpJS/./node_modules/d3-array/src/median.js","webpack://LineUpJS/./node_modules/d3-array/src/min.js","webpack://LineUpJS/./node_modules/d3-array/src/index.js","webpack://LineUpJS/./node_modules/d3-dispatch/src/dispatch.js","webpack://LineUpJS/./src/internal/AEventDispatcher.ts","webpack://LineUpJS/./node_modules/popper.js/dist/esm/popper.js","webpack://LineUpJS/./src/ui/dialogs/ADialog.ts","webpack://LineUpJS/./src/model/StringColumn.ts","webpack://LineUpJS/./src/model/MappingFunction.ts","webpack://LineUpJS/./src/provider/ADataProvider.ts","webpack://LineUpJS/./src/model/CategoricalColumn.ts","webpack://LineUpJS/./src/internal/math.ts","webpack://LineUpJS/./src/model/BooleansColumn.ts","webpack://LineUpJS/./src/model/CategoricalMapColumn.ts","webpack://LineUpJS/./src/model/CategoricalsColumn.ts","webpack://LineUpJS/./src/model/DatesMapColumn.ts","webpack://LineUpJS/./src/model/NumberMapColumn.ts","webpack://LineUpJS/./src/model/SetColumn.ts","webpack://LineUpJS/./src/model/StringMapColumn.ts","webpack://LineUpJS/./src/model/StringsColumn.ts","webpack://LineUpJS/./src/model/LinksColumn.ts","webpack://LineUpJS/./src/model/DummyColumn.ts","webpack://LineUpJS/./src/model/index.ts","webpack://LineUpJS/./src/model/ValueColumn.ts","webpack://LineUpJS/./src/model/ICategoricalColumn.ts","webpack://LineUpJS/./node_modules/d3-time/src/interval.js","webpack://LineUpJS/./node_modules/d3-time/src/duration.js","webpack://LineUpJS/./src/model/CompositeColumn.ts","webpack://LineUpJS/./src/model/internal.ts","webpack://LineUpJS/./node_modules/d3-scale-chromatic/src/ramp.js","webpack://LineUpJS/./node_modules/d3-scale-chromatic/src/sequential-single/Blues.js","webpack://LineUpJS/./node_modules/d3-scale-chromatic/src/sequential-single/Greens.js","webpack://LineUpJS/./node_modules/d3-scale-chromatic/src/sequential-single/Greys.js","webpack://LineUpJS/./node_modules/d3-scale-chromatic/src/sequential-single/Oranges.js","webpack://LineUpJS/./node_modules/d3-scale-chromatic/src/sequential-single/Purples.js","webpack://LineUpJS/./node_modules/d3-scale-chromatic/src/sequential-single/Reds.js","webpack://LineUpJS/./node_modules/d3-color/src/math.js","webpack://LineUpJS/./node_modules/d3-color/src/cubehelix.js","webpack://LineUpJS/./node_modules/d3-interpolate/src/cubehelix.js","webpack://LineUpJS/./node_modules/d3-scale-chromatic/src/sequential-multi/rainbow.js","webpack://LineUpJS/./node_modules/d3-scale-chromatic/src/sequential-multi/cubehelix.js","webpack://LineUpJS/./node_modules/d3-scale-chromatic/src/sequential-multi/viridis.js","webpack://LineUpJS/./node_modules/d3-scale-chromatic/src/sequential-multi/YlOrRd.js","webpack://LineUpJS/./node_modules/d3-scale-chromatic/src/sequential-multi/YlOrBr.js","webpack://LineUpJS/./node_modules/d3-scale-chromatic/src/sequential-multi/BuGn.js","webpack://LineUpJS/./node_modules/d3-scale-chromatic/src/sequential-multi/BuPu.js","webpack://LineUpJS/./node_modules/d3-scale-chromatic/src/sequential-multi/GnBu.js","webpack://LineUpJS/./node_modules/d3-scale-chromatic/src/sequential-multi/OrRd.js","webpack://LineUpJS/./node_modules/d3-scale-chromatic/src/sequential-multi/PuBuGn.js","webpack://LineUpJS/./node_modules/d3-scale-chromatic/src/sequential-multi/PuBu.js","webpack://LineUpJS/./node_modules/d3-scale-chromatic/src/sequential-multi/PuRd.js","webpack://LineUpJS/./node_modules/d3-scale-chromatic/src/sequential-multi/RdPu.js","webpack://LineUpJS/./node_modules/d3-scale-chromatic/src/sequential-multi/YlGnBu.js","webpack://LineUpJS/./node_modules/d3-scale-chromatic/src/sequential-multi/YlGn.js","webpack://LineUpJS/./node_modules/d3-scale-chromatic/src/diverging/BrBG.js","webpack://LineUpJS/./node_modules/d3-scale-chromatic/src/diverging/PRGn.js","webpack://LineUpJS/./node_modules/d3-scale-chromatic/src/diverging/PiYG.js","webpack://LineUpJS/./node_modules/d3-scale-chromatic/src/diverging/PuOr.js","webpack://LineUpJS/./node_modules/d3-scale-chromatic/src/diverging/RdBu.js","webpack://LineUpJS/./node_modules/d3-scale-chromatic/src/diverging/RdGy.js","webpack://LineUpJS/./node_modules/d3-scale-chromatic/src/diverging/RdYlBu.js","webpack://LineUpJS/./node_modules/d3-scale-chromatic/src/diverging/RdYlGn.js","webpack://LineUpJS/./node_modules/d3-scale-chromatic/src/diverging/Spectral.js","webpack://LineUpJS/./src/model/ColorMappingFunction.ts","webpack://LineUpJS/./src/model/NumbersColumn.ts","webpack://LineUpJS/./src/ui/missing.ts","webpack://LineUpJS/./node_modules/lineupengine/build/lineupengine.js","webpack://LineUpJS/./src/ui/dialogs/utils.ts","webpack://LineUpJS/./node_modules/d3-time-format/src/locale.js","webpack://LineUpJS/./node_modules/d3-time-format/src/defaultLocale.js","webpack://LineUpJS/./src/model/DateColumn.ts","webpack://LineUpJS/./src/ui/dialogs/ChangeRendererDialog.ts","webpack://LineUpJS/./node_modules/d3-scale-chromatic/src/categorical/category10.js","webpack://LineUpJS/./src/ui/dialogs/RenameDialog.ts","webpack://LineUpJS/./src/ui/dialogs/BooleanFilterDialog.ts","webpack://LineUpJS/./src/ui/dialogs/CategoricalFilterDialog.ts","webpack://LineUpJS/./src/ui/dialogs/CategoricalMappingFilterDialog.ts","webpack://LineUpJS/./src/ui/dialogs/CompositeChildrenDialog.ts","webpack://LineUpJS/./src/ui/dialogs/CutOffHierarchyDialog.ts","webpack://LineUpJS/./src/ui/dialogs/EditPatternDialog.ts","webpack://LineUpJS/./src/ui/dialogs/NumberFilterDialog.ts","webpack://LineUpJS/./src/ui/dialogs/ReduceDialog.ts","webpack://LineUpJS/./src/ui/dialogs/ScriptEditDialog.ts","webpack://LineUpJS/./src/ui/dialogs/SearchDialog.ts","webpack://LineUpJS/./src/ui/dialogs/StringFilterDialog.ts","webpack://LineUpJS/./src/ui/dialogs/WeightsEditDialog.ts","webpack://LineUpJS/./src/ui/dialogs/GroupDialog.ts","webpack://LineUpJS/./src/ui/dialogs/SortDialog.ts","webpack://LineUpJS/./node_modules/d3-scale-chromatic/src/categorical/Accent.js","webpack://LineUpJS/./node_modules/d3-scale-chromatic/src/categorical/Dark2.js","webpack://LineUpJS/./node_modules/d3-scale-chromatic/src/categorical/Pastel1.js","webpack://LineUpJS/./node_modules/d3-scale-chromatic/src/categorical/Pastel2.js","webpack://LineUpJS/./node_modules/d3-scale-chromatic/src/categorical/Set1.js","webpack://LineUpJS/./node_modules/d3-scale-chromatic/src/categorical/Set2.js","webpack://LineUpJS/./node_modules/d3-scale-chromatic/src/categorical/Set3.js","webpack://LineUpJS/./src/ui/dialogs/ColorMappingDialog.ts","webpack://LineUpJS/./src/ui/dialogs/MappingLineDialog.ts","webpack://LineUpJS/./src/ui/dialogs/MappingDialog.ts","webpack://LineUpJS/./src/ui/dialogs/DateFilterDialog.ts","webpack://LineUpJS/./src/ui/toolbar.ts","webpack://LineUpJS/./src/ui/dialogs/groupNumber.ts","webpack://LineUpJS/./src/ui/dialogs/groupString.ts","webpack://LineUpJS/./src/ui/dialogs/groupDate.ts","webpack://LineUpJS/./src/model/Group.ts","webpack://LineUpJS/./src/model/LinkColumn.ts","webpack://LineUpJS/./src/model/BoxPlotColumn.ts","webpack://LineUpJS/./src/model/RankColumn.ts","webpack://LineUpJS/./src/model/ArrayColumn.ts","webpack://LineUpJS/./src/internal/utils.ts","webpack://LineUpJS/./src/model/StackColumn.ts","webpack://LineUpJS/./src/internal/accessor.ts","webpack://LineUpJS/./src/internal/dnd.ts","webpack://LineUpJS/./src/ui/dialogs/MoreColumnOptionsDialog.ts","webpack://LineUpJS/./src/ui/header.ts","webpack://LineUpJS/./src/model/HierarchyColumn.ts","webpack://LineUpJS/./src/model/MapColumn.ts","webpack://LineUpJS/./src/model/DatesColumn.ts","webpack://LineUpJS/./src/ui/panel/SearchBox.ts","webpack://LineUpJS/./src/model/CompositeNumberColumn.ts","webpack://LineUpJS/./src/model/AggregateGroupColumn.ts","webpack://LineUpJS/./src/interfaces.ts","webpack://LineUpJS/./src/config.ts","webpack://LineUpJS/./src/model/IDateColumn.ts","webpack://LineUpJS/./src/ui/animation.ts","webpack://LineUpJS/./src/ui/RenderColumn.ts","webpack://LineUpJS/./src/ui/MultiLevelRenderColumn.ts","webpack://LineUpJS/./src/ui/SelectionManager.ts","webpack://LineUpJS/./src/ui/EngineRanking.ts","webpack://LineUpJS/./src/internal/debounce.ts","webpack://LineUpJS/./src/renderer/ActionRenderer.ts","webpack://LineUpJS/./src/renderer/AggregateGroupRenderer.ts","webpack://LineUpJS/./src/renderer/StringCellRenderer.ts","webpack://LineUpJS/./src/renderer/AnnotationRenderer.ts","webpack://LineUpJS/./src/renderer/impose.ts","webpack://LineUpJS/./src/renderer/BarCellRenderer.ts","webpack://LineUpJS/./src/renderer/DefaultCellRenderer.ts","webpack://LineUpJS/./src/renderer/BooleanCellRenderer.ts","webpack://LineUpJS/./src/renderer/BoxplotCellRenderer.ts","webpack://LineUpJS/./src/renderer/BrightnessCellRenderer.ts","webpack://LineUpJS/./src/renderer/CategoricalCellRenderer.ts","webpack://LineUpJS/./src/renderer/UpSetCellRenderer.ts","webpack://LineUpJS/./src/renderer/CategoricalHeatmapCellRenderer.ts","webpack://LineUpJS/./src/renderer/CategoricalStackedDistributionlCellRenderer.ts","webpack://LineUpJS/./src/renderer/CircleCellRenderer.ts","webpack://LineUpJS/./src/renderer/DotCellRenderer.ts","webpack://LineUpJS/./src/renderer/GroupCellRenderer.ts","webpack://LineUpJS/./src/renderer/ANumbersCellRenderer.ts","webpack://LineUpJS/./src/renderer/HeatmapCellRenderer.ts","webpack://LineUpJS/./src/ui/dialogs/InputNumberDialog.ts","webpack://LineUpJS/./src/renderer/HistogramCellRenderer.ts","webpack://LineUpJS/./src/renderer/ImageCellRenderer.ts","webpack://LineUpJS/./src/renderer/InterleavingCellRenderer.ts","webpack://LineUpJS/./src/renderer/LinkCellRenderer.ts","webpack://LineUpJS/./src/renderer/TableCellRenderer.ts","webpack://LineUpJS/./src/renderer/LinkMapCellRenderer.ts","webpack://LineUpJS/./src/renderer/LoadingCellRenderer.ts","webpack://LineUpJS/./src/renderer/MapBarCellRenderer.ts","webpack://LineUpJS/./src/renderer/RankCellRenderer.ts","webpack://LineUpJS/./src/renderer/SparklineCellRenderer.ts","webpack://LineUpJS/./src/renderer/VerticalBarCellRenderer.ts","webpack://LineUpJS/./src/renderer/DateCellRenderer.ts","webpack://LineUpJS/./src/renderer/index.ts","webpack://LineUpJS/./src/model/SelectionColumn.ts","webpack://LineUpJS/./src/model/IArrayColumn.ts","webpack://LineUpJS/./src/model/interfaces.ts","webpack://LineUpJS/./node_modules/d3-format/src/exponent.js","webpack://LineUpJS/./src/renderer/AAggregatedGroupRenderer.ts","webpack://LineUpJS/./src/renderer/MultiLevelCellRenderer.ts","webpack://LineUpJS/./node_modules/d3-color/src/color.js","webpack://LineUpJS/./src/model/ActionColumn.ts","webpack://LineUpJS/./src/model/GroupColumn.ts","webpack://LineUpJS/./src/model/OrdinalColumn.ts","webpack://LineUpJS/./node_modules/d3-color/src/define.js","webpack://LineUpJS/./node_modules/d3-interpolate/src/color.js","webpack://LineUpJS/./node_modules/d3-scale/src/init.js","webpack://LineUpJS/./node_modules/d3-collection/src/map.js","webpack://LineUpJS/./node_modules/d3-collection/src/set.js","webpack://LineUpJS/./node_modules/d3-scale/src/array.js","webpack://LineUpJS/./node_modules/d3-interpolate/src/numberArray.js","webpack://LineUpJS/./node_modules/d3-interpolate/src/array.js","webpack://LineUpJS/./node_modules/d3-interpolate/src/date.js","webpack://LineUpJS/./node_modules/d3-interpolate/src/number.js","webpack://LineUpJS/./node_modules/d3-interpolate/src/object.js","webpack://LineUpJS/./node_modules/d3-interpolate/src/string.js","webpack://LineUpJS/./node_modules/d3-interpolate/src/value.js","webpack://LineUpJS/./node_modules/d3-interpolate/src/round.js","webpack://LineUpJS/./node_modules/d3-scale/src/number.js","webpack://LineUpJS/./node_modules/d3-scale/src/continuous.js","webpack://LineUpJS/./node_modules/d3-scale/src/constant.js","webpack://LineUpJS/./node_modules/d3-scale/src/tickFormat.js","webpack://LineUpJS/./node_modules/d3-format/src/precisionPrefix.js","webpack://LineUpJS/./node_modules/d3-format/src/precisionRound.js","webpack://LineUpJS/./node_modules/d3-format/src/precisionFixed.js","webpack://LineUpJS/./node_modules/d3-scale/src/linear.js","webpack://LineUpJS/./node_modules/d3-scale/src/nice.js","webpack://LineUpJS/./node_modules/d3-scale/src/log.js","webpack://LineUpJS/./node_modules/d3-scale/src/pow.js","webpack://LineUpJS/./node_modules/d3-time/src/millisecond.js","webpack://LineUpJS/./node_modules/d3-scale/src/time.js","webpack://LineUpJS/./node_modules/d3-time/src/utcMonth.js","webpack://LineUpJS/./node_modules/d3-time/src/utcHour.js","webpack://LineUpJS/./node_modules/d3-time/src/utcMinute.js","webpack://LineUpJS/./node_modules/d3-scale/src/index.js","webpack://LineUpJS/./src/model/BooleanColumn.ts","webpack://LineUpJS/./src/model/ImpositionBoxPlotColumn.ts","webpack://LineUpJS/./src/model/ImpositionCompositeColumn.ts","webpack://LineUpJS/./src/model/ImpositionCompositesColumn.ts","webpack://LineUpJS/./src/model/LinkMapColumn.ts","webpack://LineUpJS/./src/provider/utils.ts","webpack://LineUpJS/./src/provider/LocalDataProvider.ts","webpack://LineUpJS/./src/ui/LineUp.ts","webpack://LineUpJS/./src/ui/dialogs/DialogManager.ts","webpack://LineUpJS/./src/ui/EngineRenderer.ts","webpack://LineUpJS/./node_modules/d3-format/src/formatPrefixAuto.js","webpack://LineUpJS/./node_modules/d3-format/src/defaultLocale.js","webpack://LineUpJS/./node_modules/d3-format/src/formatRounded.js","webpack://LineUpJS/./node_modules/d3-format/src/formatTypes.js","webpack://LineUpJS/./node_modules/d3-format/src/identity.js","webpack://LineUpJS/./node_modules/d3-format/src/locale.js","webpack://LineUpJS/./node_modules/d3-format/src/formatGroup.js","webpack://LineUpJS/./node_modules/d3-format/src/formatNumerals.js","webpack://LineUpJS/./node_modules/d3-format/src/formatTrim.js","webpack://LineUpJS/./src/model/ReduceColumn.ts","webpack://LineUpJS/./src/model/ScriptColumn.ts","webpack://LineUpJS/./src/ui/dialogs/AddonDialog.ts","webpack://LineUpJS/./src/ui/panel/Hierarchy.ts","webpack://LineUpJS/./src/ui/panel/SidePanelEntryVis.ts","webpack://LineUpJS/./src/ui/dialogs/RenameRankingDialog.ts","webpack://LineUpJS/./src/ui/dialogs/MoreRankingOptionsDialog.ts","webpack://LineUpJS/./src/ui/panel/SidePanelRanking.ts","webpack://LineUpJS/./src/ui/dialogs/ChooseRankingDialog.ts","webpack://LineUpJS/./src/ui/panel/SidePanel.ts","webpack://LineUpJS/./src/ui/SlopeGraph.ts","webpack://LineUpJS/./node_modules/d3-format/src/formatDecimal.js","webpack://LineUpJS/./src/internal/drag.ts","webpack://LineUpJS/./src/model/NestedColumn.ts","webpack://LineUpJS/./src/model/AnnotateColumn.ts","webpack://LineUpJS/./src/internal/merge.ts","webpack://LineUpJS/./node_modules/d3-interpolate/src/constant.js","webpack://LineUpJS/./src/renderer/SelectionRenderer.ts","webpack://LineUpJS/./src/browser.ts","webpack://LineUpJS/./src/ui/ALineUp.ts","webpack://LineUpJS/./src/ui/index.ts","webpack://LineUpJS/./src/provider/RemoteDataProvider.ts","webpack://LineUpJS/./src/provider/index.ts","webpack://LineUpJS/./src/model/MultiLevelCompositeColumn.ts","webpack://LineUpJS/./src/internal/OrderedSet.ts","webpack://LineUpJS/./src/provider/ACommonDataProvider.ts","webpack://LineUpJS/./src/ui/taggle/Taggle.ts","webpack://LineUpJS/./node_modules/fast-deep-equal/index.js","webpack://LineUpJS/./src/ui/taggle/TaggleRenderer.ts","webpack://LineUpJS/./src/ui/taggle/spaceFillingRule.ts","webpack://LineUpJS/./node_modules/d3-format/src/formatSpecifier.js","webpack://LineUpJS/./node_modules/d3-interpolate/src/basis.js","webpack://LineUpJS/./node_modules/d3-interpolate/src/rgb.js","webpack://LineUpJS/./node_modules/d3-interpolate/src/basisClosed.js","webpack://LineUpJS/./node_modules/d3-time/src/day.js","webpack://LineUpJS/./src/ui/dialogs/index.ts","webpack://LineUpJS/./src/ui/panel/index.ts","webpack://LineUpJS/./src/builder/column/ColumnBuilder.ts","webpack://LineUpJS/./src/builder/LineUpBuilder.ts","webpack://LineUpJS/./src/builder/RankingBuilder.ts","webpack://LineUpJS/./src/builder/DataBuilder.ts","webpack://LineUpJS/./src/builder/column/CategoricalColumnBuilder.ts","webpack://LineUpJS/./src/builder/column/NumberColumnBuilder.ts","webpack://LineUpJS/./src/builder/column/StringColumnBuilder.ts","webpack://LineUpJS/./src/builder/column/DateColumnBuilder.ts","webpack://LineUpJS/./src/builder/column/HierarchyColumnBuilder.ts","webpack://LineUpJS/./src/builder/column/ActionsColumnBuilder.ts","webpack://LineUpJS/./src/builder/adapter/column.ts","webpack://LineUpJS/./src/builder/adapter/ranking.ts","webpack://LineUpJS/./src/builder/adapter/utils.ts","webpack://LineUpJS/./src/builder/adapter/lineup.ts","webpack://LineUpJS/./src/builder/adapter/index.ts","webpack://LineUpJS/./src/builder/index.ts","webpack://LineUpJS/./node_modules/lodash.get/index.js","webpack://LineUpJS/./node_modules/detect-browser/index.js","webpack://LineUpJS/./src/index.ts","webpack://LineUpJS/./node_modules/reflect-metadata/Reflect.js","webpack://LineUpJS/./node_modules/d3-time/src/week.js","webpack://LineUpJS/./node_modules/d3-time/src/month.js","webpack://LineUpJS/./node_modules/d3-time/src/hour.js","webpack://LineUpJS/./node_modules/d3-time/src/minute.js","webpack://LineUpJS/./node_modules/d3-time/src/second.js","webpack://LineUpJS/./node_modules/d3-time/src/utcWeek.js","webpack://LineUpJS/./node_modules/d3-time/src/utcDay.js","webpack://LineUpJS/./node_modules/d3-time/src/year.js","webpack://LineUpJS/./node_modules/d3-time/src/utcYear.js","webpack://LineUpJS/./src/styles/_vars.scss"],"names":["root","factory","exports","module","define","amd","window","installedModules","__webpack_require__","moduleId","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","extendStatics","b","setPrototypeOf","__proto__","Array","__extends","__","this","constructor","__assign","assign","arguments","length","apply","__decorate","decorators","target","desc","getOwnPropertyDescriptor","Reflect","decorate","__spreadArrays","il","k","a","j","jl","id","width","parent","uid","renderer","type","groupRenderer","summaryRenderer","visible","metadata","label","description","Boolean","fixed","frozen","assignNewId","idGenerator","fqid","fqpath","indexOf","createEventList","concat","Column","EVENT_WIDTH_CHANGED","EVENT_LABEL_CHANGED","EVENT_METADATA_CHANGED","EVENT_VISIBILITY_CHANGED","EVENT_SUMMARY_RENDERER_TYPE_CHANGED","EVENT_RENDERER_TYPE_CHANGED","EVENT_GROUP_RENDERER_TYPE_CHANGED","EVENT_DIRTY","EVENT_DIRTY_HEADER","EVENT_DIRTY_VALUES","on","listener","getWidth","hide","setVisible","show","isVisible","getVisible","fire","flatten","offset","_levelsToGo","_padding","w","push","col","setWidth","setWidthImpl","setMetaData","bak","getMetaData","sortByMe","ascending","priority","findMyRanker","sortBy","groupByMe","toggleGrouping","isGroupedBy","getGroupCriteria","toggleMySorting","toggleSorting","isSortedByMeImpl","selector","ranker","asc","undefined","criterias","index","findIndex","isSortedByMe","getSortCriteria","groupSortByMe","groupSortBy","toggleMyGroupSorting","toggleGroupSorting","isGroupSortedByMe","getGroupSortCriteria","removeMe","remove","attach","detach","insertAfterMe","insertAfter","dump","toDescRef","getRenderer","getGroupRenderer","getSummaryRenderer","restore","_factory","rendererType","getLabel","row","String","getValue","_row","getExportValue","format","getColor","DEFAULT_COLOR","isMissing","compare","_a","_b","group","groupCompare","toLowerCase","localeCompare","isFiltered","filter","setRenderer","setDefaultRenderer","setGroupRenderer","setDefaultGroupRenderer","setSummaryRenderer","setDefaultSummaryRenderer","setDefaultWidth","markDirty","FLAT_ALL_COLUMNS","supportType","for","category","SupportType","SortByDefault","order","isSortingAscByDefault","clazz","hasMetadata","string","featureLevel","categorical","number","date","array","map","composite","support","other","categories","Categories","Category","cat","toolbar","keys","dialogAddons","cache","Map","isSupportType","categoryOf","getMetadata","getPrototypeOf","categoryOfDesc","models","getAllToolbarActions","has","actions","obj","toolbarIcon","getOwnMetadata","set","getAllToolbarDialogAddons","cacheKey","symbol","ESortMethod","EAdvancedSortMethod","DEFAULT_FORMATTER","isNumberColumn","getNumber","match","compareBoxPlot","aVal","getBoxPlotData","bVal","method","getSortMethod","numberCompare","getBoxPlotNumber","data","getRawBoxPlotData","NaN","isBoxPlotColumn","isNumbersColumn","getNumbers","aMissing","bMissing","isNaN","noNumberFilter","min","Infinity","max","filterMissing","isEqualNumberFilter","isNumberIncluded","isFinite","isDummyNumberFilter","restoreNumberFilter","v","attr","node","attrs","styles","text","forEach","getAttribute","setAttribute","style","getPropertyValue","setProperty","setText","noop","noRenderer","template","update","render","textContent","callback","from","querySelectorAll","forEachChild","children","matchColumns","columns","childElementCount","every","dataset","columnId","column","rendererId","idsAndRenderer","Set","idAndRenderer","removeChild","cnode","querySelector","insertAdjacentHTML","lastElementChild","appendChild","innerHTML","join","wideEnough","labels","adaptTextColorToBgColor","bgColor","adaptDynamicColorToBgColor","title","adapt","color","innerText","console","assert","ownerDocument","span","createElement","classList","add","idCounter","uniqueId","prefix","toString","exampleText","rows","examples","specifier","colors","slice","currentFilter","numberFormat","currentGroupThresholds","groupSortMethod","median","mapping","original","clone","colorMapping","missingValue","NumberColumn","getNumberFormat","stratifyThreshholds","domain","range","stratifyThresholds","EVENT_MAPPING_CHANGED","EVENT_COLOR_MAPPING_CHANGED","EVENT_FILTER_CHANGED","EVENT_SORTMETHOD_CHANGED","EVENT_GROUPING_CHANGED","raw","getRawValue","getRange","getRawNumber","getOriginalMapping","getMapping","setMapping","eq","getColorMapping","setColorMapping","getFilter","setFilter","getGroupThresholds","setGroupThresholds","threshold","treshholdIndex","setSortMethod","sortMethod","isMissingValue","isArray","isUnknown","FIRST_IS_NAN","FIRST_IS_MISSING","missingGroup","getStyle","defaultValue","COLUMN_PADDING","parseInt","DASH","height","UPSET","circle","inactive","parseFloat","stroke","DOT","size","opacity","BOX_PLOT","box","sort","outlier","AGGREGATE","strokeWidth","SLOPEGRAPH_WIDTH","CANVAS_HEIGHT","ERenderMode","renderMissingValue","ctx","x","y","dashX","Math","dashY","fillStyle","fillRect","renderMissingDOM","missing","toggle","renderMissingCanvas","maxSortCriteria","maxGroupColumns","sortCriteria","groupSortCriteria","groupColumns","comparator","groupComparator","grouper","g","groups","gi","dirtyOrder","Ranking","EVENT_DIRTY_ORDER","startsWith","EVENT_GROUPS_CHANGED","EVENT_ADD_COLUMN","EVENT_REMOVE_COLUMN","EVENT_GROUP_CRITERIA_CHANGED","EVENT_MOVE_COLUMN","EVENT_GROUP_SORT_CRITERIA_CHANGED","EVENT_COLUMN_VISIBILITY_CHANGED","EVENT_SORT_CRITERIA_CHANGED","EVENT_ORDER_CHANGED","setLabel","setOrder","setGroups","old","getOrder","oldGroups","getGroups","clear","child","sortColumn","help","find","groupBy","restoreSortCriteria","dumped","setSortCriteria","setGroupSortCriteria","levelsToGo","padding","acc","getPrimarySortCriteria","toggleSortingLogic","newSort","current","defaultAsc","splice","newGroupings","setGroupCriteria","hierarchyLogic","entries","entry","values","equalCriteria","triggerResort","cols","groupColumn","setMaxSortCriteria","getMaxSortCriteria","setMaxGroupColumns","getMaxGroupColumns","triggerGroupResort","sortCriterias","bakMulti","insert","forward","oldValue","newValue","move","error","moveAfter","reference","findByPath","indices","split","Number","shift","at","ref","unforward","isSortCriteria","sortCriteriaChanged","isGroupSortCriteria","groupSortCriteriaChanged","newGrouping","isGroupColumn","removed","idOrFilter","flatColumns","some","ai","bi","f","left","lo","hi","mid","right","ascendingBisect","bisector","bisectRight","bisect","valueof","start","stop","step","ceil","e10","sqrt","e5","e2","reverse","ticks","count","tickIncrement","floor","power","log","LN10","pow","tickStep","step0","abs","step1","LN2","identity","extent","sturges","histogram","xz","x0","x1","tz","pop","bin","bins","_","constant","thresholds","i0","value0","sum","numbers","quantile","dispatch","test","Error","Dispatch","parseTypenames","typenames","types","trim","typename","T","copy","that","args","suffix","events","listenerEvents","listeners","forwarder","fireImpl","primaryType","origin","listenersChanged","_type","_active","context","source","isBrowser","document","navigator","timeoutDuration","longerTimeoutBrowsers","userAgent","debounce","Promise","fn","called","resolve","then","scheduled","setTimeout","isFunction","functionToCheck","getStyleComputedProperty","element","nodeType","css","defaultView","getComputedStyle","getParentNode","nodeName","parentNode","host","getScrollParent","body","_getStyleComputedProp","overflow","overflowX","overflowY","getReferenceNode","referenceNode","isIE11","MSInputMethodContext","documentMode","isIE10","isIE","version","getOffsetParent","documentElement","noOffsetParent","offsetParent","nextElementSibling","getRoot","findCommonOffsetParent","element1","element2","compareDocumentPosition","Node","DOCUMENT_POSITION_FOLLOWING","end","createRange","setStart","setEnd","commonAncestorContainer","contains","firstElementChild","element1root","getScroll","side","upperSide","html","scrollingElement","includeScroll","rect","subtract","scrollTop","scrollLeft","modifier","top","bottom","getBordersSize","axis","sideA","sideB","getSize","computedStyle","getWindowSizes","classCallCheck","instance","Constructor","TypeError","createClass","defineProperties","props","descriptor","configurable","writable","protoProps","staticProps","_extends","getClientRect","offsets","getBoundingClientRect","e","result","sizes","clientWidth","clientHeight","horizScrollbar","offsetWidth","vertScrollbar","offsetHeight","getOffsetRectRelativeToArbitraryNode","fixedPosition","isHTML","childrenRect","parentRect","scrollParent","borderTopWidth","borderLeftWidth","marginTop","marginLeft","getViewportOffsetRectRelativeToArtbitraryNode","excludeScroll","relativeOffset","innerWidth","innerHeight","isFixed","getFixedPositionOffsetParent","parentElement","el","getBoundaries","popper","boundariesElement","boundaries","boundariesNode","_getWindowSizes","isPaddingNumber","getArea","_ref","computeAutoPlacement","placement","refRect","rects","sortedAreas","area","filteredAreas","_ref2","computedPlacement","variation","getReferenceOffsets","state","commonOffsetParent","getOuterSizes","marginBottom","marginRight","getOppositePlacement","hash","replace","matched","getPopperOffsets","referenceOffsets","popperRect","popperOffsets","isHoriz","mainSide","secondarySide","measurement","secondaryMeasurement","arr","check","runModifiers","modifiers","ends","prop","cur","warn","enabled","isDestroyed","arrowStyles","attributes","flipped","options","positionFixed","flip","originalPlacement","position","isCreated","onUpdate","onCreate","isModifierEnabled","modifierName","getSupportedPropertyName","prefixes","upperProp","charAt","toUpperCase","toCheck","destroy","removeAttribute","willChange","disableEventListeners","removeOnDestroy","getWindow","setupEventListeners","updateBound","addEventListener","passive","scrollElement","attachToScrollParents","event","scrollParents","isBody","eventsEnabled","enableEventListeners","scheduleUpdate","cancelAnimationFrame","removeEventListener","isNumeric","setStyles","unit","isFirefox","isModifierRequired","requestingName","requestedName","requesting","isRequired","_requesting","requested","placements","validPlacements","clockwise","counter","BEHAVIORS","parseOffset","basePlacement","useHeight","fragments","frag","divider","search","splitRegex","ops","op","mergeWithPrevious","reduce","str","toValue","index2","Defaults","shiftvariation","_data$offsets","isVertical","shiftOffsets","preventOverflow","transformProp","popperStyles","transform","primary","escapeWithReference","secondary","keepTogether","opSide","arrow","_data$offsets$arrow","arrowElement","len","sideCapitalized","altSide","arrowElementSize","center","popperMarginSide","popperBorderSide","sideValue","round","placementOpposite","flipOrder","behavior","refOffsets","overlapsRef","overflowsLeft","overflowsRight","overflowsTop","overflowsBottom","overflowsBoundaries","flippedVariationByRef","flipVariations","flippedVariationByContent","flipVariationsByContent","flippedVariation","getOppositeVariation","inner","subtractLength","bound","computeStyle","legacyGpuAccelerationOption","gpuAcceleration","offsetParentRect","shouldRound","noRound","referenceWidth","popperWidth","isVariation","horizontalToInteger","verticalToInteger","getRoundedOffsets","devicePixelRatio","prefixedProperty","invertTop","invertLeft","applyStyle","onLoad","modifierOptions","Popper","_this","requestAnimationFrame","jquery","Utils","global","PopperUtils","dialog","fullDialog","resetPossible","toggleDialog","attachment","level","equals","open","manager","removeLike","build","closest","merge","auto","self","focus","reset","onclick","evt","stopPropagation","preventDefault","onsubmit","checkValidity","submit","cancel","findInput","EAlignment","EStringGroupCriteriaType","currentGroupCriteria","alignment","escape","StringColumn","RegExp","groupCriteria","regex","FILTER_MISSING","aValue","bValue","rowValue","groupValue","toScale","clamp","exponent","isMapAbleColumn","isSame","fixDomain","invert","ScaleMappingFunction","_code","Function","code","value_min","value_max","value_range","value_domain","linear","mi","ma","ScriptMappingFunction","createMappingFunction","restoreMapping","rankings","selection","aggregations","createHelper","fromDescRef","fixDesc","columnTypes","multiSelections","multiSelection","ADataProvider","EVENT_ADD_RANKING","EVENT_REMOVE_RANKING","EVENT_SELECTION_CHANGED","EVENT_ADD_DESC","EVENT_CLEAR_DESC","EVENT_JUMP_TO_NEAREST","EVENT_GROUP_AGGREGATION_CHANGED","pushRanking","existing","cloneRanking","insertRanking","takeSnapshot","ranking","hasString","hasColumn","toClone","triggerReorder","removeRanking","cleanUpRanking","clearRankings","getRankings","getFirstRanking","getLastRanking","ensureOneRanking","_ranking","nextId","accessor","rankAccessor","isSelected","setter","select","deselect","setterAll","selectAll","deselectAll","isAggregated","setAggregated","dumpColumn","restoreColumn","getSelection","descRef","restoreRanking","layout","deriveRanking","bundle","toCol","findDesc","unaggregateParents","delete","aggregateAllOf","aggregateAll","jumpToNearest","selectAllOf","setSelection","clearSelection","toggleSelection","additional","selectedRows","view","exportTable","EVENT_AGGREGATE","lookup","missingCategory","CategoricalColumn","getCategory","vs","getValues","getLabels","getMap","cats","getMapLabel","getSet","getNumberOfBins","scale","histGen","sorted","hist","q1","q3","whiskerLow","sortedMapped","whiskerHigh","_target","propertyKey","computeStats","mean","maxBin","LazyBoxPlotData","computeHist","missingCount","precision","similar","delta","ArrayColumn","parseValue","getCategories","MapColumn","dateFormat","parse","dateParse","DatesMapColumn","Date","getDates","getDate","DatesColumn","DateColumn","NumberMapColumn","separator","SetColumn","normalize","sv","av","bv","ValueColumn","StringMapColumn","StringsColumn","patternFunction","pattern","patternTemplates","LinksColumn","setPattern","LinkColumn","getPattern","EVENT_PATTERN_CHANGED","getLinks","href","alt","transformValue","defineColumn","functions","init","CustomColumn","ActionColumn","aggregate","AggregateGroupColumn","annotate","AnnotateColumn","boolean","BooleanColumn","booleans","boxplot","BoxPlotColumn","categoricalMap","categoricals","dateMap","dates","GroupColumn","hierarchy","HierarchyColumn","imposition","ImpositionCompositeColumn","impositionBoxPlot","ImpositionBoxPlotColumn","impositions","ImpositionCompositesColumn","ReduceColumn","nested","NestedColumn","NumbersColumn","numberMap","ordinal","OrdinalColumn","rank","RankColumn","script","ScriptColumn","SelectionColumn","stack","StackColumn","stringMap","strings","link","linkMap","LinkMapColumn","links","loaded","lazyLoaded","EVENT_DATA_LOADED","isLoaded","getRaw","setLoaded","RENDERER_LOADING","isSetColumn","toCategory","nextColor","compareCategory","aNull","bNull","findMostFrequent","topCat","topCount","groupCompareCategory","aMostFrequent","bMostFrequent","toCategories","isCategoricalColumn","isEmptyFilter","isEqualCategoricalFilter","al","bl","arrayEquals","isCategoryIncluded","filterObj","includes","t0","t1","newInterval","floori","offseti","field","interval","d0","d1","previous","setTime","durationSecond","durationMinute","durationHour","durationDay","durationWeek","isMultiLevelColumn","_children","CompositeColumn","canJustAddNumbers","insertImpl","moveImpl","oldIndex","removeImpl","joinGroups","parents","subGroups","toGroupID","unifyParents","colorPool","act","medianIndex","va","vb","scheme","ramp","deg2rad","PI","rad2deg","A","B","C","D","E","ED","EB","BC_DA","cubehelixConvert","Cubehelix","h","atan2","brighter","darker","rgb","cosh","cos","sinh","sin","hue","cubehelixGamma","cubehelix","gamma","cubehelixLong","warm","cool","magma","inferno","plasma","SolidColorFunction","base","steps","perStep","quantize","QuantizedColorFunction","CustomColorMappingFunction","asColorFunction","DEFAULT_COLOR_FUNCTION","sequentialColors","divergentColors","lookupInterpolatingColor","sequential","interpolateBlues","interpolateGreens","interpolateGreys","interpolateOranges","interpolatePurples","interpolateReds","interpolateCool","interpolateCubehelixDefault","interpolateWarm","interpolatePlasma","interpolateMagma","interpolateViridis","interpolateInferno","interpolateYlOrRd","interpolateYlOrBr","interpolateBuGn","interpolateBuPu","interpolateGnBu","interpolateOrRd","interpolatePuBuGn","interpolatePuBu","interpolatePuRd","interpolateRdPu","interpolateYlGnBu","interpolateYlGn","interpolateRainbow","ts","divergent","interpolateBrBG","interpolatePRGn","interpolatePiYG","interpolatePuOr","interpolateRdBu","interpolateRdGy","interpolateRdYlBu","interpolateRdYlGn","interpolateSpectral","InterpolatingColorFunction","createColorMappingFunction","restoreColorMapping","dataLength","getRawNumbers","CENTER","filterMissingMarkup","bakMissing","idPrefix","filterMissingNumberMarkup","findFilterMissing","previousElementSibling","updateFilterMissingNumberMarkup","checked","disabled","default","race","abort","catch","lastFilled","key2index","exceptions","findValidStart","posByKey","pos","fillCacheTillKey","defaultRowHeight","fillCache","heightOf","exceptionsLookup","exceptionHeightOf","numberOfRows","positions","u","nodeY","UPDATE","UPDATE_CREATE","UPDATE_REMOVE","SHOW","HIDE","delay","animation","totalHeight","now","first","last","firstRowPos","endPos","y2","R","O","added","common","NONE","ALL","SOME","SOME_BOTTOM","SOME_TOP","handlers","animationWaiting","immediateTimeout","timersWaiting","prevs","handle","handleAnimation","handleImmediate","handleTimeouts","asInfo","setImmediate","__le_scroller__","pool","loadingPool","loading","forcedFirst","forcedLast","visibleFirstRowPos","scrollListener","abortAnimation","async","minScrollDelta","mixins","scrollingHint","batchSize","adapter","createAdapter","fragment","createDocumentFragment","addMixin","addAtBeginning","addAtBottom","removeFromBeginning","removeFromBottom","updateOffset","scroller","bodyScroller","tagName","insertBefore","firstChild","onScrolledVertically","recreate","cleanUp","updateRow","createRow","item","selectProxy","recycle","proxy","replaceChild","removeAll","forEachRow","lastChild","updateSizer","toFixed","bodySizer","recreateAnimated","recreatePure","clearPool","previousKey","currentKey","nodeYCurrentHeight","animate","phases","offsetTop","endsWith","clearTimeout","revalidate","onScrolledImpl","onScrolled","shiftLast","shiftFirst","S","rules","updateRules","addRule","updateRule","deleteRule","P","H","M","hashedId","tableIds","header","updateColumns","ruleNames","F","tableId","cellPool","visibleColumns","visibleFirstColumnPos","columnAdapter","createColumnAdapter","columnMixins","columnFragment","leftShift","addColumnMixin","addColumnAtStart","addColumnAtEnd","removeColumnFromStart","removeColumnFromEnd","updateColumnOffset","headerScroller","syncFrozen","onScrolledHorizontally","onScrolledHorizontallyImpl","removeCellFromStart","recycleCell","removeCellFromEnd","removeFrozenCells","removeFrozenColumns","removeAllColumns","removeAllCells","selectCell","updateCell","createCell","addCellAtStart","insertFrozenCells","insertFrozenColumns","addCellAtEnd","verifyRows","updateHeaders","updateHeader","createHeader","mergeColumns","z","cell","updateColumnWidths","updateShifts","L","prefetchTimeout","cleanupTimeout","prefetchRows","cleanUpRows","prefetchDown","prefetchUp","triggerPrefetch","cleanUpTop","cleanUpBottom","triggerCleanUp","hidden","onVisibilityChanged","sections","columnPadding","main","pushTable","doc","pushSeparator","widthChanged","I","IColumn","updateFilterState","filtered","active","sortMethods","methods","colorOf","localDate","setFullYear","utcDate","UTC","setUTCFullYear","newDate","timeFormat","timeParse","utcFormat","pads","numberRe","percentRe","requoteRe","pad","fill","sign","requote","formatRe","names","formatLookup","parseWeekdayNumberSunday","exec","parseWeekdayNumberMonday","parseWeekNumberSunday","U","parseWeekNumberISO","V","parseWeekNumberMonday","W","parseFullYear","parseYear","parseZone","Z","parseQuarter","q","parseMonthNumber","parseDayOfMonth","parseDayOfYear","parseHour24","parseMinutes","parseSeconds","parseMilliseconds","parseMicroseconds","parseLiteralPercent","parseUnixTimestamp","Q","parseUnixTimestampSeconds","formatDayOfMonth","formatHour24","getHours","formatHour12","formatDayOfYear","formatMilliseconds","getMilliseconds","formatMicroseconds","formatMonthNumber","getMonth","formatMinutes","getMinutes","formatSeconds","getSeconds","formatWeekdayNumberMonday","day","getDay","formatWeekNumberSunday","formatWeekNumberISO","formatWeekdayNumberSunday","formatWeekNumberMonday","formatYear","getFullYear","formatFullYear","formatZone","getTimezoneOffset","formatUTCDayOfMonth","getUTCDate","formatUTCHour24","getUTCHours","formatUTCHour12","formatUTCDayOfYear","utcDay","utcYear","formatUTCMilliseconds","getUTCMilliseconds","formatUTCMicroseconds","formatUTCMonthNumber","getUTCMonth","formatUTCMinutes","getUTCMinutes","formatUTCSeconds","getUTCSeconds","formatUTCWeekdayNumberMonday","dow","getUTCDay","formatUTCWeekNumberSunday","formatUTCWeekNumberISO","formatUTCWeekdayNumberSunday","formatUTCWeekNumberMonday","formatUTCYear","getUTCFullYear","formatUTCFullYear","formatUTCZone","formatLiteralPercent","formatUnixTimestamp","formatUnixTimestampSeconds","locale","locale_dateTime","dateTime","locale_date","locale_time","time","locale_periods","periods","locale_weekdays","days","locale_shortWeekdays","shortDays","locale_months","months","locale_shortMonths","shortMonths","periodRe","periodLookup","weekdayRe","weekdayLookup","shortWeekdayRe","shortWeekdayLookup","monthRe","monthLookup","shortMonthRe","shortMonthLookup","formats","utcFormats","parses","parseSpecifier","newFormat","charCodeAt","newParse","week","X","utcParse","formatLocale","currentGrouper","getTime","getDateGrouper","setDateGrouper","choose","trueMedian","currentGroup","currentSummary","summary","ADialog","before","newDescription","updateFilter","isTrue","isFalse","onchange","input","noFilter","joint","oninput","items","random","substr","createChildren","mergeDropAble","resizeable","className","summaryNode","statsOf","innerNodes","innerNodePaths","path","getCutOff","maxDepth","setCustomValidity","setCutOff","newNode","newNodeIndex","maxDepthText","templates","interactive","wrapper","getReduce","setReduce","getScript","setScript","provider","checkbox","searchAndJump","isRegex","valid","weights","getWeights","setWeights","weight","addons","getToolbarDialogAddons","addon","append","updateDisabled","disable","trigger","sortOrder","gradient","isCustom","continuouos","quantized","toggles","updateGradients","t2","customs","custom","s0","s1","dm1","toColor","background","stepSize","half","steppedGradient","interpolate","line","unnormalizeRaw","normalizeRaw","container","button","shiftKey","onStart","normalized","onEnd","updated","drag","onDrag","domainCircle","rangeCircle","destroyed","mappingLines","loadedData","mappingAdapter","updateLines","computeScale","rawDomain","mappingSample","scaleType","others","bb","currentTarget","copyMapping","createMappings","selectedIndex","applyMapping","newScale","valueAsDate","to","ui","onClick","dialogContext","dialogManager","uiDialog","dialogClass","extraArgs","uiSortMethod","removeAboveLevel","ctrlKey","isAscByDefault","next","shortcut","featureCategory","sortGroupBy","rename","vis","_evt","collapse","mcol","setCollapsed","getCollapsed","toolbarAddons","sortNumber","sortNumbers","sortBoxPlot","sortDates","sortGroup","groupNumber","isThreshold","groupString","valueRadioButton","startsWithRadioButton","regexRadioButton","showOrHideTextarea","display","newType","invalid","reportValidity","groupDate","granularity","circular","toolbarActions","filterNumber","filterDate","filterString","filterCategorical","filterOrdinal","filterBoolean","colorMapped","cutoff","editMapping","editPattern","editWeights","compositeContained","splitCombined","invertSelection","ss","sortActions","cacheAddon","getFullToolbar","icons","possible","getPossibleRenderer","getToolbar","flags","advancedModelFeatures","advancedRankingFeatures","advancedUIFeatures","isSortAble","isGroupAble","isGroupSortAble","defaultGroup","getLink","createRankDesc","_dataLength","originalLabels","_d","splicer","setSplicer","EVENT_SPLICE_CHANGED","getSplicer","equal","findOption","substring","equalArrays","fixCSS","createStackDesc","collapsed","adaptChange","adaptWidthChange","EVENT_COLLAPSE_CHANGED","EVENT_WEIGHTS_CHANGED","EVENT_MULTI_LEVEL_CHANGED","full","oldWeight","factor","widths","guess","compute","COLLAPSED_RENDERER","resolveValue","hasDnDType","dataTransfer","available","typesToCheck","dndTransferStorage","isEdgeDnD","updateDropEffect","dT","effectAllowed","copyDnD","dropEffect","dropAble","mimeTypes","onDrop","onDragOver","effect","getData","mime","createToolbarMenuItems","updateIconState","dragAble","rearrangeAble","createShortcutMenuItems","toggleToolbarIcons","dragAbleColumn","resolveDrop","MIMETYPE_PREFIX","alternative","JSON","pushChild","mergeImpl","mergeWith","all","numberish","draginfo","toInsertParent","rearrangeDropAble","ueberElement","mouseMove","clientX","mouseUp","onmousedown","dragWidth","colId","typeCat","sortGroups","groupedBy","addIconDOM","showLabel","action","setHighlightColumn","willAutoHide","addIcon","shortcuts","hybrids","moreEntries","defaultVisibleClientWidth","rotated","scrollWidth","toggleRotatedHeader","availableWidth","shortCuts","moreIcon","needMore","total","onDragStart","draggable","payload","setData","over","stringify","currentMaxDepth","currentLeaves","currentLeavesNameCache","currentLeavesPathCache","hierarchySeparator","initHierarchy","currentNode","computeLeaves","updateCaches","EVENT_CUTOFF_CHANGED","leaves","visit","depth","resolveInnerNodes","queue","isHierarchical","deriveHierarchy","byKey","toKeyValue","EDateSort","formatItem","placeholder","onfocus","onblur","blur","onkeydown","handleKey","buildDialog","isItem","onmouseenter","highlighted","onmouseleave","ul","KEYS","which","click","highlightPrevious","highlightNext","SearchBox","EVENT_SELECT","filterResults","empty","allChildrenHidden","CompositeNumberColumn","createAggregateDesc","DENSE_HISTOGRAM","MIN_LABEL_WIDTH","HOVER_DELAY_SHOW_DETAIL","defaultOptions","renderers","labelRotation","summaryHeader","animated","expandLineOnHover","sidePanel","sidePanelCollapsed","hierarchyIndicator","defaultSlopeGraphMode","overviewMode","rowHeight","groupHeight","groupPadding","rowPadding","levelOfDetail","customRowUpdate","dynamicHeight","disableFrozenColumns","ignoreUnsupportedBrowser","isDateColumn","isDateIncluded","defaultDateGrouper","isDefaultDateGrouper","toDateGroup","centuryP","century","decadeP","decade","year","toGroupLookup","item2groupIndex","group2firstItemIndex","relativeIndex","toKey","lineupAnimation","previousData","currentData","prevHelper","currHelper","previousFinder","currentRowIndex","referenceIndex","appearPosition","_previousFinder","currentFinder","previousRowIndex","removePosition","singleRenderer","single","singleTemplate","cloneNode","elem","asElement","singleId","groupTemplate","groupId","summaryTemplate","summaryId","isGroup","oldRenderer","currentRenderer","oldGroup","getGroup","getRow","renderCell","helper","summaries","mc","cc","gridColumnStart","updateNested","updateWidthRule","sub","hr","showHint","startNode","elementFromPoint","clientY","endNode","xShift","yShift","SelectionManager","EVENT_SELECT_RANGE","startIndex","endIndex","sy","ey","MIN_DISTANCE","dataIndex","relIndex","selectRange","OrderedSet","updateState","selectedDataIndices","AEventDispatcher","RankingEvents","EVENT_UPDATE_DATA","EVENT_UPDATE_HIST","EVENT_HIGHLIGHT_CHANGED","roptions","highlight","canvasPool","oldLeft","canvasMouseHandler","timer","enter","leave","updateHoveredRow","EngineRanking","isCanvasRenderedRow","highlightHandler","delayedUpdate","updateBody","delayedUpdateAll","updateAll","delayedUpdateColumnWidths","createCol","reindex","updateHist","disableListener","_oldValue","renderCtx","_context","createRenderer","_document","selectCanvas","rowFlags","rowany","__lu__","visibleRenderedWidth","renderRow","canvas","getContext","imageSmoothingEnabled","clearRect","save","translate","updateCanvasCell","rowIndex","updateHeaderOf","agg","meta","lod","forcedLod","computedLod","wasLod","wasGroup","canvas2","updateCanvasBody","enableHighlightListening","enable","hover","inplace","updateSelection","updateColumn","after","groupData","toMeta","rowContext","totalNumberOfRows","setHighlight","findNearest","dataIndices","lookFor","firstBeforePos","firstAfterPos","nearestPos","scrollIntoView","regular","posOf","scrollHeight","found","getHighlight","debounceUpdate","timeToDelay","tm","canRender","SUMMARY","icon","ni","createGroup","groupActions","createSummary","colWidth","_i","align","_group","interactiveSummary","form","actCol","StringCellRenderer","setValue","imposer","valueHint","renderValue","CELL","_hist","bar","backgroundColor","groupTitle","summaryTitle","_col","_mode","sortedByMe","renderDOMBoxPlot","topPadding","strokeStyle","beginPath","bottomPos","middlePos","moveTo","lineTo","renderBoxPlot","createAggregatedBoxPlot","BoxplotCellRenderer","_comtext","_interactive","hasRange","computeLabel","whiskers","leftWhisker","rightWhisker","outliers","numOutliers","unshift","insertAdjacentElement","toHeatMapColor","valueColor","globalHist","filterUpdate","interactiveHist","staticSummary","showLabels","without","contained","calculateSetPath","cellDimension","catindexes","createDOMContext","templateRows","templateRow","hasTrueValues","posx","globalAlpha","union","visibility","stackedBar","flexGrow","getDOMRenderer","dots","tmp","vi","_v","boxRaw","createContext","mover","percent","offsetX","onmousemove","ioptions","guessedBins","createHist","getHistDOMRenderer","formatter","filterMin","filterMax","minHint","maxHint","minValue","unpercent","maxValue","dialogCtx","minDelta","px","initFilter","stats","nodes","backgroundImage","grouped","dummyBin","groupedHist","LinkCellRenderer","createFixed","TableCellRenderer","example","createFixedGroup","groupByKey","getLinkMap","LinkMapCellRenderer","fromTSpan","toTSpan","moveNext","yPos","repeat","matchRows","zero","one","xpos","isGrouped","chosen","defaultCellRenderer","brightness","catdistributionbar","dot","heatmap","catheatmap","image","interleaving","MultiLevelCellRenderer","mapbars","SelectionRenderer","sparkline","table","upset","verticalbar","chooseRenderer","chooseGroupRenderer","chooseSummaryRenderer","possibleRenderer","GROUP","possibleGroupRenderer","possibleSummaryRenderer","createSelectionDesc","setImpl","setValues","toggleValue","SELECTED_GROUP","NOT_SELECTED_GROUP","isMapColumn","isArrayColumn","aggregatedIndex","gridClass","createFlatColumnData","stacked","useGrid","option","missingWeight","ci","stackShift","Color","reI","reN","reP","reHex","reRgbInteger","reRgbPercent","reRgbaInteger","reRgbaPercent","reHslPercent","reHslaPercent","named","aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkgrey","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dimgrey","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","grey","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightslategrey","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","rebeccapurple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","slategrey","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen","color_formatHex","formatHex","color_formatRgb","formatRgb","rgbn","Rgb","rgba","hsla","rgbConvert","rgb_formatHex","hex","rgb_formatRgb","Hsl","hslConvert","hsl","hsl2rgb","m1","m2","channels","displayable","formatHsl","createActionDesc","EGroupSortMethod","createGroupDesc","extend","definition","nogamma","exponential","initRange","each","proto","isNumberArray","ArrayBuffer","isView","DataView","genericArray","nb","na","reA","reB","am","bm","bs","lastIndex","numberArray","valueOf","clamper","bimap","r0","r1","polymap","unknown","transformer","untransform","piecewise","output","rescale","rangeRound","continuous","formatSpecifier","precisionPrefix","precisionRound","precisionFixed","linearish","tickFormat","nice","i1","transformLog","transformExp","exp","transformLogn","transformExpn","pow10","reflect","loggish","logs","pows","log10","log2","logp","powp","transformPow","transformSqrt","transformSquare","powish","utcMonth","setUTCDate","setUTCHours","setUTCMonth","utcHour","setUTCMinutes","duration","utcMinute","setUTCSeconds","trueMarker","GROUP_TRUE","GROUP_FALSE","createImpositionBoxPlotDesc","createImpositionDesc","createImpositionsDesc","cleanCategories","deriveType","categoricalThreshold","deriveColumnDescriptions","config","deriveColors","exportRanking","opts","newline","quote","quoteChar","verboseColumnHeaders","_data","filterGlobally","jumpToSearchResult","maxNestedSortingCriteria","_dataRows","toRows","reorderAll","getTotalNumberOfRows","getMaxNestedSortingCriteria","clearData","appendData","sortImpl","ga","gb","rowGroup","viewRaw","viewRawRows","fetch","orders","getD","isBrowserSupported","panel","collapseable","pushUpdateAble","setDataProvider","escKeyListener","removeLast","openDialogs","mask","clipPath","clearHighlight","takeDown","setUp","histCache","slopeGraphs","updateAbles","zoomFactor","enabledHighlightListening","useGridLayout","toDisable","initProvider","zoomOut","updateZoomFactor","zoomIn","fontSize","updateAble","EngineRenderer","takeDownProvider","addRanking","setHighlightToNearest","histo","SlopeGraph","BAND","ITEM","updateRotatedHeaderState","section","slope","localData","round2","defaultHeight","updateSlopeGraphs","leftRanking","rightRanking","rebuild","nearest","prefixExponent","formatDecimal","coefficient","toExponential","toPrecision","formatRounded","grouping","thousands","currencyPrefix","currency","currencySuffix","decimal","numerals","formatNumerals","minus","nan","comma","formatTypes","formatType","maybeSuffix","valuePrefix","valueSuffix","valueNegative","out","formatTrim","formatPrefix","createReduceDesc","selected","EVENT_REDUCE_CHANGED","DEFAULT_SCRIPT","createScriptDesc","allFactory","_all","byName","byID","byIndex","EVENT_SCRIPT_CHANGED","clean","raws","ColumnContext","ColumnWrapper","groupAdder","groupSortAdder","sortAdder","renderGroups","renderSorting","renderGroupSorting","toColumn","extras","addonKey","onChange","prevent","customize","addGroupAdder","addSortAdder","addGroupSortAdder","addAdder","adder","onSelect","used","dropdown","updateHierarchy","updateList","isWrapper","additionalDescs","chooser","descs","initChooser","changeDataStorage","wrapDesc","getColumns","updateChooser","updateStats","createEntry","makeActive","updateRanking","groupByType","SidePanel","EMode","leftSlopes","rightSlopes","createElementNS","initHeader","scroll","leftContext","rightContext","was","prepareRightSlopes","computeSlopes","fakeGroups","padded","slopes","gr","heightPerRow","ItemSlope","fakeGroup","createFakeGroup","free","intersection","GroupSlope","ri","leftVisibleFirst","leftVisibleLast","rightVisibleFirst","rightVisibleLast","ownerSVGElement","paths","matchLength","selectionLookup","__data__","ids","dragHandle","toContainerRelative","clientLeft","handleShift","createNestedDesc","ciResult","annotations","EVENT_VALUE_CHANGED","toMerge","keyName","rangeSelection","rankingId","distance","getUnsupportedBrowserError","info","fVersion","ignoreIncompatibleBrowser","highlightListeners","ALineUp","_enable","server","maxCacheSize","loadFromServer","computeMissing","unionAdd","loadInCache","_m","toLoad","MultiLevelCompositeColumn","list","addAll","deleteAll","callbackfn","thisArg","iterator","rowGetter","_id","isComplexAccessor","resolveComplex","rankingIndex","ranks","_desc","nextRankingId","pushDesc","clearColumns","deriveDefault","addSupportType","violationChanged","_rule","violation","setViolation","spaceFilling","switchRule","keyList","hasProp","arrA","arrB","dateA","dateB","regexpA","regexpB","isDynamicLeafHeight","rule","resizeListener","TaggleRenderer","availableHeight","spaceFillingRule","visibleHeight","lastItems","unselected","groupSeparators","re","FormatSpecifier","basis","v0","v1","v2","v3","t3","rgbGamma","rgbSpline","spline","rgbBasis","setHours","setDate","_color","asArray","asMap","buildColumn","ColumnBuilder","rotation","registerRenderer","registerToolbarAction","registerToolbarDialogAddon","groupRowHeight","disableAdvancedRankingFeatures","disableAdvancedModelFeatures","disableAdvancedUIFeatures","supportTypes","allColumns","impose","categoricalColumn","scripted","weightedSum","numberColumn","numberColumn1","weight1","numberColumn2","weight2","numberColumnAndWeights","post","operation","numberColumns","RankingBuilder","ALL_MAGIC_FLAG","addColumn","buildRanking","providerOptions","rankBuilders","_deriveColors","singleSelection","noCriteriaLimits","limitCriteria","sortingCritera","groupingCriteria","deriveColumns","registerColumnType","defaultRanking","addSupportTypes","builder","buildData","LocalDataProvider","LineUp","buildTaggle","Taggle","asOrdinal","asSet","derive","isSet","val","buildCategoricalColumn","asBoxPlot","extra","ext","buildNumberColumn","editable","buildStringColumn","buildDateColumn","buildHierarchicalColumn","groupAction","buildActionsColumn","si","pick","changed","lineupOptions","prevRankings","prevColumns","prevHighlight","onSelectionChanged","onHighlightChanged","componentDidMount","buildProvider","createInstance","resolveColumnDescs","columnDescs","deriveColumnNames","resolveRankings","builders","rankingBuilders","buildColumns","buildRankings","updateLineUp","changeDetector","providerChanged","changedLineUpOptions","updateProvider","columnsChanged","componentDidUpdate","componentWillUnmount","builderAdapter","buildString","buildNumber","buildHierarchy","buildDate","buildCategorical","buildActions","buildGeneric","buildWeightedSumRanking","buildSupportRanking","buildScriptRanking","buildReduceRanking","buildNestedRanking","buildImposeRanking","buildAllColumnsRanking","isTypeInstance","superClass","Adapter","asTaggle","asLineUp","reIsDeepProp","reIsPlainProp","reLeadingDot","rePropName","reEscapeChar","reIsHostCtor","freeGlobal","freeSelf","arrayProto","funcProto","objectProto","coreJsData","maskSrcKey","IE_PROTO","funcToString","objectToString","reIsNative","getNative","nativeCreate","symbolProto","symbolToString","Hash","ListCache","MapCache","assocIndexOf","baseGet","isSymbol","isKey","stringToPath","baseIsNative","isObject","func","tag","isHostObject","toSource","getMapData","memoize","baseToString","resolver","memoized","Cache","isObjectLike","BrowserInfo","os","NodeInfo","process","platform","BotInfo","bot","userAgentRules","operatingSystemRules","parseUserAgent","ua","matchedRule","browser","uaMatch","versionParts","ii","createVersionParts","detectOS","getNodeVersion","detect","buildId","license","createLocalDataProvider","createLineUp","createTaggle","exporter","makeExporter","hasOwn","supportsSymbol","toPrimitiveSymbol","toPrimitive","iteratorSymbol","supportsCreate","supportsProto","downLevel","HashMap","MakeDictionary","functionPrototype","usePolyfill","env","_Map","cacheSentinel","arraySentinel","MapIterator","_index","_keys","_values","_selector","done","throw","return","_cacheKey","_cacheIndex","_find","getKey","getEntry","CreateMapPolyfill","_Set","_map","Metadata","WeakMap","rootKey","CreateUniqueKey","_key","GetOrCreateWeakMapTable","CreateUUID","FillRandomBytes","buffer","Uint8Array","crypto","getRandomValues","msCrypto","byte","CreateWeakMapPolyfill","GetOrCreateMetadataMap","Create","targetMetadata","IsUndefined","metadataMap","OrdinaryHasOwnMetadata","MetadataKey","OrdinaryGetOwnMetadata","OrdinaryDefineOwnMetadata","MetadataValue","OrdinaryOwnMetadataKeys","GetMethod","IsCallable","IsObject","GetIterator","IteratorStep","nextValue","IteratorClose","Type","IsNull","ToPrimitive","PreferredType","hint","exoticToPrim","toString_1","toString_2","OrdinaryToPrimitive","ToPropertyKey","argument","ToString","IsArray","IsConstructor","OrdinaryGetPrototypeOf","prototypeProto","decorated","decorator","DecorateConstructor","DecorateProperty","metadataKey","metadataValue","IsPropertyKey","OrdinaryHasMetadata","OrdinaryGetMetadata","OrdinaryMetadataKeys","ownKeys","parentKeys","ownKeys_1","parentKeys_1","weekday","sunday","monday","tuesday","wednesday","thursday","friday","saturday","month","setMonth","hour","minute","second","utcWeekday","utcSunday","utcMonday","utcTuesday","utcWednesday","utcThursday","utcFriday","utcSaturday"],"mappings":"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","file":"LineUpJS.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"LineUpJS\"] = factory();\n\telse\n\t\troot[\"LineUpJS\"] = factory();\n})(window, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 116);\n","/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator], i = 0;\r\n    if (m) return m.call(o);\r\n    return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n","import AEventDispatcher from '../internal/AEventDispatcher';\r\nimport {similar} from '../internal/math';\r\nimport {fixCSS} from '../internal/utils';\r\nimport {defaultGroup} from './Group';\r\nimport {IColumnDesc, IDataRow, IGroup, IGroupData} from './interfaces';\r\nimport {isMissingValue} from './missing';\r\nimport Ranking, {ISortCriteria} from './Ranking';\r\nimport {IEventListener} from '../internal/AEventDispatcher';\r\nimport {isSortingAscByDefault} from './annotations';\r\n\r\nexport {IColumnDesc} from './interfaces';\r\n\r\nexport interface IFlatColumn {\r\n  readonly col: Column;\r\n  readonly offset: number;\r\n  readonly width: number;\r\n}\r\n\r\nexport interface IColumnParent {\r\n  remove(col: Column): boolean;\r\n\r\n  insert(col: Column, index?: number): Column | null;\r\n\r\n  insertAfter(col: Column, reference: Column): Column | null;\r\n\r\n  move(col: Column, index?: number): Column | null;\r\n\r\n  moveAfter(col: Column, reference: Column): Column | null;\r\n\r\n  findMyRanker(): Ranking | null;\r\n\r\n  readonly fqid: string;\r\n\r\n  indexOf(col: Column): number;\r\n\r\n  at(index: number): Column;\r\n\r\n  readonly fqpath: string;\r\n\r\n}\r\n\r\n\r\nexport interface IColumnMetaData {\r\n  label: string;\r\n  description: string;\r\n}\r\n\r\n\r\n/**\r\n * emitted when the width property changes\r\n * @asMemberOf Column\r\n * @event\r\n */\r\nexport declare function widthChanged(previous: number, current: number): void;\r\n\r\n/**\r\n * emitted when the label property changes\r\n * @asMemberOf Column\r\n * @event\r\n */\r\nexport declare function labelChanged(previous: string, current: string): void;\r\n\r\n/**\r\n * emitted when the meta data property changes\r\n * @asMemberOf Column\r\n * @event\r\n */\r\nexport declare function metaDataChanged(previous: IColumnMetaData, current: IColumnMetaData): void;\r\n\r\n/**\r\n * emitted when state of the column is dirty\r\n * @asMemberOf Column\r\n * @event\r\n */\r\nexport declare function dirty(): void;\r\n\r\n/**\r\n * emitted when state of the column related to its header is dirty\r\n * @asMemberOf Column\r\n * @event\r\n */\r\nexport declare function dirtyHeader(): void;\r\n\r\n/**\r\n * emitted when state of the column related to its values is dirty\r\n * @asMemberOf Column\r\n * @event\r\n */\r\nexport declare function dirtyValues(): void;\r\n\r\n/**\r\n * emitted when the renderer type property changes\r\n * @asMemberOf Column\r\n * @event\r\n */\r\nexport declare function rendererTypeChanged(previous: string, current: string): void;\r\n\r\n/**\r\n * emitted when the group renderer property changes\r\n * @asMemberOf Column\r\n * @event\r\n */\r\nexport declare function groupRendererChanged(previous: string, current: string): void;\r\n\r\n/**\r\n * emitted when the pattern property changes\r\n * @asMemberOf Column\r\n * @event\r\n */\r\nexport declare function summaryRendererChanged(previous: string, current: string): void;\r\n\r\n/**\r\n * emitted when the visibility of this column changes\r\n * @asMemberOf Column\r\n * @event\r\n */\r\nexport declare function visibilityChanged(previous: boolean, current: boolean): void;\r\n\r\n\r\n/**\r\n * a column in LineUp\r\n */\r\nexport default class Column extends AEventDispatcher {\r\n  /**\r\n   * default color that should be used\r\n   * @type {string}\r\n   */\r\n  static readonly DEFAULT_COLOR = '#C1C1C1';\r\n  /**\r\n   * magic variable for showing all columns\r\n   * @type {number}\r\n   */\r\n  static readonly FLAT_ALL_COLUMNS = -1;\r\n\r\n  static readonly EVENT_WIDTH_CHANGED = 'widthChanged';\r\n  static readonly EVENT_LABEL_CHANGED = 'labelChanged';\r\n  static readonly EVENT_METADATA_CHANGED = 'metaDataChanged';\r\n  static readonly EVENT_DIRTY = 'dirty';\r\n  static readonly EVENT_DIRTY_HEADER = 'dirtyHeader';\r\n  static readonly EVENT_DIRTY_VALUES = 'dirtyValues';\r\n  static readonly EVENT_RENDERER_TYPE_CHANGED = 'rendererTypeChanged';\r\n  static readonly EVENT_GROUP_RENDERER_TYPE_CHANGED = 'groupRendererChanged';\r\n  static readonly EVENT_SUMMARY_RENDERER_TYPE_CHANGED = 'summaryRendererChanged';\r\n  static readonly EVENT_VISIBILITY_CHANGED = 'visibilityChanged';\r\n\r\n  /**\r\n   * the id of this column\r\n   */\r\n  private uid: string;\r\n\r\n  /**\r\n   * width of the column\r\n   * @type {number}\r\n   * @private\r\n   */\r\n  private width: number = 100;\r\n\r\n  /**\r\n   * parent column of this column, set when added to a ranking or combined column\r\n   */\r\n  parent: Readonly<IColumnParent> | null = null;\r\n\r\n  private metadata: Readonly<IColumnMetaData>;\r\n  private renderer: string;\r\n  private groupRenderer: string;\r\n  private summaryRenderer: string;\r\n  private visible: boolean;\r\n\r\n  constructor(id: string, public readonly desc: Readonly<IColumnDesc>) {\r\n    super();\r\n    this.uid = fixCSS(id);\r\n    this.renderer = this.desc.renderer || this.desc.type;\r\n    this.groupRenderer = this.desc.groupRenderer || this.desc.type;\r\n    this.summaryRenderer = this.desc.summaryRenderer || this.desc.type;\r\n    this.width = this.desc.width != null && this.desc.width > 0 ? this.desc.width : 100;\r\n    this.visible = this.desc.visible !== false;\r\n\r\n    this.metadata = {\r\n      label: desc.label || this.id,\r\n      description: desc.description || ''\r\n    };\r\n  }\r\n\r\n  get fixed() {\r\n    return Boolean(this.desc.fixed);\r\n  }\r\n\r\n  get frozen() {\r\n    return Boolean(this.desc.frozen);\r\n  }\r\n\r\n  get id() {\r\n    return this.uid;\r\n  }\r\n\r\n  assignNewId(idGenerator: () => string) {\r\n    this.uid = fixCSS(idGenerator());\r\n  }\r\n\r\n  get label() {\r\n    return this.metadata.label;\r\n  }\r\n\r\n  get description() {\r\n    return this.metadata.description;\r\n  }\r\n\r\n  /**\r\n   * returns the fully qualified id i.e. path the parent\r\n   * @returns {string}\r\n   */\r\n  get fqid() {\r\n    return this.parent ? `${this.parent.fqid}_${this.id}` : this.id;\r\n  }\r\n\r\n  get fqpath() {\r\n    return this.parent ? `${this.parent.fqpath}@${this.parent.indexOf(this)}` : '';\r\n  }\r\n\r\n  protected createEventList() {\r\n    return super.createEventList().concat([Column.EVENT_WIDTH_CHANGED,\r\n      Column.EVENT_LABEL_CHANGED, Column.EVENT_METADATA_CHANGED, Column.EVENT_VISIBILITY_CHANGED, Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED,\r\n      Column.EVENT_RENDERER_TYPE_CHANGED, Column.EVENT_GROUP_RENDERER_TYPE_CHANGED,\r\n      Column.EVENT_DIRTY, Column.EVENT_DIRTY_HEADER, Column.EVENT_DIRTY_VALUES]);\r\n  }\r\n\r\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\r\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\r\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\r\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\r\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\r\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\r\n  on(type: string | string[], listener: IEventListener | null): this {\r\n    return super.on(type, listener);\r\n  }\r\n\r\n  getWidth() {\r\n    return this.width;\r\n  }\r\n\r\n  hide() {\r\n    this.setVisible(false);\r\n  }\r\n\r\n  show() {\r\n    this.setVisible(true);\r\n  }\r\n\r\n  isVisible() {\r\n    return this.visible;\r\n  }\r\n\r\n  getVisible() {\r\n    return this.isVisible();\r\n  }\r\n\r\n  setVisible(value: boolean) {\r\n    if (this.visible === value) {\r\n      return;\r\n    }\r\n    this.fire([Column.EVENT_VISIBILITY_CHANGED, Column.EVENT_DIRTY_HEADER, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY], this.visible, this.visible = value);\r\n  }\r\n\r\n  /**\r\n   * visitor pattern for flattening the columns\r\n   * @param {IFlatColumn} r the result array\r\n   * @param {number} offset left offset\r\n   * @param {number} _levelsToGo how many levels down\r\n   * @param {number} _padding padding between columns\r\n   * @returns {number} the used width by this column\r\n   */\r\n  flatten(r: IFlatColumn[], offset: number, _levelsToGo = 0, _padding = 0): number {\r\n    const w = this.getWidth();\r\n    r.push({col: this, offset, width: w});\r\n    return w;\r\n  }\r\n\r\n  setWidth(value: number) {\r\n    if (similar(this.width, value, 0.5)) {\r\n      return;\r\n    }\r\n    this.fire([Column.EVENT_WIDTH_CHANGED, Column.EVENT_DIRTY_HEADER, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY], this.width, this.width = value);\r\n  }\r\n\r\n  setWidthImpl(value: number) {\r\n    this.width = value;\r\n  }\r\n\r\n  setMetaData(value: Readonly<IColumnMetaData>) {\r\n    if (value.label === this.label && this.description === value.description) {\r\n      return;\r\n    }\r\n    const bak = this.getMetaData();\r\n    //copy to avoid reference\r\n    this.metadata = {\r\n      label: value.label,\r\n      description: value.description\r\n    };\r\n\r\n    this.fire([Column.EVENT_LABEL_CHANGED, Column.EVENT_METADATA_CHANGED, Column.EVENT_DIRTY_HEADER, Column.EVENT_DIRTY], bak, this.getMetaData());\r\n  }\r\n\r\n  getMetaData(): Readonly<IColumnMetaData> {\r\n    return Object.assign({}, this.metadata);\r\n  }\r\n\r\n  /**\r\n   * triggers that the ranking is sorted by this column\r\n   * @param ascending ascending order?\r\n   * @param priority sorting priority\r\n   * @returns {boolean} was successful\r\n   */\r\n  sortByMe(ascending = isSortingAscByDefault(this), priority = 0) {\r\n    const r = this.findMyRanker();\r\n    if (r) {\r\n      return r.sortBy(this, ascending, priority);\r\n    }\r\n    return false;\r\n  }\r\n\r\n  groupByMe(): boolean {\r\n    const r = this.findMyRanker();\r\n    if (r) {\r\n      return r.toggleGrouping(this);\r\n    }\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @return {number}\r\n   */\r\n  isGroupedBy(): number {\r\n    const r = this.findMyRanker();\r\n    if (!r) {\r\n      return -1;\r\n    }\r\n    return r.getGroupCriteria().indexOf(this);\r\n  }\r\n\r\n  /**\r\n   * toggles the sorting order of this column in the ranking\r\n   * @returns {boolean} was successful\r\n   */\r\n  toggleMySorting() {\r\n    const r = this.findMyRanker();\r\n    if (r) {\r\n      return r.toggleSorting(this);\r\n    }\r\n    return false;\r\n  }\r\n\r\n  private isSortedByMeImpl(selector: ((r: Ranking) => ISortCriteria[])): { asc: 'asc' | 'desc' | undefined, priority: number | undefined } {\r\n    const ranker = this.findMyRanker();\r\n    if (!ranker) {\r\n      return {asc: undefined, priority: undefined};\r\n    }\r\n    const criterias = selector(ranker);\r\n    const index = criterias.findIndex((c) => c.col === this);\r\n    if (index < 0) {\r\n      return {asc: undefined, priority: undefined};\r\n    }\r\n    return {\r\n      asc: criterias[index].asc ? 'asc' : 'desc',\r\n      priority: index\r\n    };\r\n  }\r\n\r\n  isSortedByMe() {\r\n    return this.isSortedByMeImpl((r) => r.getSortCriteria());\r\n  }\r\n\r\n  groupSortByMe(ascending = isSortingAscByDefault(this), priority = 0) {\r\n    const r = this.findMyRanker();\r\n    if (r) {\r\n      return r.groupSortBy(this, ascending, priority);\r\n    }\r\n    return false;\r\n  }\r\n\r\n  toggleMyGroupSorting() {\r\n    const r = this.findMyRanker();\r\n    if (r) {\r\n      return r.toggleGroupSorting(this);\r\n    }\r\n    return false;\r\n  }\r\n\r\n  isGroupSortedByMe() {\r\n    return this.isSortedByMeImpl((r) => r.getGroupSortCriteria());\r\n  }\r\n\r\n  /**\r\n   * removes the column from the ranking\r\n   * @returns {boolean} was successful\r\n   */\r\n  removeMe() {\r\n    if (this.fixed) {\r\n      return false;\r\n    }\r\n    if (this.parent) {\r\n      return this.parent.remove(this);\r\n    }\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * called when the columns added to a ranking\r\n   */\r\n  attach(parent: IColumnParent)  {\r\n    this.parent = parent;\r\n  }\r\n\r\n  /**\r\n   * called when the column is removed from the ranking\r\n   */\r\n  detach() {\r\n    this.parent = null;\r\n  }\r\n\r\n  /**\r\n   * inserts the given column after itself\r\n   * @param col the column to insert\r\n   * @returns {boolean} was successful\r\n   */\r\n  insertAfterMe(col: Column) {\r\n    if (this.parent) {\r\n      return this.parent.insertAfter(col, this) != null;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * finds the underlying ranking column\r\n   * @returns {Ranking|null} my current ranking\r\n   */\r\n  findMyRanker(): Ranking | null {\r\n    if (this.parent) {\r\n      return this.parent.findMyRanker();\r\n    }\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * dumps this column to JSON compatible format\r\n   * @param toDescRef helper mapping function\r\n   * @returns {any} dump of this column\r\n   */\r\n  dump(toDescRef: (desc: any) => any): any {\r\n    const r: any = {\r\n      id: this.id,\r\n      desc: toDescRef(this.desc),\r\n      width: this.width\r\n    };\r\n    if (this.label !== (this.desc.label || this.id)) {\r\n      r.label = this.label;\r\n    }\r\n    if (this.getRenderer() !== this.desc.type) {\r\n      r.renderer = this.getRenderer();\r\n    }\r\n    if (this.getGroupRenderer() !== this.desc.type) {\r\n      r.groupRenderer = this.getGroupRenderer();\r\n    }\r\n    if (this.getSummaryRenderer() !== this.desc.type) {\r\n      r.summaryRenderer = this.getSummaryRenderer();\r\n    }\r\n    return r;\r\n  }\r\n\r\n  /**\r\n   * restore the column content from a dump\r\n   * @param dump column dump\r\n   * @param _factory helper for creating columns\r\n   */\r\n  restore(dump: any, _factory: (dump: any) => Column | null) {\r\n    this.width = dump.width || this.width;\r\n    this.metadata = {\r\n      label: dump.label || this.label,\r\n      description: this.description\r\n    };\r\n    if (dump.renderer || dump.rendererType) {\r\n      this.renderer = dump.renderer || dump.rendererType;\r\n    }\r\n    if (dump.groupRenderer) {\r\n      this.groupRenderer = dump.groupRenderer;\r\n    }\r\n    if (dump.summaryRenderer) {\r\n      this.summaryRenderer = dump.summaryRenderer;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * return the label of a given row for the current column\r\n   * @param row the current row\r\n   * @return {string} the label of this column at the specified row\r\n   */\r\n  getLabel(row: IDataRow): string {\r\n    return String(this.getValue(row));\r\n  }\r\n\r\n  /**\r\n   * return the value of a given row for the current column\r\n   * @param _row the current row\r\n   * @return the value of this column at the specified row\r\n   */\r\n  getValue(_row: IDataRow): any {\r\n    return ''; //no value\r\n  }\r\n\r\n  /**\r\n   * returns the value to be used when exporting\r\n   * @param format format hint\r\n   */\r\n  getExportValue(row: IDataRow, format: 'text' | 'json'): any {\r\n    return format === 'text' ? this.getLabel(row) : this.getValue(row);\r\n  }\r\n\r\n  getColor(_row: IDataRow) {\r\n    return Column.DEFAULT_COLOR;\r\n  }\r\n\r\n  isMissing(row: IDataRow) {\r\n    return isMissingValue(this.getValue(row));\r\n  }\r\n\r\n  /**\r\n   * compare function used to determine the order according to the values of the current column\r\n   * @param _a first element\r\n   * @param _b second element\r\n   * @return {number}\r\n   */\r\n  compare(_a: IDataRow, _b: IDataRow) {\r\n    return 0; //can't compare\r\n  }\r\n\r\n  /**\r\n   * group the given row into a bin/group\r\n   * @param _row\r\n   * @return {IGroup}\r\n   */\r\n  group(_row: IDataRow): IGroup {\r\n    return defaultGroup;\r\n  }\r\n\r\n  /**\r\n   * compares groups\r\n   * @param {IGroupData} a\r\n   * @param {IGroupData} b\r\n   * @return {number}\r\n   */\r\n  groupCompare(a: IGroupData, b: IGroupData) {\r\n    return a.name.toLowerCase().localeCompare(b.name.toLowerCase());\r\n  }\r\n\r\n  /**\r\n   * flag whether any filter is applied\r\n   * @return {boolean}\r\n   */\r\n  isFiltered() {\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * predicate whether the current row should be included\r\n   * @param row\r\n   * @return {boolean}\r\n   */\r\n  filter(row: IDataRow) {\r\n    return row != null;\r\n  }\r\n\r\n  /**\r\n   * determines the renderer type that should be used to render this column. By default the same type as the column itself\r\n   * @return {string}\r\n   */\r\n  getRenderer(): string {\r\n    return this.renderer;\r\n  }\r\n\r\n  getGroupRenderer(): string {\r\n    return this.groupRenderer;\r\n  }\r\n\r\n  getSummaryRenderer(): string {\r\n    return this.summaryRenderer;\r\n  }\r\n\r\n  setRenderer(renderer: string) {\r\n    if (renderer === this.renderer) {\r\n      // nothing changes\r\n      return;\r\n    }\r\n    this.fire([Column.EVENT_RENDERER_TYPE_CHANGED, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY], this.renderer, this.renderer = renderer);\r\n  }\r\n\r\n  protected setDefaultRenderer(renderer: string) {\r\n    if (this.renderer !== this.desc.type || this.desc.renderer) {\r\n      return;\r\n    }\r\n    return this.setRenderer(renderer);\r\n  }\r\n\r\n  setGroupRenderer(renderer: string) {\r\n    if (renderer === this.groupRenderer) {\r\n      // nothing changes\r\n      return;\r\n    }\r\n    this.fire([Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY], this.groupRenderer, this.groupRenderer = renderer);\r\n  }\r\n\r\n  protected setDefaultGroupRenderer(renderer: string) {\r\n    if (this.groupRenderer !== this.desc.type || this.desc.groupRenderer) {\r\n      return;\r\n    }\r\n    return this.setGroupRenderer(renderer);\r\n  }\r\n\r\n  setSummaryRenderer(renderer: string) {\r\n    if (renderer === this.summaryRenderer) {\r\n      // nothing changes\r\n      return;\r\n    }\r\n    this.fire([Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, Column.EVENT_DIRTY_HEADER, Column.EVENT_DIRTY], this.summaryRenderer, this.summaryRenderer = renderer);\r\n  }\r\n\r\n  protected setDefaultSummaryRenderer(renderer: string) {\r\n    if (this.summaryRenderer !== this.desc.type || this.desc.summaryRenderer) {\r\n      return;\r\n    }\r\n    return this.setSummaryRenderer(renderer);\r\n  }\r\n\r\n  protected setDefaultWidth(width: number) {\r\n    if (this.width !== 100 || this.desc.width) {\r\n      return;\r\n    }\r\n    return this.setWidthImpl(width);\r\n  }\r\n\r\n  /**\r\n   * marks the header, values, or both as dirty such that the values are reevaluated\r\n   * @param type specify in more detail what is dirty, by default whole column\r\n   */\r\n  markDirty(type: 'header' | 'values' | 'all' = 'all') {\r\n    switch (type) {\r\n      case 'header':\r\n        return this.fire([Column.EVENT_DIRTY_HEADER, Column.EVENT_DIRTY]);\r\n      case 'values':\r\n        return this.fire([Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY]);\r\n      default:\r\n        return this.fire([Column.EVENT_DIRTY_HEADER, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY]);\r\n    }\r\n  }\r\n}\r\n","import 'reflect-metadata';\r\nimport Column from './Column';\r\nimport {IColumnDesc} from './interfaces';\r\n\r\nconst supportType = Symbol.for('SupportType');\r\nconst category = Symbol.for('Category');\r\n\r\nexport function SupportType() {\r\n  return Reflect.metadata(supportType, true);\r\n}\r\n\r\nexport function SortByDefault(order: 'ascending'|'descending' = 'ascending') {\r\n  if (order === 'descending') {\r\n    return Reflect.metadata(Symbol.for('sortDescendingByDefault'), true);\r\n  }\r\n  return (d: any) => d;\r\n}\r\n\r\nexport function isSortingAscByDefault(col: Column) {\r\n  const clazz = (<any>col).constructor;\r\n  return !Reflect.hasMetadata(Symbol.for('sortDescendingByDefault'), clazz);\r\n}\r\n\r\nexport class Categories {\r\n  readonly string = {label: 'label', order: 1, name: 'string', featureLevel: 'basic'};\r\n  readonly categorical = {label: 'categorical', order: 2, name: 'categorical', featureLevel: 'basic'};\r\n  readonly number = {label: 'numerical', order: 3, name: 'number', featureLevel: 'basic'};\r\n  readonly date = {label: 'date', order: 4, name: 'date', featureLevel: 'basic'};\r\n  readonly array = {label: 'matrix', order: 5, name: 'array', featureLevel: 'advanced'};\r\n  readonly map = {label: 'map', order: 6, name: 'map', featureLevel: 'advanced'};\r\n  readonly composite = {label: 'combined', order: 7, name: 'composite', featureLevel: 'advanced'};\r\n  readonly support = {label: 'support', order: 8, name: 'support', featureLevel: 'advanced'};\r\n  readonly other = {label: 'others', order: 9, name: 'other', featureLevel: 'advanced'};\r\n}\r\n\r\nexport const categories = new Categories();\r\n\r\nexport function Category(cat: keyof Categories) {\r\n  return Reflect.metadata(category, cat);\r\n}\r\n\r\nexport function toolbar(...keys: string[]) {\r\n  return Reflect.metadata(Symbol.for('toolbarIcon'), keys);\r\n}\r\n\r\nexport function dialogAddons(key: string, ...keys: string[]) {\r\n  return Reflect.metadata(Symbol.for(`toolbarDialogAddon${key}`), keys);\r\n}\r\n\r\nconst cache = new Map<string, string[]>();\r\n\r\nexport function isSupportType(col: Column) {\r\n  const clazz = (<any>col).constructor;\r\n  return Reflect.hasMetadata(supportType, clazz);\r\n}\r\n\r\nexport interface IColumnCategory {\r\n  label: string;\r\n  name: string;\r\n  order: number;\r\n  featureLevel: 'basic' | 'advanced';\r\n}\r\n\r\nexport function categoryOf(col: (typeof Column) | Column): IColumnCategory {\r\n  const cat = <keyof Categories>Reflect.getMetadata(category, col instanceof Column ? Object.getPrototypeOf(col).constructor : col) || 'other';\r\n  return <IColumnCategory>categories[cat] || categories.other;\r\n}\r\n\r\nexport function categoryOfDesc(col: IColumnDesc | string, models: { [key: string]: typeof Column }): IColumnCategory {\r\n  const type = typeof col === 'string' ? col : col.type;\r\n  const clazz = models[type];\r\n  return clazz ? categoryOf(clazz) : <IColumnCategory>categories.other;\r\n}\r\n\r\nexport function getAllToolbarActions(col: Column) {\r\n  if (cache.has(col.desc.type)) {\r\n    return cache.get(col.desc.type)!;\r\n  }\r\n  const actions = <string[]>[];\r\n\r\n  // walk up the prototype chain\r\n  let obj = <any>col;\r\n  const toolbarIcon = Symbol.for('toolbarIcon');\r\n  do {\r\n    const m = <string[]>Reflect.getOwnMetadata(toolbarIcon, obj.constructor);\r\n    if (m) {\r\n      actions.push(...m);\r\n    }\r\n    obj = Object.getPrototypeOf(obj);\r\n  } while (obj);\r\n  cache.set(col.desc.type, actions);\r\n  return actions;\r\n}\r\n\r\n\r\nexport function getAllToolbarDialogAddons(col: Column, key: string) {\r\n  const cacheKey = `${col.desc.type}@${key}`;\r\n  if (cache.has(cacheKey)) {\r\n    return cache.get(cacheKey)!;\r\n  }\r\n  const actions = <string[]>[];\r\n\r\n  // walk up the prototype chain\r\n  let obj = <any>col;\r\n  const symbol = Symbol.for(`toolbarDialogAddon${key}`);\r\n  do {\r\n    const m = <string[]>Reflect.getOwnMetadata(symbol, obj.constructor);\r\n    if (m) {\r\n      actions.push(...m);\r\n    }\r\n    obj = Object.getPrototypeOf(obj);\r\n  } while (obj);\r\n  cache.set(cacheKey, actions);\r\n  return actions;\r\n}\r\n","import {format} from 'd3-format';\r\nimport {IAdvancedBoxPlotData, IBoxPlotData, similar} from '../internal';\r\nimport Column from './Column';\r\nimport {IArrayColumn} from './IArrayColumn';\r\nimport {IColumnDesc, IDataRow} from './interfaces';\r\nimport {IMapAbleColumn, IMappingFunction} from './MappingFunction';\r\nimport {FIRST_IS_NAN} from './missing';\r\n\r\nexport {} from '../internal';\r\n\r\n\r\nexport interface INumberColumn extends Column {\r\n  getNumber(row: IDataRow): number;\r\n\r\n  getRawNumber(row: IDataRow): number;\r\n\r\n  getNumberFormat?(): (v: number) => string;\r\n}\r\n\r\n\r\nexport const DEFAULT_FORMATTER = format('.3n');\r\n\r\nexport default INumberColumn;\r\n\r\n\r\nexport interface INumberDesc {\r\n  /**\r\n   * dump of mapping function\r\n   */\r\n  map?: any;\r\n  /**\r\n   * either map or domain should be available\r\n   */\r\n  domain?: [number, number];\r\n  /**\r\n   * @default [0,1]\r\n   */\r\n  range?: [number, number];\r\n  /**\r\n   * d3 formatting option\r\n   * @default .3n\r\n   */\r\n  numberFormat?: string;\r\n\r\n  /**\r\n   * missing value to use\r\n   * @default 0\r\n   */\r\n  missingValue?: number;\r\n}\r\n\r\n/**\r\n * checks whether the given column or description is a number column, i.e. the value is a number\r\n * @param col\r\n * @returns {boolean}\r\n */\r\nexport function isNumberColumn(col: Column): col is INumberColumn;\r\nexport function isNumberColumn(col: IColumnDesc): col is INumberDesc & IColumnDesc;\r\nexport function isNumberColumn(col: Column | IColumnDesc) {\r\n  return (col instanceof Column && typeof (<INumberColumn>col).getNumber === 'function' || (!(col instanceof Column) && (<IColumnDesc>col).type.match(/(number|stack|ordinal)/) != null));\r\n}\r\n\r\nexport function compareBoxPlot(col: IBoxPlotColumn, a: IDataRow, b: IDataRow) {\r\n  const aVal = col.getBoxPlotData(a);\r\n  const bVal = col.getBoxPlotData(b);\r\n  if (aVal == null) {\r\n    return bVal == null ? 0 : FIRST_IS_NAN;\r\n  }\r\n  if (bVal == null) {\r\n    return FIRST_IS_NAN * -1;\r\n  }\r\n  const method = <keyof IBoxPlotData>col.getSortMethod();\r\n  return numberCompare(<number>aVal[method], <number>bVal[method]);\r\n}\r\n\r\nexport function getBoxPlotNumber(col: IBoxPlotColumn, row: IDataRow, mode: 'raw' | 'normalized'): number {\r\n  const data = mode === 'normalized' ? col.getBoxPlotData(row) : col.getRawBoxPlotData(row);\r\n  if (data == null) {\r\n    return NaN;\r\n  }\r\n  return <number>data[<keyof IBoxPlotData>col.getSortMethod()];\r\n}\r\n\r\nexport enum ESortMethod {\r\n  min = 'min',\r\n  max = 'max',\r\n  median = 'median',\r\n  q1 = 'q1',\r\n  q3 = 'q3'\r\n}\r\n\r\nexport interface IBoxPlotColumn extends INumberColumn, IMapAbleColumn {\r\n  getBoxPlotData(row: IDataRow): IBoxPlotData | null;\r\n\r\n  getMapping(): IMappingFunction;\r\n\r\n  getRawBoxPlotData(row: IDataRow): IBoxPlotData | null;\r\n\r\n  getSortMethod(): string;\r\n\r\n  setSortMethod(sortMethod: string): void;\r\n}\r\n\r\nexport function isBoxPlotColumn(col: Column): col is IBoxPlotColumn {\r\n  return typeof (<IBoxPlotColumn>col).getBoxPlotData === 'function';\r\n}\r\n\r\nexport enum EAdvancedSortMethod {\r\n  min = 'min',\r\n  max = 'max',\r\n  median = 'median',\r\n  q1 = 'q1',\r\n  q3 = 'q3',\r\n  mean = 'mean'\r\n}\r\n\r\nexport interface IAdvancedBoxPlotColumn extends IBoxPlotColumn {\r\n  getBoxPlotData(row: IDataRow): IAdvancedBoxPlotData | null;\r\n\r\n  getRawBoxPlotData(row: IDataRow): IAdvancedBoxPlotData | null;\r\n}\r\n\r\nexport interface INumbersColumn extends IAdvancedBoxPlotColumn, IArrayColumn<number> {\r\n  getNumbers(row: IDataRow): number[];\r\n\r\n  getRawNumbers(row: IDataRow): number[];\r\n}\r\n\r\nexport function isNumbersColumn(col: Column): col is INumbersColumn {\r\n  return isBoxPlotColumn(col) && typeof (<INumbersColumn>col).getNumbers === 'function';\r\n}\r\n\r\n/**\r\n * save number comparison\r\n * @param a\r\n * @param b\r\n * @param aMissing\r\n * @param bMissing\r\n * @return {number}\r\n */\r\nexport function numberCompare(a: number | null, b: number | null, aMissing = false, bMissing = false) {\r\n  aMissing = aMissing || a == null || isNaN(a);\r\n  bMissing = bMissing || b == null || isNaN(b);\r\n  if (aMissing) { //NaN are smaller\r\n    return bMissing ? 0 : FIRST_IS_NAN;\r\n  }\r\n  if (bMissing) {\r\n    return FIRST_IS_NAN * -1;\r\n  }\r\n  return a! - b!;\r\n}\r\n\r\nexport interface INumberFilter {\r\n  min: number;\r\n  max: number;\r\n  filterMissing: boolean;\r\n}\r\n\r\nexport function noNumberFilter() {\r\n  return ({min: -Infinity, max: Infinity, filterMissing: false});\r\n}\r\n\r\nexport function isEqualNumberFilter(a: INumberFilter, b: INumberFilter) {\r\n  return similar(a.min, b.min, 0.001) && similar(a.max, b.max, 0.001) && a.filterMissing === b.filterMissing;\r\n}\r\n\r\nexport function isNumberIncluded(filter: INumberFilter | null, value: number) {\r\n  if (!filter) {\r\n    return true;\r\n  }\r\n  if (isNaN(value)) {\r\n    return !filter.filterMissing;\r\n  }\r\n  return !((isFinite(filter.min) && value < filter.min) || (isFinite(filter.max) && value > filter.max));\r\n}\r\n\r\n/** @internal */\r\nexport function isDummyNumberFilter(filter: INumberFilter) {\r\n  return !filter.filterMissing && !isFinite(filter.min) && !isFinite(filter.max);\r\n}\r\n\r\n/** @internal */\r\nexport function restoreNumberFilter(v: INumberFilter): INumberFilter {\r\n  return {\r\n    min: v.min != null && isFinite(v.min) ? v.min : -Infinity,\r\n    max: v.max != null && isFinite(v.max) ? v.max : +Infinity,\r\n    filterMissing: v.filterMissing\r\n  };\r\n}\r\n","import {MIN_LABEL_WIDTH} from '../config';\r\nimport Column from '../model/Column';\r\nimport {IArrayColumn} from '../model/IArrayColumn';\r\nimport {hsl} from 'd3-color';\r\nimport {IDataRow} from '../model/interfaces';\r\n\r\n/**\r\n * utility function to sets attributes and styles in a nodes\r\n * @param node\r\n * @param attrs\r\n * @param styles\r\n * @param text\r\n * @return {T}\r\n */\r\nexport function attr<T extends (HTMLElement | SVGElement)>(node: T, attrs: {[key: string]: any} = {}, styles: {[key: string]: any} = {}, text?: string): T {\r\n  Object.keys(attrs).forEach((attr) => {\r\n    const v = String(attrs[attr]);\r\n    if (node.getAttribute(attr) !== v) {\r\n      node.setAttribute(attr, v);\r\n    }\r\n  });\r\n  Object.keys(styles).forEach((attr) => {\r\n    const v = styles[attr];\r\n    if ((<any>node).style.getPropertyValue(attr) !== v) {\r\n      (<any>node).style.setProperty(attr, v);\r\n    }\r\n  });\r\n  return setText(node, text);\r\n}\r\n\r\nexport function noop() {\r\n  // no op\r\n}\r\n\r\nexport const noRenderer = {\r\n  template: `<div></div>`,\r\n  update: noop,\r\n  render: noop\r\n};\r\n\r\nexport function setText<T extends Node>(node: T, text?: string): T {\r\n  if (text === undefined) {\r\n    return node;\r\n  }\r\n  //no performance boost if setting the text node directly\r\n  //const textNode = <Text>node.firstChild;\r\n  //if (textNode == null) {\r\n  //  node.appendChild(node.ownerDocument.createTextNode(text));\r\n  //} else {\r\n  //  textNode.data = text;\r\n  //}\r\n  if (node.textContent !== text) {\r\n    node.textContent = text;\r\n  }\r\n  return node;\r\n}\r\n\r\n/**\r\n * for each item matching the selector execute the callback\r\n * @param node\r\n * @param selector\r\n * @param callback\r\n */\r\nexport function forEach<T extends Element>(node: Element, selector: string, callback: (d: T, i: number) => void) {\r\n  (<T[]>Array.from(node.querySelectorAll(selector))).forEach(callback);\r\n}\r\n\r\nexport function forEachChild<T extends Element>(node: Element, callback: (d: T, i: number) => void) {\r\n  (<T[]>Array.from(node.children)).forEach(callback);\r\n}\r\n\r\n/**\r\n * matches the columns and the dom nodes representing them\r\n * @param {HTMLElement} node row\r\n * @param columns columns to check\r\n */\r\nexport function matchColumns(node: HTMLElement, columns: {column: Column, template: string, rendererId: string}[]) {\r\n  if (node.childElementCount === 0) {\r\n    // initial call fast method\r\n    node.innerHTML = columns.map((c) => c.template).join('');\r\n    const children = Array.from(node.children);\r\n    columns.forEach((col, i) => {\r\n      const cnode = <HTMLElement>children[i];\r\n      // set attribute for finding again\r\n      cnode.dataset.columnId = col.column.id;\r\n      // store current renderer\r\n      cnode.dataset.renderer = col.rendererId;\r\n    });\r\n    return;\r\n  }\r\n\r\n  function matches(c: {column: Column, rendererId: string}, i: number) {\r\n    //do both match?\r\n    const n = <HTMLElement>node.children[i];\r\n    return n != null && n.dataset.columnId === c.column.id && n.dataset.renderer === c.rendererId;\r\n  }\r\n\r\n  if (columns.every(matches)) {\r\n    return; //nothing to do\r\n  }\r\n\r\n  const idsAndRenderer = new Set(columns.map((c) => `${c.column.id}@${c.rendererId}`));\r\n  //remove all that are not existing anymore\r\n  forEachChild(node, (n: HTMLElement) => {\r\n    const id = n.dataset.columnId;\r\n    const renderer = n.dataset.renderer;\r\n    const idAndRenderer = `${id}@${renderer}`;\r\n    if (!idsAndRenderer.has(idAndRenderer)) {\r\n      node.removeChild(n);\r\n    }\r\n  });\r\n  columns.forEach((col) => {\r\n    let cnode = <HTMLElement>node.querySelector(`[data-column-id=\"${col.column.id}\"]`);\r\n    if (!cnode) {\r\n      node.insertAdjacentHTML('beforeend', col.template);\r\n      cnode = <HTMLElement>node.lastElementChild!;\r\n      cnode.dataset.columnId = col.column.id;\r\n      cnode.dataset.renderer = col.rendererId;\r\n    }\r\n    node.appendChild(cnode);\r\n  });\r\n}\r\n\r\nexport function wideEnough(col: IArrayColumn<any>, length: number = col.labels.length) {\r\n  const w = col.getWidth();\r\n  return w / length > MIN_LABEL_WIDTH; // at least 30 pixel\r\n}\r\n\r\n\r\n/**\r\n * Adapts the text color for a given background color\r\n * @param {string} bgColor as `#ff0000`\r\n * @returns {string} returns `black` or `white` for best contrast\r\n */\r\nexport function adaptTextColorToBgColor(bgColor: string): string {\r\n  return hsl(bgColor).l > 0.5 ? 'black' : 'white';\r\n}\r\n\r\n\r\n/**\r\n *\r\n * Adapts the text color for a given background color\r\n * @param {HTMLElement} node the node containing the text\r\n * @param {string} bgColor as `#ff0000`\r\n * @param {string} title the title to render\r\n * @param {number} width for which percentages of the cell this background applies (0..1)\r\n */\r\nexport function adaptDynamicColorToBgColor(node: HTMLElement, bgColor: string, title: string, width: number) {\r\n  const adapt = adaptTextColorToBgColor(bgColor);\r\n  if ((width <= 0.05 || adapt === 'black') || width > 0.9) { // almost empty or full\r\n    node.style.color = adapt === 'black' || width <= 0.05 ? null : adapt; // null = black\r\n    // node.classList.remove('lu-gradient-text');\r\n    // node.style.backgroundImage = null;\r\n    return;\r\n  }\r\n\r\n  node.style.color = null;\r\n  node.innerText = title;\r\n\r\n  console.assert(node.ownerDocument != null);\r\n  const span = node.ownerDocument!.createElement('span');\r\n  span.classList.add('lu-gradient-text');\r\n  span.style.color = adapt;\r\n  span.innerText = title;\r\n  node.appendChild(span);\r\n}\r\n\r\n\r\n\r\nexport const uniqueId: (prefix: string)=>string = (function() {\r\n  // side effect but just within the function itself, so good for the library\r\n  let idCounter = 0;\r\n  return (prefix: string) => `${prefix}${(idCounter++).toString(36)}`;\r\n})();\r\n\r\n\r\nconst NUM_EXAMPLE_VALUES = 5;\r\n\r\nexport function exampleText(col: Column, rows: IDataRow[]) {\r\n  const examples = <string[]>[];\r\n  for (const row of rows) {\r\n    if (col.isMissing(row)) {\r\n      continue;\r\n    }\r\n    const v = col.getLabel(row);\r\n    examples.push(v);\r\n    if (examples.length >= NUM_EXAMPLE_VALUES) {\r\n      break;\r\n    }\r\n  }\r\n  return `${examples.join(', ')}${examples.length < rows.length ? ', ...' : ''}`;\r\n}\r\n","export default function(specifier) {\n  var n = specifier.length / 6 | 0, colors = new Array(n), i = 0;\n  while (i < n) colors[i] = \"#\" + specifier.slice(i * 6, ++i * 6);\n  return colors;\n}\n","import {format} from 'd3-format';\r\nimport {equalArrays} from '../internal';\r\nimport {Category, toolbar, SortByDefault, dialogAddons} from './annotations';\r\nimport Column, {widthChanged, labelChanged, metaDataChanged, dirty, dirtyHeader, dirtyValues, rendererTypeChanged, groupRendererChanged, summaryRendererChanged, visibilityChanged} from './Column';\r\nimport {IDataRow, IGroup, IGroupData} from './interfaces';\r\nimport {groupCompare} from './internal';\r\nimport {\r\n  default as INumberColumn, EAdvancedSortMethod, INumberDesc, INumberFilter, isEqualNumberFilter,\r\n  isNumberIncluded, noNumberFilter, numberCompare, isDummyNumberFilter, restoreNumberFilter\r\n} from './INumberColumn';\r\nimport {\r\n  createMappingFunction, IMapAbleColumn, IMappingFunction, restoreMapping,\r\n  ScaleMappingFunction\r\n} from './MappingFunction';\r\nimport {isMissingValue, isUnknown, missingGroup} from './missing';\r\nimport ValueColumn, {IValueColumnDesc, dataLoaded} from './ValueColumn';\r\nimport {IEventListener} from '../internal/AEventDispatcher';\r\nimport {IColorMappingFunction, createColorMappingFunction, restoreColorMapping} from './ColorMappingFunction';\r\n\r\nexport {default as INumberColumn, isNumberColumn} from './INumberColumn';\r\n\r\n\r\nexport declare type INumberColumnDesc = INumberDesc & IValueColumnDesc<number>;\r\n\r\n\r\n/**\r\n * emitted when the mapping property changes\r\n * @asMemberOf NumberColumn\r\n * @event\r\n */\r\nexport declare function mappingChanged(previous: IMappingFunction, current: IMappingFunction): void;\r\n\r\n/**\r\n * emitted when the color mapping property changes\r\n * @asMemberOf NumberColumn\r\n * @event\r\n */\r\nexport declare function colorMappingChanged(previous: IColorMappingFunction, current: IColorMappingFunction): void;\r\n\r\n/**\r\n * emitted when the filter property changes\r\n * @asMemberOf NumberColumn\r\n * @event\r\n */\r\nexport declare function filterChanged(previous: INumberFilter | null, current: INumberFilter | null): void;\r\n\r\n/**\r\n * emitted when the sort method property changes\r\n * @asMemberOf NumberColumn\r\n * @event\r\n */\r\nexport declare function sortMethodChanged(previous: EAdvancedSortMethod, current: EAdvancedSortMethod): void;\r\n\r\n/**\r\n * emitted when the grouping property changes\r\n * @asMemberOf NumberColumn\r\n * @event\r\n */\r\nexport declare function groupingChanged(previous: number[], current: number[]): void;\r\n\r\n/**\r\n * a number column mapped from an original input scale to an output range\r\n */\r\n@toolbar('groupBy', 'sortGroupBy', 'filterNumber', 'colorMapped', 'editMapping')\r\n@dialogAddons('sortGroup', 'sortNumber')\r\n@dialogAddons('group', 'groupNumber')\r\n@Category('number')\r\n@SortByDefault('descending')\r\nexport default class NumberColumn extends ValueColumn<number> implements INumberColumn, IMapAbleColumn {\r\n  static readonly EVENT_MAPPING_CHANGED = 'mappingChanged';\r\n  static readonly EVENT_COLOR_MAPPING_CHANGED = 'colorMappingChanged';\r\n  static readonly EVENT_FILTER_CHANGED = 'filterChanged';\r\n  static readonly EVENT_SORTMETHOD_CHANGED = 'sortMethodChanged';\r\n  static readonly EVENT_GROUPING_CHANGED = 'groupingChanged';\r\n\r\n  private readonly missingValue: number;\r\n\r\n  private mapping: IMappingFunction;\r\n  private colorMapping: IColorMappingFunction;\r\n  private original: IMappingFunction;\r\n\r\n  /**\r\n   * currently active filter\r\n   * @type {{min: number, max: number}}\r\n   * @private\r\n   */\r\n  private currentFilter: INumberFilter = noNumberFilter();\r\n\r\n  private numberFormat: (n: number) => string = format('.2f');\r\n\r\n  private currentGroupThresholds: number[] = [];\r\n  private groupSortMethod: EAdvancedSortMethod = EAdvancedSortMethod.median;\r\n\r\n  constructor(id: string, desc: INumberColumnDesc) {\r\n    super(id, desc);\r\n\r\n    this.mapping = restoreMapping(desc);\r\n    this.original = this.mapping.clone();\r\n    this.colorMapping = restoreColorMapping(desc);\r\n\r\n    if (desc.numberFormat) {\r\n      this.numberFormat = format(desc.numberFormat);\r\n    }\r\n    this.missingValue = desc.missingValue != null ? desc.missingValue : NaN;\r\n\r\n    this.setGroupRenderer('boxplot');\r\n    this.setDefaultSummaryRenderer('histogram');\r\n  }\r\n\r\n  getNumberFormat() {\r\n    return this.numberFormat;\r\n  }\r\n\r\n  dump(toDescRef: (desc: any) => any) {\r\n    const r = super.dump(toDescRef);\r\n    r.map = this.mapping.dump();\r\n    r.colorMapping = this.colorMapping.dump();\r\n    r.filter = isDummyNumberFilter(this.currentFilter) ? null : this.currentFilter;\r\n    r.groupSortMethod = this.groupSortMethod;\r\n    if (this.currentGroupThresholds) {\r\n      r.stratifyThreshholds = this.currentGroupThresholds;\r\n    }\r\n    return r;\r\n  }\r\n\r\n  restore(dump: any, factory: (dump: any) => Column | null) {\r\n    super.restore(dump, factory);\r\n    if (dump.map) {\r\n      this.mapping = createMappingFunction(dump.map);\r\n    } else if (dump.domain) {\r\n      this.mapping = new ScaleMappingFunction(dump.domain, 'linear', dump.range || [0, 1]);\r\n    }\r\n    if (dump.colorMapping) {\r\n      this.colorMapping = createColorMappingFunction(dump.colorMapping);\r\n    }\r\n    if (dump.groupSortMethod) {\r\n      this.groupSortMethod = dump.groupSortMethod;\r\n    }\r\n    if (dump.filter) {\r\n      this.currentFilter = restoreNumberFilter(dump.filter);\r\n    }\r\n    if (dump.stratifyThreshholds) {\r\n      this.currentGroupThresholds = dump.stratifyThresholds;\r\n    }\r\n    if (dump.numberFormat) {\r\n      this.numberFormat = format(dump.numberFormat);\r\n    }\r\n  }\r\n\r\n  protected createEventList() {\r\n    return super.createEventList().concat([NumberColumn.EVENT_MAPPING_CHANGED, NumberColumn.EVENT_COLOR_MAPPING_CHANGED, NumberColumn.EVENT_FILTER_CHANGED, NumberColumn.EVENT_SORTMETHOD_CHANGED, NumberColumn.EVENT_GROUPING_CHANGED]);\r\n  }\r\n\r\n  on(type: typeof NumberColumn.EVENT_MAPPING_CHANGED, listener: typeof mappingChanged | null): this;\r\n  on(type: typeof NumberColumn.EVENT_COLOR_MAPPING_CHANGED, listener: typeof colorMappingChanged | null): this;\r\n  on(type: typeof NumberColumn.EVENT_FILTER_CHANGED, listener: typeof filterChanged | null): this;\r\n  on(type: typeof NumberColumn.EVENT_SORTMETHOD_CHANGED, listener: typeof sortMethodChanged | null): this;\r\n  on(type: typeof NumberColumn.EVENT_GROUPING_CHANGED, listener: typeof groupingChanged | null): this;\r\n  on(type: typeof ValueColumn.EVENT_DATA_LOADED, listener: typeof dataLoaded | null): this;\r\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\r\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\r\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\r\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\r\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\r\n  on(type: string | string[], listener: IEventListener | null): this;\r\n  on(type: string | string[], listener: IEventListener | null): this {\r\n    return super.on(<any>type, listener);\r\n  }\r\n\r\n  getLabel(row: IDataRow) {\r\n    if ((<any>this.desc).numberFormat) {\r\n      const raw = this.getRawValue(row);\r\n      //if a dedicated format and a number use the formatter in any case\r\n      if (isNaN(raw)) {\r\n        return 'NaN';\r\n      }\r\n      if (!isFinite(raw)) {\r\n        return raw.toString();\r\n      }\r\n      return this.numberFormat(raw);\r\n    }\r\n    const v = super.getValue(row);\r\n    //keep non number if it is not a number else convert using formatter\r\n    if (typeof v === 'number') {\r\n      return this.numberFormat(+v);\r\n    }\r\n    return String(v);\r\n  }\r\n\r\n  getRange() {\r\n    return this.mapping.getRange(this.numberFormat);\r\n  }\r\n\r\n  getRawValue(row: IDataRow, missingValue = this.missingValue) {\r\n    const v: any = super.getValue(row);\r\n    if (isMissingValue(v)) {\r\n      return missingValue;\r\n    }\r\n    return +v;\r\n  }\r\n\r\n  getExportValue(row: IDataRow, format: 'text' | 'json'): any {\r\n    return format === 'json' ? this.getRawValue(row) : super.getExportValue(row, format);\r\n  }\r\n\r\n  isMissing(row: IDataRow) {\r\n    return isMissingValue(super.getValue(row));\r\n  }\r\n\r\n  getValue(row: IDataRow) {\r\n    const v = this.getRawValue(row);\r\n    if (isNaN(v)) {\r\n      return v;\r\n    }\r\n    return this.mapping.apply(v);\r\n  }\r\n\r\n  getNumber(row: IDataRow) {\r\n    return this.getValue(row);\r\n  }\r\n\r\n  getRawNumber(row: IDataRow, missingValue = this.missingValue) {\r\n    return this.getRawValue(row, missingValue);\r\n  }\r\n\r\n  compare(a: IDataRow, b: IDataRow) {\r\n    return numberCompare(this.getNumber(a), this.getNumber(b), this.isMissing(a), this.isMissing(b));\r\n  }\r\n\r\n  groupCompare(a: IGroupData, b: IGroupData): number {\r\n    return groupCompare(a.rows, b.rows, this, <any>this.groupSortMethod);\r\n  }\r\n\r\n  getOriginalMapping() {\r\n    return this.original.clone();\r\n  }\r\n\r\n  getMapping() {\r\n    return this.mapping.clone();\r\n  }\r\n\r\n  setMapping(mapping: IMappingFunction) {\r\n    if (this.mapping.eq(mapping)) {\r\n      return;\r\n    }\r\n    this.fire([NumberColumn.EVENT_MAPPING_CHANGED, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY_HEADER, Column.EVENT_DIRTY], this.mapping.clone(), this.mapping = mapping);\r\n  }\r\n\r\n  getColor(row: IDataRow) {\r\n    const v = this.getNumber(row);\r\n    if (isNaN(v)) {\r\n      return Column.DEFAULT_COLOR;\r\n    }\r\n    return this.colorMapping.apply(v);\r\n  }\r\n\r\n  getColorMapping() {\r\n    return this.colorMapping.clone();\r\n  }\r\n\r\n  setColorMapping(mapping: IColorMappingFunction) {\r\n    if (this.colorMapping.eq(mapping)) {\r\n      return;\r\n    }\r\n    this.fire([NumberColumn.EVENT_COLOR_MAPPING_CHANGED, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY_HEADER, Column.EVENT_DIRTY], this.colorMapping.clone(), this.colorMapping = mapping);\r\n  }\r\n\r\n  isFiltered() {\r\n    return !isDummyNumberFilter(this.currentFilter);\r\n  }\r\n\r\n  getFilter(): INumberFilter {\r\n    return Object.assign({}, this.currentFilter);\r\n  }\r\n\r\n  setFilter(value: INumberFilter = {min: -Infinity, max: +Infinity, filterMissing: false}) {\r\n    if (isEqualNumberFilter(value, this.currentFilter)) {\r\n      return;\r\n    }\r\n    const bak = this.getFilter();\r\n    this.currentFilter.min = isUnknown(value.min) ? -Infinity : value.min;\r\n    this.currentFilter.max = isUnknown(value.max) ? Infinity : value.max;\r\n    this.currentFilter.filterMissing = value.filterMissing;\r\n    this.fire([NumberColumn.EVENT_FILTER_CHANGED, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY], bak, this.getFilter());\r\n  }\r\n\r\n  /**\r\n   * filter the current row if any filter is set\r\n   * @param row\r\n   * @returns {boolean}\r\n   */\r\n  filter(row: IDataRow) {\r\n    return isNumberIncluded(this.currentFilter, this.getRawNumber(row, NaN));\r\n  }\r\n\r\n  getGroupThresholds() {\r\n    return this.currentGroupThresholds.slice();\r\n  }\r\n\r\n  setGroupThresholds(value: number[]) {\r\n    if (equalArrays(this.currentGroupThresholds, value)) {\r\n      return;\r\n    }\r\n    const bak = this.getGroupThresholds();\r\n    this.currentGroupThresholds = value.slice();\r\n    this.fire([NumberColumn.EVENT_GROUPING_CHANGED, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY], bak, value);\r\n  }\r\n\r\n\r\n  group(row: IDataRow): IGroup {\r\n    if (this.isMissing(row)) {\r\n      return missingGroup;\r\n    }\r\n\r\n    let threshold = this.currentGroupThresholds;\r\n    if (threshold.length === 0) {\r\n      // default threshold\r\n      const d = this.mapping.domain;\r\n      threshold = [(d[1] - d[0]) / 2];\r\n    }\r\n\r\n    const value = this.getRawNumber(row);\r\n    const treshholdIndex = threshold.findIndex((t) => value <= t);\r\n    // group by thresholds / bins\r\n    switch (treshholdIndex) {\r\n      case -1:\r\n        //bigger than the last threshold\r\n        return {\r\n          name: `${this.label} > ${threshold[threshold.length - 1]}`,\r\n          color: this.colorMapping.apply(1)\r\n        };\r\n      case 0:\r\n        //smallest\r\n        return {\r\n          name: `${this.label} <= ${threshold[0]}`,\r\n          color: this.colorMapping.apply(0)\r\n        };\r\n      default:\r\n        return {\r\n          name: `${threshold[treshholdIndex - 1]} <= ${this.label} <= ${threshold[treshholdIndex]}`,\r\n          color: this.colorMapping.apply(this.mapping.apply((threshold[treshholdIndex - 1] + threshold[treshholdIndex]) / 2))\r\n        };\r\n    }\r\n  }\r\n\r\n  getSortMethod() {\r\n    return this.groupSortMethod;\r\n  }\r\n\r\n  setSortMethod(sortMethod: EAdvancedSortMethod) {\r\n    if (this.groupSortMethod === sortMethod) {\r\n      return;\r\n    }\r\n    this.fire([NumberColumn.EVENT_SORTMETHOD_CHANGED], this.groupSortMethod, this.groupSortMethod = sortMethod);\r\n    // sort by me if not already sorted by me\r\n    if (!this.isGroupSortedByMe().asc) {\r\n      this.toggleMyGroupSorting();\r\n    }\r\n  }\r\n}\r\n","import {IGroup} from './interfaces';\r\n\r\n\r\nexport function isMissingValue(v: any): boolean {\r\n  return typeof(v) === 'undefined' || v == null || (typeof v === 'number' && isNaN(v)) || v === '' || v === 'NA' || v === 'NaN' || (typeof(v) === 'string' && (v.toLowerCase() === 'na') || (Array.isArray(v) && v.every((v) => isMissingValue(v))));\r\n}\r\n\r\nexport function isUnknown(v?: number | null) {\r\n  return v == null || v === undefined || isNaN(v);\r\n}\r\n\r\nexport const FIRST_IS_NAN = -1;\r\nexport const FIRST_IS_MISSING = 1;\r\n\r\n\r\nexport const missingGroup: IGroup = {\r\n  name: 'Missing values',\r\n  color: 'gray'\r\n};\r\n","import * as vars from 'raw-loader!./_vars.scss';\r\n\r\nconst styles = new Map<string, string>();\r\n{\r\n  const r = /^[$]([\\w]+): ([\\w #.()'\\/,-]+)( !default)?;/gmi;\r\n  const s = String(vars);\r\n\r\n  let m: RegExpMatchArray | null = s.match(r);\r\n  while (m != null) {\r\n    styles.set(m[1], m[2]);\r\n    m = s.match(r);\r\n  }\r\n}\r\n\r\nexport default function getStyle(key: string, defaultValue = '') {\r\n  if (key[0] === '$') {\r\n    key = key.slice(1);\r\n  }\r\n  if (styles.has(key)) {\r\n    return styles.get(key)!;\r\n  }\r\n  return defaultValue;\r\n}\r\n\r\n\r\nexport const COLUMN_PADDING = parseInt(getStyle('lu_engine_grip_gap', '5px'), 10);\r\n\r\nexport const DASH = {\r\n  width: parseInt(getStyle('lu_missing_dash_width', '3px'), 10),\r\n  height: parseInt(getStyle('lu_missing_dash_height', '10px'), 10),\r\n  color: getStyle('lu_missing_dash_color', 'gray')\r\n};\r\n\r\nexport const UPSET = {\r\n  circle: getStyle('lu_renderer_upset_circle_color'),\r\n  inactive: parseFloat(getStyle('lu_renderer_upset_inactive_opacity', '0.1')),\r\n  stroke: getStyle('lu_renderer_upset_stroke')\r\n};\r\n\r\nexport const DOT = {\r\n  color: getStyle('lu_renderer_dot_color', 'gray'),\r\n  size: parseInt(getStyle('lu_renderer_dot_size', '5px'), 10),\r\n  opacity: parseFloat(getStyle('lu_renderer_dot_opacity', '0.7'))\r\n};\r\n\r\nexport const BOX_PLOT = {\r\n  box: getStyle('lu_renderer_boxplot_box', '#e0e0e0'),\r\n  stroke: getStyle('lu_renderer_boxplot_stroke', 'black'),\r\n  sort: getStyle('lu_renderer_boxplot_sort_indicator', '#ffa500'),\r\n  outlier: getStyle('lu_renderer_boxplot_outlier', '#e0e0e0')\r\n};\r\n\r\nexport const AGGREGATE = {\r\n  width: parseInt(getStyle('lu_aggregate_square_bracket_width', '4px'), 10),\r\n  strokeWidth: parseInt(getStyle('lu_aggregate_square_bracket_stroke_width', '1px'), 10),\r\n  color: getStyle('lu_aggregate_square_bracket_stroke_color', '#000')\r\n};\r\n\r\nexport const SLOPEGRAPH_WIDTH = parseInt(getStyle('lu_slopw_width', '200px'), 10);\r\nexport const CANVAS_HEIGHT = 4;\r\n","import {ICategoricalStatistics, IStatistics} from '../internal/math';\r\nimport {ICategoricalColumn, IDataRow, IGroup, INumberColumn} from '../model';\r\nimport Column from '../model/Column';\r\nimport {IDataProvider} from '../provider/ADataProvider';\r\nimport DialogManager from '../ui/dialogs/DialogManager';\r\n\r\nexport interface IImposer {\r\n  color?(row: IDataRow | null, valueHint?: number): string | null;\r\n}\r\n\r\n\r\n/**\r\n * a cell renderer for rendering a cell of specific column\r\n */\r\nexport interface ICellRenderer {\r\n  /**\r\n   * template as a basis for the update\r\n   */\r\n  readonly template: string;\r\n\r\n  /**\r\n   * update a given node (create using the template) with the given data\r\n   * @param node the node to update\r\n   * @param d the data item\r\n   * @param i the order relative index\r\n   * @param group the group this row is part of\r\n   */\r\n  update(node: HTMLElement, d: IDataRow, i: number, group: IGroup): void;\r\n\r\n  render(ctx: CanvasRenderingContext2D, d: IDataRow, i: number, group: IGroup): void;\r\n}\r\n\r\n/**\r\n * a cell renderer for rendering a cell of specific column\r\n */\r\nexport interface IGroupCellRenderer {\r\n  /**\r\n   * template as a basis for the update\r\n   */\r\n  readonly template: string;\r\n\r\n  /**\r\n   * update a given node (create using the template) with the given data\r\n   * @param node the node to update\r\n   * @param group the group to render\r\n   * @param rows the data items\r\n   */\r\n  update(node: HTMLElement, group: IGroup, rows: IDataRow[]): void;\r\n}\r\n\r\nexport interface ISummaryRenderer {\r\n  /**\r\n   * template as a basis for the update\r\n   */\r\n  readonly template: string;\r\n\r\n  update(node: HTMLElement, hist: IStatistics | ICategoricalStatistics | null): void;\r\n}\r\n\r\n\r\n/**\r\n * context for rendering, wrapped as an object for easy extensibility\r\n */\r\nexport interface IRenderContext {\r\n  /**\r\n   * render a column\r\n   * @param col\r\n   */\r\n  renderer(col: Column, imposer?: IImposer): ICellRenderer;\r\n\r\n  /**\r\n   * render a column\r\n   * @param col\r\n   */\r\n  groupRenderer(col: Column, imposer?: IImposer): IGroupCellRenderer;\r\n\r\n  summaryRenderer(co: Column, interactive: boolean, imposer?: IImposer): ISummaryRenderer;\r\n\r\n  statsOf(col: (INumberColumn | ICategoricalColumn) & Column): ICategoricalStatistics | IStatistics | null;\r\n\r\n  /**\r\n   * prefix used for all generated id names\r\n   */\r\n  readonly idPrefix: string;\r\n\r\n  /**\r\n   * lookup custom options by key\r\n   * @param key key to lookup\r\n   * @param defaultValue default value\r\n   */\r\n  option<T>(key: string, defaultValue: T): T;\r\n\r\n  readonly totalNumberOfRows: number;\r\n\r\n  colWidth(col: Column): number;\r\n\r\n  readonly provider: IDataProvider;\r\n  readonly dialogManager: DialogManager;\r\n}\r\n\r\nexport enum ERenderMode {\r\n  CELL, GROUP, SUMMARY\r\n}\r\n\r\n\r\nexport interface ICellRendererFactory {\r\n  readonly title: string;\r\n  readonly groupTitle?: string;\r\n  readonly summaryTitle?: string;\r\n\r\n  canRender(col: Column, mode: ERenderMode): boolean;\r\n\r\n  create(col: Column, context: IRenderContext, hist: IStatistics | ICategoricalStatistics | null, imposer?: IImposer): ICellRenderer;\r\n\r\n  createGroup(col: Column, context: IRenderContext, hist: IStatistics | ICategoricalStatistics | null, imposer?: IImposer): IGroupCellRenderer;\r\n\r\n  createSummary(col: Column, context: IRenderContext, interactive: boolean, imposer?: IImposer): ISummaryRenderer;\r\n}\r\n\r\n\r\nexport default IRenderContext;\r\n","import {IDataRow} from '../model';\r\nimport Column from '../model/Column';\r\nimport {CANVAS_HEIGHT, DASH} from '../styles';\r\n\r\nexport function renderMissingValue(ctx: CanvasRenderingContext2D, width: number, height: number, x = 0, y = 0) {\r\n\r\n  const dashX = Math.max(0, x + (width - DASH.width) / 2); // center horizontally\r\n  const dashY = Math.max(0, y + (height - DASH.height) / 2); // center vertically\r\n  ctx.fillStyle = DASH.color;\r\n  ctx.fillRect(dashX, dashY, Math.min(width, DASH.width), Math.min(height, DASH.height));\r\n}\r\n\r\nexport function renderMissingDOM(node: HTMLElement, col: Column, d: IDataRow) {\r\n  const missing = col.isMissing(d);\r\n  node.classList.toggle('lu-missing', missing);\r\n  return missing;\r\n}\r\n\r\nexport function renderMissingCanvas(ctx: CanvasRenderingContext2D, col: Column, d: IDataRow, width: number, x = 0, y = 0) {\r\n  const missing = col.isMissing(d);\r\n  if (missing) {\r\n    renderMissingValue(ctx, width, CANVAS_HEIGHT, x, y);\r\n  }\r\n  return missing;\r\n}\r\n","import {equalArrays, fixCSS} from '../internal';\r\nimport AEventDispatcher, {suffix} from '../internal/AEventDispatcher';\r\nimport {isSortingAscByDefault} from './annotations';\r\nimport Column, {IColumnParent, IFlatColumn, visibilityChanged, dirtyValues, dirtyHeader, labelChanged, widthChanged, dirty} from './Column';\r\nimport {defaultGroup, IOrderedGroup} from './Group';\r\nimport {IDataRow, IGroup, IGroupData} from './interfaces';\r\nimport {joinGroups} from './internal';\r\nimport NumberColumn, {filterChanged} from './NumberColumn';\r\nimport CompositeColumn from './CompositeColumn';\r\nimport {IEventListener} from '../internal/AEventDispatcher';\r\n\r\nexport interface ISortCriteria {\r\n  readonly col: Column;\r\n  readonly asc: boolean;\r\n}\r\n\r\n\r\n/**\r\n * emitted when a column has been added\r\n * @asMemberOf Ranking\r\n * @event\r\n */\r\nexport declare function addColumn(col: Column, index: number): void;\r\n\r\n/**\r\n * emitted when a column has been moved within this composite columm\r\n * @asMemberOf Ranking\r\n * @event\r\n */\r\nexport declare function moveColumn(col: Column, index: number, oldIndex: number): void;\r\n\r\n/**\r\n * emitted when a column has been removed\r\n * @asMemberOf Ranking\r\n * @event\r\n */\r\nexport declare function removeColumn(col: Column, index: number): void;\r\n/**\r\n * emitted when the sort criteria propery changes\r\n * @asMemberOf Ranking\r\n * @event\r\n */\r\nexport declare function sortCriteriaChanged(previous: ISortCriteria[], current: ISortCriteria[]): void;\r\n/**\r\n * emitted when the sort criteria propery changes\r\n * @asMemberOf Ranking\r\n * @event\r\n */\r\nexport declare function groupCriteriaChanged(previous: Column[], current: Column[]): void;\r\n/**\r\n * emitted when the sort criteria propery changes\r\n * @asMemberOf Ranking\r\n * @event\r\n */\r\nexport declare function groupSortCriteriaChanged(previous: ISortCriteria[], current: ISortCriteria[]): void;\r\n/**\r\n * emitted when the sort criteria propery changes\r\n * @asMemberOf Ranking\r\n * @event\r\n */\r\nexport declare function dirtyOrder(): void;\r\n/**\r\n * @asMemberOf Ranking\r\n * @event\r\n */\r\nexport declare function orderChanged(previous: number[], current: number[], previousGroups: IOrderedGroup[], currentGroups: IOrderedGroup[]): void;\r\n/**\r\n * @asMemberOf Ranking\r\n * @event\r\n */\r\nexport declare function groupsChanged(previous: number[], current: number[], previousGroups: IOrderedGroup[], currentGroups: IOrderedGroup[]): void;\r\n\r\n/**\r\n * a ranking\r\n */\r\nexport default class Ranking extends AEventDispatcher implements IColumnParent {\r\n  static readonly EVENT_WIDTH_CHANGED = Column.EVENT_WIDTH_CHANGED;\r\n  static readonly EVENT_FILTER_CHANGED = NumberColumn.EVENT_FILTER_CHANGED;\r\n  static readonly EVENT_LABEL_CHANGED = Column.EVENT_LABEL_CHANGED;\r\n  static readonly EVENT_ADD_COLUMN = CompositeColumn.EVENT_ADD_COLUMN;\r\n  static readonly EVENT_MOVE_COLUMN = CompositeColumn.EVENT_MOVE_COLUMN;\r\n  static readonly EVENT_REMOVE_COLUMN = CompositeColumn.EVENT_REMOVE_COLUMN;\r\n  static readonly EVENT_DIRTY = Column.EVENT_DIRTY;\r\n  static readonly EVENT_DIRTY_HEADER = Column.EVENT_DIRTY_HEADER;\r\n  static readonly EVENT_DIRTY_VALUES = Column.EVENT_DIRTY_VALUES;\r\n  static readonly EVENT_COLUMN_VISIBILITY_CHANGED = Column.EVENT_VISIBILITY_CHANGED;\r\n  static readonly EVENT_SORT_CRITERIA_CHANGED = 'sortCriteriaChanged';\r\n  static readonly EVENT_GROUP_CRITERIA_CHANGED = 'groupCriteriaChanged';\r\n  static readonly EVENT_GROUP_SORT_CRITERIA_CHANGED = 'groupSortCriteriaChanged';\r\n  static readonly EVENT_DIRTY_ORDER = 'dirtyOrder';\r\n  static readonly EVENT_ORDER_CHANGED = 'orderChanged';\r\n  static readonly EVENT_GROUPS_CHANGED = 'groupsChanged';\r\n\r\n\r\n  private label: string;\r\n  /**\r\n   * the list of sort criteria\r\n   * @type {Array}\r\n   */\r\n  private readonly sortCriteria: ISortCriteria[] = [];\r\n  private readonly groupSortCriteria: ISortCriteria[] = [];\r\n\r\n  private readonly groupColumns: Column[] = [];\r\n\r\n  /**\r\n   * columns of this ranking\r\n   * @type {Array}\r\n   * @private\r\n   */\r\n  private readonly columns: Column[] = [];\r\n\r\n  readonly comparator = (a: IDataRow, b: IDataRow) => {\r\n    if (this.sortCriteria.length === 0) {\r\n      return a.i - b.i;\r\n    }\r\n    for (const sort of this.sortCriteria) {\r\n      const r = sort.col!.compare(a, b);\r\n      if (r !== 0) {\r\n        return sort.asc ? r : -r;\r\n      }\r\n    }\r\n    return a.i - b.i; //to have a deterministic order\r\n  };\r\n\r\n  readonly groupComparator = (a: IGroupData, b: IGroupData) => {\r\n    if (this.groupSortCriteria.length === 0) {\r\n      return a.name.toLowerCase().localeCompare(b.name.toLowerCase());\r\n    }\r\n    for (const sort of this.groupSortCriteria) {\r\n      const r = sort.col!.groupCompare(a, b);\r\n      if (r !== 0) {\r\n        return sort.asc ? r : -r;\r\n      }\r\n    }\r\n    return a.name.localeCompare(b.name);\r\n  };\r\n\r\n  readonly grouper = (row: IDataRow): IGroup => {\r\n    const g = this.groupColumns;\r\n    switch (g.length) {\r\n      case 0:\r\n        return defaultGroup;\r\n      case 1:\r\n        return g[0].group(row);\r\n      default:\r\n        const groups = g.map((gi) => gi.group(row));\r\n        return joinGroups(groups);\r\n    }\r\n  };\r\n\r\n  readonly dirtyOrder = () => {\r\n    this.fire([Ranking.EVENT_DIRTY_ORDER, Ranking.EVENT_DIRTY_VALUES, Ranking.EVENT_DIRTY], this.getSortCriteria(), this.getGroupSortCriteria(), this.getGroupCriteria());\r\n  };\r\n\r\n  /**\r\n   * the current ordering as an sorted array of indices\r\n   * @type {Array}\r\n   */\r\n  private groups: IOrderedGroup[] = [Object.assign({order: <number[]>[]}, defaultGroup)];\r\n\r\n  constructor(public id: string, private maxSortCriteria = 2, private maxGroupColumns = 1) {\r\n    super();\r\n    this.id = fixCSS(id);\r\n    this.label = `Ranking ${id.startsWith('rank') ? id.slice(4) : id}`;\r\n  }\r\n\r\n  protected createEventList() {\r\n    return super.createEventList().concat([\r\n      Ranking.EVENT_WIDTH_CHANGED, Ranking.EVENT_FILTER_CHANGED,\r\n      Ranking.EVENT_LABEL_CHANGED, Ranking.EVENT_GROUPS_CHANGED,\r\n      Ranking.EVENT_ADD_COLUMN, Ranking.EVENT_REMOVE_COLUMN, Ranking.EVENT_GROUP_CRITERIA_CHANGED, Ranking.EVENT_MOVE_COLUMN,\r\n      Ranking.EVENT_DIRTY, Ranking.EVENT_DIRTY_HEADER, Ranking.EVENT_DIRTY_VALUES,\r\n      Ranking.EVENT_GROUP_SORT_CRITERIA_CHANGED, Ranking.EVENT_COLUMN_VISIBILITY_CHANGED,\r\n      Ranking.EVENT_SORT_CRITERIA_CHANGED, Ranking.EVENT_DIRTY_ORDER, Ranking.EVENT_ORDER_CHANGED]);\r\n  }\r\n\r\n  on(type: typeof Ranking.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\r\n  on(type: typeof Ranking.EVENT_FILTER_CHANGED, listener: typeof filterChanged | null): this;\r\n  on(type: typeof Ranking.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\r\n  on(type: typeof Ranking.EVENT_ADD_COLUMN, listener: typeof addColumn | null): this;\r\n  on(type: typeof Ranking.EVENT_MOVE_COLUMN, listener: typeof moveColumn | null): this;\r\n  on(type: typeof Ranking.EVENT_REMOVE_COLUMN, listener: typeof removeColumn | null): this;\r\n  on(type: typeof Ranking.EVENT_DIRTY, listener: typeof dirty | null): this;\r\n  on(type: typeof Ranking.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\r\n  on(type: typeof Ranking.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\r\n  on(type: typeof Ranking.EVENT_COLUMN_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\r\n  on(type: typeof Ranking.EVENT_SORT_CRITERIA_CHANGED, listener: typeof sortCriteriaChanged | null): this;\r\n  on(type: typeof Ranking.EVENT_GROUP_CRITERIA_CHANGED, listener: typeof groupCriteriaChanged | null): this;\r\n  on(type: typeof Ranking.EVENT_GROUP_SORT_CRITERIA_CHANGED, listener: typeof groupSortCriteriaChanged | null): this;\r\n  on(type: typeof Ranking.EVENT_DIRTY_ORDER, listener: typeof dirtyOrder | null): this;\r\n  on(type: typeof Ranking.EVENT_ORDER_CHANGED, listener: typeof orderChanged | null): this;\r\n  on(type: typeof Ranking.EVENT_GROUPS_CHANGED, listener: typeof groupsChanged | null): this;\r\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\r\n  on(type: string | string[], listener: IEventListener | null): this {\r\n    return super.on(type, listener);\r\n  }\r\n\r\n  assignNewId(idGenerator: () => string) {\r\n    this.id = fixCSS(idGenerator());\r\n    this.columns.forEach((c) => c.assignNewId(idGenerator));\r\n  }\r\n\r\n  getLabel() {\r\n    return this.label;\r\n  }\r\n\r\n  setLabel(value: string) {\r\n    if (value === this.label) {\r\n      return;\r\n    }\r\n    this.fire(Ranking.EVENT_LABEL_CHANGED, this.label, this.label = value);\r\n  }\r\n\r\n  setOrder(order: number[]) {\r\n    this.setGroups([Object.assign({order}, defaultGroup)]);\r\n  }\r\n\r\n  setGroups(groups: IOrderedGroup[]) {\r\n    const old = this.getOrder();\r\n    const oldGroups = this.groups;\r\n    this.groups = groups;\r\n    this.fire([Ranking.EVENT_ORDER_CHANGED, Ranking.EVENT_GROUPS_CHANGED, Ranking.EVENT_DIRTY_VALUES, Ranking.EVENT_DIRTY], old, this.getOrder(), oldGroups, groups);\r\n  }\r\n\r\n  getOrder() {\r\n    switch (this.groups.length) {\r\n      case 0:\r\n        return [];\r\n      case 1:\r\n        return this.groups[0].order;\r\n      default:\r\n        return (<number[]>[]).concat(...this.groups.map((g) => g.order));\r\n    }\r\n  }\r\n\r\n  getGroups() {\r\n    return this.groups.slice();\r\n  }\r\n\r\n  dump(toDescRef: (desc: any) => any) {\r\n    const r: any = {};\r\n    r.columns = this.columns.map((d) => d.dump(toDescRef));\r\n    r.sortCriteria = this.sortCriteria.map((s) => ({asc: s.asc, sortBy: s.col!.id}));\r\n    r.groupSortCriteria = this.groupSortCriteria.map((s) => ({asc: s.asc, sortBy: s.col!.id}));\r\n    r.groupColumns = this.groupColumns.map((d) => d.id);\r\n    return r;\r\n  }\r\n\r\n  restore(dump: any, factory: (dump: any) => Column | null) {\r\n    this.clear();\r\n    dump.columns.map((child: any) => {\r\n      const c = factory(child);\r\n      if (c) {\r\n        this.push(c);\r\n      }\r\n    });\r\n    // compatibility case\r\n    if (dump.sortColumn && dump.sortColumn.sortBy) {\r\n      const help = this.columns.find((d) => d.id === dump.sortColumn.sortBy);\r\n      if (help) {\r\n        this.sortBy(help, dump.sortColumn.asc);\r\n      }\r\n    }\r\n    if (dump.groupColumns) {\r\n      const groupColumns = dump.groupColumns.map((id: string) => this.columns.find((d) => d.id === id));\r\n      this.groupBy(groupColumns);\r\n    }\r\n\r\n    const restoreSortCriteria = (dumped: any) => {\r\n      return dumped.map((s: { asc: boolean, sortBy: string }) => {\r\n        return {\r\n          asc: s.asc,\r\n          col: this.columns.find((d) => d.id === s.sortBy) || null\r\n        };\r\n      }).filter((s: any) => s.col);\r\n    };\r\n\r\n    if (dump.sortCriteria) {\r\n      this.setSortCriteria(restoreSortCriteria(dump.sortCriteria));\r\n    }\r\n\r\n    if (dump.groupSortCriteria) {\r\n      this.setGroupSortCriteria(restoreSortCriteria(dump.groupSortCriteria));\r\n    }\r\n  }\r\n\r\n  flatten(r: IFlatColumn[], offset: number, levelsToGo = 0, padding = 0) {\r\n    let acc = offset; // + this.getWidth() + padding;\r\n    if (levelsToGo > 0 || levelsToGo <= Column.FLAT_ALL_COLUMNS) {\r\n      this.columns.forEach((c) => {\r\n        if (c.getVisible() && levelsToGo <= Column.FLAT_ALL_COLUMNS) {\r\n          acc += c.flatten(r, acc, levelsToGo - 1, padding) + padding;\r\n        }\r\n      });\r\n    }\r\n    return acc - offset;\r\n  }\r\n\r\n  getPrimarySortCriteria(): ISortCriteria | null {\r\n    if (this.sortCriteria.length === 0) {\r\n      return null;\r\n    }\r\n    return this.sortCriteria[0];\r\n  }\r\n\r\n  getSortCriteria(): ISortCriteria[] {\r\n    return this.sortCriteria.map((d) => Object.assign({}, d));\r\n  }\r\n\r\n  getGroupSortCriteria(): ISortCriteria[] {\r\n    return this.groupSortCriteria.map((d) => Object.assign({}, d));\r\n  }\r\n\r\n  toggleSorting(col: Column) {\r\n    return this.setSortCriteria(this.toggleSortingLogic(col, this.sortCriteria));\r\n  }\r\n\r\n  private toggleSortingLogic(col: Column, sortCriteria: ISortCriteria[]) {\r\n    const newSort = sortCriteria.slice();\r\n    const current = newSort.findIndex((d) => d.col === col);\r\n    const defaultAsc = isSortingAscByDefault(col);\r\n\r\n    if (current < 0) {\r\n      newSort.splice(0, newSort.length, {col, asc: defaultAsc});\r\n    } else if (newSort[current].asc === defaultAsc) {\r\n      // asc -> desc, or desc -> asc\r\n      newSort.splice(current, 1, {col, asc: !defaultAsc});\r\n    } else {\r\n      // remove\r\n      newSort.splice(current, 1);\r\n    }\r\n    return newSort;\r\n  }\r\n\r\n  toggleGrouping(col: Column) {\r\n    const old = this.groupColumns.indexOf(col);\r\n    if (old >= 0) {\r\n      const newGroupings = this.groupColumns.slice();\r\n      newGroupings.splice(old, 1);\r\n      return this.setGroupCriteria(newGroupings);\r\n    }\r\n    return this.setGroupCriteria([col]);\r\n  }\r\n\r\n  getGroupCriteria() {\r\n    return this.groupColumns.slice();\r\n  }\r\n\r\n  /**\r\n   * replaces, moves, or remove the given column in the sorting hierarchy\r\n   * @param col {Column}\r\n   * @param priority {number} when priority < 0 remove the column only else replace at the given priority\r\n   */\r\n  sortBy(col: Column, ascending: boolean = false, priority: number = 0) {\r\n    if (col.findMyRanker() !== this) {\r\n      return false; //not one of mine\r\n    }\r\n    return this.setSortCriteria(this.hierarchyLogic(this.sortCriteria, this.sortCriteria.findIndex((d) => d.col === col), {col, asc: ascending}, priority));\r\n  }\r\n\r\n  /**\r\n   * replaces, moves, or remove the given column in the group sorting hierarchy\r\n   * @param col {Column}\r\n   * @param priority {number} when priority < 0 remove the column only else replace at the given priority\r\n   */\r\n  groupSortBy(col: Column, ascending: boolean = false, priority: number = 0) {\r\n    if (col.findMyRanker() !== this) {\r\n      return false; //not one of mine\r\n    }\r\n    return this.setGroupSortCriteria(this.hierarchyLogic(this.groupSortCriteria, this.groupSortCriteria.findIndex((d) => d.col === col), {col, asc: ascending}, priority));\r\n  }\r\n\r\n  private hierarchyLogic<T>(entries: T[], index: number, entry: T, priority: number) {\r\n    entries = entries.slice();\r\n    if (index >= 0) {\r\n      // move at the other position\r\n      entries.splice(index, 1);\r\n      if (priority >= 0) {\r\n        entries.splice(Math.min(priority, entries.length), 0, entry);\r\n      }\r\n    } else if (priority >= 0) {\r\n      entries[Math.min(priority, entries.length)] = entry;\r\n    }\r\n    return entries;\r\n  }\r\n\r\n  /**\r\n   * replaces, moves, or remove the given column in the grouping hierarchy\r\n   * @param col {Column}\r\n   * @param priority {number} when priority < 0 remove the column only else replace at the given priority\r\n   */\r\n  groupBy(col: Column, priority: number = 0): boolean {\r\n    if (col.findMyRanker() !== this) {\r\n      return false; //not one of mine\r\n    }\r\n    return this.setGroupCriteria(this.hierarchyLogic(this.groupColumns, this.groupColumns.indexOf(col), col, priority));\r\n  }\r\n\r\n  setSortCriteria(value: ISortCriteria | ISortCriteria[]) {\r\n    const values = Array.isArray(value) ? value.slice() : [value];\r\n    // trim\r\n    if (values.length > this.maxSortCriteria) {\r\n      values.splice(this.maxSortCriteria, values.length - this.maxSortCriteria);\r\n    }\r\n    const bak = this.sortCriteria.slice();\r\n\r\n    if (equalCriteria(values, bak)) {\r\n      return false;\r\n    }\r\n\r\n    // update listener\r\n    bak.forEach((d) => {\r\n      d.col.on(`${Column.EVENT_DIRTY_VALUES}.order`, null!);\r\n      d.col.on(`${NumberColumn.EVENT_SORTMETHOD_CHANGED}.order`, null!);\r\n    });\r\n\r\n    values.forEach((d) => {\r\n      d.col.on(`${Column.EVENT_DIRTY_VALUES}.order`, this.dirtyOrder);\r\n      d.col.on(`${NumberColumn.EVENT_SORTMETHOD_CHANGED}.order`, this.dirtyOrder);\r\n    });\r\n    this.sortCriteria.splice(0, this.sortCriteria.length, ...values.slice());\r\n    this.triggerResort(bak);\r\n    return true;\r\n  }\r\n\r\n  setGroupCriteria(column: Column[]|Column) {\r\n    let cols = Array.isArray(column) ? column : [column];\r\n\r\n    // trim\r\n    if (cols.length > this.maxGroupColumns) {\r\n      cols = cols.slice(0, this.maxGroupColumns);\r\n    }\r\n\r\n    if (equalArrays(this.groupColumns, cols)) {\r\n      return true; //same\r\n    }\r\n    this.groupColumns.forEach((groupColumn) => {\r\n      groupColumn.on(suffix('.group', Column.EVENT_DIRTY_VALUES, NumberColumn.EVENT_SORTMETHOD_CHANGED, NumberColumn.EVENT_GROUPING_CHANGED), null);\r\n    });\r\n\r\n    const bak = this.groupColumns.slice();\r\n    this.groupColumns.splice(0, this.groupColumns.length, ...cols);\r\n\r\n    this.groupColumns.forEach((groupColumn) => {\r\n      groupColumn.on(suffix('.group', Column.EVENT_DIRTY_VALUES, NumberColumn.EVENT_SORTMETHOD_CHANGED, NumberColumn.EVENT_GROUPING_CHANGED), this.dirtyOrder);\r\n    });\r\n\r\n    this.fire([Ranking.EVENT_GROUP_CRITERIA_CHANGED, Ranking.EVENT_DIRTY_ORDER, Ranking.EVENT_DIRTY_HEADER,\r\n      Ranking.EVENT_DIRTY_VALUES, Ranking.EVENT_DIRTY], bak, this.getGroupCriteria());\r\n    return true;\r\n  }\r\n\r\n  toggleGroupSorting(col: Column) {\r\n    return this.setGroupSortCriteria(this.toggleSortingLogic(col, this.groupSortCriteria));\r\n  }\r\n\r\n  setMaxSortCriteria(maxSortCriteria: number) {\r\n    const old = this.maxSortCriteria;\r\n    if (old === maxSortCriteria) {\r\n      return;\r\n    }\r\n    this.maxSortCriteria = maxSortCriteria;\r\n    if (old < maxSortCriteria || this.sortCriteria.length < maxSortCriteria) {\r\n      return;\r\n    }\r\n    // check if we have to slice\r\n    this.setSortCriteria(this.sortCriteria.slice(0, maxSortCriteria));\r\n  }\r\n\r\n  getMaxSortCriteria() {\r\n    return this.maxSortCriteria;\r\n  }\r\n\r\n  setMaxGroupColumns(maxGroupColumns: number) {\r\n    const old = this.maxGroupColumns;\r\n    if (old === maxGroupColumns) {\r\n      return;\r\n    }\r\n    this.maxGroupColumns = maxGroupColumns;\r\n    if (old < maxGroupColumns || this.groupColumns.length < maxGroupColumns) {\r\n      return;\r\n    }\r\n    // check if we have to slice\r\n    this.setGroupCriteria(this.groupColumns.slice(0, maxGroupColumns));\r\n  }\r\n\r\n  getMaxGroupColumns() {\r\n    return this.maxGroupColumns;\r\n  }\r\n\r\n  setGroupSortCriteria(value: ISortCriteria | ISortCriteria[]) {\r\n    const values = Array.isArray(value) ? value.slice() : [value];\r\n    // trim\r\n    if (values.length > this.maxSortCriteria) {\r\n      values.splice(this.maxSortCriteria, values.length - this.maxSortCriteria);\r\n    }\r\n\r\n    const bak = this.groupSortCriteria.slice();\r\n\r\n    if (equalCriteria(values, bak)) {\r\n      return false;\r\n    }\r\n\r\n    bak.forEach((d) => {\r\n      d.col.on(`${Column.EVENT_DIRTY_VALUES}.groupOrder`, null!);\r\n      d.col.on(`${NumberColumn.EVENT_SORTMETHOD_CHANGED}.groupOrder`, null!);\r\n    });\r\n\r\n    values.forEach((d) => {\r\n      d.col.on(`${Column.EVENT_DIRTY_VALUES}.groupOrder`, this.dirtyOrder);\r\n      d.col.on(`${NumberColumn.EVENT_SORTMETHOD_CHANGED}.groupOrder`, this.dirtyOrder);\r\n    });\r\n    this.groupSortCriteria.splice(0, this.groupSortCriteria.length, ...values.slice());\r\n    this.triggerGroupResort(bak);\r\n    return true;\r\n  }\r\n\r\n  private triggerGroupResort(bak: ISortCriteria | ISortCriteria[] | null) {\r\n    const sortCriterias = this.getGroupSortCriteria();\r\n    const bakMulti = Array.isArray(bak) ? bak : sortCriterias;\r\n    this.fire([Ranking.EVENT_GROUP_SORT_CRITERIA_CHANGED, Ranking.EVENT_DIRTY_ORDER, Ranking.EVENT_DIRTY_HEADER,\r\n      Ranking.EVENT_DIRTY_VALUES, Ranking.EVENT_DIRTY], bakMulti, sortCriterias);\r\n  }\r\n\r\n  private triggerResort(bak: ISortCriteria | ISortCriteria[] | null) {\r\n    const sortCriterias = this.getSortCriteria();\r\n    const bakMulti = Array.isArray(bak) ? bak : sortCriterias;\r\n    this.fire([Ranking.EVENT_SORT_CRITERIA_CHANGED, Ranking.EVENT_DIRTY_ORDER, Ranking.EVENT_DIRTY_HEADER,\r\n      Ranking.EVENT_DIRTY_VALUES, Ranking.EVENT_DIRTY], bakMulti, sortCriterias);\r\n  }\r\n\r\n  get children() {\r\n    return this.columns.slice();\r\n  }\r\n\r\n  get length() {\r\n    return this.columns.length;\r\n  }\r\n\r\n  insert(col: Column, index: number = this.columns.length) {\r\n    this.columns.splice(index, 0, col);\r\n    col.attach(this);\r\n    this.forward(col, ...suffix('.ranking', Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY_HEADER, Column.EVENT_DIRTY, NumberColumn.EVENT_FILTER_CHANGED));\r\n    col.on(`${Ranking.EVENT_FILTER_CHANGED}.order`, this.dirtyOrder);\r\n\r\n    col.on(`${Column.EVENT_VISIBILITY_CHANGED}.ranking`, (oldValue, newValue) => this.fire([Ranking.EVENT_COLUMN_VISIBILITY_CHANGED, Ranking.EVENT_DIRTY_HEADER, Ranking.EVENT_DIRTY_VALUES, Ranking.EVENT_DIRTY], col, oldValue, newValue));\r\n\r\n    this.fire([Ranking.EVENT_ADD_COLUMN, Ranking.EVENT_DIRTY_HEADER, Ranking.EVENT_DIRTY_VALUES, Ranking.EVENT_DIRTY], col, index);\r\n    return col;\r\n  }\r\n\r\n  move(col: Column, index: number = this.columns.length) {\r\n    if (col.parent !== this) {\r\n      // not a move operation!\r\n      console.error('invalid move operation: ', col);\r\n      return null;\r\n    }\r\n    const old = this.columns.indexOf(col);\r\n    if (index === old) {\r\n      // no move needed\r\n      return col;\r\n    }\r\n    //delete first\r\n    this.columns.splice(old, 1);\r\n    // adapt target index based on previous index, i.e shift by one\r\n    this.columns.splice(old < index ? index - 1 : index, 0, col);\r\n\r\n    this.fire([Ranking.EVENT_MOVE_COLUMN, Ranking.EVENT_DIRTY_HEADER, Ranking.EVENT_DIRTY_VALUES, Ranking.EVENT_DIRTY], col, index, old);\r\n    return col;\r\n  }\r\n\r\n  moveAfter(col: Column, reference: Column) {\r\n    const i = this.columns.indexOf(reference);\r\n    if (i < 0) {\r\n      return null;\r\n    }\r\n    return this.move(col, i + 1);\r\n  }\r\n\r\n  get fqpath() {\r\n    return '';\r\n  }\r\n\r\n  findByPath(fqpath: string): Column {\r\n    let p: IColumnParent | Column = <any>this;\r\n    const indices = fqpath.split('@').map(Number).slice(1); //ignore the first entry = ranking\r\n    while (indices.length > 0) {\r\n      const i = indices.shift()!;\r\n      p = (<IColumnParent>p).at(i);\r\n    }\r\n    return <Column>p;\r\n  }\r\n\r\n  indexOf(col: Column) {\r\n    return this.columns.indexOf(col);\r\n  }\r\n\r\n  at(index: number) {\r\n    return this.columns[index];\r\n  }\r\n\r\n  insertAfter(col: Column, ref: Column) {\r\n    const i = this.columns.indexOf(ref);\r\n    if (i < 0) {\r\n      return null;\r\n    }\r\n    return this.insert(col, i + 1);\r\n  }\r\n\r\n  push(col: Column) {\r\n    return this.insert(col);\r\n  }\r\n\r\n  remove(col: Column) {\r\n    const i = this.columns.indexOf(col);\r\n    if (i < 0) {\r\n      return false;\r\n    }\r\n\r\n    this.unforward(col, ...suffix('.ranking', Column.EVENT_VISIBILITY_CHANGED, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY_HEADER, Column.EVENT_DIRTY, NumberColumn.EVENT_FILTER_CHANGED));\r\n\r\n    const isSortCriteria = this.sortCriteria.findIndex((d) => d.col === col);\r\n    const sortCriteriaChanged = isSortCriteria >= 0;\r\n    if (sortCriteriaChanged) {\r\n      this.sortCriteria.splice(isSortCriteria, 1);\r\n    }\r\n\r\n    const isGroupSortCriteria = this.groupSortCriteria.findIndex((d) => d.col === col);\r\n    const groupSortCriteriaChanged = isGroupSortCriteria >= 0;\r\n    if (groupSortCriteriaChanged) {\r\n      this.groupSortCriteria.splice(isGroupSortCriteria, 1);\r\n    }\r\n\r\n    let newGrouping: Column[]|null = null;\r\n    const isGroupColumn = this.groupColumns.indexOf(col);\r\n    if (isGroupColumn >= 0) { // was my grouping criteria\r\n      newGrouping = this.groupColumns.slice();\r\n      newGrouping.splice(isGroupColumn, 1);\r\n    }\r\n\r\n    col.detach();\r\n    this.columns.splice(i, 1);\r\n\r\n    this.fire([Ranking.EVENT_REMOVE_COLUMN, Ranking.EVENT_DIRTY_HEADER, Ranking.EVENT_DIRTY_VALUES, Ranking.EVENT_DIRTY], col, i);\r\n\r\n    if (newGrouping) {\r\n      this.setGroupCriteria(newGrouping);\r\n    } else if (sortCriteriaChanged) {\r\n      this.triggerResort(null);\r\n    } else if (groupSortCriteriaChanged) {\r\n      this.triggerGroupResort(null);\r\n    } else if (col.isFiltered()) {\r\n      this.dirtyOrder();\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  clear() {\r\n    if (this.columns.length === 0) {\r\n      return;\r\n    }\r\n    this.sortCriteria.splice(0, this.sortCriteria.length);\r\n    this.groupSortCriteria.splice(0, this.groupSortCriteria.length);\r\n\r\n    this.groupColumns.forEach((groupColumn) => {\r\n      groupColumn.on(`${Column.EVENT_DIRTY_VALUES}.group`, null);\r\n      groupColumn.on(`${NumberColumn.EVENT_SORTMETHOD_CHANGED}.group`, null);\r\n    });\r\n    this.groupColumns.splice(0, this.groupColumns.length);\r\n\r\n    this.columns.forEach((col) => {\r\n      this.unforward(col, ...suffix('.ranking', Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY_HEADER, Column.EVENT_DIRTY, NumberColumn.EVENT_FILTER_CHANGED));\r\n      col.detach();\r\n    });\r\n    const removed = this.columns.splice(0, this.columns.length);\r\n    this.fire([Ranking.EVENT_REMOVE_COLUMN, Ranking.EVENT_DIRTY_HEADER, Ranking.EVENT_DIRTY_VALUES, Ranking.EVENT_DIRTY], removed);\r\n  }\r\n\r\n  get flatColumns(): Column[] {\r\n    const r: IFlatColumn[] = [];\r\n    this.flatten(r, 0, Column.FLAT_ALL_COLUMNS);\r\n    return r.map((d) => d.col);\r\n  }\r\n\r\n  find(idOrFilter: string | ((col: Column) => boolean)) {\r\n    const filter = typeof(idOrFilter) === 'string' ? (col: Column) => col.id === idOrFilter : idOrFilter;\r\n    const r = this.flatColumns;\r\n    for (const v of r) {\r\n      if (filter(v)) {\r\n        return v;\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n\r\n  isFiltered() {\r\n    return this.columns.some((d) => d.isFiltered());\r\n  }\r\n\r\n  filter(row: IDataRow) {\r\n    return this.columns.every((d) => d.filter(row));\r\n  }\r\n\r\n  findMyRanker() {\r\n    return this;\r\n  }\r\n\r\n  get fqid() {\r\n    return this.id;\r\n  }\r\n\r\n  /**\r\n   * marks the header, values, or both as dirty such that the values are reevaluated\r\n   * @param type specify in more detail what is dirty, by default whole column\r\n   */\r\n  markDirty(type: 'header' | 'values' | 'all' = 'all') {\r\n    switch (type) {\r\n      case 'header':\r\n        return this.fire([Column.EVENT_DIRTY_HEADER, Column.EVENT_DIRTY]);\r\n      case 'values':\r\n        return this.fire([Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY]);\r\n      default:\r\n        return this.fire([Column.EVENT_DIRTY_HEADER, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY]);\r\n    }\r\n  }\r\n}\r\n\r\nfunction equalCriteria(a: ISortCriteria[], b: ISortCriteria[]) {\r\n  if (a.length !== b.length) {\r\n    return false;\r\n  }\r\n  return a.every((ai, i) => {\r\n    const bi = b[i];\r\n    return ai.col === bi.col && ai.asc === bi.asc;\r\n  });\r\n}\r\n","export default function(a, b) {\n  return a < b ? -1 : a > b ? 1 : a >= b ? 0 : NaN;\n}\n","import ascending from \"./ascending\";\n\nexport default function(compare) {\n  if (compare.length === 1) compare = ascendingComparator(compare);\n  return {\n    left: function(a, x, lo, hi) {\n      if (lo == null) lo = 0;\n      if (hi == null) hi = a.length;\n      while (lo < hi) {\n        var mid = lo + hi >>> 1;\n        if (compare(a[mid], x) < 0) lo = mid + 1;\n        else hi = mid;\n      }\n      return lo;\n    },\n    right: function(a, x, lo, hi) {\n      if (lo == null) lo = 0;\n      if (hi == null) hi = a.length;\n      while (lo < hi) {\n        var mid = lo + hi >>> 1;\n        if (compare(a[mid], x) > 0) hi = mid;\n        else lo = mid + 1;\n      }\n      return lo;\n    }\n  };\n}\n\nfunction ascendingComparator(f) {\n  return function(d, x) {\n    return ascending(f(d), x);\n  };\n}\n","import ascending from \"./ascending\";\nimport bisector from \"./bisector\";\n\nvar ascendingBisect = bisector(ascending);\nexport var bisectRight = ascendingBisect.right;\nexport var bisectLeft = ascendingBisect.left;\nexport default bisectRight;\n","import {pair} from \"./pairs\";\n\nexport default function(values0, values1, reduce) {\n  var n0 = values0.length,\n      n1 = values1.length,\n      values = new Array(n0 * n1),\n      i0,\n      i1,\n      i,\n      value0;\n\n  if (reduce == null) reduce = pair;\n\n  for (i0 = i = 0; i0 < n0; ++i0) {\n    for (value0 = values0[i0], i1 = 0; i1 < n1; ++i1, ++i) {\n      values[i] = reduce(value0, values1[i1]);\n    }\n  }\n\n  return values;\n}\n","export default function(x) {\n  return x === null ? NaN : +x;\n}\n","export default function(values, valueof) {\n  var n = values.length,\n      i = -1,\n      value,\n      min,\n      max;\n\n  if (valueof == null) {\n    while (++i < n) { // Find the first comparable value.\n      if ((value = values[i]) != null && value >= value) {\n        min = max = value;\n        while (++i < n) { // Compare the remaining values.\n          if ((value = values[i]) != null) {\n            if (min > value) min = value;\n            if (max < value) max = value;\n          }\n        }\n      }\n    }\n  }\n\n  else {\n    while (++i < n) { // Find the first comparable value.\n      if ((value = valueof(values[i], i, values)) != null && value >= value) {\n        min = max = value;\n        while (++i < n) { // Compare the remaining values.\n          if ((value = valueof(values[i], i, values)) != null) {\n            if (min > value) min = value;\n            if (max < value) max = value;\n          }\n        }\n      }\n    }\n  }\n\n  return [min, max];\n}\n","var array = Array.prototype;\n\nexport var slice = array.slice;\nexport var map = array.map;\n","export default function(x) {\n  return function() {\n    return x;\n  };\n}\n","export default function(x) {\n  return x;\n}\n","export default function(start, stop, step) {\n  start = +start, stop = +stop, step = (n = arguments.length) < 2 ? (stop = start, start = 0, 1) : n < 3 ? 1 : +step;\n\n  var i = -1,\n      n = Math.max(0, Math.ceil((stop - start) / step)) | 0,\n      range = new Array(n);\n\n  while (++i < n) {\n    range[i] = start + i * step;\n  }\n\n  return range;\n}\n","var e10 = Math.sqrt(50),\n    e5 = Math.sqrt(10),\n    e2 = Math.sqrt(2);\n\nexport default function(start, stop, count) {\n  var reverse,\n      i = -1,\n      n,\n      ticks,\n      step;\n\n  stop = +stop, start = +start, count = +count;\n  if (start === stop && count > 0) return [start];\n  if (reverse = stop < start) n = start, start = stop, stop = n;\n  if ((step = tickIncrement(start, stop, count)) === 0 || !isFinite(step)) return [];\n\n  if (step > 0) {\n    start = Math.ceil(start / step);\n    stop = Math.floor(stop / step);\n    ticks = new Array(n = Math.ceil(stop - start + 1));\n    while (++i < n) ticks[i] = (start + i) * step;\n  } else {\n    start = Math.floor(start * step);\n    stop = Math.ceil(stop * step);\n    ticks = new Array(n = Math.ceil(start - stop + 1));\n    while (++i < n) ticks[i] = (start - i) / step;\n  }\n\n  if (reverse) ticks.reverse();\n\n  return ticks;\n}\n\nexport function tickIncrement(start, stop, count) {\n  var step = (stop - start) / Math.max(0, count),\n      power = Math.floor(Math.log(step) / Math.LN10),\n      error = step / Math.pow(10, power);\n  return power >= 0\n      ? (error >= e10 ? 10 : error >= e5 ? 5 : error >= e2 ? 2 : 1) * Math.pow(10, power)\n      : -Math.pow(10, -power) / (error >= e10 ? 10 : error >= e5 ? 5 : error >= e2 ? 2 : 1);\n}\n\nexport function tickStep(start, stop, count) {\n  var step0 = Math.abs(stop - start) / Math.max(0, count),\n      step1 = Math.pow(10, Math.floor(Math.log(step0) / Math.LN10)),\n      error = step0 / step1;\n  if (error >= e10) step1 *= 10;\n  else if (error >= e5) step1 *= 5;\n  else if (error >= e2) step1 *= 2;\n  return stop < start ? -step1 : step1;\n}\n","export default function(values) {\n  return Math.ceil(Math.log(values.length) / Math.LN2) + 1;\n}\n","import {slice} from \"./array\";\nimport bisect from \"./bisect\";\nimport constant from \"./constant\";\nimport extent from \"./extent\";\nimport identity from \"./identity\";\nimport range from \"./range\";\nimport {tickStep} from \"./ticks\";\nimport sturges from \"./threshold/sturges\";\n\nexport default function() {\n  var value = identity,\n      domain = extent,\n      threshold = sturges;\n\n  function histogram(data) {\n    var i,\n        n = data.length,\n        x,\n        values = new Array(n);\n\n    for (i = 0; i < n; ++i) {\n      values[i] = value(data[i], i, data);\n    }\n\n    var xz = domain(values),\n        x0 = xz[0],\n        x1 = xz[1],\n        tz = threshold(values, x0, x1);\n\n    // Convert number of thresholds into uniform thresholds.\n    if (!Array.isArray(tz)) {\n      tz = tickStep(x0, x1, tz);\n      tz = range(Math.ceil(x0 / tz) * tz, x1, tz); // exclusive\n    }\n\n    // Remove any thresholds outside the domain.\n    var m = tz.length;\n    while (tz[0] <= x0) tz.shift(), --m;\n    while (tz[m - 1] > x1) tz.pop(), --m;\n\n    var bins = new Array(m + 1),\n        bin;\n\n    // Initialize bins.\n    for (i = 0; i <= m; ++i) {\n      bin = bins[i] = [];\n      bin.x0 = i > 0 ? tz[i - 1] : x0;\n      bin.x1 = i < m ? tz[i] : x1;\n    }\n\n    // Assign data to bins by value, ignoring any outside the domain.\n    for (i = 0; i < n; ++i) {\n      x = values[i];\n      if (x0 <= x && x <= x1) {\n        bins[bisect(tz, x, 0, m)].push(data[i]);\n      }\n    }\n\n    return bins;\n  }\n\n  histogram.value = function(_) {\n    return arguments.length ? (value = typeof _ === \"function\" ? _ : constant(_), histogram) : value;\n  };\n\n  histogram.domain = function(_) {\n    return arguments.length ? (domain = typeof _ === \"function\" ? _ : constant([_[0], _[1]]), histogram) : domain;\n  };\n\n  histogram.thresholds = function(_) {\n    return arguments.length ? (threshold = typeof _ === \"function\" ? _ : Array.isArray(_) ? constant(slice.call(_)) : constant(_), histogram) : threshold;\n  };\n\n  return histogram;\n}\n","import number from \"./number\";\n\nexport default function(values, p, valueof) {\n  if (valueof == null) valueof = number;\n  if (!(n = values.length)) return;\n  if ((p = +p) <= 0 || n < 2) return +valueof(values[0], 0, values);\n  if (p >= 1) return +valueof(values[n - 1], n - 1, values);\n  var n,\n      i = (n - 1) * p,\n      i0 = Math.floor(i),\n      value0 = +valueof(values[i0], i0, values),\n      value1 = +valueof(values[i0 + 1], i0 + 1, values);\n  return value0 + (value1 - value0) * (i - i0);\n}\n","export default function(values, valueof) {\n  var n = values.length,\n      i = -1,\n      value,\n      max;\n\n  if (valueof == null) {\n    while (++i < n) { // Find the first comparable value.\n      if ((value = values[i]) != null && value >= value) {\n        max = value;\n        while (++i < n) { // Compare the remaining values.\n          if ((value = values[i]) != null && value > max) {\n            max = value;\n          }\n        }\n      }\n    }\n  }\n\n  else {\n    while (++i < n) { // Find the first comparable value.\n      if ((value = valueof(values[i], i, values)) != null && value >= value) {\n        max = value;\n        while (++i < n) { // Compare the remaining values.\n          if ((value = valueof(values[i], i, values)) != null && value > max) {\n            max = value;\n          }\n        }\n      }\n    }\n  }\n\n  return max;\n}\n","import number from \"./number\";\n\nexport default function(values, valueof) {\n  var n = values.length,\n      m = n,\n      i = -1,\n      value,\n      sum = 0;\n\n  if (valueof == null) {\n    while (++i < n) {\n      if (!isNaN(value = number(values[i]))) sum += value;\n      else --m;\n    }\n  }\n\n  else {\n    while (++i < n) {\n      if (!isNaN(value = number(valueof(values[i], i, values)))) sum += value;\n      else --m;\n    }\n  }\n\n  if (m) return sum / m;\n}\n","import ascending from \"./ascending\";\nimport number from \"./number\";\nimport quantile from \"./quantile\";\n\nexport default function(values, valueof) {\n  var n = values.length,\n      i = -1,\n      value,\n      numbers = [];\n\n  if (valueof == null) {\n    while (++i < n) {\n      if (!isNaN(value = number(values[i]))) {\n        numbers.push(value);\n      }\n    }\n  }\n\n  else {\n    while (++i < n) {\n      if (!isNaN(value = number(valueof(values[i], i, values)))) {\n        numbers.push(value);\n      }\n    }\n  }\n\n  return quantile(numbers.sort(ascending), 0.5);\n}\n","export default function(values, valueof) {\n  var n = values.length,\n      i = -1,\n      value,\n      min;\n\n  if (valueof == null) {\n    while (++i < n) { // Find the first comparable value.\n      if ((value = values[i]) != null && value >= value) {\n        min = value;\n        while (++i < n) { // Compare the remaining values.\n          if ((value = values[i]) != null && min > value) {\n            min = value;\n          }\n        }\n      }\n    }\n  }\n\n  else {\n    while (++i < n) { // Find the first comparable value.\n      if ((value = valueof(values[i], i, values)) != null && value >= value) {\n        min = value;\n        while (++i < n) { // Compare the remaining values.\n          if ((value = valueof(values[i], i, values)) != null && min > value) {\n            min = value;\n          }\n        }\n      }\n    }\n  }\n\n  return min;\n}\n","export {default as bisect, bisectRight, bisectLeft} from \"./bisect\";\nexport {default as ascending} from \"./ascending\";\nexport {default as bisector} from \"./bisector\";\nexport {default as cross} from \"./cross\";\nexport {default as descending} from \"./descending\";\nexport {default as deviation} from \"./deviation\";\nexport {default as extent} from \"./extent\";\nexport {default as histogram} from \"./histogram\";\nexport {default as thresholdFreedmanDiaconis} from \"./threshold/freedmanDiaconis\";\nexport {default as thresholdScott} from \"./threshold/scott\";\nexport {default as thresholdSturges} from \"./threshold/sturges\";\nexport {default as max} from \"./max\";\nexport {default as mean} from \"./mean\";\nexport {default as median} from \"./median\";\nexport {default as merge} from \"./merge\";\nexport {default as min} from \"./min\";\nexport {default as pairs} from \"./pairs\";\nexport {default as permute} from \"./permute\";\nexport {default as quantile} from \"./quantile\";\nexport {default as range} from \"./range\";\nexport {default as scan} from \"./scan\";\nexport {default as shuffle} from \"./shuffle\";\nexport {default as sum} from \"./sum\";\nexport {default as ticks, tickIncrement, tickStep} from \"./ticks\";\nexport {default as transpose} from \"./transpose\";\nexport {default as variance} from \"./variance\";\nexport {default as zip} from \"./zip\";\n","var noop = {value: function() {}};\n\nfunction dispatch() {\n  for (var i = 0, n = arguments.length, _ = {}, t; i < n; ++i) {\n    if (!(t = arguments[i] + \"\") || (t in _) || /[\\s.]/.test(t)) throw new Error(\"illegal type: \" + t);\n    _[t] = [];\n  }\n  return new Dispatch(_);\n}\n\nfunction Dispatch(_) {\n  this._ = _;\n}\n\nfunction parseTypenames(typenames, types) {\n  return typenames.trim().split(/^|\\s+/).map(function(t) {\n    var name = \"\", i = t.indexOf(\".\");\n    if (i >= 0) name = t.slice(i + 1), t = t.slice(0, i);\n    if (t && !types.hasOwnProperty(t)) throw new Error(\"unknown type: \" + t);\n    return {type: t, name: name};\n  });\n}\n\nDispatch.prototype = dispatch.prototype = {\n  constructor: Dispatch,\n  on: function(typename, callback) {\n    var _ = this._,\n        T = parseTypenames(typename + \"\", _),\n        t,\n        i = -1,\n        n = T.length;\n\n    // If no callback was specified, return the callback of the given type and name.\n    if (arguments.length < 2) {\n      while (++i < n) if ((t = (typename = T[i]).type) && (t = get(_[t], typename.name))) return t;\n      return;\n    }\n\n    // If a type was specified, set the callback for the given type and name.\n    // Otherwise, if a null callback was specified, remove callbacks of the given name.\n    if (callback != null && typeof callback !== \"function\") throw new Error(\"invalid callback: \" + callback);\n    while (++i < n) {\n      if (t = (typename = T[i]).type) _[t] = set(_[t], typename.name, callback);\n      else if (callback == null) for (t in _) _[t] = set(_[t], typename.name, null);\n    }\n\n    return this;\n  },\n  copy: function() {\n    var copy = {}, _ = this._;\n    for (var t in _) copy[t] = _[t].slice();\n    return new Dispatch(copy);\n  },\n  call: function(type, that) {\n    if ((n = arguments.length - 2) > 0) for (var args = new Array(n), i = 0, n, t; i < n; ++i) args[i] = arguments[i + 2];\n    if (!this._.hasOwnProperty(type)) throw new Error(\"unknown type: \" + type);\n    for (t = this._[type], i = 0, n = t.length; i < n; ++i) t[i].value.apply(that, args);\n  },\n  apply: function(type, that, args) {\n    if (!this._.hasOwnProperty(type)) throw new Error(\"unknown type: \" + type);\n    for (var t = this._[type], i = 0, n = t.length; i < n; ++i) t[i].value.apply(that, args);\n  }\n};\n\nfunction get(type, name) {\n  for (var i = 0, n = type.length, c; i < n; ++i) {\n    if ((c = type[i]).name === name) {\n      return c.value;\n    }\n  }\n}\n\nfunction set(type, name, callback) {\n  for (var i = 0, n = type.length; i < n; ++i) {\n    if (type[i].name === name) {\n      type[i] = noop, type = type.slice(0, i).concat(type.slice(i + 1));\n      break;\n    }\n  }\n  if (callback != null) type.push({name: name, value: callback});\n  return type;\n}\n\nexport default dispatch;\n","import {dispatch, Dispatch} from 'd3-dispatch';\r\n\r\n/** @internal */\r\nexport function suffix(suffix: string, ...prefix: string[]) {\r\n  return prefix.map((p) => `${p}${suffix}`);\r\n}\r\n\r\nexport interface IEventContext {\r\n  /**\r\n   * who is sending this event\r\n   */\r\n  readonly source: AEventDispatcher;\r\n\r\n  readonly origin: AEventDispatcher;\r\n  /**\r\n   * the event type\r\n   */\r\n  readonly type: string;\r\n  /**\r\n   * in case of multi propagation the 'main' event type\r\n   */\r\n  readonly primaryType: string;\r\n  /**\r\n   * the arguments to the listener\r\n   */\r\n  readonly args: any[];\r\n}\r\n\r\nexport interface IEventListener {\r\n  (this: IEventContext, ...args: any[]): any;\r\n}\r\n\r\nexport interface IEventHandler {\r\n  on(type: string | string[], listener: IEventListener | null): this;\r\n}\r\n\r\ndeclare const __DEBUG__: boolean;\r\n\r\n/**\r\n * base class for event dispatching using d3 event mechanism\r\n */\r\nexport default class AEventDispatcher implements IEventHandler {\r\n  private readonly listeners: Dispatch<any>;\r\n  private readonly listenerEvents: Set<string>;\r\n  private readonly forwarder: (...args: any[]) => void;\r\n\r\n  constructor() {\r\n    const events = this.createEventList();\r\n    this.listenerEvents = new Set(events);\r\n    this.listeners = dispatch(...events);\r\n\r\n    const that = this;\r\n    this.forwarder = function (this: IEventContext, ...args: any[]) {\r\n      that.fireImpl(this.type, this.primaryType, this.origin, ...args);\r\n    };\r\n  }\r\n\r\n  on(type: string | string[], listener: IEventListener | null): this {\r\n    if (Array.isArray(type)) {\r\n      type.forEach((d) => {\r\n        if (this.listenerEvents.has(d.split('.')[0])) {\r\n          this.listenersChanged(d, Boolean(listener!));\r\n          this.listeners.on(d, listener!);\r\n        } else if (__DEBUG__ && !d.includes('.')) {\r\n           console.warn(this, 'invalid event type', d);\r\n        }\r\n      });\r\n    } else if (this.listenerEvents.has((<string>type).split('.')[0])) {\r\n      this.listenersChanged(<string>type, Boolean(listener!));\r\n      this.listeners.on(<string>type, listener!);\r\n    } else if (__DEBUG__ && !type.includes('.')) {\r\n      console.warn(this, 'invalid event type', type);\r\n    }\r\n    return this;\r\n  }\r\n\r\n  protected listenersChanged(_type: string, _active: boolean) {\r\n    // hook\r\n  }\r\n\r\n  /**\r\n   * return the list of events to be able to dispatch\r\n   * @return {Array} by default no events\r\n   */\r\n  protected createEventList(): string[] {\r\n    return [];\r\n  }\r\n\r\n  protected fire(type: string | string[], ...args: any[]) {\r\n    const primaryType = Array.isArray(type) ? type[0] : type;\r\n    this.fireImpl(type, primaryType, this, ...args);\r\n  }\r\n\r\n  private fireImpl(type: string | string[], primaryType: string, origin: AEventDispatcher, ...args: any[]) {\r\n    const fireImpl = (t: string) => {\r\n      if (!this.listenerEvents.has(t)) {\r\n        if (__DEBUG__) {\r\n          console.warn(this, 'invalid event type', t);\r\n        }\r\n        return;\r\n      }\r\n      //local context per event, set a this argument\r\n      const context: IEventContext = {\r\n        source: this, //who is sending this event,\r\n        origin,\r\n        type: t, //the event type\r\n        primaryType, //in case of multi propagation the 'main' event type\r\n        args //the arguments to the listener\r\n      };\r\n      this.listeners.apply(t, context, args);\r\n    };\r\n    if (Array.isArray(type)) {\r\n      type.forEach(fireImpl.bind(this));\r\n    } else {\r\n      fireImpl(<string>type);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * forwards one or more events from a given dispatcher to the current one\r\n   * i.e. when one of the given events is fired in 'from' it will be forwarded to all my listeners\r\n   * @param {IEventHandler} from the event dispatcher to forward from\r\n   * @param {string[]} types the event types to forward\r\n   */\r\n  protected forward(from: IEventHandler, ...types: string[]) {\r\n    from.on(types, this.forwarder);\r\n  }\r\n\r\n  /**\r\n   * removes the forwarding declarations\r\n   * @param {IEventHandler} from the originated dispatcher\r\n   * @param {string[]} types event types to forward\r\n   */\r\n  protected unforward(from: IEventHandler, ...types: string[]) {\r\n    from.on(types, null);\r\n  }\r\n}\r\n","/**!\n * @fileOverview Kickass library to create and place poppers near their reference elements.\n * @version 1.16.0\n * @license\n * Copyright (c) 2016 Federico Zivolo and contributors\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\nvar isBrowser = typeof window !== 'undefined' && typeof document !== 'undefined' && typeof navigator !== 'undefined';\n\nvar timeoutDuration = function () {\n  var longerTimeoutBrowsers = ['Edge', 'Trident', 'Firefox'];\n  for (var i = 0; i < longerTimeoutBrowsers.length; i += 1) {\n    if (isBrowser && navigator.userAgent.indexOf(longerTimeoutBrowsers[i]) >= 0) {\n      return 1;\n    }\n  }\n  return 0;\n}();\n\nfunction microtaskDebounce(fn) {\n  var called = false;\n  return function () {\n    if (called) {\n      return;\n    }\n    called = true;\n    window.Promise.resolve().then(function () {\n      called = false;\n      fn();\n    });\n  };\n}\n\nfunction taskDebounce(fn) {\n  var scheduled = false;\n  return function () {\n    if (!scheduled) {\n      scheduled = true;\n      setTimeout(function () {\n        scheduled = false;\n        fn();\n      }, timeoutDuration);\n    }\n  };\n}\n\nvar supportsMicroTasks = isBrowser && window.Promise;\n\n/**\n* Create a debounced version of a method, that's asynchronously deferred\n* but called in the minimum time possible.\n*\n* @method\n* @memberof Popper.Utils\n* @argument {Function} fn\n* @returns {Function}\n*/\nvar debounce = supportsMicroTasks ? microtaskDebounce : taskDebounce;\n\n/**\n * Check if the given variable is a function\n * @method\n * @memberof Popper.Utils\n * @argument {Any} functionToCheck - variable to check\n * @returns {Boolean} answer to: is a function?\n */\nfunction isFunction(functionToCheck) {\n  var getType = {};\n  return functionToCheck && getType.toString.call(functionToCheck) === '[object Function]';\n}\n\n/**\n * Get CSS computed property of the given element\n * @method\n * @memberof Popper.Utils\n * @argument {Eement} element\n * @argument {String} property\n */\nfunction getStyleComputedProperty(element, property) {\n  if (element.nodeType !== 1) {\n    return [];\n  }\n  // NOTE: 1 DOM access here\n  var window = element.ownerDocument.defaultView;\n  var css = window.getComputedStyle(element, null);\n  return property ? css[property] : css;\n}\n\n/**\n * Returns the parentNode or the host of the element\n * @method\n * @memberof Popper.Utils\n * @argument {Element} element\n * @returns {Element} parent\n */\nfunction getParentNode(element) {\n  if (element.nodeName === 'HTML') {\n    return element;\n  }\n  return element.parentNode || element.host;\n}\n\n/**\n * Returns the scrolling parent of the given element\n * @method\n * @memberof Popper.Utils\n * @argument {Element} element\n * @returns {Element} scroll parent\n */\nfunction getScrollParent(element) {\n  // Return body, `getScroll` will take care to get the correct `scrollTop` from it\n  if (!element) {\n    return document.body;\n  }\n\n  switch (element.nodeName) {\n    case 'HTML':\n    case 'BODY':\n      return element.ownerDocument.body;\n    case '#document':\n      return element.body;\n  }\n\n  // Firefox want us to check `-x` and `-y` variations as well\n\n  var _getStyleComputedProp = getStyleComputedProperty(element),\n      overflow = _getStyleComputedProp.overflow,\n      overflowX = _getStyleComputedProp.overflowX,\n      overflowY = _getStyleComputedProp.overflowY;\n\n  if (/(auto|scroll|overlay)/.test(overflow + overflowY + overflowX)) {\n    return element;\n  }\n\n  return getScrollParent(getParentNode(element));\n}\n\n/**\n * Returns the reference node of the reference object, or the reference object itself.\n * @method\n * @memberof Popper.Utils\n * @param {Element|Object} reference - the reference element (the popper will be relative to this)\n * @returns {Element} parent\n */\nfunction getReferenceNode(reference) {\n  return reference && reference.referenceNode ? reference.referenceNode : reference;\n}\n\nvar isIE11 = isBrowser && !!(window.MSInputMethodContext && document.documentMode);\nvar isIE10 = isBrowser && /MSIE 10/.test(navigator.userAgent);\n\n/**\n * Determines if the browser is Internet Explorer\n * @method\n * @memberof Popper.Utils\n * @param {Number} version to check\n * @returns {Boolean} isIE\n */\nfunction isIE(version) {\n  if (version === 11) {\n    return isIE11;\n  }\n  if (version === 10) {\n    return isIE10;\n  }\n  return isIE11 || isIE10;\n}\n\n/**\n * Returns the offset parent of the given element\n * @method\n * @memberof Popper.Utils\n * @argument {Element} element\n * @returns {Element} offset parent\n */\nfunction getOffsetParent(element) {\n  if (!element) {\n    return document.documentElement;\n  }\n\n  var noOffsetParent = isIE(10) ? document.body : null;\n\n  // NOTE: 1 DOM access here\n  var offsetParent = element.offsetParent || null;\n  // Skip hidden elements which don't have an offsetParent\n  while (offsetParent === noOffsetParent && element.nextElementSibling) {\n    offsetParent = (element = element.nextElementSibling).offsetParent;\n  }\n\n  var nodeName = offsetParent && offsetParent.nodeName;\n\n  if (!nodeName || nodeName === 'BODY' || nodeName === 'HTML') {\n    return element ? element.ownerDocument.documentElement : document.documentElement;\n  }\n\n  // .offsetParent will return the closest TH, TD or TABLE in case\n  // no offsetParent is present, I hate this job...\n  if (['TH', 'TD', 'TABLE'].indexOf(offsetParent.nodeName) !== -1 && getStyleComputedProperty(offsetParent, 'position') === 'static') {\n    return getOffsetParent(offsetParent);\n  }\n\n  return offsetParent;\n}\n\nfunction isOffsetContainer(element) {\n  var nodeName = element.nodeName;\n\n  if (nodeName === 'BODY') {\n    return false;\n  }\n  return nodeName === 'HTML' || getOffsetParent(element.firstElementChild) === element;\n}\n\n/**\n * Finds the root node (document, shadowDOM root) of the given element\n * @method\n * @memberof Popper.Utils\n * @argument {Element} node\n * @returns {Element} root node\n */\nfunction getRoot(node) {\n  if (node.parentNode !== null) {\n    return getRoot(node.parentNode);\n  }\n\n  return node;\n}\n\n/**\n * Finds the offset parent common to the two provided nodes\n * @method\n * @memberof Popper.Utils\n * @argument {Element} element1\n * @argument {Element} element2\n * @returns {Element} common offset parent\n */\nfunction findCommonOffsetParent(element1, element2) {\n  // This check is needed to avoid errors in case one of the elements isn't defined for any reason\n  if (!element1 || !element1.nodeType || !element2 || !element2.nodeType) {\n    return document.documentElement;\n  }\n\n  // Here we make sure to give as \"start\" the element that comes first in the DOM\n  var order = element1.compareDocumentPosition(element2) & Node.DOCUMENT_POSITION_FOLLOWING;\n  var start = order ? element1 : element2;\n  var end = order ? element2 : element1;\n\n  // Get common ancestor container\n  var range = document.createRange();\n  range.setStart(start, 0);\n  range.setEnd(end, 0);\n  var commonAncestorContainer = range.commonAncestorContainer;\n\n  // Both nodes are inside #document\n\n  if (element1 !== commonAncestorContainer && element2 !== commonAncestorContainer || start.contains(end)) {\n    if (isOffsetContainer(commonAncestorContainer)) {\n      return commonAncestorContainer;\n    }\n\n    return getOffsetParent(commonAncestorContainer);\n  }\n\n  // one of the nodes is inside shadowDOM, find which one\n  var element1root = getRoot(element1);\n  if (element1root.host) {\n    return findCommonOffsetParent(element1root.host, element2);\n  } else {\n    return findCommonOffsetParent(element1, getRoot(element2).host);\n  }\n}\n\n/**\n * Gets the scroll value of the given element in the given side (top and left)\n * @method\n * @memberof Popper.Utils\n * @argument {Element} element\n * @argument {String} side `top` or `left`\n * @returns {number} amount of scrolled pixels\n */\nfunction getScroll(element) {\n  var side = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'top';\n\n  var upperSide = side === 'top' ? 'scrollTop' : 'scrollLeft';\n  var nodeName = element.nodeName;\n\n  if (nodeName === 'BODY' || nodeName === 'HTML') {\n    var html = element.ownerDocument.documentElement;\n    var scrollingElement = element.ownerDocument.scrollingElement || html;\n    return scrollingElement[upperSide];\n  }\n\n  return element[upperSide];\n}\n\n/*\n * Sum or subtract the element scroll values (left and top) from a given rect object\n * @method\n * @memberof Popper.Utils\n * @param {Object} rect - Rect object you want to change\n * @param {HTMLElement} element - The element from the function reads the scroll values\n * @param {Boolean} subtract - set to true if you want to subtract the scroll values\n * @return {Object} rect - The modifier rect object\n */\nfunction includeScroll(rect, element) {\n  var subtract = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n\n  var scrollTop = getScroll(element, 'top');\n  var scrollLeft = getScroll(element, 'left');\n  var modifier = subtract ? -1 : 1;\n  rect.top += scrollTop * modifier;\n  rect.bottom += scrollTop * modifier;\n  rect.left += scrollLeft * modifier;\n  rect.right += scrollLeft * modifier;\n  return rect;\n}\n\n/*\n * Helper to detect borders of a given element\n * @method\n * @memberof Popper.Utils\n * @param {CSSStyleDeclaration} styles\n * Result of `getStyleComputedProperty` on the given element\n * @param {String} axis - `x` or `y`\n * @return {number} borders - The borders size of the given axis\n */\n\nfunction getBordersSize(styles, axis) {\n  var sideA = axis === 'x' ? 'Left' : 'Top';\n  var sideB = sideA === 'Left' ? 'Right' : 'Bottom';\n\n  return parseFloat(styles['border' + sideA + 'Width'], 10) + parseFloat(styles['border' + sideB + 'Width'], 10);\n}\n\nfunction getSize(axis, body, html, computedStyle) {\n  return Math.max(body['offset' + axis], body['scroll' + axis], html['client' + axis], html['offset' + axis], html['scroll' + axis], isIE(10) ? parseInt(html['offset' + axis]) + parseInt(computedStyle['margin' + (axis === 'Height' ? 'Top' : 'Left')]) + parseInt(computedStyle['margin' + (axis === 'Height' ? 'Bottom' : 'Right')]) : 0);\n}\n\nfunction getWindowSizes(document) {\n  var body = document.body;\n  var html = document.documentElement;\n  var computedStyle = isIE(10) && getComputedStyle(html);\n\n  return {\n    height: getSize('Height', body, html, computedStyle),\n    width: getSize('Width', body, html, computedStyle)\n  };\n}\n\nvar classCallCheck = function (instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n};\n\nvar createClass = function () {\n  function defineProperties(target, props) {\n    for (var i = 0; i < props.length; i++) {\n      var descriptor = props[i];\n      descriptor.enumerable = descriptor.enumerable || false;\n      descriptor.configurable = true;\n      if (\"value\" in descriptor) descriptor.writable = true;\n      Object.defineProperty(target, descriptor.key, descriptor);\n    }\n  }\n\n  return function (Constructor, protoProps, staticProps) {\n    if (protoProps) defineProperties(Constructor.prototype, protoProps);\n    if (staticProps) defineProperties(Constructor, staticProps);\n    return Constructor;\n  };\n}();\n\n\n\n\n\nvar defineProperty = function (obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n};\n\nvar _extends = Object.assign || function (target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i];\n\n    for (var key in source) {\n      if (Object.prototype.hasOwnProperty.call(source, key)) {\n        target[key] = source[key];\n      }\n    }\n  }\n\n  return target;\n};\n\n/**\n * Given element offsets, generate an output similar to getBoundingClientRect\n * @method\n * @memberof Popper.Utils\n * @argument {Object} offsets\n * @returns {Object} ClientRect like output\n */\nfunction getClientRect(offsets) {\n  return _extends({}, offsets, {\n    right: offsets.left + offsets.width,\n    bottom: offsets.top + offsets.height\n  });\n}\n\n/**\n * Get bounding client rect of given element\n * @method\n * @memberof Popper.Utils\n * @param {HTMLElement} element\n * @return {Object} client rect\n */\nfunction getBoundingClientRect(element) {\n  var rect = {};\n\n  // IE10 10 FIX: Please, don't ask, the element isn't\n  // considered in DOM in some circumstances...\n  // This isn't reproducible in IE10 compatibility mode of IE11\n  try {\n    if (isIE(10)) {\n      rect = element.getBoundingClientRect();\n      var scrollTop = getScroll(element, 'top');\n      var scrollLeft = getScroll(element, 'left');\n      rect.top += scrollTop;\n      rect.left += scrollLeft;\n      rect.bottom += scrollTop;\n      rect.right += scrollLeft;\n    } else {\n      rect = element.getBoundingClientRect();\n    }\n  } catch (e) {}\n\n  var result = {\n    left: rect.left,\n    top: rect.top,\n    width: rect.right - rect.left,\n    height: rect.bottom - rect.top\n  };\n\n  // subtract scrollbar size from sizes\n  var sizes = element.nodeName === 'HTML' ? getWindowSizes(element.ownerDocument) : {};\n  var width = sizes.width || element.clientWidth || result.width;\n  var height = sizes.height || element.clientHeight || result.height;\n\n  var horizScrollbar = element.offsetWidth - width;\n  var vertScrollbar = element.offsetHeight - height;\n\n  // if an hypothetical scrollbar is detected, we must be sure it's not a `border`\n  // we make this check conditional for performance reasons\n  if (horizScrollbar || vertScrollbar) {\n    var styles = getStyleComputedProperty(element);\n    horizScrollbar -= getBordersSize(styles, 'x');\n    vertScrollbar -= getBordersSize(styles, 'y');\n\n    result.width -= horizScrollbar;\n    result.height -= vertScrollbar;\n  }\n\n  return getClientRect(result);\n}\n\nfunction getOffsetRectRelativeToArbitraryNode(children, parent) {\n  var fixedPosition = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n\n  var isIE10 = isIE(10);\n  var isHTML = parent.nodeName === 'HTML';\n  var childrenRect = getBoundingClientRect(children);\n  var parentRect = getBoundingClientRect(parent);\n  var scrollParent = getScrollParent(children);\n\n  var styles = getStyleComputedProperty(parent);\n  var borderTopWidth = parseFloat(styles.borderTopWidth, 10);\n  var borderLeftWidth = parseFloat(styles.borderLeftWidth, 10);\n\n  // In cases where the parent is fixed, we must ignore negative scroll in offset calc\n  if (fixedPosition && isHTML) {\n    parentRect.top = Math.max(parentRect.top, 0);\n    parentRect.left = Math.max(parentRect.left, 0);\n  }\n  var offsets = getClientRect({\n    top: childrenRect.top - parentRect.top - borderTopWidth,\n    left: childrenRect.left - parentRect.left - borderLeftWidth,\n    width: childrenRect.width,\n    height: childrenRect.height\n  });\n  offsets.marginTop = 0;\n  offsets.marginLeft = 0;\n\n  // Subtract margins of documentElement in case it's being used as parent\n  // we do this only on HTML because it's the only element that behaves\n  // differently when margins are applied to it. The margins are included in\n  // the box of the documentElement, in the other cases not.\n  if (!isIE10 && isHTML) {\n    var marginTop = parseFloat(styles.marginTop, 10);\n    var marginLeft = parseFloat(styles.marginLeft, 10);\n\n    offsets.top -= borderTopWidth - marginTop;\n    offsets.bottom -= borderTopWidth - marginTop;\n    offsets.left -= borderLeftWidth - marginLeft;\n    offsets.right -= borderLeftWidth - marginLeft;\n\n    // Attach marginTop and marginLeft because in some circumstances we may need them\n    offsets.marginTop = marginTop;\n    offsets.marginLeft = marginLeft;\n  }\n\n  if (isIE10 && !fixedPosition ? parent.contains(scrollParent) : parent === scrollParent && scrollParent.nodeName !== 'BODY') {\n    offsets = includeScroll(offsets, parent);\n  }\n\n  return offsets;\n}\n\nfunction getViewportOffsetRectRelativeToArtbitraryNode(element) {\n  var excludeScroll = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n\n  var html = element.ownerDocument.documentElement;\n  var relativeOffset = getOffsetRectRelativeToArbitraryNode(element, html);\n  var width = Math.max(html.clientWidth, window.innerWidth || 0);\n  var height = Math.max(html.clientHeight, window.innerHeight || 0);\n\n  var scrollTop = !excludeScroll ? getScroll(html) : 0;\n  var scrollLeft = !excludeScroll ? getScroll(html, 'left') : 0;\n\n  var offset = {\n    top: scrollTop - relativeOffset.top + relativeOffset.marginTop,\n    left: scrollLeft - relativeOffset.left + relativeOffset.marginLeft,\n    width: width,\n    height: height\n  };\n\n  return getClientRect(offset);\n}\n\n/**\n * Check if the given element is fixed or is inside a fixed parent\n * @method\n * @memberof Popper.Utils\n * @argument {Element} element\n * @argument {Element} customContainer\n * @returns {Boolean} answer to \"isFixed?\"\n */\nfunction isFixed(element) {\n  var nodeName = element.nodeName;\n  if (nodeName === 'BODY' || nodeName === 'HTML') {\n    return false;\n  }\n  if (getStyleComputedProperty(element, 'position') === 'fixed') {\n    return true;\n  }\n  var parentNode = getParentNode(element);\n  if (!parentNode) {\n    return false;\n  }\n  return isFixed(parentNode);\n}\n\n/**\n * Finds the first parent of an element that has a transformed property defined\n * @method\n * @memberof Popper.Utils\n * @argument {Element} element\n * @returns {Element} first transformed parent or documentElement\n */\n\nfunction getFixedPositionOffsetParent(element) {\n  // This check is needed to avoid errors in case one of the elements isn't defined for any reason\n  if (!element || !element.parentElement || isIE()) {\n    return document.documentElement;\n  }\n  var el = element.parentElement;\n  while (el && getStyleComputedProperty(el, 'transform') === 'none') {\n    el = el.parentElement;\n  }\n  return el || document.documentElement;\n}\n\n/**\n * Computed the boundaries limits and return them\n * @method\n * @memberof Popper.Utils\n * @param {HTMLElement} popper\n * @param {HTMLElement} reference\n * @param {number} padding\n * @param {HTMLElement} boundariesElement - Element used to define the boundaries\n * @param {Boolean} fixedPosition - Is in fixed position mode\n * @returns {Object} Coordinates of the boundaries\n */\nfunction getBoundaries(popper, reference, padding, boundariesElement) {\n  var fixedPosition = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : false;\n\n  // NOTE: 1 DOM access here\n\n  var boundaries = { top: 0, left: 0 };\n  var offsetParent = fixedPosition ? getFixedPositionOffsetParent(popper) : findCommonOffsetParent(popper, getReferenceNode(reference));\n\n  // Handle viewport case\n  if (boundariesElement === 'viewport') {\n    boundaries = getViewportOffsetRectRelativeToArtbitraryNode(offsetParent, fixedPosition);\n  } else {\n    // Handle other cases based on DOM element used as boundaries\n    var boundariesNode = void 0;\n    if (boundariesElement === 'scrollParent') {\n      boundariesNode = getScrollParent(getParentNode(reference));\n      if (boundariesNode.nodeName === 'BODY') {\n        boundariesNode = popper.ownerDocument.documentElement;\n      }\n    } else if (boundariesElement === 'window') {\n      boundariesNode = popper.ownerDocument.documentElement;\n    } else {\n      boundariesNode = boundariesElement;\n    }\n\n    var offsets = getOffsetRectRelativeToArbitraryNode(boundariesNode, offsetParent, fixedPosition);\n\n    // In case of HTML, we need a different computation\n    if (boundariesNode.nodeName === 'HTML' && !isFixed(offsetParent)) {\n      var _getWindowSizes = getWindowSizes(popper.ownerDocument),\n          height = _getWindowSizes.height,\n          width = _getWindowSizes.width;\n\n      boundaries.top += offsets.top - offsets.marginTop;\n      boundaries.bottom = height + offsets.top;\n      boundaries.left += offsets.left - offsets.marginLeft;\n      boundaries.right = width + offsets.left;\n    } else {\n      // for all the other DOM elements, this one is good\n      boundaries = offsets;\n    }\n  }\n\n  // Add paddings\n  padding = padding || 0;\n  var isPaddingNumber = typeof padding === 'number';\n  boundaries.left += isPaddingNumber ? padding : padding.left || 0;\n  boundaries.top += isPaddingNumber ? padding : padding.top || 0;\n  boundaries.right -= isPaddingNumber ? padding : padding.right || 0;\n  boundaries.bottom -= isPaddingNumber ? padding : padding.bottom || 0;\n\n  return boundaries;\n}\n\nfunction getArea(_ref) {\n  var width = _ref.width,\n      height = _ref.height;\n\n  return width * height;\n}\n\n/**\n * Utility used to transform the `auto` placement to the placement with more\n * available space.\n * @method\n * @memberof Popper.Utils\n * @argument {Object} data - The data object generated by update method\n * @argument {Object} options - Modifiers configuration and options\n * @returns {Object} The data object, properly modified\n */\nfunction computeAutoPlacement(placement, refRect, popper, reference, boundariesElement) {\n  var padding = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : 0;\n\n  if (placement.indexOf('auto') === -1) {\n    return placement;\n  }\n\n  var boundaries = getBoundaries(popper, reference, padding, boundariesElement);\n\n  var rects = {\n    top: {\n      width: boundaries.width,\n      height: refRect.top - boundaries.top\n    },\n    right: {\n      width: boundaries.right - refRect.right,\n      height: boundaries.height\n    },\n    bottom: {\n      width: boundaries.width,\n      height: boundaries.bottom - refRect.bottom\n    },\n    left: {\n      width: refRect.left - boundaries.left,\n      height: boundaries.height\n    }\n  };\n\n  var sortedAreas = Object.keys(rects).map(function (key) {\n    return _extends({\n      key: key\n    }, rects[key], {\n      area: getArea(rects[key])\n    });\n  }).sort(function (a, b) {\n    return b.area - a.area;\n  });\n\n  var filteredAreas = sortedAreas.filter(function (_ref2) {\n    var width = _ref2.width,\n        height = _ref2.height;\n    return width >= popper.clientWidth && height >= popper.clientHeight;\n  });\n\n  var computedPlacement = filteredAreas.length > 0 ? filteredAreas[0].key : sortedAreas[0].key;\n\n  var variation = placement.split('-')[1];\n\n  return computedPlacement + (variation ? '-' + variation : '');\n}\n\n/**\n * Get offsets to the reference element\n * @method\n * @memberof Popper.Utils\n * @param {Object} state\n * @param {Element} popper - the popper element\n * @param {Element} reference - the reference element (the popper will be relative to this)\n * @param {Element} fixedPosition - is in fixed position mode\n * @returns {Object} An object containing the offsets which will be applied to the popper\n */\nfunction getReferenceOffsets(state, popper, reference) {\n  var fixedPosition = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : null;\n\n  var commonOffsetParent = fixedPosition ? getFixedPositionOffsetParent(popper) : findCommonOffsetParent(popper, getReferenceNode(reference));\n  return getOffsetRectRelativeToArbitraryNode(reference, commonOffsetParent, fixedPosition);\n}\n\n/**\n * Get the outer sizes of the given element (offset size + margins)\n * @method\n * @memberof Popper.Utils\n * @argument {Element} element\n * @returns {Object} object containing width and height properties\n */\nfunction getOuterSizes(element) {\n  var window = element.ownerDocument.defaultView;\n  var styles = window.getComputedStyle(element);\n  var x = parseFloat(styles.marginTop || 0) + parseFloat(styles.marginBottom || 0);\n  var y = parseFloat(styles.marginLeft || 0) + parseFloat(styles.marginRight || 0);\n  var result = {\n    width: element.offsetWidth + y,\n    height: element.offsetHeight + x\n  };\n  return result;\n}\n\n/**\n * Get the opposite placement of the given one\n * @method\n * @memberof Popper.Utils\n * @argument {String} placement\n * @returns {String} flipped placement\n */\nfunction getOppositePlacement(placement) {\n  var hash = { left: 'right', right: 'left', bottom: 'top', top: 'bottom' };\n  return placement.replace(/left|right|bottom|top/g, function (matched) {\n    return hash[matched];\n  });\n}\n\n/**\n * Get offsets to the popper\n * @method\n * @memberof Popper.Utils\n * @param {Object} position - CSS position the Popper will get applied\n * @param {HTMLElement} popper - the popper element\n * @param {Object} referenceOffsets - the reference offsets (the popper will be relative to this)\n * @param {String} placement - one of the valid placement options\n * @returns {Object} popperOffsets - An object containing the offsets which will be applied to the popper\n */\nfunction getPopperOffsets(popper, referenceOffsets, placement) {\n  placement = placement.split('-')[0];\n\n  // Get popper node sizes\n  var popperRect = getOuterSizes(popper);\n\n  // Add position, width and height to our offsets object\n  var popperOffsets = {\n    width: popperRect.width,\n    height: popperRect.height\n  };\n\n  // depending by the popper placement we have to compute its offsets slightly differently\n  var isHoriz = ['right', 'left'].indexOf(placement) !== -1;\n  var mainSide = isHoriz ? 'top' : 'left';\n  var secondarySide = isHoriz ? 'left' : 'top';\n  var measurement = isHoriz ? 'height' : 'width';\n  var secondaryMeasurement = !isHoriz ? 'height' : 'width';\n\n  popperOffsets[mainSide] = referenceOffsets[mainSide] + referenceOffsets[measurement] / 2 - popperRect[measurement] / 2;\n  if (placement === secondarySide) {\n    popperOffsets[secondarySide] = referenceOffsets[secondarySide] - popperRect[secondaryMeasurement];\n  } else {\n    popperOffsets[secondarySide] = referenceOffsets[getOppositePlacement(secondarySide)];\n  }\n\n  return popperOffsets;\n}\n\n/**\n * Mimics the `find` method of Array\n * @method\n * @memberof Popper.Utils\n * @argument {Array} arr\n * @argument prop\n * @argument value\n * @returns index or -1\n */\nfunction find(arr, check) {\n  // use native find if supported\n  if (Array.prototype.find) {\n    return arr.find(check);\n  }\n\n  // use `filter` to obtain the same behavior of `find`\n  return arr.filter(check)[0];\n}\n\n/**\n * Return the index of the matching object\n * @method\n * @memberof Popper.Utils\n * @argument {Array} arr\n * @argument prop\n * @argument value\n * @returns index or -1\n */\nfunction findIndex(arr, prop, value) {\n  // use native findIndex if supported\n  if (Array.prototype.findIndex) {\n    return arr.findIndex(function (cur) {\n      return cur[prop] === value;\n    });\n  }\n\n  // use `find` + `indexOf` if `findIndex` isn't supported\n  var match = find(arr, function (obj) {\n    return obj[prop] === value;\n  });\n  return arr.indexOf(match);\n}\n\n/**\n * Loop trough the list of modifiers and run them in order,\n * each of them will then edit the data object.\n * @method\n * @memberof Popper.Utils\n * @param {dataObject} data\n * @param {Array} modifiers\n * @param {String} ends - Optional modifier name used as stopper\n * @returns {dataObject}\n */\nfunction runModifiers(modifiers, data, ends) {\n  var modifiersToRun = ends === undefined ? modifiers : modifiers.slice(0, findIndex(modifiers, 'name', ends));\n\n  modifiersToRun.forEach(function (modifier) {\n    if (modifier['function']) {\n      // eslint-disable-line dot-notation\n      console.warn('`modifier.function` is deprecated, use `modifier.fn`!');\n    }\n    var fn = modifier['function'] || modifier.fn; // eslint-disable-line dot-notation\n    if (modifier.enabled && isFunction(fn)) {\n      // Add properties to offsets to make them a complete clientRect object\n      // we do this before each modifier to make sure the previous one doesn't\n      // mess with these values\n      data.offsets.popper = getClientRect(data.offsets.popper);\n      data.offsets.reference = getClientRect(data.offsets.reference);\n\n      data = fn(data, modifier);\n    }\n  });\n\n  return data;\n}\n\n/**\n * Updates the position of the popper, computing the new offsets and applying\n * the new style.<br />\n * Prefer `scheduleUpdate` over `update` because of performance reasons.\n * @method\n * @memberof Popper\n */\nfunction update() {\n  // if popper is destroyed, don't perform any further update\n  if (this.state.isDestroyed) {\n    return;\n  }\n\n  var data = {\n    instance: this,\n    styles: {},\n    arrowStyles: {},\n    attributes: {},\n    flipped: false,\n    offsets: {}\n  };\n\n  // compute reference element offsets\n  data.offsets.reference = getReferenceOffsets(this.state, this.popper, this.reference, this.options.positionFixed);\n\n  // compute auto placement, store placement inside the data object,\n  // modifiers will be able to edit `placement` if needed\n  // and refer to originalPlacement to know the original value\n  data.placement = computeAutoPlacement(this.options.placement, data.offsets.reference, this.popper, this.reference, this.options.modifiers.flip.boundariesElement, this.options.modifiers.flip.padding);\n\n  // store the computed placement inside `originalPlacement`\n  data.originalPlacement = data.placement;\n\n  data.positionFixed = this.options.positionFixed;\n\n  // compute the popper offsets\n  data.offsets.popper = getPopperOffsets(this.popper, data.offsets.reference, data.placement);\n\n  data.offsets.popper.position = this.options.positionFixed ? 'fixed' : 'absolute';\n\n  // run the modifiers\n  data = runModifiers(this.modifiers, data);\n\n  // the first `update` will call `onCreate` callback\n  // the other ones will call `onUpdate` callback\n  if (!this.state.isCreated) {\n    this.state.isCreated = true;\n    this.options.onCreate(data);\n  } else {\n    this.options.onUpdate(data);\n  }\n}\n\n/**\n * Helper used to know if the given modifier is enabled.\n * @method\n * @memberof Popper.Utils\n * @returns {Boolean}\n */\nfunction isModifierEnabled(modifiers, modifierName) {\n  return modifiers.some(function (_ref) {\n    var name = _ref.name,\n        enabled = _ref.enabled;\n    return enabled && name === modifierName;\n  });\n}\n\n/**\n * Get the prefixed supported property name\n * @method\n * @memberof Popper.Utils\n * @argument {String} property (camelCase)\n * @returns {String} prefixed property (camelCase or PascalCase, depending on the vendor prefix)\n */\nfunction getSupportedPropertyName(property) {\n  var prefixes = [false, 'ms', 'Webkit', 'Moz', 'O'];\n  var upperProp = property.charAt(0).toUpperCase() + property.slice(1);\n\n  for (var i = 0; i < prefixes.length; i++) {\n    var prefix = prefixes[i];\n    var toCheck = prefix ? '' + prefix + upperProp : property;\n    if (typeof document.body.style[toCheck] !== 'undefined') {\n      return toCheck;\n    }\n  }\n  return null;\n}\n\n/**\n * Destroys the popper.\n * @method\n * @memberof Popper\n */\nfunction destroy() {\n  this.state.isDestroyed = true;\n\n  // touch DOM only if `applyStyle` modifier is enabled\n  if (isModifierEnabled(this.modifiers, 'applyStyle')) {\n    this.popper.removeAttribute('x-placement');\n    this.popper.style.position = '';\n    this.popper.style.top = '';\n    this.popper.style.left = '';\n    this.popper.style.right = '';\n    this.popper.style.bottom = '';\n    this.popper.style.willChange = '';\n    this.popper.style[getSupportedPropertyName('transform')] = '';\n  }\n\n  this.disableEventListeners();\n\n  // remove the popper if user explicitly asked for the deletion on destroy\n  // do not use `remove` because IE11 doesn't support it\n  if (this.options.removeOnDestroy) {\n    this.popper.parentNode.removeChild(this.popper);\n  }\n  return this;\n}\n\n/**\n * Get the window associated with the element\n * @argument {Element} element\n * @returns {Window}\n */\nfunction getWindow(element) {\n  var ownerDocument = element.ownerDocument;\n  return ownerDocument ? ownerDocument.defaultView : window;\n}\n\nfunction attachToScrollParents(scrollParent, event, callback, scrollParents) {\n  var isBody = scrollParent.nodeName === 'BODY';\n  var target = isBody ? scrollParent.ownerDocument.defaultView : scrollParent;\n  target.addEventListener(event, callback, { passive: true });\n\n  if (!isBody) {\n    attachToScrollParents(getScrollParent(target.parentNode), event, callback, scrollParents);\n  }\n  scrollParents.push(target);\n}\n\n/**\n * Setup needed event listeners used to update the popper position\n * @method\n * @memberof Popper.Utils\n * @private\n */\nfunction setupEventListeners(reference, options, state, updateBound) {\n  // Resize event listener on window\n  state.updateBound = updateBound;\n  getWindow(reference).addEventListener('resize', state.updateBound, { passive: true });\n\n  // Scroll event listener on scroll parents\n  var scrollElement = getScrollParent(reference);\n  attachToScrollParents(scrollElement, 'scroll', state.updateBound, state.scrollParents);\n  state.scrollElement = scrollElement;\n  state.eventsEnabled = true;\n\n  return state;\n}\n\n/**\n * It will add resize/scroll events and start recalculating\n * position of the popper element when they are triggered.\n * @method\n * @memberof Popper\n */\nfunction enableEventListeners() {\n  if (!this.state.eventsEnabled) {\n    this.state = setupEventListeners(this.reference, this.options, this.state, this.scheduleUpdate);\n  }\n}\n\n/**\n * Remove event listeners used to update the popper position\n * @method\n * @memberof Popper.Utils\n * @private\n */\nfunction removeEventListeners(reference, state) {\n  // Remove resize event listener on window\n  getWindow(reference).removeEventListener('resize', state.updateBound);\n\n  // Remove scroll event listener on scroll parents\n  state.scrollParents.forEach(function (target) {\n    target.removeEventListener('scroll', state.updateBound);\n  });\n\n  // Reset state\n  state.updateBound = null;\n  state.scrollParents = [];\n  state.scrollElement = null;\n  state.eventsEnabled = false;\n  return state;\n}\n\n/**\n * It will remove resize/scroll events and won't recalculate popper position\n * when they are triggered. It also won't trigger `onUpdate` callback anymore,\n * unless you call `update` method manually.\n * @method\n * @memberof Popper\n */\nfunction disableEventListeners() {\n  if (this.state.eventsEnabled) {\n    cancelAnimationFrame(this.scheduleUpdate);\n    this.state = removeEventListeners(this.reference, this.state);\n  }\n}\n\n/**\n * Tells if a given input is a number\n * @method\n * @memberof Popper.Utils\n * @param {*} input to check\n * @return {Boolean}\n */\nfunction isNumeric(n) {\n  return n !== '' && !isNaN(parseFloat(n)) && isFinite(n);\n}\n\n/**\n * Set the style to the given popper\n * @method\n * @memberof Popper.Utils\n * @argument {Element} element - Element to apply the style to\n * @argument {Object} styles\n * Object with a list of properties and values which will be applied to the element\n */\nfunction setStyles(element, styles) {\n  Object.keys(styles).forEach(function (prop) {\n    var unit = '';\n    // add unit if the value is numeric and is one of the following\n    if (['width', 'height', 'top', 'right', 'bottom', 'left'].indexOf(prop) !== -1 && isNumeric(styles[prop])) {\n      unit = 'px';\n    }\n    element.style[prop] = styles[prop] + unit;\n  });\n}\n\n/**\n * Set the attributes to the given popper\n * @method\n * @memberof Popper.Utils\n * @argument {Element} element - Element to apply the attributes to\n * @argument {Object} styles\n * Object with a list of properties and values which will be applied to the element\n */\nfunction setAttributes(element, attributes) {\n  Object.keys(attributes).forEach(function (prop) {\n    var value = attributes[prop];\n    if (value !== false) {\n      element.setAttribute(prop, attributes[prop]);\n    } else {\n      element.removeAttribute(prop);\n    }\n  });\n}\n\n/**\n * @function\n * @memberof Modifiers\n * @argument {Object} data - The data object generated by `update` method\n * @argument {Object} data.styles - List of style properties - values to apply to popper element\n * @argument {Object} data.attributes - List of attribute properties - values to apply to popper element\n * @argument {Object} options - Modifiers configuration and options\n * @returns {Object} The same data object\n */\nfunction applyStyle(data) {\n  // any property present in `data.styles` will be applied to the popper,\n  // in this way we can make the 3rd party modifiers add custom styles to it\n  // Be aware, modifiers could override the properties defined in the previous\n  // lines of this modifier!\n  setStyles(data.instance.popper, data.styles);\n\n  // any property present in `data.attributes` will be applied to the popper,\n  // they will be set as HTML attributes of the element\n  setAttributes(data.instance.popper, data.attributes);\n\n  // if arrowElement is defined and arrowStyles has some properties\n  if (data.arrowElement && Object.keys(data.arrowStyles).length) {\n    setStyles(data.arrowElement, data.arrowStyles);\n  }\n\n  return data;\n}\n\n/**\n * Set the x-placement attribute before everything else because it could be used\n * to add margins to the popper margins needs to be calculated to get the\n * correct popper offsets.\n * @method\n * @memberof Popper.modifiers\n * @param {HTMLElement} reference - The reference element used to position the popper\n * @param {HTMLElement} popper - The HTML element used as popper\n * @param {Object} options - Popper.js options\n */\nfunction applyStyleOnLoad(reference, popper, options, modifierOptions, state) {\n  // compute reference element offsets\n  var referenceOffsets = getReferenceOffsets(state, popper, reference, options.positionFixed);\n\n  // compute auto placement, store placement inside the data object,\n  // modifiers will be able to edit `placement` if needed\n  // and refer to originalPlacement to know the original value\n  var placement = computeAutoPlacement(options.placement, referenceOffsets, popper, reference, options.modifiers.flip.boundariesElement, options.modifiers.flip.padding);\n\n  popper.setAttribute('x-placement', placement);\n\n  // Apply `position` to popper before anything else because\n  // without the position applied we can't guarantee correct computations\n  setStyles(popper, { position: options.positionFixed ? 'fixed' : 'absolute' });\n\n  return options;\n}\n\n/**\n * @function\n * @memberof Popper.Utils\n * @argument {Object} data - The data object generated by `update` method\n * @argument {Boolean} shouldRound - If the offsets should be rounded at all\n * @returns {Object} The popper's position offsets rounded\n *\n * The tale of pixel-perfect positioning. It's still not 100% perfect, but as\n * good as it can be within reason.\n * Discussion here: https://github.com/FezVrasta/popper.js/pull/715\n *\n * Low DPI screens cause a popper to be blurry if not using full pixels (Safari\n * as well on High DPI screens).\n *\n * Firefox prefers no rounding for positioning and does not have blurriness on\n * high DPI screens.\n *\n * Only horizontal placement and left/right values need to be considered.\n */\nfunction getRoundedOffsets(data, shouldRound) {\n  var _data$offsets = data.offsets,\n      popper = _data$offsets.popper,\n      reference = _data$offsets.reference;\n  var round = Math.round,\n      floor = Math.floor;\n\n  var noRound = function noRound(v) {\n    return v;\n  };\n\n  var referenceWidth = round(reference.width);\n  var popperWidth = round(popper.width);\n\n  var isVertical = ['left', 'right'].indexOf(data.placement) !== -1;\n  var isVariation = data.placement.indexOf('-') !== -1;\n  var sameWidthParity = referenceWidth % 2 === popperWidth % 2;\n  var bothOddWidth = referenceWidth % 2 === 1 && popperWidth % 2 === 1;\n\n  var horizontalToInteger = !shouldRound ? noRound : isVertical || isVariation || sameWidthParity ? round : floor;\n  var verticalToInteger = !shouldRound ? noRound : round;\n\n  return {\n    left: horizontalToInteger(bothOddWidth && !isVariation && shouldRound ? popper.left - 1 : popper.left),\n    top: verticalToInteger(popper.top),\n    bottom: verticalToInteger(popper.bottom),\n    right: horizontalToInteger(popper.right)\n  };\n}\n\nvar isFirefox = isBrowser && /Firefox/i.test(navigator.userAgent);\n\n/**\n * @function\n * @memberof Modifiers\n * @argument {Object} data - The data object generated by `update` method\n * @argument {Object} options - Modifiers configuration and options\n * @returns {Object} The data object, properly modified\n */\nfunction computeStyle(data, options) {\n  var x = options.x,\n      y = options.y;\n  var popper = data.offsets.popper;\n\n  // Remove this legacy support in Popper.js v2\n\n  var legacyGpuAccelerationOption = find(data.instance.modifiers, function (modifier) {\n    return modifier.name === 'applyStyle';\n  }).gpuAcceleration;\n  if (legacyGpuAccelerationOption !== undefined) {\n    console.warn('WARNING: `gpuAcceleration` option moved to `computeStyle` modifier and will not be supported in future versions of Popper.js!');\n  }\n  var gpuAcceleration = legacyGpuAccelerationOption !== undefined ? legacyGpuAccelerationOption : options.gpuAcceleration;\n\n  var offsetParent = getOffsetParent(data.instance.popper);\n  var offsetParentRect = getBoundingClientRect(offsetParent);\n\n  // Styles\n  var styles = {\n    position: popper.position\n  };\n\n  var offsets = getRoundedOffsets(data, window.devicePixelRatio < 2 || !isFirefox);\n\n  var sideA = x === 'bottom' ? 'top' : 'bottom';\n  var sideB = y === 'right' ? 'left' : 'right';\n\n  // if gpuAcceleration is set to `true` and transform is supported,\n  //  we use `translate3d` to apply the position to the popper we\n  // automatically use the supported prefixed version if needed\n  var prefixedProperty = getSupportedPropertyName('transform');\n\n  // now, let's make a step back and look at this code closely (wtf?)\n  // If the content of the popper grows once it's been positioned, it\n  // may happen that the popper gets misplaced because of the new content\n  // overflowing its reference element\n  // To avoid this problem, we provide two options (x and y), which allow\n  // the consumer to define the offset origin.\n  // If we position a popper on top of a reference element, we can set\n  // `x` to `top` to make the popper grow towards its top instead of\n  // its bottom.\n  var left = void 0,\n      top = void 0;\n  if (sideA === 'bottom') {\n    // when offsetParent is <html> the positioning is relative to the bottom of the screen (excluding the scrollbar)\n    // and not the bottom of the html element\n    if (offsetParent.nodeName === 'HTML') {\n      top = -offsetParent.clientHeight + offsets.bottom;\n    } else {\n      top = -offsetParentRect.height + offsets.bottom;\n    }\n  } else {\n    top = offsets.top;\n  }\n  if (sideB === 'right') {\n    if (offsetParent.nodeName === 'HTML') {\n      left = -offsetParent.clientWidth + offsets.right;\n    } else {\n      left = -offsetParentRect.width + offsets.right;\n    }\n  } else {\n    left = offsets.left;\n  }\n  if (gpuAcceleration && prefixedProperty) {\n    styles[prefixedProperty] = 'translate3d(' + left + 'px, ' + top + 'px, 0)';\n    styles[sideA] = 0;\n    styles[sideB] = 0;\n    styles.willChange = 'transform';\n  } else {\n    // othwerise, we use the standard `top`, `left`, `bottom` and `right` properties\n    var invertTop = sideA === 'bottom' ? -1 : 1;\n    var invertLeft = sideB === 'right' ? -1 : 1;\n    styles[sideA] = top * invertTop;\n    styles[sideB] = left * invertLeft;\n    styles.willChange = sideA + ', ' + sideB;\n  }\n\n  // Attributes\n  var attributes = {\n    'x-placement': data.placement\n  };\n\n  // Update `data` attributes, styles and arrowStyles\n  data.attributes = _extends({}, attributes, data.attributes);\n  data.styles = _extends({}, styles, data.styles);\n  data.arrowStyles = _extends({}, data.offsets.arrow, data.arrowStyles);\n\n  return data;\n}\n\n/**\n * Helper used to know if the given modifier depends from another one.<br />\n * It checks if the needed modifier is listed and enabled.\n * @method\n * @memberof Popper.Utils\n * @param {Array} modifiers - list of modifiers\n * @param {String} requestingName - name of requesting modifier\n * @param {String} requestedName - name of requested modifier\n * @returns {Boolean}\n */\nfunction isModifierRequired(modifiers, requestingName, requestedName) {\n  var requesting = find(modifiers, function (_ref) {\n    var name = _ref.name;\n    return name === requestingName;\n  });\n\n  var isRequired = !!requesting && modifiers.some(function (modifier) {\n    return modifier.name === requestedName && modifier.enabled && modifier.order < requesting.order;\n  });\n\n  if (!isRequired) {\n    var _requesting = '`' + requestingName + '`';\n    var requested = '`' + requestedName + '`';\n    console.warn(requested + ' modifier is required by ' + _requesting + ' modifier in order to work, be sure to include it before ' + _requesting + '!');\n  }\n  return isRequired;\n}\n\n/**\n * @function\n * @memberof Modifiers\n * @argument {Object} data - The data object generated by update method\n * @argument {Object} options - Modifiers configuration and options\n * @returns {Object} The data object, properly modified\n */\nfunction arrow(data, options) {\n  var _data$offsets$arrow;\n\n  // arrow depends on keepTogether in order to work\n  if (!isModifierRequired(data.instance.modifiers, 'arrow', 'keepTogether')) {\n    return data;\n  }\n\n  var arrowElement = options.element;\n\n  // if arrowElement is a string, suppose it's a CSS selector\n  if (typeof arrowElement === 'string') {\n    arrowElement = data.instance.popper.querySelector(arrowElement);\n\n    // if arrowElement is not found, don't run the modifier\n    if (!arrowElement) {\n      return data;\n    }\n  } else {\n    // if the arrowElement isn't a query selector we must check that the\n    // provided DOM node is child of its popper node\n    if (!data.instance.popper.contains(arrowElement)) {\n      console.warn('WARNING: `arrow.element` must be child of its popper element!');\n      return data;\n    }\n  }\n\n  var placement = data.placement.split('-')[0];\n  var _data$offsets = data.offsets,\n      popper = _data$offsets.popper,\n      reference = _data$offsets.reference;\n\n  var isVertical = ['left', 'right'].indexOf(placement) !== -1;\n\n  var len = isVertical ? 'height' : 'width';\n  var sideCapitalized = isVertical ? 'Top' : 'Left';\n  var side = sideCapitalized.toLowerCase();\n  var altSide = isVertical ? 'left' : 'top';\n  var opSide = isVertical ? 'bottom' : 'right';\n  var arrowElementSize = getOuterSizes(arrowElement)[len];\n\n  //\n  // extends keepTogether behavior making sure the popper and its\n  // reference have enough pixels in conjunction\n  //\n\n  // top/left side\n  if (reference[opSide] - arrowElementSize < popper[side]) {\n    data.offsets.popper[side] -= popper[side] - (reference[opSide] - arrowElementSize);\n  }\n  // bottom/right side\n  if (reference[side] + arrowElementSize > popper[opSide]) {\n    data.offsets.popper[side] += reference[side] + arrowElementSize - popper[opSide];\n  }\n  data.offsets.popper = getClientRect(data.offsets.popper);\n\n  // compute center of the popper\n  var center = reference[side] + reference[len] / 2 - arrowElementSize / 2;\n\n  // Compute the sideValue using the updated popper offsets\n  // take popper margin in account because we don't have this info available\n  var css = getStyleComputedProperty(data.instance.popper);\n  var popperMarginSide = parseFloat(css['margin' + sideCapitalized], 10);\n  var popperBorderSide = parseFloat(css['border' + sideCapitalized + 'Width'], 10);\n  var sideValue = center - data.offsets.popper[side] - popperMarginSide - popperBorderSide;\n\n  // prevent arrowElement from being placed not contiguously to its popper\n  sideValue = Math.max(Math.min(popper[len] - arrowElementSize, sideValue), 0);\n\n  data.arrowElement = arrowElement;\n  data.offsets.arrow = (_data$offsets$arrow = {}, defineProperty(_data$offsets$arrow, side, Math.round(sideValue)), defineProperty(_data$offsets$arrow, altSide, ''), _data$offsets$arrow);\n\n  return data;\n}\n\n/**\n * Get the opposite placement variation of the given one\n * @method\n * @memberof Popper.Utils\n * @argument {String} placement variation\n * @returns {String} flipped placement variation\n */\nfunction getOppositeVariation(variation) {\n  if (variation === 'end') {\n    return 'start';\n  } else if (variation === 'start') {\n    return 'end';\n  }\n  return variation;\n}\n\n/**\n * List of accepted placements to use as values of the `placement` option.<br />\n * Valid placements are:\n * - `auto`\n * - `top`\n * - `right`\n * - `bottom`\n * - `left`\n *\n * Each placement can have a variation from this list:\n * - `-start`\n * - `-end`\n *\n * Variations are interpreted easily if you think of them as the left to right\n * written languages. Horizontally (`top` and `bottom`), `start` is left and `end`\n * is right.<br />\n * Vertically (`left` and `right`), `start` is top and `end` is bottom.\n *\n * Some valid examples are:\n * - `top-end` (on top of reference, right aligned)\n * - `right-start` (on right of reference, top aligned)\n * - `bottom` (on bottom, centered)\n * - `auto-end` (on the side with more space available, alignment depends by placement)\n *\n * @static\n * @type {Array}\n * @enum {String}\n * @readonly\n * @method placements\n * @memberof Popper\n */\nvar placements = ['auto-start', 'auto', 'auto-end', 'top-start', 'top', 'top-end', 'right-start', 'right', 'right-end', 'bottom-end', 'bottom', 'bottom-start', 'left-end', 'left', 'left-start'];\n\n// Get rid of `auto` `auto-start` and `auto-end`\nvar validPlacements = placements.slice(3);\n\n/**\n * Given an initial placement, returns all the subsequent placements\n * clockwise (or counter-clockwise).\n *\n * @method\n * @memberof Popper.Utils\n * @argument {String} placement - A valid placement (it accepts variations)\n * @argument {Boolean} counter - Set to true to walk the placements counterclockwise\n * @returns {Array} placements including their variations\n */\nfunction clockwise(placement) {\n  var counter = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n\n  var index = validPlacements.indexOf(placement);\n  var arr = validPlacements.slice(index + 1).concat(validPlacements.slice(0, index));\n  return counter ? arr.reverse() : arr;\n}\n\nvar BEHAVIORS = {\n  FLIP: 'flip',\n  CLOCKWISE: 'clockwise',\n  COUNTERCLOCKWISE: 'counterclockwise'\n};\n\n/**\n * @function\n * @memberof Modifiers\n * @argument {Object} data - The data object generated by update method\n * @argument {Object} options - Modifiers configuration and options\n * @returns {Object} The data object, properly modified\n */\nfunction flip(data, options) {\n  // if `inner` modifier is enabled, we can't use the `flip` modifier\n  if (isModifierEnabled(data.instance.modifiers, 'inner')) {\n    return data;\n  }\n\n  if (data.flipped && data.placement === data.originalPlacement) {\n    // seems like flip is trying to loop, probably there's not enough space on any of the flippable sides\n    return data;\n  }\n\n  var boundaries = getBoundaries(data.instance.popper, data.instance.reference, options.padding, options.boundariesElement, data.positionFixed);\n\n  var placement = data.placement.split('-')[0];\n  var placementOpposite = getOppositePlacement(placement);\n  var variation = data.placement.split('-')[1] || '';\n\n  var flipOrder = [];\n\n  switch (options.behavior) {\n    case BEHAVIORS.FLIP:\n      flipOrder = [placement, placementOpposite];\n      break;\n    case BEHAVIORS.CLOCKWISE:\n      flipOrder = clockwise(placement);\n      break;\n    case BEHAVIORS.COUNTERCLOCKWISE:\n      flipOrder = clockwise(placement, true);\n      break;\n    default:\n      flipOrder = options.behavior;\n  }\n\n  flipOrder.forEach(function (step, index) {\n    if (placement !== step || flipOrder.length === index + 1) {\n      return data;\n    }\n\n    placement = data.placement.split('-')[0];\n    placementOpposite = getOppositePlacement(placement);\n\n    var popperOffsets = data.offsets.popper;\n    var refOffsets = data.offsets.reference;\n\n    // using floor because the reference offsets may contain decimals we are not going to consider here\n    var floor = Math.floor;\n    var overlapsRef = placement === 'left' && floor(popperOffsets.right) > floor(refOffsets.left) || placement === 'right' && floor(popperOffsets.left) < floor(refOffsets.right) || placement === 'top' && floor(popperOffsets.bottom) > floor(refOffsets.top) || placement === 'bottom' && floor(popperOffsets.top) < floor(refOffsets.bottom);\n\n    var overflowsLeft = floor(popperOffsets.left) < floor(boundaries.left);\n    var overflowsRight = floor(popperOffsets.right) > floor(boundaries.right);\n    var overflowsTop = floor(popperOffsets.top) < floor(boundaries.top);\n    var overflowsBottom = floor(popperOffsets.bottom) > floor(boundaries.bottom);\n\n    var overflowsBoundaries = placement === 'left' && overflowsLeft || placement === 'right' && overflowsRight || placement === 'top' && overflowsTop || placement === 'bottom' && overflowsBottom;\n\n    // flip the variation if required\n    var isVertical = ['top', 'bottom'].indexOf(placement) !== -1;\n\n    // flips variation if reference element overflows boundaries\n    var flippedVariationByRef = !!options.flipVariations && (isVertical && variation === 'start' && overflowsLeft || isVertical && variation === 'end' && overflowsRight || !isVertical && variation === 'start' && overflowsTop || !isVertical && variation === 'end' && overflowsBottom);\n\n    // flips variation if popper content overflows boundaries\n    var flippedVariationByContent = !!options.flipVariationsByContent && (isVertical && variation === 'start' && overflowsRight || isVertical && variation === 'end' && overflowsLeft || !isVertical && variation === 'start' && overflowsBottom || !isVertical && variation === 'end' && overflowsTop);\n\n    var flippedVariation = flippedVariationByRef || flippedVariationByContent;\n\n    if (overlapsRef || overflowsBoundaries || flippedVariation) {\n      // this boolean to detect any flip loop\n      data.flipped = true;\n\n      if (overlapsRef || overflowsBoundaries) {\n        placement = flipOrder[index + 1];\n      }\n\n      if (flippedVariation) {\n        variation = getOppositeVariation(variation);\n      }\n\n      data.placement = placement + (variation ? '-' + variation : '');\n\n      // this object contains `position`, we want to preserve it along with\n      // any additional property we may add in the future\n      data.offsets.popper = _extends({}, data.offsets.popper, getPopperOffsets(data.instance.popper, data.offsets.reference, data.placement));\n\n      data = runModifiers(data.instance.modifiers, data, 'flip');\n    }\n  });\n  return data;\n}\n\n/**\n * @function\n * @memberof Modifiers\n * @argument {Object} data - The data object generated by update method\n * @argument {Object} options - Modifiers configuration and options\n * @returns {Object} The data object, properly modified\n */\nfunction keepTogether(data) {\n  var _data$offsets = data.offsets,\n      popper = _data$offsets.popper,\n      reference = _data$offsets.reference;\n\n  var placement = data.placement.split('-')[0];\n  var floor = Math.floor;\n  var isVertical = ['top', 'bottom'].indexOf(placement) !== -1;\n  var side = isVertical ? 'right' : 'bottom';\n  var opSide = isVertical ? 'left' : 'top';\n  var measurement = isVertical ? 'width' : 'height';\n\n  if (popper[side] < floor(reference[opSide])) {\n    data.offsets.popper[opSide] = floor(reference[opSide]) - popper[measurement];\n  }\n  if (popper[opSide] > floor(reference[side])) {\n    data.offsets.popper[opSide] = floor(reference[side]);\n  }\n\n  return data;\n}\n\n/**\n * Converts a string containing value + unit into a px value number\n * @function\n * @memberof {modifiers~offset}\n * @private\n * @argument {String} str - Value + unit string\n * @argument {String} measurement - `height` or `width`\n * @argument {Object} popperOffsets\n * @argument {Object} referenceOffsets\n * @returns {Number|String}\n * Value in pixels, or original string if no values were extracted\n */\nfunction toValue(str, measurement, popperOffsets, referenceOffsets) {\n  // separate value from unit\n  var split = str.match(/((?:\\-|\\+)?\\d*\\.?\\d*)(.*)/);\n  var value = +split[1];\n  var unit = split[2];\n\n  // If it's not a number it's an operator, I guess\n  if (!value) {\n    return str;\n  }\n\n  if (unit.indexOf('%') === 0) {\n    var element = void 0;\n    switch (unit) {\n      case '%p':\n        element = popperOffsets;\n        break;\n      case '%':\n      case '%r':\n      default:\n        element = referenceOffsets;\n    }\n\n    var rect = getClientRect(element);\n    return rect[measurement] / 100 * value;\n  } else if (unit === 'vh' || unit === 'vw') {\n    // if is a vh or vw, we calculate the size based on the viewport\n    var size = void 0;\n    if (unit === 'vh') {\n      size = Math.max(document.documentElement.clientHeight, window.innerHeight || 0);\n    } else {\n      size = Math.max(document.documentElement.clientWidth, window.innerWidth || 0);\n    }\n    return size / 100 * value;\n  } else {\n    // if is an explicit pixel unit, we get rid of the unit and keep the value\n    // if is an implicit unit, it's px, and we return just the value\n    return value;\n  }\n}\n\n/**\n * Parse an `offset` string to extrapolate `x` and `y` numeric offsets.\n * @function\n * @memberof {modifiers~offset}\n * @private\n * @argument {String} offset\n * @argument {Object} popperOffsets\n * @argument {Object} referenceOffsets\n * @argument {String} basePlacement\n * @returns {Array} a two cells array with x and y offsets in numbers\n */\nfunction parseOffset(offset, popperOffsets, referenceOffsets, basePlacement) {\n  var offsets = [0, 0];\n\n  // Use height if placement is left or right and index is 0 otherwise use width\n  // in this way the first offset will use an axis and the second one\n  // will use the other one\n  var useHeight = ['right', 'left'].indexOf(basePlacement) !== -1;\n\n  // Split the offset string to obtain a list of values and operands\n  // The regex addresses values with the plus or minus sign in front (+10, -20, etc)\n  var fragments = offset.split(/(\\+|\\-)/).map(function (frag) {\n    return frag.trim();\n  });\n\n  // Detect if the offset string contains a pair of values or a single one\n  // they could be separated by comma or space\n  var divider = fragments.indexOf(find(fragments, function (frag) {\n    return frag.search(/,|\\s/) !== -1;\n  }));\n\n  if (fragments[divider] && fragments[divider].indexOf(',') === -1) {\n    console.warn('Offsets separated by white space(s) are deprecated, use a comma (,) instead.');\n  }\n\n  // If divider is found, we divide the list of values and operands to divide\n  // them by ofset X and Y.\n  var splitRegex = /\\s*,\\s*|\\s+/;\n  var ops = divider !== -1 ? [fragments.slice(0, divider).concat([fragments[divider].split(splitRegex)[0]]), [fragments[divider].split(splitRegex)[1]].concat(fragments.slice(divider + 1))] : [fragments];\n\n  // Convert the values with units to absolute pixels to allow our computations\n  ops = ops.map(function (op, index) {\n    // Most of the units rely on the orientation of the popper\n    var measurement = (index === 1 ? !useHeight : useHeight) ? 'height' : 'width';\n    var mergeWithPrevious = false;\n    return op\n    // This aggregates any `+` or `-` sign that aren't considered operators\n    // e.g.: 10 + +5 => [10, +, +5]\n    .reduce(function (a, b) {\n      if (a[a.length - 1] === '' && ['+', '-'].indexOf(b) !== -1) {\n        a[a.length - 1] = b;\n        mergeWithPrevious = true;\n        return a;\n      } else if (mergeWithPrevious) {\n        a[a.length - 1] += b;\n        mergeWithPrevious = false;\n        return a;\n      } else {\n        return a.concat(b);\n      }\n    }, [])\n    // Here we convert the string values into number values (in px)\n    .map(function (str) {\n      return toValue(str, measurement, popperOffsets, referenceOffsets);\n    });\n  });\n\n  // Loop trough the offsets arrays and execute the operations\n  ops.forEach(function (op, index) {\n    op.forEach(function (frag, index2) {\n      if (isNumeric(frag)) {\n        offsets[index] += frag * (op[index2 - 1] === '-' ? -1 : 1);\n      }\n    });\n  });\n  return offsets;\n}\n\n/**\n * @function\n * @memberof Modifiers\n * @argument {Object} data - The data object generated by update method\n * @argument {Object} options - Modifiers configuration and options\n * @argument {Number|String} options.offset=0\n * The offset value as described in the modifier description\n * @returns {Object} The data object, properly modified\n */\nfunction offset(data, _ref) {\n  var offset = _ref.offset;\n  var placement = data.placement,\n      _data$offsets = data.offsets,\n      popper = _data$offsets.popper,\n      reference = _data$offsets.reference;\n\n  var basePlacement = placement.split('-')[0];\n\n  var offsets = void 0;\n  if (isNumeric(+offset)) {\n    offsets = [+offset, 0];\n  } else {\n    offsets = parseOffset(offset, popper, reference, basePlacement);\n  }\n\n  if (basePlacement === 'left') {\n    popper.top += offsets[0];\n    popper.left -= offsets[1];\n  } else if (basePlacement === 'right') {\n    popper.top += offsets[0];\n    popper.left += offsets[1];\n  } else if (basePlacement === 'top') {\n    popper.left += offsets[0];\n    popper.top -= offsets[1];\n  } else if (basePlacement === 'bottom') {\n    popper.left += offsets[0];\n    popper.top += offsets[1];\n  }\n\n  data.popper = popper;\n  return data;\n}\n\n/**\n * @function\n * @memberof Modifiers\n * @argument {Object} data - The data object generated by `update` method\n * @argument {Object} options - Modifiers configuration and options\n * @returns {Object} The data object, properly modified\n */\nfunction preventOverflow(data, options) {\n  var boundariesElement = options.boundariesElement || getOffsetParent(data.instance.popper);\n\n  // If offsetParent is the reference element, we really want to\n  // go one step up and use the next offsetParent as reference to\n  // avoid to make this modifier completely useless and look like broken\n  if (data.instance.reference === boundariesElement) {\n    boundariesElement = getOffsetParent(boundariesElement);\n  }\n\n  // NOTE: DOM access here\n  // resets the popper's position so that the document size can be calculated excluding\n  // the size of the popper element itself\n  var transformProp = getSupportedPropertyName('transform');\n  var popperStyles = data.instance.popper.style; // assignment to help minification\n  var top = popperStyles.top,\n      left = popperStyles.left,\n      transform = popperStyles[transformProp];\n\n  popperStyles.top = '';\n  popperStyles.left = '';\n  popperStyles[transformProp] = '';\n\n  var boundaries = getBoundaries(data.instance.popper, data.instance.reference, options.padding, boundariesElement, data.positionFixed);\n\n  // NOTE: DOM access here\n  // restores the original style properties after the offsets have been computed\n  popperStyles.top = top;\n  popperStyles.left = left;\n  popperStyles[transformProp] = transform;\n\n  options.boundaries = boundaries;\n\n  var order = options.priority;\n  var popper = data.offsets.popper;\n\n  var check = {\n    primary: function primary(placement) {\n      var value = popper[placement];\n      if (popper[placement] < boundaries[placement] && !options.escapeWithReference) {\n        value = Math.max(popper[placement], boundaries[placement]);\n      }\n      return defineProperty({}, placement, value);\n    },\n    secondary: function secondary(placement) {\n      var mainSide = placement === 'right' ? 'left' : 'top';\n      var value = popper[mainSide];\n      if (popper[placement] > boundaries[placement] && !options.escapeWithReference) {\n        value = Math.min(popper[mainSide], boundaries[placement] - (placement === 'right' ? popper.width : popper.height));\n      }\n      return defineProperty({}, mainSide, value);\n    }\n  };\n\n  order.forEach(function (placement) {\n    var side = ['left', 'top'].indexOf(placement) !== -1 ? 'primary' : 'secondary';\n    popper = _extends({}, popper, check[side](placement));\n  });\n\n  data.offsets.popper = popper;\n\n  return data;\n}\n\n/**\n * @function\n * @memberof Modifiers\n * @argument {Object} data - The data object generated by `update` method\n * @argument {Object} options - Modifiers configuration and options\n * @returns {Object} The data object, properly modified\n */\nfunction shift(data) {\n  var placement = data.placement;\n  var basePlacement = placement.split('-')[0];\n  var shiftvariation = placement.split('-')[1];\n\n  // if shift shiftvariation is specified, run the modifier\n  if (shiftvariation) {\n    var _data$offsets = data.offsets,\n        reference = _data$offsets.reference,\n        popper = _data$offsets.popper;\n\n    var isVertical = ['bottom', 'top'].indexOf(basePlacement) !== -1;\n    var side = isVertical ? 'left' : 'top';\n    var measurement = isVertical ? 'width' : 'height';\n\n    var shiftOffsets = {\n      start: defineProperty({}, side, reference[side]),\n      end: defineProperty({}, side, reference[side] + reference[measurement] - popper[measurement])\n    };\n\n    data.offsets.popper = _extends({}, popper, shiftOffsets[shiftvariation]);\n  }\n\n  return data;\n}\n\n/**\n * @function\n * @memberof Modifiers\n * @argument {Object} data - The data object generated by update method\n * @argument {Object} options - Modifiers configuration and options\n * @returns {Object} The data object, properly modified\n */\nfunction hide(data) {\n  if (!isModifierRequired(data.instance.modifiers, 'hide', 'preventOverflow')) {\n    return data;\n  }\n\n  var refRect = data.offsets.reference;\n  var bound = find(data.instance.modifiers, function (modifier) {\n    return modifier.name === 'preventOverflow';\n  }).boundaries;\n\n  if (refRect.bottom < bound.top || refRect.left > bound.right || refRect.top > bound.bottom || refRect.right < bound.left) {\n    // Avoid unnecessary DOM access if visibility hasn't changed\n    if (data.hide === true) {\n      return data;\n    }\n\n    data.hide = true;\n    data.attributes['x-out-of-boundaries'] = '';\n  } else {\n    // Avoid unnecessary DOM access if visibility hasn't changed\n    if (data.hide === false) {\n      return data;\n    }\n\n    data.hide = false;\n    data.attributes['x-out-of-boundaries'] = false;\n  }\n\n  return data;\n}\n\n/**\n * @function\n * @memberof Modifiers\n * @argument {Object} data - The data object generated by `update` method\n * @argument {Object} options - Modifiers configuration and options\n * @returns {Object} The data object, properly modified\n */\nfunction inner(data) {\n  var placement = data.placement;\n  var basePlacement = placement.split('-')[0];\n  var _data$offsets = data.offsets,\n      popper = _data$offsets.popper,\n      reference = _data$offsets.reference;\n\n  var isHoriz = ['left', 'right'].indexOf(basePlacement) !== -1;\n\n  var subtractLength = ['top', 'left'].indexOf(basePlacement) === -1;\n\n  popper[isHoriz ? 'left' : 'top'] = reference[basePlacement] - (subtractLength ? popper[isHoriz ? 'width' : 'height'] : 0);\n\n  data.placement = getOppositePlacement(placement);\n  data.offsets.popper = getClientRect(popper);\n\n  return data;\n}\n\n/**\n * Modifier function, each modifier can have a function of this type assigned\n * to its `fn` property.<br />\n * These functions will be called on each update, this means that you must\n * make sure they are performant enough to avoid performance bottlenecks.\n *\n * @function ModifierFn\n * @argument {dataObject} data - The data object generated by `update` method\n * @argument {Object} options - Modifiers configuration and options\n * @returns {dataObject} The data object, properly modified\n */\n\n/**\n * Modifiers are plugins used to alter the behavior of your poppers.<br />\n * Popper.js uses a set of 9 modifiers to provide all the basic functionalities\n * needed by the library.\n *\n * Usually you don't want to override the `order`, `fn` and `onLoad` props.\n * All the other properties are configurations that could be tweaked.\n * @namespace modifiers\n */\nvar modifiers = {\n  /**\n   * Modifier used to shift the popper on the start or end of its reference\n   * element.<br />\n   * It will read the variation of the `placement` property.<br />\n   * It can be one either `-end` or `-start`.\n   * @memberof modifiers\n   * @inner\n   */\n  shift: {\n    /** @prop {number} order=100 - Index used to define the order of execution */\n    order: 100,\n    /** @prop {Boolean} enabled=true - Whether the modifier is enabled or not */\n    enabled: true,\n    /** @prop {ModifierFn} */\n    fn: shift\n  },\n\n  /**\n   * The `offset` modifier can shift your popper on both its axis.\n   *\n   * It accepts the following units:\n   * - `px` or unit-less, interpreted as pixels\n   * - `%` or `%r`, percentage relative to the length of the reference element\n   * - `%p`, percentage relative to the length of the popper element\n   * - `vw`, CSS viewport width unit\n   * - `vh`, CSS viewport height unit\n   *\n   * For length is intended the main axis relative to the placement of the popper.<br />\n   * This means that if the placement is `top` or `bottom`, the length will be the\n   * `width`. In case of `left` or `right`, it will be the `height`.\n   *\n   * You can provide a single value (as `Number` or `String`), or a pair of values\n   * as `String` divided by a comma or one (or more) white spaces.<br />\n   * The latter is a deprecated method because it leads to confusion and will be\n   * removed in v2.<br />\n   * Additionally, it accepts additions and subtractions between different units.\n   * Note that multiplications and divisions aren't supported.\n   *\n   * Valid examples are:\n   * ```\n   * 10\n   * '10%'\n   * '10, 10'\n   * '10%, 10'\n   * '10 + 10%'\n   * '10 - 5vh + 3%'\n   * '-10px + 5vh, 5px - 6%'\n   * ```\n   * > **NB**: If you desire to apply offsets to your poppers in a way that may make them overlap\n   * > with their reference element, unfortunately, you will have to disable the `flip` modifier.\n   * > You can read more on this at this [issue](https://github.com/FezVrasta/popper.js/issues/373).\n   *\n   * @memberof modifiers\n   * @inner\n   */\n  offset: {\n    /** @prop {number} order=200 - Index used to define the order of execution */\n    order: 200,\n    /** @prop {Boolean} enabled=true - Whether the modifier is enabled or not */\n    enabled: true,\n    /** @prop {ModifierFn} */\n    fn: offset,\n    /** @prop {Number|String} offset=0\n     * The offset value as described in the modifier description\n     */\n    offset: 0\n  },\n\n  /**\n   * Modifier used to prevent the popper from being positioned outside the boundary.\n   *\n   * A scenario exists where the reference itself is not within the boundaries.<br />\n   * We can say it has \"escaped the boundaries\"  or just \"escaped\".<br />\n   * In this case we need to decide whether the popper should either:\n   *\n   * - detach from the reference and remain \"trapped\" in the boundaries, or\n   * - if it should ignore the boundary and \"escape with its reference\"\n   *\n   * When `escapeWithReference` is set to`true` and reference is completely\n   * outside its boundaries, the popper will overflow (or completely leave)\n   * the boundaries in order to remain attached to the edge of the reference.\n   *\n   * @memberof modifiers\n   * @inner\n   */\n  preventOverflow: {\n    /** @prop {number} order=300 - Index used to define the order of execution */\n    order: 300,\n    /** @prop {Boolean} enabled=true - Whether the modifier is enabled or not */\n    enabled: true,\n    /** @prop {ModifierFn} */\n    fn: preventOverflow,\n    /**\n     * @prop {Array} [priority=['left','right','top','bottom']]\n     * Popper will try to prevent overflow following these priorities by default,\n     * then, it could overflow on the left and on top of the `boundariesElement`\n     */\n    priority: ['left', 'right', 'top', 'bottom'],\n    /**\n     * @prop {number} padding=5\n     * Amount of pixel used to define a minimum distance between the boundaries\n     * and the popper. This makes sure the popper always has a little padding\n     * between the edges of its container\n     */\n    padding: 5,\n    /**\n     * @prop {String|HTMLElement} boundariesElement='scrollParent'\n     * Boundaries used by the modifier. Can be `scrollParent`, `window`,\n     * `viewport` or any DOM element.\n     */\n    boundariesElement: 'scrollParent'\n  },\n\n  /**\n   * Modifier used to make sure the reference and its popper stay near each other\n   * without leaving any gap between the two. Especially useful when the arrow is\n   * enabled and you want to ensure that it points to its reference element.\n   * It cares only about the first axis. You can still have poppers with margin\n   * between the popper and its reference element.\n   * @memberof modifiers\n   * @inner\n   */\n  keepTogether: {\n    /** @prop {number} order=400 - Index used to define the order of execution */\n    order: 400,\n    /** @prop {Boolean} enabled=true - Whether the modifier is enabled or not */\n    enabled: true,\n    /** @prop {ModifierFn} */\n    fn: keepTogether\n  },\n\n  /**\n   * This modifier is used to move the `arrowElement` of the popper to make\n   * sure it is positioned between the reference element and its popper element.\n   * It will read the outer size of the `arrowElement` node to detect how many\n   * pixels of conjunction are needed.\n   *\n   * It has no effect if no `arrowElement` is provided.\n   * @memberof modifiers\n   * @inner\n   */\n  arrow: {\n    /** @prop {number} order=500 - Index used to define the order of execution */\n    order: 500,\n    /** @prop {Boolean} enabled=true - Whether the modifier is enabled or not */\n    enabled: true,\n    /** @prop {ModifierFn} */\n    fn: arrow,\n    /** @prop {String|HTMLElement} element='[x-arrow]' - Selector or node used as arrow */\n    element: '[x-arrow]'\n  },\n\n  /**\n   * Modifier used to flip the popper's placement when it starts to overlap its\n   * reference element.\n   *\n   * Requires the `preventOverflow` modifier before it in order to work.\n   *\n   * **NOTE:** this modifier will interrupt the current update cycle and will\n   * restart it if it detects the need to flip the placement.\n   * @memberof modifiers\n   * @inner\n   */\n  flip: {\n    /** @prop {number} order=600 - Index used to define the order of execution */\n    order: 600,\n    /** @prop {Boolean} enabled=true - Whether the modifier is enabled or not */\n    enabled: true,\n    /** @prop {ModifierFn} */\n    fn: flip,\n    /**\n     * @prop {String|Array} behavior='flip'\n     * The behavior used to change the popper's placement. It can be one of\n     * `flip`, `clockwise`, `counterclockwise` or an array with a list of valid\n     * placements (with optional variations)\n     */\n    behavior: 'flip',\n    /**\n     * @prop {number} padding=5\n     * The popper will flip if it hits the edges of the `boundariesElement`\n     */\n    padding: 5,\n    /**\n     * @prop {String|HTMLElement} boundariesElement='viewport'\n     * The element which will define the boundaries of the popper position.\n     * The popper will never be placed outside of the defined boundaries\n     * (except if `keepTogether` is enabled)\n     */\n    boundariesElement: 'viewport',\n    /**\n     * @prop {Boolean} flipVariations=false\n     * The popper will switch placement variation between `-start` and `-end` when\n     * the reference element overlaps its boundaries.\n     *\n     * The original placement should have a set variation.\n     */\n    flipVariations: false,\n    /**\n     * @prop {Boolean} flipVariationsByContent=false\n     * The popper will switch placement variation between `-start` and `-end` when\n     * the popper element overlaps its reference boundaries.\n     *\n     * The original placement should have a set variation.\n     */\n    flipVariationsByContent: false\n  },\n\n  /**\n   * Modifier used to make the popper flow toward the inner of the reference element.\n   * By default, when this modifier is disabled, the popper will be placed outside\n   * the reference element.\n   * @memberof modifiers\n   * @inner\n   */\n  inner: {\n    /** @prop {number} order=700 - Index used to define the order of execution */\n    order: 700,\n    /** @prop {Boolean} enabled=false - Whether the modifier is enabled or not */\n    enabled: false,\n    /** @prop {ModifierFn} */\n    fn: inner\n  },\n\n  /**\n   * Modifier used to hide the popper when its reference element is outside of the\n   * popper boundaries. It will set a `x-out-of-boundaries` attribute which can\n   * be used to hide with a CSS selector the popper when its reference is\n   * out of boundaries.\n   *\n   * Requires the `preventOverflow` modifier before it in order to work.\n   * @memberof modifiers\n   * @inner\n   */\n  hide: {\n    /** @prop {number} order=800 - Index used to define the order of execution */\n    order: 800,\n    /** @prop {Boolean} enabled=true - Whether the modifier is enabled or not */\n    enabled: true,\n    /** @prop {ModifierFn} */\n    fn: hide\n  },\n\n  /**\n   * Computes the style that will be applied to the popper element to gets\n   * properly positioned.\n   *\n   * Note that this modifier will not touch the DOM, it just prepares the styles\n   * so that `applyStyle` modifier can apply it. This separation is useful\n   * in case you need to replace `applyStyle` with a custom implementation.\n   *\n   * This modifier has `850` as `order` value to maintain backward compatibility\n   * with previous versions of Popper.js. Expect the modifiers ordering method\n   * to change in future major versions of the library.\n   *\n   * @memberof modifiers\n   * @inner\n   */\n  computeStyle: {\n    /** @prop {number} order=850 - Index used to define the order of execution */\n    order: 850,\n    /** @prop {Boolean} enabled=true - Whether the modifier is enabled or not */\n    enabled: true,\n    /** @prop {ModifierFn} */\n    fn: computeStyle,\n    /**\n     * @prop {Boolean} gpuAcceleration=true\n     * If true, it uses the CSS 3D transformation to position the popper.\n     * Otherwise, it will use the `top` and `left` properties\n     */\n    gpuAcceleration: true,\n    /**\n     * @prop {string} [x='bottom']\n     * Where to anchor the X axis (`bottom` or `top`). AKA X offset origin.\n     * Change this if your popper should grow in a direction different from `bottom`\n     */\n    x: 'bottom',\n    /**\n     * @prop {string} [x='left']\n     * Where to anchor the Y axis (`left` or `right`). AKA Y offset origin.\n     * Change this if your popper should grow in a direction different from `right`\n     */\n    y: 'right'\n  },\n\n  /**\n   * Applies the computed styles to the popper element.\n   *\n   * All the DOM manipulations are limited to this modifier. This is useful in case\n   * you want to integrate Popper.js inside a framework or view library and you\n   * want to delegate all the DOM manipulations to it.\n   *\n   * Note that if you disable this modifier, you must make sure the popper element\n   * has its position set to `absolute` before Popper.js can do its work!\n   *\n   * Just disable this modifier and define your own to achieve the desired effect.\n   *\n   * @memberof modifiers\n   * @inner\n   */\n  applyStyle: {\n    /** @prop {number} order=900 - Index used to define the order of execution */\n    order: 900,\n    /** @prop {Boolean} enabled=true - Whether the modifier is enabled or not */\n    enabled: true,\n    /** @prop {ModifierFn} */\n    fn: applyStyle,\n    /** @prop {Function} */\n    onLoad: applyStyleOnLoad,\n    /**\n     * @deprecated since version 1.10.0, the property moved to `computeStyle` modifier\n     * @prop {Boolean} gpuAcceleration=true\n     * If true, it uses the CSS 3D transformation to position the popper.\n     * Otherwise, it will use the `top` and `left` properties\n     */\n    gpuAcceleration: undefined\n  }\n};\n\n/**\n * The `dataObject` is an object containing all the information used by Popper.js.\n * This object is passed to modifiers and to the `onCreate` and `onUpdate` callbacks.\n * @name dataObject\n * @property {Object} data.instance The Popper.js instance\n * @property {String} data.placement Placement applied to popper\n * @property {String} data.originalPlacement Placement originally defined on init\n * @property {Boolean} data.flipped True if popper has been flipped by flip modifier\n * @property {Boolean} data.hide True if the reference element is out of boundaries, useful to know when to hide the popper\n * @property {HTMLElement} data.arrowElement Node used as arrow by arrow modifier\n * @property {Object} data.styles Any CSS property defined here will be applied to the popper. It expects the JavaScript nomenclature (eg. `marginBottom`)\n * @property {Object} data.arrowStyles Any CSS property defined here will be applied to the popper arrow. It expects the JavaScript nomenclature (eg. `marginBottom`)\n * @property {Object} data.boundaries Offsets of the popper boundaries\n * @property {Object} data.offsets The measurements of popper, reference and arrow elements\n * @property {Object} data.offsets.popper `top`, `left`, `width`, `height` values\n * @property {Object} data.offsets.reference `top`, `left`, `width`, `height` values\n * @property {Object} data.offsets.arrow] `top` and `left` offsets, only one of them will be different from 0\n */\n\n/**\n * Default options provided to Popper.js constructor.<br />\n * These can be overridden using the `options` argument of Popper.js.<br />\n * To override an option, simply pass an object with the same\n * structure of the `options` object, as the 3rd argument. For example:\n * ```\n * new Popper(ref, pop, {\n *   modifiers: {\n *     preventOverflow: { enabled: false }\n *   }\n * })\n * ```\n * @type {Object}\n * @static\n * @memberof Popper\n */\nvar Defaults = {\n  /**\n   * Popper's placement.\n   * @prop {Popper.placements} placement='bottom'\n   */\n  placement: 'bottom',\n\n  /**\n   * Set this to true if you want popper to position it self in 'fixed' mode\n   * @prop {Boolean} positionFixed=false\n   */\n  positionFixed: false,\n\n  /**\n   * Whether events (resize, scroll) are initially enabled.\n   * @prop {Boolean} eventsEnabled=true\n   */\n  eventsEnabled: true,\n\n  /**\n   * Set to true if you want to automatically remove the popper when\n   * you call the `destroy` method.\n   * @prop {Boolean} removeOnDestroy=false\n   */\n  removeOnDestroy: false,\n\n  /**\n   * Callback called when the popper is created.<br />\n   * By default, it is set to no-op.<br />\n   * Access Popper.js instance with `data.instance`.\n   * @prop {onCreate}\n   */\n  onCreate: function onCreate() {},\n\n  /**\n   * Callback called when the popper is updated. This callback is not called\n   * on the initialization/creation of the popper, but only on subsequent\n   * updates.<br />\n   * By default, it is set to no-op.<br />\n   * Access Popper.js instance with `data.instance`.\n   * @prop {onUpdate}\n   */\n  onUpdate: function onUpdate() {},\n\n  /**\n   * List of modifiers used to modify the offsets before they are applied to the popper.\n   * They provide most of the functionalities of Popper.js.\n   * @prop {modifiers}\n   */\n  modifiers: modifiers\n};\n\n/**\n * @callback onCreate\n * @param {dataObject} data\n */\n\n/**\n * @callback onUpdate\n * @param {dataObject} data\n */\n\n// Utils\n// Methods\nvar Popper = function () {\n  /**\n   * Creates a new Popper.js instance.\n   * @class Popper\n   * @param {Element|referenceObject} reference - The reference element used to position the popper\n   * @param {Element} popper - The HTML / XML element used as the popper\n   * @param {Object} options - Your custom options to override the ones defined in [Defaults](#defaults)\n   * @return {Object} instance - The generated Popper.js instance\n   */\n  function Popper(reference, popper) {\n    var _this = this;\n\n    var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n    classCallCheck(this, Popper);\n\n    this.scheduleUpdate = function () {\n      return requestAnimationFrame(_this.update);\n    };\n\n    // make update() debounced, so that it only runs at most once-per-tick\n    this.update = debounce(this.update.bind(this));\n\n    // with {} we create a new object with the options inside it\n    this.options = _extends({}, Popper.Defaults, options);\n\n    // init state\n    this.state = {\n      isDestroyed: false,\n      isCreated: false,\n      scrollParents: []\n    };\n\n    // get reference and popper elements (allow jQuery wrappers)\n    this.reference = reference && reference.jquery ? reference[0] : reference;\n    this.popper = popper && popper.jquery ? popper[0] : popper;\n\n    // Deep merge modifiers options\n    this.options.modifiers = {};\n    Object.keys(_extends({}, Popper.Defaults.modifiers, options.modifiers)).forEach(function (name) {\n      _this.options.modifiers[name] = _extends({}, Popper.Defaults.modifiers[name] || {}, options.modifiers ? options.modifiers[name] : {});\n    });\n\n    // Refactoring modifiers' list (Object => Array)\n    this.modifiers = Object.keys(this.options.modifiers).map(function (name) {\n      return _extends({\n        name: name\n      }, _this.options.modifiers[name]);\n    })\n    // sort the modifiers by order\n    .sort(function (a, b) {\n      return a.order - b.order;\n    });\n\n    // modifiers have the ability to execute arbitrary code when Popper.js get inited\n    // such code is executed in the same order of its modifier\n    // they could add new properties to their options configuration\n    // BE AWARE: don't add options to `options.modifiers.name` but to `modifierOptions`!\n    this.modifiers.forEach(function (modifierOptions) {\n      if (modifierOptions.enabled && isFunction(modifierOptions.onLoad)) {\n        modifierOptions.onLoad(_this.reference, _this.popper, _this.options, modifierOptions, _this.state);\n      }\n    });\n\n    // fire the first update to position the popper in the right place\n    this.update();\n\n    var eventsEnabled = this.options.eventsEnabled;\n    if (eventsEnabled) {\n      // setup event listeners, they will take care of update the position in specific situations\n      this.enableEventListeners();\n    }\n\n    this.state.eventsEnabled = eventsEnabled;\n  }\n\n  // We can't use class properties because they don't get listed in the\n  // class prototype and break stuff like Sinon stubs\n\n\n  createClass(Popper, [{\n    key: 'update',\n    value: function update$$1() {\n      return update.call(this);\n    }\n  }, {\n    key: 'destroy',\n    value: function destroy$$1() {\n      return destroy.call(this);\n    }\n  }, {\n    key: 'enableEventListeners',\n    value: function enableEventListeners$$1() {\n      return enableEventListeners.call(this);\n    }\n  }, {\n    key: 'disableEventListeners',\n    value: function disableEventListeners$$1() {\n      return disableEventListeners.call(this);\n    }\n\n    /**\n     * Schedules an update. It will run on the next UI update available.\n     * @method scheduleUpdate\n     * @memberof Popper\n     */\n\n\n    /**\n     * Collection of utilities useful when writing custom modifiers.\n     * Starting from version 1.7, this method is available only if you\n     * include `popper-utils.js` before `popper.js`.\n     *\n     * **DEPRECATION**: This way to access PopperUtils is deprecated\n     * and will be removed in v2! Use the PopperUtils module directly instead.\n     * Due to the high instability of the methods contained in Utils, we can't\n     * guarantee them to follow semver. Use them at your own risk!\n     * @static\n     * @private\n     * @type {Object}\n     * @deprecated since version 1.8\n     * @member Utils\n     * @memberof Popper\n     */\n\n  }]);\n  return Popper;\n}();\n\n/**\n * The `referenceObject` is an object that provides an interface compatible with Popper.js\n * and lets you use it as replacement of a real DOM node.<br />\n * You can use this method to position a popper relatively to a set of coordinates\n * in case you don't have a DOM node to use as reference.\n *\n * ```\n * new Popper(referenceObject, popperNode);\n * ```\n *\n * NB: This feature isn't supported in Internet Explorer 10.\n * @name referenceObject\n * @property {Function} data.getBoundingClientRect\n * A function that returns a set of coordinates compatible with the native `getBoundingClientRect` method.\n * @property {number} data.clientWidth\n * An ES6 getter that will return the width of the virtual reference element.\n * @property {number} data.clientHeight\n * An ES6 getter that will return the height of the virtual reference element.\n */\n\n\nPopper.Utils = (typeof window !== 'undefined' ? window : global).PopperUtils;\nPopper.placements = placements;\nPopper.Defaults = Defaults;\n\nexport default Popper;\n//# sourceMappingURL=popper.js.map\n","import Popper from 'popper.js';\r\nimport DialogManager from './DialogManager';\r\nimport merge from '../../internal/merge';\r\n\r\nexport interface IDialogOptions {\r\n  title: string;\r\n  fullDialog: boolean;\r\n  resetPossible: boolean;\r\n\r\n  // popper options\r\n  placement?: Popper.Placement;\r\n  eventsEnabled?: boolean;\r\n  modifiers?: Popper.Modifiers;\r\n  toggleDialog: boolean;\r\n}\r\n\r\nexport interface IDialogContext {\r\n  attachment: HTMLElement;\r\n  level: number;\r\n  manager: DialogManager;\r\n  idPrefix: string;\r\n}\r\n\r\nabstract class ADialog {\r\n\r\n  private readonly options: Readonly<IDialogOptions> = {\r\n    title: '',\r\n    fullDialog: false,\r\n    resetPossible: true,\r\n    placement: 'bottom-start',\r\n    toggleDialog: true,\r\n    modifiers: {\r\n    }\r\n  };\r\n\r\n  readonly node: HTMLFormElement;\r\n  private popper: Popper | null = null;\r\n\r\n  constructor(protected readonly dialog: Readonly<IDialogContext>, options: Partial<IDialogOptions> = {}) {\r\n    Object.assign(this.options, options);\r\n    console.assert(dialog.attachment.ownerDocument != null);\r\n    this.node = dialog.attachment.ownerDocument!.createElement('form');\r\n    this.node.classList.add('lu-dialog');\r\n  }\r\n\r\n  get attachment() {\r\n    return this.dialog.attachment;\r\n  }\r\n\r\n  get level() {\r\n    return this.dialog.level;\r\n  }\r\n\r\n  protected abstract build(node: HTMLElement): boolean | void;\r\n\r\n  equals(that: ADialog) {\r\n    return this.dialog.level === that.dialog.level && this.dialog.attachment === that.dialog.attachment;\r\n  }\r\n\r\n  open() {\r\n    if (this.options.toggleDialog && this.dialog.manager.removeLike(this)) {\r\n      return;\r\n    }\r\n    if (this.build(this.node) === false) {\r\n      return;\r\n    }\r\n    const parent = <HTMLElement>this.attachment.closest('.lu')!;\r\n\r\n    if (this.options.title) {\r\n      this.node.insertAdjacentHTML('afterbegin', `<strong>${this.options.title}</strong>`);\r\n    }\r\n    if (this.options.fullDialog) {\r\n      this.node.insertAdjacentHTML('beforeend', `<div>\r\n        <button type=\"submit\" title=\"Apply\"></button>\r\n        <button type=\"button\" title=\"Cancel\"></button>\r\n        <button type=\"reset\" title=\"Reset to default values\" ${!this.options.resetPossible ? 'style=\"visibility: hidden\"': ''}></button>\r\n      </div>`);\r\n    }\r\n\r\n    parent.appendChild(this.node);\r\n    this.popper = new Popper(this.attachment, this.node, merge({\r\n      modifiers: {\r\n        preventOverflow: {\r\n          boundariesElement: parent\r\n        }\r\n      }\r\n    }, this.options));\r\n\r\n    const auto = this.find<HTMLInputElement>('input[autofocus]');\r\n    if (auto) {\r\n      // delay such that it works\r\n      self.setTimeout(() => auto.focus());\r\n    }\r\n\r\n    const reset = this.find<HTMLButtonElement>('button[type=reset]');\r\n    if (reset) {\r\n      reset.onclick = (evt) => {\r\n        evt.stopPropagation();\r\n        evt.preventDefault();\r\n        this.reset();\r\n      };\r\n    }\r\n    this.node.onsubmit = (evt) => {\r\n      evt.stopPropagation();\r\n      evt.preventDefault();\r\n      if (!this.node.checkValidity()) {\r\n        return false;\r\n      }\r\n      if (this.submit()) {\r\n        this.destroy();\r\n      }\r\n      return false;\r\n    };\r\n    const cancel = this.find<HTMLButtonElement>('button[title=Cancel]');\r\n    if (cancel) {\r\n      cancel.onclick = (evt) => {\r\n        evt.stopPropagation();\r\n        evt.preventDefault();\r\n        this.destroy();\r\n      };\r\n    }\r\n\r\n    this.dialog.manager.push(this);\r\n  }\r\n\r\n  protected find<T extends HTMLElement>(selector: string): T {\r\n    return <T>this.node.querySelector(selector);\r\n  }\r\n\r\n  protected findInput(selector: string) {\r\n    return this.find<HTMLInputElement>(selector);\r\n  }\r\n\r\n  protected forEach<M extends Element, T>(selector: string, callback: (d: M, i: number) => T): T[] {\r\n    return (<M[]>Array.from(this.node.querySelectorAll(selector))).map(callback);\r\n  }\r\n\r\n  protected reset() {\r\n    // hook\r\n  }\r\n\r\n  protected submit(): boolean {\r\n    // hook\r\n    return true;\r\n  }\r\n\r\n  destroy() {\r\n    this.dialog.manager.remove(this);\r\n    if (this.popper) {\r\n      this.popper.destroy();\r\n    }\r\n    this.node.remove();\r\n  }\r\n}\r\n\r\nexport default ADialog;\r\n","import {Category, toolbar, dialogAddons} from './annotations';\r\nimport Column, {widthChanged, labelChanged, metaDataChanged, dirty, dirtyHeader, dirtyValues, rendererTypeChanged, groupRendererChanged, summaryRendererChanged, visibilityChanged} from './Column';\r\nimport {IDataRow, IGroup} from './interfaces';\r\nimport {FIRST_IS_MISSING, missingGroup} from './missing';\r\nimport ValueColumn, {IValueColumnDesc, dataLoaded} from './ValueColumn';\r\nimport {IEventListener} from '../internal/AEventDispatcher';\r\nimport {equal} from '../internal';\r\nimport {defaultGroup} from './Group';\r\n\r\nexport enum EAlignment {\r\n  left = 'left',\r\n  center = 'center',\r\n  right = 'right'\r\n}\r\n\r\nexport enum EStringGroupCriteriaType {\r\n  value = 'value',\r\n  startsWith = 'startsWith',\r\n  regex = 'regex'\r\n}\r\n\r\nexport interface IStringGroupCriteria {\r\n  type: EStringGroupCriteriaType;\r\n  values: (string | RegExp)[];\r\n}\r\n\r\nexport interface IStringDesc {\r\n  /**\r\n   * column alignment: left, center, right\r\n   * @default left\r\n   */\r\n  alignment?: EAlignment;\r\n\r\n  /**\r\n   * escape html tags\r\n   */\r\n  escape?: boolean;\r\n}\r\n\r\n\r\nexport declare type IStringColumnDesc = IStringDesc & IValueColumnDesc<string>;\r\n\r\n/**\r\n * emitted when the filter property changes\r\n * @asMemberOf StringColumn\r\n * @event\r\n */\r\nexport declare function filterChanged(previous: string | RegExp | null, current: string | RegExp | null): void;\r\n\r\n\r\n/**\r\n * emitted when the grouping property changes\r\n * @asMemberOf StringColumn\r\n * @event\r\n */\r\nexport declare function groupingChanged(previous: (RegExp | string)[][], current: (RegExp | string)[][]): void;\r\n\r\n/**\r\n * a string column with optional alignment\r\n */\r\n@toolbar('search', 'groupBy', 'filterString')\r\n@dialogAddons('group', 'groupString')\r\n@Category('string')\r\nexport default class StringColumn extends ValueColumn<string> {\r\n  static readonly EVENT_FILTER_CHANGED = 'filterChanged';\r\n  static readonly EVENT_GROUPING_CHANGED = 'groupingChanged';\r\n\r\n  //magic key for filtering missing ones\r\n  static readonly FILTER_MISSING = '__FILTER_MISSING';\r\n  private currentFilter: string | RegExp | null = null;\r\n\r\n  readonly alignment: EAlignment;\r\n  readonly escape: boolean;\r\n\r\n  private currentGroupCriteria: IStringGroupCriteria = {\r\n    type: EStringGroupCriteriaType.startsWith,\r\n    values: []\r\n  };\r\n\r\n  constructor(id: string, desc: Readonly<IStringColumnDesc>) {\r\n    super(id, desc);\r\n    this.setDefaultWidth(200); //by default 200\r\n    this.alignment = <any>desc.alignment || EAlignment.left;\r\n    this.escape = desc.escape !== false;\r\n  }\r\n\r\n\r\n  protected createEventList() {\r\n    return super.createEventList().concat([StringColumn.EVENT_GROUPING_CHANGED, StringColumn.EVENT_FILTER_CHANGED]);\r\n  }\r\n\r\n  on(type: typeof StringColumn.EVENT_FILTER_CHANGED, listener: typeof filterChanged | null): this;\r\n  on(type: typeof ValueColumn.EVENT_DATA_LOADED, listener: typeof dataLoaded | null): this;\r\n  on(type: typeof StringColumn.EVENT_GROUPING_CHANGED, listener: typeof groupingChanged | null): this;\r\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\r\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\r\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\r\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\r\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\r\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\r\n  on(type: string | string[], listener: IEventListener | null): this {\r\n    return super.on(<any>type, listener);\r\n  }\r\n\r\n  getValue(row: IDataRow) {\r\n    const v: any = super.getValue(row);\r\n    return v == null ? '' : String(v);\r\n  }\r\n\r\n  getLabel(row: IDataRow) {\r\n    return this.getValue(row) || '';\r\n  }\r\n\r\n  dump(toDescRef: (desc: any) => any): any {\r\n    const r = super.dump(toDescRef);\r\n    if (this.currentFilter instanceof RegExp) {\r\n      r.filter = `REGEX:${(<RegExp>this.currentFilter).source}`;\r\n    } else {\r\n      r.filter = this.currentFilter;\r\n    }\r\n    if (this.currentGroupCriteria) {\r\n      const {type, values} = this.currentGroupCriteria;\r\n      r.groupCriteria = {\r\n        type,\r\n        values: values.map((value) => `${type}:${value instanceof RegExp && type === EStringGroupCriteriaType.regex ? value.source : value}`)\r\n      };\r\n    }\r\n    return r;\r\n  }\r\n\r\n  restore(dump: any, factory: (dump: any) => Column | null) {\r\n    super.restore(dump, factory);\r\n    if (dump.filter && (<string>dump.filter).startsWith('REGEX:')) {\r\n      this.currentFilter = new RegExp(dump.filter.slice(6), 'gm');\r\n    } else {\r\n      this.currentFilter = dump.filter || null;\r\n    }\r\n    // tslint:disable-next-line: early-exit\r\n    if (dump.groupCriteria) {\r\n      const {type, values} = <IStringGroupCriteria>dump.groupCriteria;\r\n      this.currentGroupCriteria = {\r\n        type,\r\n        values: values.map((value) => type === EStringGroupCriteriaType.regex ? new RegExp(<string>value, 'gm') : value)\r\n      };\r\n    }\r\n  }\r\n\r\n  isFiltered() {\r\n    return this.currentFilter != null;\r\n  }\r\n\r\n  filter(row: IDataRow) {\r\n    if (!this.isFiltered()) {\r\n      return true;\r\n    }\r\n    const r = this.getLabel(row);\r\n    const filter = this.currentFilter;\r\n\r\n    if (filter === StringColumn.FILTER_MISSING) { //filter empty\r\n      return r != null && r.trim() !== '';\r\n    }\r\n    if (typeof filter === 'string' && filter.length > 0) {\r\n      return r !== '' && r.toLowerCase().indexOf(filter.toLowerCase()) >= 0;\r\n    }\r\n    if (filter instanceof RegExp) {\r\n      return r !== '' && r.match(filter) != null; // You can not use RegExp.test(), because of https://stackoverflow.com/a/6891667\r\n    }\r\n    return true;\r\n  }\r\n\r\n  getFilter() {\r\n    return this.currentFilter;\r\n  }\r\n\r\n  setFilter(filter: string | RegExp | null) {\r\n    if (filter === '') {\r\n      filter = null;\r\n    }\r\n    if (this.currentFilter === filter) {\r\n      return;\r\n    }\r\n    this.fire([StringColumn.EVENT_FILTER_CHANGED, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY], this.currentFilter, this.currentFilter = filter);\r\n  }\r\n\r\n  getGroupCriteria(): IStringGroupCriteria {\r\n    return this.currentGroupCriteria;\r\n  }\r\n\r\n  setGroupCriteria(value: IStringGroupCriteria) {\r\n    if (equal(this.currentGroupCriteria, value)) {\r\n      return;\r\n    }\r\n    const bak = this.getGroupCriteria();\r\n    this.currentGroupCriteria = value;\r\n    this.fire([StringColumn.EVENT_GROUPING_CHANGED, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY], bak, value);\r\n  }\r\n\r\n  compare(a: IDataRow, b: IDataRow) {\r\n    const aValue = this.getLabel(a);\r\n    const bValue = this.getLabel(b);\r\n    if (aValue === '') {\r\n      return bValue === '' ? 0 : FIRST_IS_MISSING; //same = 0\r\n    }\r\n    if (bValue === '') {\r\n      return -FIRST_IS_MISSING;\r\n    }\r\n    return aValue.toLowerCase().localeCompare(bValue.toLowerCase());\r\n  }\r\n\r\n  group(row: IDataRow): IGroup {\r\n    if (this.isMissing(row)) {\r\n      return missingGroup;\r\n    }\r\n\r\n    const rowValue = this.getLabel(row);\r\n\r\n    if (!rowValue) {\r\n      return defaultGroup;\r\n    }\r\n\r\n    const {type, values} = this.currentGroupCriteria;\r\n    if (type === EStringGroupCriteriaType.value) {\r\n      return {\r\n        name: rowValue,\r\n        color: defaultGroup.color\r\n      };\r\n    }\r\n    for (const groupValue of values) {\r\n      if (type === EStringGroupCriteriaType.startsWith && typeof groupValue === 'string' && rowValue.startsWith(groupValue)) {\r\n        return {\r\n          name: groupValue,\r\n          color: defaultGroup.color\r\n        };\r\n      }\r\n      // tslint:disable-next-line: early-exit\r\n      if (type === EStringGroupCriteriaType.regex && groupValue instanceof RegExp && groupValue.test(rowValue)) {\r\n        return {\r\n          name: groupValue.source,\r\n          color: defaultGroup.color\r\n        };\r\n      }\r\n    }\r\n\r\n    return defaultGroup;\r\n  }\r\n}\r\n\r\n","import {scaleLinear, scaleLog, scalePow, scaleSqrt} from 'd3-scale';\r\nimport {similar} from '../internal';\r\nimport Column from './Column';\r\nimport INumberColumn, {INumberFilter} from './INumberColumn';\r\nimport {IColorMappingFunction} from './ColorMappingFunction';\r\n\r\n/**\r\n * interface of a d3 scale\r\n */\r\nexport interface IScale {\r\n  (v: number): number;\r\n\r\n  invert(r: number): number;\r\n\r\n  domain(): number[];\r\n\r\n  domain(domain: number[]): this;\r\n\r\n  range(): number[];\r\n\r\n  range(range: number[]): this;\r\n}\r\n\r\nexport interface IMappingFunction {\r\n  //new(domain: number[]);\r\n\r\n  apply(v: number): number;\r\n\r\n  dump(): any;\r\n\r\n  restore(dump: any): void;\r\n\r\n  domain: number[];\r\n\r\n  clone(): IMappingFunction;\r\n\r\n  eq(other: IMappingFunction): boolean;\r\n\r\n  getRange(formatter: (v: number) => string): [string, string];\r\n\r\n}\r\n\r\n\r\nfunction toScale(type = 'linear'): IScale {\r\n  switch (type) {\r\n    case 'log':\r\n      return scaleLog().clamp(true);\r\n    case 'sqrt':\r\n      return scaleSqrt().clamp(true);\r\n    case 'pow1.1':\r\n      return scalePow().exponent(1.1).clamp(true);\r\n    case 'pow2':\r\n      return scalePow().exponent(2).clamp(true);\r\n    case 'pow3':\r\n      return scalePow().exponent(3).clamp(true);\r\n    default:\r\n      return scaleLinear().clamp(true);\r\n  }\r\n}\r\n\r\n\r\nexport interface IMapAbleColumn extends INumberColumn {\r\n  getOriginalMapping(): IMappingFunction;\r\n\r\n  getMapping(): IMappingFunction;\r\n\r\n  setMapping(mapping: IMappingFunction): void;\r\n\r\n  getColorMapping(): IColorMappingFunction;\r\n\r\n  setColorMapping(mapping: IColorMappingFunction): void;\r\n\r\n  getFilter(): INumberFilter;\r\n\r\n  setFilter(value?: INumberFilter): void;\r\n\r\n  getRange(): [string, string];\r\n}\r\n\r\nexport function isMapAbleColumn(col: Column): col is IMapAbleColumn {\r\n  return typeof (<IMapAbleColumn>col).getMapping === 'function';\r\n}\r\n\r\nfunction isSame(a: number[], b: number[]) {\r\n  if (a.length !== b.length) {\r\n    return false;\r\n  }\r\n  return a.every((ai, i) => similar(ai, b[i], 0.0001));\r\n}\r\n\r\n\r\nfunction fixDomain(domain: number[], type: string) {\r\n  if (type === 'log' && domain[0] === 0) {\r\n    domain[0] = 0.0000001; //0 is bad\r\n  }\r\n  return domain;\r\n}\r\n\r\n/**\r\n * a mapping function based on a d3 scale (linear, sqrt, log)\r\n */\r\nexport class ScaleMappingFunction implements IMappingFunction {\r\n  private s: IScale;\r\n\r\n  constructor(domain: number[] = [0, 1], private type = 'linear', range: number[] = [0, 1]) {\r\n\r\n    this.s = toScale(type).domain(fixDomain(domain, this.type)).range(range);\r\n  }\r\n\r\n  get domain() {\r\n    return this.s.domain();\r\n  }\r\n\r\n  set domain(domain: number[]) {\r\n    this.s.domain(fixDomain(domain, this.type));\r\n  }\r\n\r\n  get range() {\r\n    return this.s.range();\r\n  }\r\n\r\n  set range(range: number[]) {\r\n    this.s.range(range);\r\n  }\r\n\r\n  getRange(format: (v: number) => string): [string, string] {\r\n    return [format(this.invert(0)), format(this.invert(1))];\r\n  }\r\n\r\n  apply(v: number): number {\r\n    return this.s(v);\r\n  }\r\n\r\n  invert(r: number) {\r\n    return this.s.invert(r);\r\n  }\r\n\r\n  get scaleType() {\r\n    return this.type;\r\n  }\r\n\r\n  dump(): any {\r\n    return {\r\n      type: this.type,\r\n      domain: this.domain,\r\n      range: this.range\r\n    };\r\n  }\r\n\r\n  eq(other: IMappingFunction): boolean {\r\n    if (!(other instanceof ScaleMappingFunction)) {\r\n      return false;\r\n    }\r\n    const that = <ScaleMappingFunction>other;\r\n    return that.type === this.type && isSame(this.domain, that.domain) && isSame(this.range, that.range);\r\n  }\r\n\r\n  restore(dump: any) {\r\n    this.type = dump.type;\r\n    this.s = toScale(dump.type).domain(dump.domain).range(dump.range);\r\n  }\r\n\r\n  clone() {\r\n    return new ScaleMappingFunction(this.domain, this.type, this.range);\r\n  }\r\n}\r\n\r\n/**\r\n * a mapping function based on a custom user function using 'value' as the current value\r\n */\r\nexport class ScriptMappingFunction implements IMappingFunction {\r\n  private f: Function;\r\n\r\n  constructor(public domain: number[] = [0, 1], private _code: string = 'return this.linear(value,this.value_min,this.value_max);') {\r\n    this.f = new Function('value', _code);\r\n  }\r\n\r\n  get code() {\r\n    return this._code;\r\n  }\r\n\r\n  set code(code: string) {\r\n    if (this._code === code) {\r\n      return;\r\n    }\r\n    this._code = code;\r\n    this.f = new Function('value', code);\r\n  }\r\n\r\n  getRange(): [string, string] {\r\n    return ['?', '?'];\r\n  }\r\n\r\n  apply(v: number): number {\r\n    const min = this.domain[0],\r\n      max = this.domain[this.domain.length - 1];\r\n    const r = this.f.call({\r\n      value_min: min,\r\n      value_max: max,\r\n      value_range: max - min,\r\n      value_domain: this.domain.slice(),\r\n      linear: (v: number, mi: number, ma: number) => (v - mi) / (ma - mi)\r\n    }, v);\r\n\r\n    if (typeof r === 'number') {\r\n      return Math.max(Math.min(r, 1), 0);\r\n    }\r\n    return NaN;\r\n  }\r\n\r\n  dump(): any {\r\n    return {\r\n      type: 'script',\r\n      code: this.code,\r\n      domain: this.domain\r\n    };\r\n  }\r\n\r\n  eq(other: IMappingFunction): boolean {\r\n    if (!(other instanceof ScriptMappingFunction)) {\r\n      return false;\r\n    }\r\n    const that = <ScriptMappingFunction>other;\r\n    return that.code === this.code;\r\n  }\r\n\r\n  restore(dump: any) {\r\n    this.code = dump.code;\r\n    this.domain = dump.domain;\r\n  }\r\n\r\n  clone() {\r\n    return new ScriptMappingFunction(this.domain, this.code);\r\n  }\r\n}\r\n\r\nexport interface IMapAbleDesc {\r\n  /**\r\n   * dump of mapping function\r\n   */\r\n  map?: any;\r\n  /**\r\n   * either map or domain should be available\r\n   */\r\n  domain?: [number, number];\r\n  /**\r\n   * @default [0,1]\r\n   */\r\n  range?: [number, number];\r\n\r\n  /**\r\n   * @deprecated use colorMapping instead\r\n   */\r\n  color?: string;\r\n  colorMapping?: string | ((v: number)=>string) | any;\r\n}\r\n\r\nexport function createMappingFunction(dump: any): IMappingFunction {\r\n  if (dump.type === 'script') {\r\n    const s = new ScriptMappingFunction();\r\n    s.restore(dump);\r\n    return s;\r\n  }\r\n  const l = new ScaleMappingFunction();\r\n  l.restore(dump);\r\n  return l;\r\n}\r\n\r\nexport function restoreMapping(desc: IMapAbleDesc): IMappingFunction {\r\n  if (desc.map) {\r\n    return createMappingFunction(desc.map);\r\n  }\r\n  if (desc.domain) {\r\n    return new ScaleMappingFunction(desc.domain, 'linear', desc.range || [0, 1]);\r\n  }\r\n  return new ScaleMappingFunction([0, 1], 'linear', [0, 1]);\r\n}\r\n","import {ICategoricalStatistics, IStatistics} from '../internal';\r\nimport AEventDispatcher, {suffix} from '../internal/AEventDispatcher';\r\nimport debounce from '../internal/debounce';\r\nimport OrderedSet from '../internal/OrderedSet';\r\nimport {\r\n  Column, createActionDesc, createAggregateDesc, createGroupDesc, createRankDesc, createSelectionDesc,\r\n  createStackDesc, ICategoricalColumn, IColumnDesc, IDataRow, IGroup, INumberColumn, IOrderedGroup,\r\n  ISelectionColumnDesc, IValueColumnDesc, models\r\n} from '../model';\r\nimport {dirty, dirtyHeader, dirtyValues} from '../model/Column';\r\nimport AggregateGroupColumn, {IAggregateGroupColumnDesc} from '../model/AggregateGroupColumn';\r\nimport {toGroupID, unifyParents} from '../model/internal';\r\nimport RankColumn from '../model/RankColumn';\r\nimport Ranking, {orderChanged, addColumn, removeColumn} from '../model/Ranking';\r\nimport StackColumn from '../model/StackColumn';\r\nimport {exportRanking, IExportOptions} from './utils';\r\nimport {isSupportType} from '../model/annotations';\r\nimport {IEventListener} from '../internal/AEventDispatcher';\r\n\r\nexport {IExportOptions} from './utils';\r\n\r\nexport interface IStatsBuilder {\r\n  stats(col: INumberColumn): Promise<IStatistics> | IStatistics;\r\n\r\n  hist(col: ICategoricalColumn): Promise<ICategoricalStatistics> | ICategoricalStatistics;\r\n}\r\n\r\nexport interface IDataProviderOptions {\r\n  columnTypes: { [columnType: string]: typeof Column };\r\n\r\n  /**\r\n   * allow multiple selected rows\r\n   * default: true\r\n   */\r\n  multiSelection: boolean;\r\n}\r\n\r\nexport interface IDataProvider extends AEventDispatcher {\r\n  readonly columnTypes: { [columnType: string]: typeof Column };\r\n\r\n  getTotalNumberOfRows(): number;\r\n\r\n  takeSnapshot(col: Column): void;\r\n\r\n  selectAllOf(ranking: Ranking): void;\r\n\r\n  getSelection(): number[];\r\n\r\n  setSelection(dataIndices: number[]): void;\r\n\r\n  toggleSelection(i: number, additional?: boolean): boolean;\r\n\r\n  isSelected(i: number): boolean;\r\n\r\n  removeRanking(ranking: Ranking): void;\r\n\r\n  ensureOneRanking(): void;\r\n\r\n  find(id: string): Column | null;\r\n\r\n  clone(col: Column): Column;\r\n\r\n  create(desc: IColumnDesc): Column | null;\r\n\r\n  toDescRef(desc: IColumnDesc): any;\r\n\r\n  fromDescRef(ref: any): IColumnDesc;\r\n\r\n  mappingSample(col: Column): Promise<number[]> | number[];\r\n\r\n  searchAndJump(search: string | RegExp, col: Column): void;\r\n\r\n  getRankings(): Ranking[];\r\n\r\n  getFirstRanking(): Ranking | null;\r\n  getLastRanking(): Ranking;\r\n\r\n  getColumns(): IColumnDesc[];\r\n\r\n  isAggregated(ranking: Ranking, group: IGroup): boolean;\r\n\r\n  aggregateAllOf(ranking: Ranking, aggregateAll: boolean): void;\r\n}\r\n\r\n/**\r\n * emitted when the selection changes\r\n * @asMemberOf ADataProvider\r\n * @param dataIndices the selected data indices\r\n * @event\r\n */\r\nexport declare function selectionChanged(dataIndices: number[]): void;\r\n/**\r\n * @asMemberOf ADataProvider\r\n * @event\r\n */\r\nexport declare function addRanking(ranking: Ranking, index: number): void;\r\n/**\r\n * @asMemberOf ADataProvider\r\n * @param ranking if null all rankings are removed else just the specific one\r\n * @event\r\n */\r\nexport declare function removeRanking(ranking: Ranking | null, index: number): void;\r\n/**\r\n * emitted when the selection changes\r\n * @asMemberOf ADataProvider\r\n * @param dataIndices the selected data indices\r\n * @event\r\n */\r\nexport declare function orderchanged(dataIndices: number[]): void;\r\n/**\r\n * @asMemberOf ADataProvider\r\n * @event\r\n */\r\nexport declare function addDesc(desc: IColumnDesc): void;\r\n/**\r\n * @asMemberOf ADataProvider\r\n * @event\r\n */\r\nexport declare function clearDesc(): void;\r\n/**\r\n * emitted when the selection changes\r\n * @asMemberOf ADataProvider\r\n * @param dataIndices the selected data indices\r\n * @event\r\n */\r\nexport declare function jumpToNearest(dataIndices: number[]): void;\r\n/**\r\n * @asMemberOf ADataProvider\r\n * @event\r\n */\r\nexport declare function aggregate(ranking: Ranking, group: IGroup|IGroup[], value: boolean): void;\r\n\r\n/**\r\n * a basic data provider holding the data and rankings\r\n */\r\nabstract class ADataProvider extends AEventDispatcher implements IDataProvider {\r\n  static readonly EVENT_SELECTION_CHANGED = 'selectionChanged';\r\n  static readonly EVENT_ADD_COLUMN = Ranking.EVENT_ADD_COLUMN;\r\n  static readonly EVENT_REMOVE_COLUMN = Ranking.EVENT_REMOVE_COLUMN;\r\n  static readonly EVENT_ADD_RANKING = 'addRanking';\r\n  static readonly EVENT_REMOVE_RANKING = 'removeRanking';\r\n  static readonly EVENT_DIRTY = Ranking.EVENT_DIRTY;\r\n  static readonly EVENT_DIRTY_HEADER = Ranking.EVENT_DIRTY_HEADER;\r\n  static readonly EVENT_DIRTY_VALUES = Ranking.EVENT_DIRTY_VALUES;\r\n  static readonly EVENT_ORDER_CHANGED = Ranking.EVENT_ORDER_CHANGED;\r\n  static readonly EVENT_ADD_DESC = 'addDesc';\r\n  static readonly EVENT_CLEAR_DESC = 'clearDesc';\r\n  static readonly EVENT_JUMP_TO_NEAREST = 'jumpToNearest';\r\n  static readonly EVENT_GROUP_AGGREGATION_CHANGED = AggregateGroupColumn.EVENT_AGGREGATE;\r\n\r\n  /**\r\n   * all rankings\r\n   * @type {Array}\r\n   * @private\r\n   */\r\n  private rankings: Ranking[] = [];\r\n  /**\r\n   * the current selected indices\r\n   * @type {OrderedSet}\r\n   */\r\n  private readonly selection = new OrderedSet<number>();\r\n\r\n  //ranking.id@group.name\r\n  private aggregations = new Set<string>();\r\n\r\n  private uid = 0;\r\n\r\n  /**\r\n   * lookup map of a column type to its column implementation\r\n   */\r\n  readonly columnTypes: { [columnType: string]: typeof Column };\r\n\r\n  protected readonly multiSelections: boolean;\r\n\r\n  constructor(options: Partial<IDataProviderOptions> = {}) {\r\n    super();\r\n    this.columnTypes = Object.assign(models(), options.columnTypes || {});\r\n    this.multiSelections = options.multiSelection !== false;\r\n  }\r\n\r\n  /**\r\n   * events:\r\n   *  * column changes: addColumn, removeColumn\r\n   *  * ranking changes: addRanking, removeRanking\r\n   *  * dirty: dirty, dirtyHeder, dirtyValues\r\n   *  * selectionChanged\r\n   * @returns {string[]}\r\n   */\r\n  protected createEventList() {\r\n    return super.createEventList().concat([\r\n      ADataProvider.EVENT_ADD_COLUMN, ADataProvider.EVENT_REMOVE_COLUMN,\r\n      ADataProvider.EVENT_ADD_RANKING, ADataProvider.EVENT_REMOVE_RANKING,\r\n      ADataProvider.EVENT_DIRTY, ADataProvider.EVENT_DIRTY_HEADER, ADataProvider.EVENT_DIRTY_VALUES,\r\n      ADataProvider.EVENT_ORDER_CHANGED, ADataProvider.EVENT_SELECTION_CHANGED,\r\n      ADataProvider.EVENT_ADD_DESC, ADataProvider.EVENT_CLEAR_DESC,\r\n      ADataProvider.EVENT_JUMP_TO_NEAREST, ADataProvider.EVENT_GROUP_AGGREGATION_CHANGED]);\r\n  }\r\n\r\n  on(type: typeof ADataProvider.EVENT_ADD_COLUMN, listener: typeof addColumn | null): this;\r\n  on(type: typeof ADataProvider.EVENT_REMOVE_COLUMN, listener: typeof removeColumn | null): this;\r\n  on(type: typeof ADataProvider.EVENT_ADD_RANKING, listener: typeof addRanking | null): this;\r\n  on(type: typeof ADataProvider.EVENT_REMOVE_RANKING, listener: typeof removeRanking | null): this;\r\n  on(type: typeof ADataProvider.EVENT_DIRTY, listener: typeof dirty | null): this;\r\n  on(type: typeof ADataProvider.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\r\n  on(type: typeof ADataProvider.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\r\n  on(type: typeof ADataProvider.EVENT_ORDER_CHANGED, listener: typeof orderChanged | null): this;\r\n  on(type: typeof ADataProvider.EVENT_ADD_DESC, listener: typeof addDesc | null): this;\r\n  on(type: typeof ADataProvider.EVENT_CLEAR_DESC, listener: typeof clearDesc | null): this;\r\n  on(type: typeof ADataProvider.EVENT_JUMP_TO_NEAREST, listener: typeof jumpToNearest | null): this;\r\n  on(type: typeof ADataProvider.EVENT_GROUP_AGGREGATION_CHANGED, listener: typeof aggregate | null): this;\r\n  on(type: typeof ADataProvider.EVENT_SELECTION_CHANGED, listener: typeof selectionChanged | null): this;\r\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\r\n  on(type: string | string[], listener: IEventListener | null): this {\r\n    return super.on(type, listener);\r\n  }\r\n\r\n  abstract getTotalNumberOfRows(): number;\r\n\r\n  /**\r\n   * returns a list of all known column descriptions\r\n   * @returns {Array}\r\n   */\r\n  abstract getColumns(): IColumnDesc[];\r\n\r\n  /**\r\n   * adds a new ranking\r\n   * @param existing an optional existing ranking to clone\r\n   * @return the new ranking\r\n   */\r\n  pushRanking(existing?: Ranking): Ranking {\r\n    const r = this.cloneRanking(existing);\r\n\r\n    this.insertRanking(r);\r\n    return r;\r\n  }\r\n\r\n  takeSnapshot(col: Column): Ranking {\r\n    const r = this.cloneRanking();\r\n    const ranking = col.findMyRanker();\r\n    // by convention copy all support types and the first string column\r\n    let hasString = col.desc.type === 'string';\r\n    let hasColumn = false;\r\n    const toClone = !ranking ? [col] : ranking.children.filter((c) => {\r\n      if (c === col) {\r\n        hasColumn = false;\r\n        return true;\r\n      }\r\n      if (!hasString && c.desc.type === 'string') {\r\n        hasString = true;\r\n        return true;\r\n      }\r\n      return isSupportType(c);\r\n    });\r\n\r\n    if (!hasColumn) {\r\n      // maybe a nested one thus not in the top level\r\n      toClone.push(col);\r\n    }\r\n\r\n    toClone.forEach((c) => {\r\n      const clone = this.clone(c);\r\n      r.push(clone);\r\n      if (c === col) {\r\n        clone.sortByMe();\r\n      }\r\n    });\r\n    this.insertRanking(r);\r\n    return r;\r\n  }\r\n\r\n  insertRanking(r: Ranking, index = this.rankings.length) {\r\n    this.rankings.splice(index, 0, r);\r\n    this.forward(r, ...suffix('.provider', Ranking.EVENT_ADD_COLUMN, Ranking.EVENT_REMOVE_COLUMN,\r\n      Ranking.EVENT_DIRTY, Ranking.EVENT_DIRTY_HEADER,\r\n      Ranking.EVENT_ORDER_CHANGED, Ranking.EVENT_DIRTY_VALUES));\r\n    const that = this;\r\n    //delayed reordering per ranking\r\n    r.on(`${Ranking.EVENT_DIRTY_ORDER}.provider`, debounce(function (this: { source: Ranking }) {\r\n      that.triggerReorder(this.source);\r\n    }, 100));\r\n    this.fire([ADataProvider.EVENT_ADD_RANKING, ADataProvider.EVENT_DIRTY_HEADER, ADataProvider.EVENT_DIRTY_VALUES, ADataProvider.EVENT_DIRTY], r, index);\r\n    this.triggerReorder(r);\r\n  }\r\n\r\n  protected triggerReorder(ranking: Ranking) {\r\n    Promise.resolve(this.sort(ranking)).then((order) => {\r\n      unifyParents(order);\r\n      ranking.setGroups(order);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * removes a ranking from this data provider\r\n   * @param ranking\r\n   * @returns {boolean}\r\n   */\r\n  removeRanking(ranking: Ranking) {\r\n    const i = this.rankings.indexOf(ranking);\r\n    if (i < 0) {\r\n      return false;\r\n    }\r\n    this.unforward(ranking, ...suffix('.provider', Ranking.EVENT_ADD_COLUMN, Ranking.EVENT_REMOVE_COLUMN,\r\n      Ranking.EVENT_DIRTY, Ranking.EVENT_DIRTY_HEADER,\r\n      Ranking.EVENT_ORDER_CHANGED, Ranking.EVENT_DIRTY_VALUES));\r\n    this.rankings.splice(i, 1);\r\n    ranking.on(`${Ranking.EVENT_DIRTY_ORDER}.provider`, null);\r\n    this.cleanUpRanking(ranking);\r\n    this.fire([ADataProvider.EVENT_REMOVE_RANKING, ADataProvider.EVENT_DIRTY_HEADER, ADataProvider.EVENT_DIRTY_VALUES, ADataProvider.EVENT_DIRTY], ranking, i);\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * removes all rankings\r\n   */\r\n  clearRankings() {\r\n    this.rankings.forEach((ranking) => {\r\n      this.unforward(ranking, ...suffix('.provider', Ranking.EVENT_ADD_COLUMN, Ranking.EVENT_REMOVE_COLUMN,\r\n        Ranking.EVENT_DIRTY, Ranking.EVENT_DIRTY_HEADER,\r\n        Ranking.EVENT_ORDER_CHANGED, Ranking.EVENT_DIRTY_VALUES));\r\n      ranking.on(`${Ranking.EVENT_DIRTY_ORDER}.provider`, null);\r\n      this.cleanUpRanking(ranking);\r\n    });\r\n    this.rankings = [];\r\n    this.fire([ADataProvider.EVENT_REMOVE_RANKING, ADataProvider.EVENT_DIRTY_HEADER, ADataProvider.EVENT_DIRTY_VALUES, ADataProvider.EVENT_DIRTY], null, -1);\r\n  }\r\n\r\n  /**\r\n   * returns a list of all current rankings\r\n   * @returns {Ranking[]}\r\n   */\r\n  getRankings() {\r\n    return this.rankings.slice();\r\n  }\r\n\r\n  /**\r\n   * returns the last ranking for quicker access\r\n   * @returns {Ranking}\r\n   */\r\n  getFirstRanking() {\r\n    return this.rankings[0] || null;\r\n  }\r\n\r\n  /**\r\n   * returns the last ranking for quicker access\r\n   * @returns {Ranking}\r\n   */\r\n  getLastRanking() {\r\n    return this.rankings[this.rankings.length - 1];\r\n  }\r\n\r\n  ensureOneRanking() {\r\n    if (this.rankings.length === 0) {\r\n      const r = this.pushRanking();\r\n      this.push(r, createRankDesc());\r\n    }\r\n  }\r\n\r\n  /**\r\n   * hook method for cleaning up a ranking\r\n   * @param _ranking\r\n   */\r\n  cleanUpRanking(_ranking: Ranking) {\r\n    //nothing to do\r\n  }\r\n\r\n  /**\r\n   * abstract method for cloning a ranking\r\n   * @param existing\r\n   * @returns {null}\r\n   */\r\n  abstract cloneRanking(existing?: Ranking): Ranking;\r\n\r\n  /**\r\n   * adds a column to a ranking described by its column description\r\n   * @param ranking the ranking to add the column to\r\n   * @param desc the description of the column\r\n   * @return {Column} the newly created column or null\r\n   */\r\n  push(ranking: Ranking, desc: IColumnDesc): Column | null {\r\n    const r = this.create(desc);\r\n    if (r) {\r\n      ranking.push(r);\r\n      return r;\r\n    }\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * adds a column to a ranking described by its column description\r\n   * @param ranking the ranking to add the column to\r\n   * @param index the position to insert the column\r\n   * @param desc the description of the column\r\n   * @return {Column} the newly created column or null\r\n   */\r\n  insert(ranking: Ranking, index: number, desc: IColumnDesc) {\r\n    const r = this.create(desc);\r\n    if (r) {\r\n      ranking.insert(r, index);\r\n      return r;\r\n    }\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * creates a new unique id for a column\r\n   * @returns {string}\r\n   */\r\n  private nextId() {\r\n    return `col${this.uid++}`;\r\n  }\r\n\r\n  protected abstract rankAccessor(row: IDataRow, id: string, desc: IColumnDesc, ranking: Ranking): number;\r\n\r\n  private fixDesc(desc: IColumnDesc) {\r\n    //hacks for provider dependent descriptors\r\n    if (desc.type === 'rank') {\r\n      (<IValueColumnDesc<number>>desc).accessor = this.rankAccessor.bind(this);\r\n    } else if (desc.type === 'selection') {\r\n      (<ISelectionColumnDesc>desc).accessor = (row: IDataRow) => this.isSelected(row.i);\r\n      (<ISelectionColumnDesc>desc).setter = (row: IDataRow, value: boolean) => value ? this.select(row.i) : this.deselect(row.i);\r\n      (<ISelectionColumnDesc>desc).setterAll = (rows: IDataRow[], value: boolean) => value ? this.selectAll(rows.map((d) => d.i)) : this.deselectAll(rows.map((d) => d.i));\r\n    } else if (desc.type === 'aggregate') {\r\n      (<IAggregateGroupColumnDesc>desc).isAggregated = (ranking: Ranking, group: IGroup) => this.isAggregated(ranking, group);\r\n      (<IAggregateGroupColumnDesc>desc).setAggregated = (ranking: Ranking, group: IGroup, value: boolean) => this.setAggregated(ranking, group, value);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * creates an internal column model out of the given column description\r\n   * @param desc\r\n   * @returns {Column} the new column or null if it can't be created\r\n   */\r\n  create(desc: IColumnDesc): Column | null {\r\n    this.fixDesc(desc);\r\n    //find by type and instantiate\r\n    const type = this.columnTypes[desc.type];\r\n    if (type) {\r\n      return new type(this.nextId(), desc);\r\n    }\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * clones a column by dumping and restoring\r\n   * @param col\r\n   * @returns {Column}\r\n   */\r\n  clone(col: Column) {\r\n    const dump = this.dumpColumn(col);\r\n    return this.restoreColumn(dump);\r\n  }\r\n\r\n  /**\r\n   * restores a column from a dump\r\n   * @param dump\r\n   * @returns {Column}\r\n   */\r\n  restoreColumn(dump: any): Column {\r\n    const create = (d: any) => {\r\n      const desc = this.fromDescRef(d.desc);\r\n      const type = this.columnTypes[desc.type];\r\n      this.fixDesc(desc);\r\n      const c = new type('', desc);\r\n      c.restore(d, create);\r\n      c.assignNewId(this.nextId.bind(this));\r\n      return c;\r\n    };\r\n    return create(dump);\r\n  }\r\n\r\n  /**\r\n   * finds a column in all rankings returning the first match\r\n   * @param idOrFilter by id or by a filter function\r\n   * @returns {Column}\r\n   */\r\n  find(idOrFilter: string | ((col: Column) => boolean)): Column | null {\r\n    //convert to function\r\n    const filter = typeof(idOrFilter) === 'string' ? (col: Column) => col.id === idOrFilter : idOrFilter;\r\n\r\n    for (const ranking of this.rankings) {\r\n      const r = ranking.find(filter);\r\n      if (r) {\r\n        return r;\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n\r\n\r\n  /**\r\n   * dumps this whole provider including selection and the rankings\r\n   * @returns {{uid: number, selection: number[], rankings: *[]}}\r\n   */\r\n  dump(): any {\r\n    return {\r\n      uid: this.uid,\r\n      selection: this.getSelection(),\r\n      aggregations: Array.from(this.aggregations),\r\n      rankings: this.rankings.map((r) => r.dump(this.toDescRef))\r\n    };\r\n  }\r\n\r\n  /**\r\n   * dumps a specific column\r\n   */\r\n  dumpColumn(col: Column) {\r\n    return col.dump(this.toDescRef);\r\n  }\r\n\r\n  /**\r\n   * for better dumping describe reference, by default just return the description\r\n   */\r\n  toDescRef(desc: any): any {\r\n    return desc;\r\n  }\r\n\r\n  /**\r\n   * inverse operation of toDescRef\r\n   */\r\n  fromDescRef(descRef: any): any {\r\n    return descRef;\r\n  }\r\n\r\n  private createHelper = (d: any) => {\r\n    //factory method for restoring a column\r\n    const desc = this.fromDescRef(d.desc);\r\n    let c = null;\r\n    if (desc && desc.type) {\r\n      this.fixDesc(d.desc);\r\n      const type = this.columnTypes[desc.type];\r\n      c = new type(d.id, desc);\r\n      c.restore(d, this.createHelper);\r\n    }\r\n    return c;\r\n  };\r\n\r\n  restoreRanking(dump: any) {\r\n    const ranking = this.cloneRanking();\r\n    ranking.restore(dump, this.createHelper);\r\n    //if no rank column add one\r\n    if (!ranking.children.some((d) => d instanceof RankColumn)) {\r\n      ranking.insert(this.create(createRankDesc())!, 0);\r\n    }\r\n    const idGenerator = this.nextId.bind(this);\r\n    ranking.children.forEach((c) => c.assignNewId(idGenerator));\r\n\r\n    return ranking;\r\n  }\r\n\r\n  restore(dump: any) {\r\n    //clean old\r\n    this.clearRankings();\r\n\r\n    //restore selection\r\n    this.uid = dump.uid || 0;\r\n    if (dump.selection) {\r\n      dump.selection.forEach((s: number) => this.selection.add(s));\r\n    }\r\n    if (dump.aggregations) {\r\n      this.aggregations.clear();\r\n      dump.aggregations.forEach((a: string) => this.aggregations.add(a));\r\n    }\r\n\r\n\r\n    //restore rankings\r\n    if (dump.rankings) {\r\n      dump.rankings.forEach((r: any) => {\r\n        const ranking = this.cloneRanking();\r\n        ranking.restore(r, this.createHelper);\r\n        //if no rank column add one\r\n        if (!ranking.children.some((d) => d instanceof RankColumn)) {\r\n          ranking.insert(this.create(createRankDesc())!, 0);\r\n        }\r\n        this.insertRanking(ranking);\r\n      });\r\n    }\r\n    if (dump.layout) { //we have the old format try to create it\r\n      Object.keys(dump.layout).forEach((key) => {\r\n        this.deriveRanking(dump.layout[key]);\r\n      });\r\n    }\r\n    //assign new ids\r\n    const idGenerator = this.nextId.bind(this);\r\n    this.rankings.forEach((r) => {\r\n      r.children.forEach((c) => c.assignNewId(idGenerator));\r\n    });\r\n  }\r\n\r\n  abstract findDesc(ref: string): IColumnDesc | null;\r\n\r\n  abstract deriveDefault(addSupporType?: boolean): Ranking;\r\n\r\n  /**\r\n   * derives a ranking from an old layout bundle format\r\n   * @param bundle\r\n   */\r\n  private deriveRanking(bundle: any[]) {\r\n    const ranking = this.cloneRanking();\r\n    ranking.clear();\r\n    const toCol = (column: any) => {\r\n      switch (column.type) {\r\n        case 'rank':\r\n          return this.create(createRankDesc());\r\n        case 'selection':\r\n          return this.create(createSelectionDesc());\r\n        case 'group':\r\n          return this.create(createGroupDesc());\r\n        case 'aggregate':\r\n          return this.create(createAggregateDesc());\r\n        case 'actions':\r\n          const actions = this.create(createActionDesc(column.label || 'actions'))!;\r\n          actions.restore(column, this.createHelper);\r\n          return actions;\r\n        case 'stacked':\r\n          //create a stacked one\r\n          const stacked = <StackColumn>this.create(createStackDesc(column.label || 'Combined'))!;\r\n          (column.children || []).forEach((col: any) => {\r\n            const c = toCol(col);\r\n            if (c) {\r\n              stacked.push(c);\r\n            }\r\n          });\r\n          return stacked;\r\n        default: {\r\n          const desc = this.findDesc(column.column);\r\n          if (desc) {\r\n            const r = this.create(desc);\r\n            column.label = column.label || desc.label || (<any>desc).column;\r\n            if (r) {\r\n              r.restore(column, this.createHelper);\r\n            }\r\n            return r;\r\n          }\r\n          return null;\r\n        }\r\n      }\r\n    };\r\n    bundle.forEach((column) => {\r\n      const col = toCol(column);\r\n      if (col) {\r\n        ranking.push(col);\r\n      }\r\n    });\r\n    //if no rank column add one\r\n    if (!ranking.children.some((d) => d instanceof RankColumn)) {\r\n      ranking.insert(this.create(createRankDesc())!, 0);\r\n    }\r\n    this.insertRanking(ranking);\r\n    return ranking;\r\n  }\r\n\r\n  isAggregated(ranking: Ranking, group: IGroup) {\r\n    let g: IGroup | undefined | null = group;\r\n    while (g) {\r\n      const key = `${ranking.id}@${toGroupID(g)}`;\r\n      if (this.aggregations.has(key)) {\r\n        // propagate to leaf\r\n        this.aggregations.add(`${ranking.id}@${toGroupID(group)}`);\r\n        return true;\r\n      }\r\n      g = g.parent;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  private unaggregateParents(ranking: Ranking, group: IGroup) {\r\n    let g: IGroup | undefined | null = group.parent;\r\n    while (g) {\r\n      this.aggregations.delete(`${ranking.id}@${toGroupID(g)}`);\r\n      g = g.parent;\r\n    }\r\n  }\r\n\r\n  setAggregated(ranking: Ranking, group: IGroup, value: boolean) {\r\n    this.unaggregateParents(ranking, group);\r\n    const key = `${ranking.id}@${toGroupID(group)}`;\r\n    const current = this.isAggregated(ranking, group);\r\n    if (current === value) {\r\n      return;\r\n    }\r\n    if (value) {\r\n      this.aggregations.add(key);\r\n    } else {\r\n      this.aggregations.delete(key);\r\n    }\r\n    this.fire([ADataProvider.EVENT_GROUP_AGGREGATION_CHANGED, ADataProvider.EVENT_DIRTY_VALUES, ADataProvider.EVENT_DIRTY], ranking, group, value);\r\n  }\r\n\r\n  aggregateAllOf(ranking: Ranking, aggregateAll: boolean) {\r\n    const groups = ranking.getGroups();\r\n    groups.forEach((group) => {\r\n      this.unaggregateParents(ranking, group);\r\n      const current = this.isAggregated(ranking, group);\r\n      if (current === aggregateAll) {\r\n        return;\r\n      }\r\n      const key = `${ranking.id}@${toGroupID(group)}`;\r\n      if (aggregateAll) {\r\n        this.aggregations.add(key);\r\n      } else {\r\n        this.aggregations.delete(key);\r\n      }\r\n    });\r\n    this.fire([ADataProvider.EVENT_GROUP_AGGREGATION_CHANGED, ADataProvider.EVENT_DIRTY_VALUES, ADataProvider.EVENT_DIRTY], ranking, groups, aggregateAll);\r\n  }\r\n\r\n  /**\r\n   * sorts the given ranking and eventually return a ordering of the data items\r\n   * @param ranking\r\n   * @return {Promise<any>}\r\n   */\r\n  abstract sort(ranking: Ranking): Promise<IOrderedGroup[]> | IOrderedGroup[];\r\n\r\n  /**\r\n   * returns a view in the order of the given indices\r\n   * @param indices\r\n   * @return {Promise<any>}\r\n   */\r\n  abstract view(indices: number[]): Promise<any[]> | any[];\r\n\r\n  abstract fetch(orders: number[][]): (Promise<IDataRow> | IDataRow)[][];\r\n\r\n  /**\r\n   * returns a data sample used for the mapping editor\r\n   * @param col\r\n   * @return {Promise<any>}\r\n   */\r\n  abstract mappingSample(col: Column): Promise<number[]> | number[];\r\n\r\n  /**\r\n   * helper for computing statistics\r\n   * @param indices\r\n   * @returns {{stats: (function(INumberColumn): *), hist: (function(ICategoricalColumn): *)}}\r\n   */\r\n  abstract stats(indices: number[]): IStatsBuilder;\r\n\r\n  /**\r\n   * is the given row selected\r\n   * @param index\r\n   * @return {boolean}\r\n   */\r\n  isSelected(index: number) {\r\n    return this.selection.has(index);\r\n  }\r\n\r\n  /**\r\n   * also select the given row\r\n   * @param index\r\n   */\r\n  select(index: number) {\r\n    if (this.selection.has(index)) {\r\n      return; //no change\r\n    }\r\n    if (!this.multiSelections && this.selection.size > 0) {\r\n      this.selection.clear();\r\n    }\r\n    this.selection.add(index);\r\n    this.fire(ADataProvider.EVENT_SELECTION_CHANGED, this.getSelection());\r\n  }\r\n\r\n  /**\r\n   * hook for selecting elements matching the given arguments\r\n   * @param search\r\n   * @param col\r\n   */\r\n  abstract searchAndJump(search: string | RegExp, col: Column): void;\r\n\r\n  jumpToNearest(indices: number[]) {\r\n    if (indices.length === 0) {\r\n      return;\r\n    }\r\n    this.fire(ADataProvider.EVENT_JUMP_TO_NEAREST, indices);\r\n  }\r\n\r\n  /**\r\n   * also select all the given rows\r\n   * @param indices\r\n   */\r\n  selectAll(indices: number[]) {\r\n    if (indices.every((i) => this.selection.has(i))) {\r\n      return; //no change\r\n    }\r\n    if (!this.multiSelections) {\r\n      this.selection.clear();\r\n      indices = indices.slice(0, 1); //just the first one\r\n    }\r\n    indices.forEach((index) => {\r\n      this.selection.add(index);\r\n    });\r\n    this.fire(ADataProvider.EVENT_SELECTION_CHANGED, this.getSelection());\r\n  }\r\n\r\n  selectAllOf(ranking: Ranking) {\r\n    this.setSelection(ranking.getOrder());\r\n  }\r\n\r\n  /**\r\n   * set the selection to the given rows\r\n   * @param indices\r\n   */\r\n  setSelection(indices: number[]) {\r\n    if (indices.length === 0) {\r\n      return this.clearSelection();\r\n    }\r\n    if (this.selection.size === indices.length && indices.every((i) => this.selection.has(i))) {\r\n      return; //no change\r\n    }\r\n    this.selection.clear();\r\n    this.selectAll(indices);\r\n  }\r\n\r\n  /**\r\n   * toggles the selection of the given data index\r\n   * @param index\r\n   * @param additional just this element or all\r\n   * @returns {boolean} whether the index is currently selected\r\n   */\r\n  toggleSelection(index: number, additional = false) {\r\n    if (this.isSelected(index)) {\r\n      if (additional) {\r\n        this.deselect(index);\r\n      } else {\r\n        this.clearSelection();\r\n      }\r\n      return false;\r\n    }\r\n    if (additional) {\r\n      this.select(index);\r\n    } else {\r\n      this.setSelection([index]);\r\n    }\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * deselect the given row\r\n   * @param index\r\n   */\r\n  deselect(index: number) {\r\n    if (!this.selection.has(index)) {\r\n      return; //no change\r\n    }\r\n    this.selection.delete(index);\r\n    this.fire(ADataProvider.EVENT_SELECTION_CHANGED, this.getSelection());\r\n  }\r\n\r\n  /**\r\n   * also select all the given rows\r\n   * @param indices\r\n   */\r\n  deselectAll(indices: number[]) {\r\n    if (indices.every((i) => !this.selection.has(i))) {\r\n      return; //no change\r\n    }\r\n    indices.forEach((index) => {\r\n      this.selection.delete(index);\r\n    });\r\n    this.fire(ADataProvider.EVENT_SELECTION_CHANGED, this.getSelection());\r\n  }\r\n\r\n  /**\r\n   * returns a promise containing the selected rows\r\n   * @return {Promise<any[]>}\r\n   */\r\n  selectedRows(): Promise<any[]> | any[] {\r\n    if (this.selection.size === 0) {\r\n      return [];\r\n    }\r\n    return this.view(this.getSelection());\r\n  }\r\n\r\n  /**\r\n   * returns the currently selected indices\r\n   * @returns {Array}\r\n   */\r\n  getSelection() {\r\n    return Array.from(this.selection);\r\n  }\r\n\r\n  /**\r\n   * clears the selection\r\n   */\r\n  clearSelection() {\r\n    if (this.selection.size === 0) {\r\n      return; //no change\r\n    }\r\n    this.selection.clear();\r\n    this.fire(ADataProvider.EVENT_SELECTION_CHANGED, [], false);\r\n  }\r\n\r\n  /**\r\n   * utility to export a ranking to a table with the given separator\r\n   * @param ranking\r\n   * @param options\r\n   * @returns {Promise<string>}\r\n   */\r\n  exportTable(ranking: Ranking, options: Partial<IExportOptions> = {}) {\r\n    return Promise.resolve(this.view(ranking.getOrder())).then((data) => exportRanking(ranking, data, options));\r\n  }\r\n}\r\n\r\nexport default ADataProvider;\r\n","import {Category, toolbar} from './annotations';\r\nimport Column, {widthChanged, labelChanged, metaDataChanged, dirty, dirtyHeader, dirtyValues, rendererTypeChanged, groupRendererChanged, summaryRendererChanged, visibilityChanged} from './Column';\r\nimport ValueColumn, {dataLoaded} from './ValueColumn';\r\nimport {\r\n  compareCategory, groupCompareCategory,\r\n  ICategoricalColumn, ICategoricalColumnDesc, ICategoricalFilter, ICategory,\r\n  isEqualCategoricalFilter, isCategoryIncluded, toCategories, toCategory,\r\n} from './ICategoricalColumn';\r\nimport {IDataRow, IGroup, IGroupData} from './interfaces';\r\nimport {missingGroup} from './missing';\r\nimport {IEventListener} from '../internal/AEventDispatcher';\r\n\r\n/**\r\n * emitted when the filter property changes\r\n * @asMemberOf CategoricalColumn\r\n * @event\r\n */\r\nexport declare function filterChanged(previous: ICategoricalFilter | null, current: ICategoricalFilter | null): void;\r\n\r\n/**\r\n * column for categorical values\r\n */\r\n@toolbar('group', 'groupBy', 'sortGroupBy', 'filterCategorical')\r\n@Category('categorical')\r\nexport default class CategoricalColumn extends ValueColumn<string> implements ICategoricalColumn {\r\n  static readonly EVENT_FILTER_CHANGED = 'filterChanged';\r\n\r\n  readonly categories: ICategory[];\r\n\r\n  private readonly missingCategory: ICategory | null;\r\n\r\n  private readonly lookup = new Map<string, Readonly<ICategory>>();\r\n  /**\r\n   * set of categories to show\r\n   * @type {null}\r\n   * @private\r\n   */\r\n  private currentFilter: ICategoricalFilter | null = null;\r\n\r\n  constructor(id: string, desc: Readonly<ICategoricalColumnDesc>) {\r\n    super(id, desc);\r\n    this.categories = toCategories(desc);\r\n    this.missingCategory = desc.missingCategory ? toCategory(desc.missingCategory, NaN) : null;\r\n    this.categories.forEach((d) => this.lookup.set(d.name, d));\r\n  }\r\n\r\n  protected createEventList() {\r\n    return super.createEventList().concat([CategoricalColumn.EVENT_FILTER_CHANGED]);\r\n  }\r\n\r\n  on(type: typeof CategoricalColumn.EVENT_FILTER_CHANGED, listener: typeof filterChanged | null): this;\r\n  on(type: typeof ValueColumn.EVENT_DATA_LOADED, listener: typeof dataLoaded | null): this;\r\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\r\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\r\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\r\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\r\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\r\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\r\n  on(type: string | string[], listener: IEventListener | null): this {\r\n    return super.on(<any>type, listener);\r\n  }\r\n\r\n  getValue(row: IDataRow) {\r\n    const v = this.getCategory(row);\r\n    return v ? v.name : null;\r\n  }\r\n\r\n  getCategory(row: IDataRow) {\r\n    const v = super.getValue(row);\r\n    if (!v) {\r\n      return this.missingCategory;\r\n    }\r\n    const vs = String(v);\r\n    return this.lookup.has(vs) ? this.lookup.get(vs)! : this.missingCategory;\r\n  }\r\n\r\n  get dataLength() {\r\n    return this.categories.length;\r\n  }\r\n\r\n  get labels() {\r\n    return this.categories.map((d) => d.label);\r\n  }\r\n\r\n  getLabel(row: IDataRow) {\r\n    const v = this.getCategory(row);\r\n    return v ? v.label : '';\r\n  }\r\n\r\n  getColor(row: IDataRow) {\r\n    const v = this.getCategory(row);\r\n    return v ? v.color : Column.DEFAULT_COLOR;\r\n  }\r\n\r\n  getValues(row: IDataRow) {\r\n    const v = this.getCategory(row);\r\n    return this.categories.map((d) => d === v);\r\n  }\r\n\r\n  getLabels(row: IDataRow) {\r\n    return this.getValues(row).map(String);\r\n  }\r\n\r\n  getMap(row: IDataRow) {\r\n    const cats = this.categories;\r\n    return this.getValues(row).map((value, i) => ({key: cats[i].label, value}));\r\n  }\r\n\r\n  getMapLabel(row: IDataRow) {\r\n    const cats = this.categories;\r\n    return this.getLabels(row).map((value, i) => ({key: cats[i].label, value}));\r\n  }\r\n\r\n  getSet(row: IDataRow) {\r\n    const cat = this.getCategory(row);\r\n    const r = new Set<ICategory>();\r\n    if (cat && cat !== this.missingCategory) {\r\n      r.add(cat);\r\n    }\r\n    return r;\r\n  }\r\n\r\n  isMissing(row: IDataRow) {\r\n    return this.getCategory(row) === this.missingCategory;\r\n  }\r\n\r\n  dump(toDescRef: (desc: any) => any): any {\r\n    const r = super.dump(toDescRef);\r\n    r.filter = this.currentFilter;\r\n    return r;\r\n  }\r\n\r\n  restore(dump: any, factory: (dump: any) => Column | null) {\r\n    super.restore(dump, factory);\r\n    if (!('filter' in dump)) {\r\n      this.currentFilter = null;\r\n      return;\r\n    }\r\n    const bak = dump.filter;\r\n    if (typeof bak === 'string' || Array.isArray(bak)) {\r\n      this.currentFilter = {filter: bak, filterMissing: false};\r\n    } else {\r\n      this.currentFilter = bak;\r\n    }\r\n  }\r\n\r\n  isFiltered() {\r\n    return this.currentFilter != null;\r\n  }\r\n\r\n  filter(row: IDataRow): boolean {\r\n    return isCategoryIncluded(this.currentFilter, this.getCategory(row));\r\n  }\r\n\r\n  getFilter() {\r\n    return this.currentFilter == null ? null : Object.assign({}, this.currentFilter);\r\n  }\r\n\r\n  setFilter(filter: ICategoricalFilter | null) {\r\n    if (isEqualCategoricalFilter(this.currentFilter, filter)) {\r\n      return;\r\n    }\r\n    this.fire([CategoricalColumn.EVENT_FILTER_CHANGED, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY], this.currentFilter, this.currentFilter = filter);\r\n  }\r\n\r\n  compare(a: IDataRow, b: IDataRow) {\r\n    return compareCategory(this.getCategory(a), this.getCategory(b));\r\n  }\r\n\r\n  group(row: IDataRow): IGroup {\r\n    const cat = this.getCategory(row);\r\n    if (!cat) {\r\n      return missingGroup;\r\n    }\r\n    return {name: cat.label, color: cat.color};\r\n  }\r\n\r\n  groupCompare(a: IGroupData, b: IGroupData): number {\r\n    return groupCompareCategory(a.rows, b.rows, this);\r\n  }\r\n\r\n  getGroupRenderer() {\r\n    const current = super.getGroupRenderer();\r\n    if (current === this.desc.type && this.isGroupedBy() >= 0) {\r\n      // still the default and the stratification criteria\r\n      return 'catdistributionbar';\r\n    }\r\n    return current;\r\n  }\r\n}\r\n","import {ascending, histogram, mean, median, quantile} from 'd3-array';\r\nimport {ICategory, isMissingValue} from '../model';\r\nimport {IMappingFunction} from '../model/MappingFunction';\r\n\r\nexport interface INumberBin {\r\n  x0: number;\r\n  x1: number;\r\n  length: number;\r\n}\r\n\r\nexport interface IBoxPlotData {\r\n  readonly min: number;\r\n  readonly max: number;\r\n  readonly median: number;\r\n  readonly q1: number;\r\n  readonly q3: number;\r\n  readonly outlier?: number[];\r\n  readonly whiskerLow?: number;\r\n  readonly whiskerHigh?: number;\r\n}\r\n\r\nexport interface IAdvancedBoxPlotData extends IBoxPlotData {\r\n  readonly mean: number;\r\n}\r\n\r\nexport interface IStatistics extends IAdvancedBoxPlotData {\r\n  readonly count: number;\r\n  readonly maxBin: number;\r\n  readonly hist: INumberBin[];\r\n  readonly missing: number;\r\n}\r\n\r\nexport interface ICategoricalBin {\r\n  cat: string;\r\n  y: number;\r\n}\r\n\r\nexport interface ICategoricalStatistics {\r\n  readonly maxBin: number;\r\n  readonly hist: ICategoricalBin[];\r\n  readonly missing: number;\r\n}\r\n\r\n/**\r\n * @internal\r\n * @param {number} length\r\n * @returns {number}\r\n */\r\nexport function getNumberOfBins(length: number) {\r\n  // as by default used in d3 the Sturges' formula\r\n  return Math.ceil(Math.log(length) / Math.LN2) + 1;\r\n}\r\n\r\n\r\n/**\r\n * helper class to lazily compute box plotdata out of a given number array\r\n * @internal\r\n */\r\nexport class LazyBoxPlotData implements IStatistics {\r\n  private readonly values: number[];\r\n\r\n  readonly missing: number;\r\n\r\n  constructor(values: number[], private readonly scale?: Readonly<IMappingFunction>, private readonly histGen?: (data: number[]) => INumberBin[]) {\r\n    // filter out NaN\r\n    this.values = values.filter((d) => !isMissingValue(d));\r\n    this.missing = values.length - this.values.length;\r\n  }\r\n\r\n  get count() {\r\n    return this.values.length + this.missing;\r\n  }\r\n\r\n  /**\r\n   * lazy compute sorted array\r\n   * @returns {number[]}\r\n   */\r\n  @cached()\r\n  private get sorted(): number[] {\r\n    return this.values.slice().sort(ascending);\r\n  }\r\n\r\n  @cached()\r\n  private get sortedMapped(): number[] {\r\n    return this.scale ? this.sorted.map((v) => this.scale!.apply(v)) : this.sorted;\r\n  }\r\n\r\n  private map(v: number | undefined) {\r\n    return this.scale && v != null ? this.scale.apply(v!) : v!;\r\n  }\r\n\r\n  @cached()\r\n  get hist() {\r\n    if (!this.histGen) {\r\n      return [];\r\n    }\r\n    return this.histGen(this.values);\r\n  }\r\n\r\n  @cached()\r\n  get maxBin() {\r\n    return Math.max(...this.hist.map((d) => d.length));\r\n  }\r\n\r\n  @cached()\r\n  get min() {\r\n    return this.map(Math.min(...this.values));\r\n  }\r\n\r\n  @cached()\r\n  get max() {\r\n    return this.map(Math.max(...this.values));\r\n  }\r\n\r\n  @cached()\r\n  get median() {\r\n    return this.map(median(this.sorted));\r\n  }\r\n\r\n  @cached()\r\n  get q1() {\r\n    return this.map(quantile(this.sorted, 0.25));\r\n  }\r\n\r\n  @cached()\r\n  get q3() {\r\n    return this.map(quantile(this.sorted, 0.75));\r\n  }\r\n\r\n  @cached()\r\n  get mean() {\r\n    return this.map(mean(this.values));\r\n  }\r\n\r\n  @cached()\r\n  get whiskerLow() {\r\n    const q1 = this.q1;\r\n    const q3 = this.q3;\r\n    const iqr = q3 - q1;\r\n    const left = q1 - 1.5 * iqr;\r\n    // look for the closests value which is bigger than the computed left\r\n    let whiskerLow = left;\r\n    for (const v of this.sortedMapped) {\r\n      if (left < v) {\r\n        whiskerLow = v;\r\n        break;\r\n      }\r\n    }\r\n    return whiskerLow;\r\n  }\r\n\r\n  @cached()\r\n  get whiskerHigh() {\r\n    const q1 = this.q1;\r\n    const q3 = this.q3;\r\n    const iqr = q3 - q1;\r\n    const right = q3 + 1.5 * iqr;\r\n    // look for the closests value which is smaller than the computed right\r\n    let whiskerHigh = right;\r\n    for (const v of this.sortedMapped.slice().reverse()) {\r\n      if (v < right) {\r\n        whiskerHigh = v;\r\n        break;\r\n      }\r\n    }\r\n    return whiskerHigh;\r\n\r\n  }\r\n\r\n  @cached()\r\n  get outlier() {\r\n    const left = this.whiskerLow;\r\n    const right = this.whiskerHigh;\r\n    return this.sortedMapped.filter((v) => (v < left || v > right) && !isMissingValue(v));\r\n  }\r\n}\r\n\r\n/**\r\n * cache the value in a hidden __ variable\r\n * @internal\r\n */\r\nfunction cached() {\r\n  return function (_target: any, propertyKey: string, descriptor: PropertyDescriptor) {\r\n    const getter = descriptor.get!;\r\n    const cacheKey = `__${propertyKey}`;\r\n    descriptor.get = function (this: any) {\r\n      if (this.hasOwnProperty(cacheKey)) {\r\n        return this[cacheKey];\r\n      }\r\n      const value = getter.call(this);\r\n      this[cacheKey] = value;\r\n      return value;\r\n    };\r\n    return descriptor;\r\n  };\r\n}\r\n\r\n\r\n/**\r\n * computes the simple statistics of an array using d3 histogram\r\n * @param arr the data array\r\n * @param acc accessor function\r\n * @param missing accessor if the value is missing\r\n * @param range the total value range\r\n * @param bins the number of bins\r\n * @returns {{min: number, max: number, count: number, hist: histogram.Bin<number>[]}}\r\n * @internal\r\n */\r\nexport function computeStats<T>(arr: T[], acc: (row: T) => number, missing: (row: T) => boolean, range?: [number, number], bins?: number): IStatistics {\r\n  if (arr.length === 0) {\r\n    return {\r\n      min: NaN,\r\n      max: NaN,\r\n      mean: NaN,\r\n      q1: NaN,\r\n      q3: NaN,\r\n      outlier: [],\r\n      median: NaN,\r\n      count: 0,\r\n      maxBin: 0,\r\n      hist: [],\r\n      missing: 0\r\n    };\r\n  }\r\n\r\n  const hist = histogram();\r\n  if (range) {\r\n    hist.domain(range);\r\n  }\r\n  if (bins) {\r\n    hist.thresholds(bins);\r\n  } else {\r\n    hist.thresholds(getNumberOfBins(arr.length));\r\n  }\r\n\r\n  const values = arr.map((v) => missing(v) ? NaN : acc(v));\r\n\r\n  return new LazyBoxPlotData(values, undefined, <(data: number[]) => INumberBin[]>hist);\r\n}\r\n\r\n\r\n/**\r\n * computes a categorical histogram\r\n * @param arr the data array\r\n * @param acc the accessor\r\n * @param categories the list of known categories\r\n * @returns {{hist: {cat: string, y: number}[]}}\r\n * @internal\r\n */\r\nexport function computeHist<T>(arr: T[], acc: (row: T) => ICategory | null, categories: ICategory[]): ICategoricalStatistics {\r\n  const m = new Map<string, number>();\r\n  let missingCount = 0;\r\n  categories.forEach((cat) => m.set(cat.name, 0));\r\n\r\n  arr.forEach((a) => {\r\n    const v = acc(a);\r\n    if (v == null) {\r\n      missingCount += 1;\r\n      return;\r\n    }\r\n    m.set(v.name, (m.get(v.name) || 0) + 1);\r\n  });\r\n  const entries: { cat: string; y: number }[] = [];\r\n  m.forEach((v, k) => entries.push({cat: k, y: v}));\r\n  return {\r\n    maxBin: Math.max(...entries.map((d) => d.y)),\r\n    hist: entries,\r\n    missing: missingCount\r\n  };\r\n}\r\n\r\n/**\r\n * round to the given commas similar to d3.round\r\n * @param {number} v\r\n * @param {number} precision\r\n * @returns {number}\r\n * @internal\r\n */\r\nexport function round(v: number, precision: number = 0) {\r\n  if (precision === 0) {\r\n    return Math.round(v);\r\n  }\r\n  const scale = Math.pow(10, precision);\r\n  return Math.round(v * scale) / scale;\r\n}\r\n\r\n/**\r\n * compares two number whether they are similar up to delta\r\n * @param {number} a first numbre\r\n * @param {number} b second number\r\n * @param {number} delta\r\n * @returns {boolean} a and b are similar\r\n * @internal\r\n */\r\nexport function similar(a: number, b: number, delta = 0.5) {\r\n  if (a === b) {\r\n    return true;\r\n  }\r\n  return Math.abs(a - b) < delta;\r\n}\r\n","import ArrayColumn, {IArrayColumnDesc} from './ArrayColumn';\r\nimport {ISetColumn, toCategory} from './ICategoricalColumn';\r\nimport {IDataRow} from './interfaces';\r\nimport {FIRST_IS_MISSING} from './missing';\r\n\r\nexport declare type IBooleansColumnDesc = IArrayColumnDesc<boolean>;\r\n\r\nexport default class BooleansColumn extends ArrayColumn<boolean> implements ISetColumn {\r\n  constructor(id: string, desc: Readonly<IBooleansColumnDesc>) {\r\n    super(id, desc);\r\n    this.setDefaultRenderer('upset');\r\n  }\r\n\r\n  get categories() {\r\n    return this.labels.map((d, i) => toCategory(d, i));\r\n  }\r\n\r\n  getSet(row: IDataRow) {\r\n    const vs = this.getValues(row);\r\n    return new Set(this.categories.filter((_, i) => vs[i]));\r\n  }\r\n\r\n  compare(a: IDataRow, b: IDataRow) {\r\n    const aVal = this.getValue(a);\r\n    const bVal = this.getValue(b);\r\n    if (aVal == null) {\r\n      return bVal == null ? 0 : FIRST_IS_MISSING;\r\n    }\r\n    if (bVal == null) {\r\n      return -FIRST_IS_MISSING;\r\n    }\r\n\r\n    const aCat = aVal.filter((x) => x).length;\r\n    const bCat = bVal.filter((x) => x).length;\r\n    return (aCat - bCat);\r\n  }\r\n}\r\n","import {ICategoricalDesc, ICategory, toCategories, toCategory} from './ICategoricalColumn';\r\nimport {IDataRow} from './interfaces';\r\nimport MapColumn, {IMapColumnDesc} from './MapColumn';\r\n\r\nexport declare type ICategoricalMapColumnDesc = ICategoricalDesc & IMapColumnDesc<string | null>;\r\n\r\nexport default class CategoricalMapColumn extends MapColumn<string | null> {\r\n  readonly categories: ICategory[];\r\n\r\n  private readonly missingCategory: ICategory | null;\r\n\r\n  private readonly lookup = new Map<string, Readonly<ICategory>>();\r\n\r\n  constructor(id: string, desc: Readonly<ICategoricalMapColumnDesc>) {\r\n    super(id, desc);\r\n    this.categories = toCategories(desc);\r\n    this.missingCategory = desc.missingCategory ? toCategory(desc.missingCategory, NaN) : null;\r\n    this.categories.forEach((d) => this.lookup.set(d.name, d));\r\n  }\r\n\r\n\r\n  private parseValue(v: any) {\r\n    if (!v) {\r\n      return this.missingCategory;\r\n    }\r\n    const vs = String(v);\r\n    return this.lookup.has(vs) ? this.lookup.get(vs)! : this.missingCategory;\r\n  }\r\n\r\n  getCategories(row: IDataRow) {\r\n    return super.getValue(row).map(({key, value}) => ({\r\n      key,\r\n      value: this.parseValue(value)\r\n    }));\r\n  }\r\n\r\n  getValue(row: IDataRow) {\r\n    return this.getCategories(row).map(({key, value}) => ({\r\n      key,\r\n      value: value ? value.name : null\r\n    }));\r\n  }\r\n\r\n  getLabels(row: IDataRow) {\r\n    return this.getCategories(row).map(({key, value}) => ({\r\n      key,\r\n      value: value ? value.label : ''\r\n    }));\r\n  }\r\n}\r\n","import ArrayColumn, {IArrayColumnDesc} from './ArrayColumn';\r\nimport {ICategoricalDesc, ICategory, toCategories, toCategory} from './ICategoricalColumn';\r\nimport {IDataRow} from './interfaces';\r\n\r\nexport declare type ICategoricalsColumnDesc = ICategoricalDesc & IArrayColumnDesc<string | null>;\r\n\r\n/**\r\n * a string column with optional alignment\r\n */\r\nexport default class CategoricalsColumn extends ArrayColumn<string | null> {\r\n  readonly categories: ICategory[];\r\n\r\n  private readonly missingCategory: ICategory | null;\r\n\r\n  private readonly lookup = new Map<string, Readonly<ICategory>>();\r\n\r\n  constructor(id: string, desc: Readonly<ICategoricalsColumnDesc>) {\r\n    super(id, desc);\r\n    this.categories = toCategories(desc);\r\n    this.missingCategory = desc.missingCategory ? toCategory(desc.missingCategory, NaN) : null;\r\n    this.categories.forEach((d) => this.lookup.set(d.name, d));\r\n  }\r\n\r\n  getCategories(row: IDataRow) {\r\n    return super.getValues(row).map((v) => {\r\n      if (!v) {\r\n        return this.missingCategory;\r\n      }\r\n      const vs = String(v);\r\n      return this.lookup.has(vs) ? this.lookup.get(vs)! : this.missingCategory;\r\n    });\r\n  }\r\n\r\n  getSet(row: IDataRow) {\r\n    const r = new Set(this.getCategories(row));\r\n    r.delete(this.missingCategory);\r\n    return r;\r\n  }\r\n\r\n  getValues(row: IDataRow) {\r\n    return this.getCategories(row).map((v) => v ? v.name : null);\r\n  }\r\n\r\n  getLabels(row: IDataRow) {\r\n    return this.getCategories(row).map((v) => v ? v.label : '');\r\n  }\r\n}\r\n","import {timeFormat, timeParse} from 'd3-time-format';\r\nimport {IDateColumn, IDateFilter, noDateFilter, restoreDateFilter, isDummyDateFilter} from './IDateColumn';\r\nimport {IKeyValue} from './IArrayColumn';\r\nimport {IDataRow} from './interfaces';\r\nimport MapColumn, {IMapColumnDesc} from './MapColumn';\r\nimport {isMissingValue} from './missing';\r\nimport DatesColumn, {EDateSort, IDatesDesc} from './DatesColumn';\r\nimport DateColumn from './DateColumn';\r\nimport {dialogAddons, toolbar} from './annotations';\r\nimport Column, {widthChanged, labelChanged, metaDataChanged, dirty, dirtyHeader, dirtyValues, rendererTypeChanged, groupRendererChanged, summaryRendererChanged, visibilityChanged} from './Column';\r\nimport ValueColumn, {dataLoaded} from './ValueColumn';\r\nimport {IEventListener} from '../internal/AEventDispatcher';\r\n\r\nexport declare type IDateMapColumnDesc = IDatesDesc & IMapColumnDesc<Date | null>;\r\n\r\n/**\r\n * emitted when the sort method property changes\r\n * @asMemberOf DatesMapColumn\r\n * @event\r\n */\r\nexport declare function sortMethodChanged(previous: EDateSort, current: EDateSort): void;\r\n\r\n/**\r\n * emitted when the filter property changes\r\n * @asMemberOf DatesMapColumn\r\n * @event\r\n */\r\nexport declare function filterChanged(previous: IDateFilter | null, current: IDateFilter | null): void;\r\n\r\n\r\n@toolbar('filterDate')\r\n@dialogAddons('sort', 'sortDates')\r\nexport default class DatesMapColumn extends MapColumn<Date | null> implements IDateColumn {\r\n  static readonly EVENT_SORTMETHOD_CHANGED = DatesColumn.EVENT_SORTMETHOD_CHANGED;\r\n  static readonly EVENT_FILTER_CHANGED = DateColumn.EVENT_FILTER_CHANGED;\r\n\r\n  private readonly format: (date: Date) => string;\r\n  private readonly parse: (date: string) => Date | null;\r\n  private sort: EDateSort;\r\n  private currentFilter: IDateFilter = noDateFilter();\r\n\r\n  constructor(id: string, desc: Readonly<IDateMapColumnDesc>) {\r\n    super(id, desc);\r\n    this.format = timeFormat(desc.dateFormat || '%x');\r\n    this.parse = desc.dateParse ? timeParse(desc.dateParse) : timeParse(desc.dateFormat || '%x');\r\n    this.sort = desc.sort || EDateSort.median;\r\n    this.setDefaultRenderer('default');\r\n  }\r\n\r\n  protected createEventList() {\r\n    return super.createEventList().concat([DatesMapColumn.EVENT_SORTMETHOD_CHANGED, DatesMapColumn.EVENT_FILTER_CHANGED]);\r\n  }\r\n\r\n  on(type: typeof DatesMapColumn.EVENT_SORTMETHOD_CHANGED, listener: typeof sortMethodChanged | null): this;\r\n  on(type: typeof DatesMapColumn.EVENT_FILTER_CHANGED, listener: typeof filterChanged | null): this;\r\n  on(type: typeof ValueColumn.EVENT_DATA_LOADED, listener: typeof dataLoaded | null): this;\r\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\r\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\r\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\r\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\r\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\r\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\r\n  on(type: string | string[], listener: IEventListener | null): this {\r\n    return super.on(<any>type, listener);\r\n  }\r\n\r\n  private parseValue(v: any) {\r\n    if (isMissingValue(v)) {\r\n      return null;\r\n    }\r\n    if (v instanceof Date) {\r\n      return v;\r\n    }\r\n    return this.parse(String(v));\r\n  }\r\n\r\n  getValue(row: IDataRow) {\r\n    return super.getValue(row).map(({key, value}) => ({\r\n      key,\r\n      value: this.parseValue(value)\r\n    }));\r\n  }\r\n\r\n  getLabels(row: IDataRow): IKeyValue<string>[] {\r\n    return this.getValue(row).map(({key, value}) => ({\r\n      key,\r\n      value: (value instanceof Date) ? this.format(value) : ''\r\n    }));\r\n  }\r\n\r\n  getDates(row: IDataRow): (Date | null)[] {\r\n    return this.getValue(row).map((v) => v.value);\r\n  }\r\n\r\n  getDate(row: IDataRow) {\r\n    return DatesColumn.prototype.getDate.call(this, row);\r\n  }\r\n\r\n  getSortMethod() {\r\n    return this.sort;\r\n  }\r\n\r\n  setSortMethod(sort: EDateSort) {\r\n    return DatesColumn.prototype.setSortMethod.call(this, sort);\r\n  }\r\n\r\n  dump(toDescRef: (desc: any) => any): any {\r\n    const r = super.dump(toDescRef);\r\n    r.sortMethod = this.getSortMethod();\r\n    r.filter = !isDummyDateFilter(this.currentFilter) ? this.currentFilter : null;\r\n    return r;\r\n  }\r\n\r\n  restore(dump: any, factory: (dump: any) => Column | null) {\r\n    super.restore(dump, factory);\r\n    if (dump.sortMethod) {\r\n      this.sort = dump.sortMethod;\r\n    }\r\n    if (dump.filter) {\r\n      this.currentFilter = restoreDateFilter(dump.filter);\r\n    }\r\n  }\r\n\r\n  isFiltered() {\r\n    return DateColumn.prototype.isFiltered.call(this);\r\n  }\r\n\r\n  getFilter(): IDateFilter {\r\n    return DateColumn.prototype.getFilter.call(this);\r\n  }\r\n\r\n  setFilter(value: IDateFilter = {min: -Infinity, max: +Infinity, filterMissing: false}) {\r\n    DateColumn.prototype.setFilter.call(this, value);\r\n  }\r\n\r\n  filter(row: IDataRow) {\r\n    return DateColumn.prototype.filter.call(this, row);\r\n  }\r\n}\r\n","import {LazyBoxPlotData} from '../internal';\r\nimport {toolbar, SortByDefault, dialogAddons} from './annotations';\r\nimport Column, {widthChanged, labelChanged, metaDataChanged, dirty, dirtyHeader, dirtyValues, rendererTypeChanged, groupRendererChanged, summaryRendererChanged, visibilityChanged} from './Column';\r\nimport ValueColumn, {dataLoaded} from './ValueColumn';\r\nimport {IKeyValue} from './IArrayColumn';\r\nimport {IDataRow} from './interfaces';\r\nimport {\r\n  compareBoxPlot, DEFAULT_FORMATTER, EAdvancedSortMethod, getBoxPlotNumber, IAdvancedBoxPlotColumn, INumberDesc,\r\n  INumberFilter, noNumberFilter, isDummyNumberFilter, restoreNumberFilter\r\n} from './INumberColumn';\r\nimport {default as MapColumn, IMapColumnDesc} from './MapColumn';\r\nimport {createMappingFunction, IMappingFunction, restoreMapping, ScaleMappingFunction} from './MappingFunction';\r\nimport {isMissingValue} from './missing';\r\nimport NumberColumn, {colorMappingChanged} from './NumberColumn';\r\nimport {IAdvancedBoxPlotData} from '../internal/math';\r\nimport {IEventListener} from '../internal/AEventDispatcher';\r\nimport {IColorMappingFunction, restoreColorMapping, createColorMappingFunction} from './ColorMappingFunction';\r\n\r\n\r\nexport interface INumberMapDesc extends INumberDesc {\r\n  readonly sort?: EAdvancedSortMethod;\r\n}\r\n\r\nexport declare type INumberMapColumnDesc = INumberMapDesc & IMapColumnDesc<number>;\r\n\r\n/**\r\n * emitted when the mapping property changes\r\n * @asMemberOf NumberMapColumn\r\n * @event\r\n */\r\nexport declare function mappingChanged(previous: IMappingFunction, current: IMappingFunction): void;\r\n\r\n/**\r\n * emitted when the sort method property changes\r\n * @asMemberOf NumberMapColumn\r\n * @event\r\n */\r\nexport declare function sortMethodChanged(previous: EAdvancedSortMethod, current: EAdvancedSortMethod): void;\r\n\r\n/**\r\n * emitted when the filter property changes\r\n * @asMemberOf NumberMapColumn\r\n * @event\r\n */\r\nexport declare function filterChanged(previous: INumberFilter | null, current: INumberFilter | null): void;\r\n\r\n@toolbar('filterNumber', 'colorMapped', 'editMapping')\r\n@dialogAddons('sort', 'sortNumbers')\r\n@SortByDefault('descending')\r\nexport default class NumberMapColumn extends MapColumn<number> implements IAdvancedBoxPlotColumn {\r\n  static readonly EVENT_MAPPING_CHANGED = NumberColumn.EVENT_MAPPING_CHANGED;\r\n  static readonly EVENT_COLOR_MAPPING_CHANGED = NumberColumn.EVENT_COLOR_MAPPING_CHANGED;\r\n  static readonly EVENT_SORTMETHOD_CHANGED = NumberColumn.EVENT_SORTMETHOD_CHANGED;\r\n  static readonly EVENT_FILTER_CHANGED = NumberColumn.EVENT_FILTER_CHANGED;\r\n\r\n  private sort: EAdvancedSortMethod;\r\n  private mapping: IMappingFunction;\r\n  private original: IMappingFunction;\r\n  private colorMapping: IColorMappingFunction;\r\n  /**\r\n   * currently active filter\r\n   * @type {{min: number, max: number}}\r\n   * @private\r\n   */\r\n  private currentFilter: INumberFilter = noNumberFilter();\r\n\r\n  constructor(id: string, desc: Readonly<INumberMapColumnDesc>) {\r\n    super(id, desc);\r\n    this.mapping = restoreMapping(desc);\r\n    this.original = this.mapping.clone();\r\n    this.colorMapping = restoreColorMapping(desc);\r\n    this.sort = desc.sort || EAdvancedSortMethod.median;\r\n    this.setDefaultRenderer('mapbars');\r\n  }\r\n\r\n  compare(a: IDataRow, b: IDataRow): number {\r\n    return compareBoxPlot(this, a, b);\r\n  }\r\n\r\n  getBoxPlotData(row: IDataRow): IAdvancedBoxPlotData | null {\r\n    const data = this.getRawValue(row);\r\n    if (data == null) {\r\n      return null;\r\n    }\r\n    return new LazyBoxPlotData(data.map((d) => d.value), this.mapping);\r\n  }\r\n\r\n  getRange() {\r\n    return this.mapping.getRange(DEFAULT_FORMATTER);\r\n  }\r\n\r\n  getRawBoxPlotData(row: IDataRow): IAdvancedBoxPlotData | null {\r\n    const data = this.getRawValue(row);\r\n    if (data == null) {\r\n      return null;\r\n    }\r\n    return new LazyBoxPlotData(data.map((d) => d.value));\r\n  }\r\n\r\n  getNumber(row: IDataRow): number {\r\n    return getBoxPlotNumber(this, row, 'normalized');\r\n  }\r\n\r\n  getRawNumber(row: IDataRow): number {\r\n    return getBoxPlotNumber(this, row, 'raw');\r\n  }\r\n\r\n  getValue(row: IDataRow) {\r\n    const values = this.getRawValue(row);\r\n    return values.map(({key, value}) => ({key, value: isMissingValue(value) ? NaN : this.mapping.apply(value)}));\r\n  }\r\n\r\n  getRawValue(row: IDataRow): IKeyValue<number>[] {\r\n    const r = super.getValue(row);\r\n    return r == null ? [] : r;\r\n  }\r\n\r\n  getExportValue(row: IDataRow, format: 'text' | 'json'): any {\r\n    return format === 'json' ? this.getRawValue(row) : super.getExportValue(row, format);\r\n  }\r\n\r\n  getLabels(row: IDataRow) {\r\n    const v = this.getValue(row);\r\n    return v.map(({key, value}) => ({key, value: DEFAULT_FORMATTER(value)}));\r\n  }\r\n\r\n  getSortMethod() {\r\n    return this.sort;\r\n  }\r\n\r\n  setSortMethod(sort: EAdvancedSortMethod) {\r\n    if (this.sort === sort) {\r\n      return;\r\n    }\r\n    this.fire([NumberMapColumn.EVENT_SORTMETHOD_CHANGED], this.sort, this.sort = sort);\r\n    // sort by me if not already sorted by me\r\n    if (!this.isSortedByMe().asc) {\r\n      this.sortByMe();\r\n    }\r\n  }\r\n\r\n  dump(toDescRef: (desc: any) => any): any {\r\n    const r = super.dump(toDescRef);\r\n    r.sortMethod = this.getSortMethod();\r\n    r.filter = !isDummyNumberFilter(this.currentFilter) ? this.currentFilter : null;\r\n    r.map = this.mapping.dump();\r\n    r.colorMapping = this.colorMapping.dump();\r\n    return r;\r\n  }\r\n\r\n  restore(dump: any, factory: (dump: any) => Column | null) {\r\n    super.restore(dump, factory);\r\n    if (dump.sortMethod) {\r\n      this.sort = dump.sortMethod;\r\n    }\r\n    if (dump.filter) {\r\n      this.currentFilter = restoreNumberFilter(dump.filter);\r\n    }\r\n    if (dump.map) {\r\n      this.mapping = createMappingFunction(dump.map);\r\n    } else if (dump.domain) {\r\n      this.mapping = new ScaleMappingFunction(dump.domain, 'linear', dump.range || [0, 1]);\r\n    }\r\n    if (dump.colorMapping) {\r\n      this.colorMapping = createColorMappingFunction(dump.colorMapping);\r\n    }\r\n  }\r\n\r\n  protected createEventList() {\r\n    return super.createEventList().concat([NumberMapColumn.EVENT_COLOR_MAPPING_CHANGED, NumberMapColumn.EVENT_MAPPING_CHANGED, NumberMapColumn.EVENT_SORTMETHOD_CHANGED, NumberMapColumn.EVENT_FILTER_CHANGED]);\r\n  }\r\n\r\n  on(type: typeof NumberMapColumn.EVENT_COLOR_MAPPING_CHANGED, listener: typeof colorMappingChanged | null): this;\r\n  on(type: typeof NumberMapColumn.EVENT_MAPPING_CHANGED, listener: typeof mappingChanged | null): this;\r\n  on(type: typeof NumberMapColumn.EVENT_SORTMETHOD_CHANGED, listener: typeof sortMethodChanged | null): this;\r\n  on(type: typeof NumberMapColumn.EVENT_FILTER_CHANGED, listener: typeof filterChanged | null): this;\r\n  on(type: typeof ValueColumn.EVENT_DATA_LOADED, listener: typeof dataLoaded | null): this;\r\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\r\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\r\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\r\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\r\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\r\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\r\n  on(type: string | string[], listener: IEventListener | null): this {\r\n    return super.on(<any>type, listener);\r\n  }\r\n\r\n  getOriginalMapping() {\r\n    return this.original.clone();\r\n  }\r\n\r\n  getMapping() {\r\n    return this.mapping.clone();\r\n  }\r\n\r\n  setMapping(mapping: IMappingFunction) {\r\n    if (this.mapping.eq(mapping)) {\r\n      return;\r\n    }\r\n    this.fire([NumberMapColumn.EVENT_MAPPING_CHANGED, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY], this.mapping.clone(), this.mapping = mapping);\r\n  }\r\n\r\n  getColor(row: IDataRow) {\r\n    return NumberColumn.prototype.getColor.call(this, row);\r\n  }\r\n\r\n  getColorMapping() {\r\n    return this.colorMapping.clone();\r\n  }\r\n\r\n  setColorMapping(mapping: IColorMappingFunction) {\r\n    if (this.colorMapping.eq(mapping)) {\r\n      return;\r\n    }\r\n    this.fire([NumberMapColumn.EVENT_COLOR_MAPPING_CHANGED, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY], this.colorMapping.clone(), this.colorMapping = mapping);\r\n  }\r\n\r\n  isFiltered() {\r\n    return NumberColumn.prototype.isFiltered.call(this);\r\n  }\r\n\r\n  getFilter(): INumberFilter {\r\n    return NumberColumn.prototype.getFilter.call(this);\r\n  }\r\n\r\n  setFilter(value: INumberFilter = {min: -Infinity, max: +Infinity, filterMissing: false}) {\r\n    NumberColumn.prototype.setFilter.call(this, value);\r\n  }\r\n\r\n  filter(row: IDataRow) {\r\n    return NumberColumn.prototype.filter.call(this, row);\r\n  }\r\n}\r\n\r\n","import {Category, toolbar} from './annotations';\r\nimport CategoricalColumn from './CategoricalColumn';\r\nimport Column, {labelChanged, metaDataChanged, dirty, widthChanged, dirtyHeader, dirtyValues, rendererTypeChanged, groupRendererChanged, summaryRendererChanged, visibilityChanged} from './Column';\r\nimport {IArrayColumn} from './IArrayColumn';\r\nimport {ICategoricalDesc, ICategoricalFilter, ICategory, isCategoryIncluded, toCategories} from './ICategoricalColumn';\r\nimport {IDataRow} from './interfaces';\r\nimport {FIRST_IS_MISSING} from './missing';\r\nimport ValueColumn, {IValueColumnDesc, dataLoaded} from './ValueColumn';\r\nimport {IEventListener} from '../internal/AEventDispatcher';\r\n\r\nexport interface ISetDesc extends ICategoricalDesc {\r\n  separator?: string;\r\n}\r\n\r\nexport declare type ISetColumnDesc = ISetDesc & IValueColumnDesc<string[]>;\r\n\r\n/**\r\n * emitted when the filter property changes\r\n * @asMemberOf SetColumn\r\n * @event\r\n */\r\nexport declare function filterChanged(previous: ICategoricalFilter | null, current: ICategoricalFilter | null): void;\r\n\r\n/**\r\n * a string column with optional alignment\r\n */\r\n@toolbar('filterCategorical')\r\n@Category('categorical')\r\nexport default class SetColumn extends ValueColumn<string[]> implements IArrayColumn<boolean> {\r\n  static readonly EVENT_FILTER_CHANGED = CategoricalColumn.EVENT_FILTER_CHANGED;\r\n\r\n  readonly categories: ICategory[];\r\n\r\n  private readonly separator: RegExp;\r\n\r\n  private readonly lookup = new Map<string, Readonly<ICategory>>();\r\n  /**\r\n   * set of categories to show\r\n   * @type {null}\r\n   * @private\r\n   */\r\n  private currentFilter: ICategoricalFilter | null = null;\r\n\r\n  constructor(id: string, desc: Readonly<ISetColumnDesc>) {\r\n    super(id, desc);\r\n    this.separator = new RegExp(desc.separator || ';');\r\n    this.categories = toCategories(desc);\r\n    this.categories.forEach((d) => this.lookup.set(d.name, d));\r\n    this.setDefaultRenderer('upset');\r\n    this.setDefaultGroupRenderer('upset');\r\n  }\r\n\r\n  protected createEventList() {\r\n    return super.createEventList().concat([SetColumn.EVENT_FILTER_CHANGED]);\r\n  }\r\n\r\n  on(type: typeof SetColumn.EVENT_FILTER_CHANGED, listener: typeof filterChanged | null): this;\r\n  on(type: typeof ValueColumn.EVENT_DATA_LOADED, listener: typeof dataLoaded | null): this;\r\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\r\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\r\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\r\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\r\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\r\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\r\n  on(type: string | string[], listener: IEventListener | null): this {\r\n    return super.on(<any>type, listener);\r\n  }\r\n\r\n  get labels() {\r\n    return this.categories.map((d) => d.label);\r\n  }\r\n\r\n  get dataLength() {\r\n    return this.categories.length;\r\n  }\r\n\r\n  getValue(row: IDataRow): string[] {\r\n    return this.getCategories(row).map((d) => d.name);\r\n  }\r\n\r\n  getLabel(row: IDataRow) {\r\n    return `(${this.getCategories(row).map((d) => d.label).join(',')})`;\r\n  }\r\n\r\n  private normalize(v: any) {\r\n    if (typeof v === 'string') {\r\n      return v.split(this.separator).map((s) => s.trim());\r\n    }\r\n    if (Array.isArray(v)) {\r\n      return v.map((v) => String(v).trim());\r\n    }\r\n    if (v instanceof Set) {\r\n      return Array.from(v).map(String);\r\n    }\r\n    return [];\r\n  }\r\n\r\n  getSet(row: IDataRow) {\r\n    const sv = this.normalize(super.getValue(row));\r\n    const r = new Set<ICategory>();\r\n    sv.forEach((n) => {\r\n      const cat = this.lookup.get(n);\r\n      if (cat) {\r\n        r.add(cat);\r\n      }\r\n    });\r\n    return r;\r\n  }\r\n\r\n  getCategories(row: IDataRow) {\r\n    return Array.from(this.getSet(row)).sort((a, b) => a.value === b.value ? a.label.localeCompare(b.label) : a.value - b.value);\r\n  }\r\n\r\n  isMissing(row: IDataRow) {\r\n    const s = this.getSet(row);\r\n    return s.size === 0;\r\n  }\r\n\r\n  getValues(row: IDataRow) {\r\n    const s = new Set(this.getSet(row));\r\n    return this.categories.map((d) => s.has(d));\r\n  }\r\n\r\n  getLabels(row: IDataRow) {\r\n    return this.getValues(row).map(String);\r\n  }\r\n\r\n  getMap(row: IDataRow) {\r\n    return this.getCategories(row).map((d) => ({key: d.label, value: true}));\r\n  }\r\n\r\n  getMapLabel(row: IDataRow) {\r\n    return this.getCategories(row).map((d) => ({key: d.label, value: 'true'}));\r\n  }\r\n\r\n  dump(toDescRef: (desc: any) => any): any {\r\n    const r = super.dump(toDescRef);\r\n    r.filter = this.currentFilter;\r\n    return r;\r\n  }\r\n\r\n  restore(dump: any, factory: (dump: any) => Column | null) {\r\n    super.restore(dump, factory);\r\n    if (!('filter' in dump)) {\r\n      this.currentFilter = null;\r\n      return;\r\n    }\r\n    const bak = dump.filter;\r\n    if (typeof bak === 'string' || Array.isArray(bak)) {\r\n      this.currentFilter = {filter: bak, filterMissing: false};\r\n    } else {\r\n      this.currentFilter = bak;\r\n    }\r\n  }\r\n\r\n  isFiltered() {\r\n    return this.currentFilter != null;\r\n  }\r\n\r\n  filter(row: IDataRow): boolean {\r\n    if (!this.currentFilter) {\r\n      return true;\r\n    }\r\n    return Array.from(this.getSet(row)).some((s) => isCategoryIncluded(this.currentFilter, s));\r\n  }\r\n\r\n  getFilter() {\r\n    return CategoricalColumn.prototype.getFilter.call(this);\r\n  }\r\n\r\n  setFilter(filter: ICategoricalFilter | null) {\r\n    return CategoricalColumn.prototype.setFilter.call(this, filter);\r\n  }\r\n\r\n  compare(a: IDataRow, b: IDataRow) {\r\n    const av = this.getSet(a);\r\n    const bv = this.getSet(b);\r\n    if (av.size === 0) {\r\n      return bv.size === 0 ? 0 : FIRST_IS_MISSING;\r\n    }\r\n    if (bv.size === 0) {\r\n      return -FIRST_IS_MISSING;\r\n    }\r\n    if (av.size !== bv.size) {\r\n      return av.size - bv.size;\r\n    }\r\n    // first one having a category wins\r\n    for (const cat of this.categories) {\r\n      if (av.has(cat)) {\r\n        return -1;\r\n      }\r\n      if (bv.has(cat)) {\r\n        return +1;\r\n      }\r\n    }\r\n    return 0;\r\n  }\r\n}\r\n","import {toolbar} from './annotations';\r\nimport Column, {widthChanged, labelChanged, metaDataChanged, dirty, dirtyHeader, dirtyValues, rendererTypeChanged, groupRendererChanged, summaryRendererChanged, visibilityChanged} from './Column';\r\nimport ValueColumn, {dataLoaded} from './ValueColumn';\r\nimport {IDataRow} from './interfaces';\r\nimport MapColumn, {IMapColumnDesc} from './MapColumn';\r\nimport {EAlignment, IStringDesc} from './StringColumn';\r\nimport {IEventListener} from '../internal/AEventDispatcher';\r\n\r\nexport declare type IStringMapColumnDesc = IStringDesc & IMapColumnDesc<string>;\r\n\r\n/**\r\n * a string column with optional alignment\r\n */\r\n@toolbar('search')\r\nexport default class StringMapColumn extends MapColumn<string> {\r\n  readonly alignment: EAlignment;\r\n  readonly escape: boolean;\r\n\r\n  constructor(id: string, desc: Readonly<IStringMapColumnDesc>) {\r\n    super(id, desc);\r\n    this.setDefaultWidth(200); //by default 200\r\n    this.alignment = <any>desc.alignment || EAlignment.left;\r\n    this.escape = desc.escape !== false;\r\n    this.setDefaultRenderer('map');\r\n  }\r\n\r\n  on(type: typeof ValueColumn.EVENT_DATA_LOADED, listener: typeof dataLoaded | null): this;\r\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\r\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\r\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\r\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\r\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\r\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\r\n  on(type: string | string[], listener: IEventListener | null): this {\r\n    return super.on(<any>type, listener);\r\n  }\r\n\r\n  getValue(row: IDataRow) {\r\n    return super.getValue(row).map(({key, value}) => ({\r\n      key,\r\n      value: value == null ? '' : String(value)\r\n    }));\r\n  }\r\n}\r\n","import {toolbar} from './annotations';\r\nimport ArrayColumn, {IArrayColumnDesc, spliceChanged} from './ArrayColumn';\r\nimport Column, {widthChanged, labelChanged, metaDataChanged, dirty, dirtyHeader, dirtyValues, rendererTypeChanged, groupRendererChanged, summaryRendererChanged, visibilityChanged} from './Column';\r\nimport ValueColumn, {dataLoaded} from './ValueColumn';\r\nimport {IDataRow} from './interfaces';\r\nimport {EAlignment, IStringDesc} from './StringColumn';\r\nimport {IEventListener} from '../internal/AEventDispatcher';\r\n\r\nexport declare type IStringsColumnDesc = IStringDesc & IArrayColumnDesc<string>;\r\n\r\n/**\r\n * a string column with optional alignment\r\n */\r\n@toolbar('search')\r\nexport default class StringsColumn extends ArrayColumn<string> {\r\n  readonly alignment: EAlignment;\r\n  readonly escape: boolean;\r\n\r\n  constructor(id: string, desc: Readonly<IStringsColumnDesc>) {\r\n    super(id, desc);\r\n    this.setDefaultWidth(200); //by default 200\r\n    this.alignment = <any>desc.alignment || EAlignment.left;\r\n    this.escape = desc.escape !== false;\r\n  }\r\n\r\n  on(type: typeof ArrayColumn.EVENT_SPLICE_CHANGED, listener: typeof spliceChanged | null): this;\r\n  on(type: typeof ValueColumn.EVENT_DATA_LOADED, listener: typeof dataLoaded | null): this;\r\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\r\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\r\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\r\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\r\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\r\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\r\n  on(type: string | string[], listener: IEventListener | null): this {\r\n    return super.on(<any>type, listener);\r\n  }\r\n\r\n  getValues(row: IDataRow) {\r\n    return super.getValues(row).map((v) => {\r\n      return v == null ? '' : String(v);\r\n    });\r\n  }\r\n}\r\n","import {toolbar} from './annotations';\r\nimport ArrayColumn, {IArrayColumnDesc, spliceChanged} from './ArrayColumn';\r\nimport Column, {widthChanged, labelChanged, metaDataChanged, dirty, dirtyHeader, dirtyValues, rendererTypeChanged, groupRendererChanged, summaryRendererChanged, visibilityChanged} from './Column';\r\nimport ValueColumn, {dataLoaded} from './ValueColumn';\r\nimport {IDataRow} from './interfaces';\r\nimport {patternFunction} from './internal';\r\nimport {EAlignment} from './StringColumn';\r\nimport {IEventListener} from '../internal/AEventDispatcher';\r\nimport LinkColumn, {ILink, ILinkDesc, patternChanged} from './LinkColumn';\r\n\r\nexport declare type ILinksColumnDesc = ILinkDesc & IArrayColumnDesc<string | ILink>;\r\n\r\n@toolbar('search', 'editPattern')\r\nexport default class LinksColumn extends ArrayColumn<string | ILink> {\r\n  static readonly EVENT_PATTERN_CHANGED = LinkColumn.EVENT_PATTERN_CHANGED;\r\n\r\n  readonly alignment: EAlignment;\r\n  readonly escape: boolean;\r\n  private pattern: string;\r\n  private patternFunction: Function | null = null;\r\n  readonly patternTemplates: string[];\r\n\r\n  constructor(id: string, desc: Readonly<ILinksColumnDesc>) {\r\n    super(id, desc);\r\n    this.setDefaultWidth(200); //by default 200\r\n    this.alignment = <any>desc.alignment || EAlignment.left;\r\n    this.escape = desc.escape !== false;\r\n    this.pattern = desc.pattern || '';\r\n    this.patternTemplates = desc.patternTemplates || [];\r\n  }\r\n\r\n  setPattern(pattern: string) {\r\n    return LinkColumn.prototype.setPattern.call(this, pattern);\r\n  }\r\n\r\n  getPattern() {\r\n    return this.pattern;\r\n  }\r\n\r\n  protected createEventList() {\r\n    return super.createEventList().concat([LinksColumn.EVENT_PATTERN_CHANGED]);\r\n  }\r\n\r\n  on(type: typeof LinksColumn.EVENT_PATTERN_CHANGED, listener: typeof patternChanged | null): this;\r\n  on(type: typeof ArrayColumn.EVENT_SPLICE_CHANGED, listener: typeof spliceChanged | null): this;\r\n  on(type: typeof ValueColumn.EVENT_DATA_LOADED, listener: typeof dataLoaded | null): this;\r\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\r\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\r\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\r\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\r\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\r\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\r\n  on(type: string | string[], listener: IEventListener | null): this {\r\n    return super.on(<any>type, listener);\r\n  }\r\n\r\n  getValues(row: IDataRow) {\r\n    return this.getLinks(row).map((d) => d ? d.href : '');\r\n  }\r\n\r\n  getLabels(row: IDataRow) {\r\n    return this.getLinks(row).map((d) => d ? d.alt : '');\r\n  }\r\n\r\n  private transformValue(v: any, row: IDataRow, i: number) {\r\n    if (v == null || v === '') {\r\n      return null;\r\n    }\r\n    if (typeof v === 'string') {\r\n      if (!this.pattern) {\r\n        return {\r\n          alt: v,\r\n          href: v\r\n        };\r\n      }\r\n      if (!this.patternFunction) {\r\n        this.patternFunction = patternFunction(this.pattern, 'item', 'index');\r\n      }\r\n      return {\r\n        alt: v,\r\n        href: this.patternFunction.call(this, v, row.v, i)\r\n      };\r\n    }\r\n    return v;\r\n  }\r\n\r\n  getLinks(row: IDataRow): ILink[] {\r\n    return super.getValues(row).map((v, i) => {\r\n      return this.transformValue(v, row, i);\r\n    });\r\n  }\r\n\r\n  dump(toDescRef: (desc: any) => any): any {\r\n    const r = super.dump(toDescRef);\r\n    if (this.pattern !== (<any>this.desc).pattern) {\r\n      r.pattern = this.pattern;\r\n    }\r\n    return r;\r\n  }\r\n\r\n  restore(dump: any, factory: (dump: any) => Column | null) {\r\n    if (dump.pattern) {\r\n      this.pattern = dump.pattern;\r\n    }\r\n    super.restore(dump, factory);\r\n  }\r\n}\r\n","import Column, {IColumnDesc} from './Column';\r\n\r\n/**\r\n * a default column with no values\r\n */\r\nexport default class DummyColumn extends Column {\r\n\r\n  constructor(id: string, desc: Readonly<IColumnDesc>) {\r\n    super(id, desc);\r\n  }\r\n\r\n  getLabel() {\r\n    return '';\r\n  }\r\n\r\n  getValue() {\r\n    return '';\r\n  }\r\n\r\n  compare() {\r\n    return 0; //can't compare\r\n  }\r\n}\r\n","import ActionColumn from './ActionColumn';\r\nimport AggregateGroupColumn from './AggregateGroupColumn';\r\nimport AnnotateColumn from './AnnotateColumn';\r\nimport BooleanColumn from './BooleanColumn';\r\nimport BooleansColumn from './BooleansColumn';\r\nimport BoxPlotColumn from './BoxPlotColumn';\r\nimport CategoricalColumn from './CategoricalColumn';\r\nimport CategoricalMapColumn from './CategoricalMapColumn';\r\nimport CategoricalsColumn from './CategoricalsColumn';\r\nimport Column from './Column';\r\nimport DateColumn from './DateColumn';\r\nimport DatesColumn from './DatesColumn';\r\nimport DatesMapColumn from './DatesMapColumn';\r\nimport GroupColumn from './GroupColumn';\r\nimport HierarchyColumn from './HierarchyColumn';\r\nimport ImpositionCompositeColumn from './ImpositionCompositeColumn';\r\nimport ImpositionCompositesColumn from './ImpositionCompositesColumn';\r\nimport NestedColumn from './NestedColumn';\r\nimport NumberColumn from './NumberColumn';\r\nimport NumberMapColumn from './NumberMapColumn';\r\nimport NumbersColumn from './NumbersColumn';\r\nimport OrdinalColumn from './OrdinalColumn';\r\nimport RankColumn from './RankColumn';\r\nimport ReduceColumn from './ReduceColumn';\r\nimport ScriptColumn from './ScriptColumn';\r\nimport SelectionColumn from './SelectionColumn';\r\nimport SetColumn from './SetColumn';\r\nimport StackColumn from './StackColumn';\r\nimport StringColumn from './StringColumn';\r\nimport StringMapColumn from './StringMapColumn';\r\nimport StringsColumn from './StringsColumn';\r\nimport ValueColumn, {IValueColumnDesc} from './ValueColumn';\r\nimport ImpositionBoxPlotColumn from './ImpositionBoxPlotColumn';\r\nimport LinkColumn from './LinkColumn';\r\nimport LinkMapColumn from './LinkMapColumn';\r\nimport LinksColumn from './LinksColumn';\r\n\r\nexport {isSupportType, Category, SupportType, SortByDefault, Categories, toolbar, dialogAddons, categoryOfDesc, categoryOf, IColumnCategory} from './annotations';\r\nexport {isMissingValue, isUnknown, FIRST_IS_NAN, FIRST_IS_MISSING, missingGroup} from './missing';\r\nexport * from './Group';\r\nexport * from './interfaces';\r\nexport * from './ICategoricalColumn';\r\nexport * from './INumberColumn';\r\nexport * from './IDateColumn';\r\nexport * from './IArrayColumn';\r\nexport * from './MappingFunction';\r\n\r\nexport {default as ActionColumn} from './ActionColumn';\r\nexport * from './ActionColumn';\r\nexport {default as AggregateGroupColumn, createAggregateDesc, IAggregateGroupColumnDesc} from './AggregateGroupColumn';\r\nexport {default as AnnotateColumn} from './AnnotateColumn';\r\nexport {default as ArrayColumn, IArrayColumnDesc, IArrayDesc, ISplicer} from './ArrayColumn';\r\nexport {default as BooleanColumn, IBooleanColumnDesc, IBooleanDesc} from './BooleanColumn';\r\nexport * from './BooleansColumn';\r\nexport {default as BooleansColumn} from './BooleansColumn';\r\nexport {default as BoxPlotColumn, IBoxPlotColumnDesc, IBoxPlotDesc} from './BoxPlotColumn';\r\nexport {default as CategoricalColumn} from './CategoricalColumn';\r\nexport * from './CategoricalMapColumn';\r\nexport {default as CategoricalMapColumn} from './CategoricalMapColumn';\r\nexport * from './CategoricalsColumn';\r\nexport {default as CategoricalsColumn} from './CategoricalsColumn';\r\nexport {default, default as Column, IFlatColumn, IColumnParent, IColumnMetaData, IColumnDesc} from './Column';\r\nexport {default as CompositeColumn, isMultiLevelColumn, IMultiLevelColumn} from './CompositeColumn';\r\nexport * from './CompositeNumberColumn';\r\nexport {default as CompositeNumberColumn} from './CompositeNumberColumn';\r\nexport {default as DateColumn, IDateColumnDesc} from './DateColumn';\r\nexport {default as DatesMapColumn, IDateMapColumnDesc} from './DatesMapColumn';\r\nexport {default as DatesColumn, IDatesDesc, IDatesColumnDesc} from './DatesColumn';\r\nexport * from './DummyColumn';\r\nexport {default as DummyColumn} from './DummyColumn';\r\nexport {default as GroupColumn, createGroupDesc, EGroupSortMethod} from './GroupColumn';\r\nexport {default as HierarchyColumn, ICategoryNode, IPartialCategoryNode, IHierarchyColumnDesc, IHierarchyDesc, ICategoryInternalNode, ICutOffNode, resolveInnerNodes, isHierarchical, deriveHierarchy} from './HierarchyColumn';\r\nexport * from './ImpositionBoxPlotColumn';\r\nexport {default as ImpositionBoxPlotColumn} from './ImpositionBoxPlotColumn';\r\nexport * from './ImpositionCompositeColumn';\r\nexport {default as ImpositionCompositeColumn} from './ImpositionCompositeColumn';\r\nexport * from './ImpositionCompositesColumn';\r\nexport {default as ImpositionCompositesColumn} from './ImpositionCompositesColumn';\r\nexport * from './MapColumn';\r\nexport {default as MapColumn} from './MapColumn';\r\nexport {default as MultiLevelCompositeColumn} from './MultiLevelCompositeColumn';\r\nexport * from './NestedColumn';\r\nexport {default as NestedColumn} from './NestedColumn';\r\nexport {default as NumberColumn, INumberColumnDesc, INumberColumn, isNumberColumn} from './NumberColumn';\r\nexport {default as NumberMapColumn, INumberMapDesc, INumberMapColumnDesc} from './NumberMapColumn';\r\nexport {default as NumbersColumn, INumbersDesc, INumbersColumnDesc} from './NumbersColumn';\r\nexport {default as OrdinalColumn, ICategoricalNumberColumnDesc} from './OrdinalColumn';\r\nexport * from './RankColumn';\r\nexport {default as RankColumn} from './RankColumn';\r\nexport {default as Ranking, ISortCriteria} from './Ranking';\r\nexport {default as ReduceColumn, createReduceDesc, IReduceDesc, IReduceColumnDesc} from './ReduceColumn';\r\nexport {default as ScriptColumn, createScriptDesc, IScriptDesc, IScriptColumnDesc} from './ScriptColumn';\r\nexport {default as SelectionColumn, createSelectionDesc, ISelectionColumnDesc} from './SelectionColumn';\r\nexport {default as SetColumn, ISetColumnDesc, ISetDesc} from './SetColumn';\r\nexport {default as StackColumn, createStackDesc} from './StackColumn';\r\nexport {default as StringColumn, EAlignment, IStringDesc, IStringColumnDesc, EStringGroupCriteriaType, IStringGroupCriteria} from './StringColumn';\r\nexport * from './StringMapColumn';\r\nexport {default as StringMapColumn} from './StringMapColumn';\r\nexport * from './StringsColumn';\r\nexport {default as StringsColumn} from './StringsColumn';\r\nexport {default as ValueColumn, IValueColumnDesc} from './ValueColumn';\r\nexport {default as LinkColumn, ILinkDesc, ILinkColumnDesc, ILink} from './LinkColumn';\r\nexport * from './LinkMapColumn';\r\nexport {default as LinkMapColumn} from './LinkMapColumn';\r\nexport * from './LinksColumn';\r\nexport {default as LinksColumn} from './LinksColumn';\r\n\r\n/**\r\n * defines a new column type\r\n * @param name\r\n * @param functions\r\n * @returns {CustomColumn}\r\n */\r\nexport function defineColumn<T>(name: string, functions: any = {}): typeof Column {\r\n  class CustomColumn extends ValueColumn<T> {\r\n    constructor(id: string, desc: IValueColumnDesc<T>) {\r\n      super(id, desc);\r\n      if (typeof (this.init) === 'function') {\r\n        this.init.apply(this, [].slice.apply(arguments));\r\n      }\r\n    }\r\n\r\n    init() {\r\n      // dummy\r\n    }\r\n  }\r\n\r\n  CustomColumn.prototype.toString = () => name;\r\n  CustomColumn.prototype = Object.assign(CustomColumn.prototype, functions);\r\n\r\n  return CustomColumn;\r\n}\r\n\r\n\r\n/**\r\n * a map of all known column types\r\n */\r\nexport function models() {\r\n  return {\r\n    actions: ActionColumn,\r\n    aggregate: AggregateGroupColumn,\r\n    annotate: AnnotateColumn,\r\n    boolean: BooleanColumn,\r\n    booleans: BooleansColumn,\r\n    boxplot: BoxPlotColumn,\r\n    categorical: CategoricalColumn,\r\n    categoricalMap: CategoricalMapColumn,\r\n    categoricals: CategoricalsColumn,\r\n    date: DateColumn,\r\n    dateMap: DatesMapColumn,\r\n    dates: DatesColumn,\r\n    group: GroupColumn,\r\n    hierarchy: HierarchyColumn,\r\n    imposition: ImpositionCompositeColumn,\r\n    impositionBoxPlot: ImpositionBoxPlotColumn,\r\n    impositions: ImpositionCompositesColumn,\r\n    reduce: ReduceColumn,\r\n    nested: NestedColumn,\r\n    number: NumberColumn,\r\n    numbers: NumbersColumn,\r\n    numberMap: NumberMapColumn,\r\n    ordinal: OrdinalColumn,\r\n    rank: RankColumn,\r\n    script: ScriptColumn,\r\n    selection: SelectionColumn,\r\n    set: SetColumn,\r\n    stack: StackColumn,\r\n    string: StringColumn,\r\n    stringMap: StringMapColumn,\r\n    strings: StringsColumn,\r\n    link: LinkColumn,\r\n    linkMap: LinkMapColumn,\r\n    links: LinksColumn\r\n  };\r\n}\r\n","import Column, {widthChanged, labelChanged, metaDataChanged, dirty, dirtyHeader, dirtyValues, rendererTypeChanged, groupRendererChanged, summaryRendererChanged, visibilityChanged} from './Column';\r\nimport {IColumnDesc, IDataRow} from './interfaces';\r\nimport Ranking from './Ranking';\r\nimport {IEventListener} from '../internal/AEventDispatcher';\r\n\r\n\r\nexport interface IValueColumnDesc<T> extends IColumnDesc {\r\n  /**\r\n   * is the data lazy loaded and not yet available\r\n   * @default false\r\n   */\r\n  lazyLoaded?: boolean;\r\n\r\n  /**\r\n   * value accessor of this column\r\n   * @param row the current row\r\n   * @param id the id of this column\r\n   * @param desc the description of this column\r\n   * @param ranking the ranking of this column\r\n   */\r\n  accessor?(row: IDataRow, id: string, desc: any, ranking: Ranking | null): T;\r\n}\r\n\r\n/**\r\n * emitted when the data of this column has been loaded\r\n * @asMemberOf ValueColumn\r\n * @event\r\n */\r\nexport declare function dataLoaded(previous: boolean, current: boolean): void;\r\n\r\n/**\r\n * a column having an accessor to get the cell value\r\n */\r\nexport default class ValueColumn<T> extends Column {\r\n  static readonly EVENT_DATA_LOADED = 'dataLoaded';\r\n\r\n  static readonly RENDERER_LOADING = 'loading';\r\n\r\n  private readonly accessor: (row: IDataRow, id: string, desc: any, ranking: Ranking | null) => T;\r\n\r\n  /**\r\n   * is the data available\r\n   * @type {boolean}\r\n   */\r\n  private loaded: boolean;\r\n\r\n  constructor(id: string, desc: Readonly<IValueColumnDesc<T>>) {\r\n    super(id, desc);\r\n    //find accessor\r\n    this.accessor = desc.accessor! || (() => null);\r\n    this.loaded = desc.lazyLoaded !== true;\r\n  }\r\n\r\n  protected createEventList() {\r\n    return super.createEventList().concat([ValueColumn.EVENT_DATA_LOADED]);\r\n  }\r\n\r\n  on(type: typeof ValueColumn.EVENT_DATA_LOADED, listener: typeof dataLoaded | null): this;\r\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\r\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\r\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\r\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\r\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\r\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\r\n  on(type: string | string[], listener: IEventListener | null): this {\r\n    return super.on(<any>type, listener);\r\n  }\r\n\r\n\r\n  getLabel(row: IDataRow) {\r\n    if (!this.isLoaded()) {\r\n      return '';\r\n    }\r\n    return String(this.getValue(row));\r\n  }\r\n\r\n  getRaw(row: IDataRow) {\r\n    if (!this.isLoaded()) {\r\n      return null;\r\n    }\r\n    return this.accessor(row, this.id, this.desc, this.findMyRanker());\r\n  }\r\n\r\n  getValue(row: IDataRow) {\r\n    return this.getRaw(row);\r\n  }\r\n\r\n  isLoaded() {\r\n    return this.loaded;\r\n  }\r\n\r\n  setLoaded(loaded: boolean) {\r\n    if (this.loaded === loaded) {\r\n      return;\r\n    }\r\n    this.fire([ValueColumn.EVENT_DATA_LOADED, Column.EVENT_DIRTY_HEADER, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY], this.loaded, this.loaded = loaded);\r\n  }\r\n\r\n  getRenderer(): string {\r\n    if (!this.isLoaded()) {\r\n      return ValueColumn.RENDERER_LOADING;\r\n    }\r\n    return super.getRenderer();\r\n  }\r\n\r\n  /**\r\n   * patch the dump such that the loaded attribute is defined (for lazy loading columns)\r\n   * @param toDescRef\r\n   * @returns {any}\r\n   */\r\n  dump(toDescRef: (desc: any) => any): any {\r\n    const r = super.dump(toDescRef);\r\n    r.loaded = this.loaded;\r\n\r\n    if (!this.loaded && r.rendererType === ValueColumn.RENDERER_LOADING) {\r\n      delete r.rendererType;\r\n    }\r\n    return r;\r\n  }\r\n\r\n  restore(dump: any, factory: (dump: any) => Column | null) {\r\n    if (dump.loaded !== undefined) {\r\n      this.loaded = dump.loaded;\r\n    }\r\n    super.restore(dump, factory);\r\n  }\r\n}\r\n","import Column from './Column';\r\nimport {IArrayColumn, isArrayColumn} from './IArrayColumn';\r\nimport {IColumnDesc, IDataRow} from './interfaces';\r\nimport {colorPool} from './internal';\r\nimport {FIRST_IS_MISSING} from './missing';\r\nimport {IValueColumnDesc} from './ValueColumn';\r\n\r\nexport interface ICategoricalDesc {\r\n  categories: (string | Partial<ICategory>)[];\r\n  missingCategory: (string | Partial<ICategory>);\r\n}\r\n\r\nexport declare type ICategoricalColumnDesc = IValueColumnDesc<string> & ICategoricalDesc;\r\n\r\nexport interface ISetColumn extends IArrayColumn<boolean> {\r\n  readonly categories: ICategory[];\r\n\r\n  getSet(row: IDataRow): Set<ICategory>;\r\n}\r\n\r\nexport function isSetColumn(col: Column): col is ISetColumn {\r\n  return isArrayColumn(col) && Array.isArray((<ISetColumn>col).categories);\r\n}\r\n\r\nexport interface ICategoricalColumn extends ISetColumn {\r\n  getCategory(row: IDataRow): ICategory | null;\r\n}\r\n\r\nexport interface ICategory {\r\n  readonly name: string;\r\n\r\n  /**\r\n   * optional label of this category (the one to render)\r\n   */\r\n  readonly label: string;\r\n  /**\r\n   * category color\r\n   * @default next in d3 color 10 range\r\n   */\r\n  readonly color: string;\r\n\r\n  value: number;\r\n}\r\n\r\n/** @internal */\r\nexport function toCategory(cat: (string | Partial<ICategory>), value: number, nextColor: () => string = () => Column.DEFAULT_COLOR) {\r\n  if (typeof cat === 'string') {\r\n    //just the category value\r\n    return {name: cat, label: cat, color: nextColor(), value};\r\n  }\r\n  const name = cat.name == null ? String(cat.value) : cat.name;\r\n  return {\r\n    name,\r\n    label: cat.label || name,\r\n    color: cat.color || nextColor(),\r\n    value: cat.value != null ? cat.value : value\r\n  };\r\n}\r\n\r\nexport function compareCategory(a: ICategory | null, b: ICategory | null) {\r\n  const aNull = a == null || isNaN(a.value);\r\n  const bNull = b == null || isNaN(b.value);\r\n  if (aNull || a == null) {\r\n    return bNull ? 0 : FIRST_IS_MISSING;\r\n  }\r\n  if (bNull || b == null) {\r\n    return -FIRST_IS_MISSING;\r\n  }\r\n  if (a.value === b.value) {\r\n    return a.label.toLowerCase().localeCompare(b.label.toLowerCase());\r\n  }\r\n  return a.value - b.value;\r\n}\r\n\r\nfunction findMostFrequent(rows: IDataRow[], col: ICategoricalColumn): {cat: ICategory | null, count: number} {\r\n  const hist = new Map<ICategory | null, number>();\r\n\r\n  for (const row of rows) {\r\n    const cat = col.getCategory(row);\r\n    hist.set(cat, (hist.get(cat) || 0) + 1);\r\n  }\r\n\r\n  if (hist.size === 0) {\r\n    return {\r\n      cat: null,\r\n      count: 0\r\n    };\r\n  }\r\n  let topCat: ICategory | null = null;\r\n  let topCount = 0;\r\n  hist.forEach((count, cat) => {\r\n    if (count > topCount) {\r\n      topCat = cat;\r\n      topCount = count;\r\n    }\r\n  });\r\n  return {\r\n    cat: topCat,\r\n    count: topCount\r\n  };\r\n}\r\n\r\n/**\r\n * sort group by most frequent category or if same without count desc\r\n */\r\nexport function groupCompareCategory(a: IDataRow[], b: IDataRow[], col: ICategoricalColumn) {\r\n  if (a.length === 0) {\r\n    return b.length === 0 ? 0 : FIRST_IS_MISSING;\r\n  }\r\n  if (b.length === 0) {\r\n    return -FIRST_IS_MISSING;\r\n  }\r\n\r\n  const aMostFrequent = findMostFrequent(a, col);\r\n  const bMostFrequent = findMostFrequent(b, col);\r\n\r\n  if (aMostFrequent.cat === null) {\r\n    return bMostFrequent.cat === null ? 0 : FIRST_IS_MISSING;\r\n  }\r\n  if (bMostFrequent.cat === null) {\r\n    return -FIRST_IS_MISSING;\r\n  }\r\n\r\n  if (aMostFrequent.cat === bMostFrequent.cat) {\r\n    return bMostFrequent.count - aMostFrequent.count; // by count desc\r\n  }\r\n  return aMostFrequent.cat.value - bMostFrequent.cat.value;\r\n}\r\n\r\nexport function toCategories(desc: ICategoricalDesc) {\r\n  if (!desc.categories) {\r\n    return [];\r\n  }\r\n  const nextColor = colorPool();\r\n  const l = desc.categories.length - 1;\r\n  const cats = desc.categories.map((cat, i) => toCategory(cat, i / l, nextColor));\r\n  return cats.sort(compareCategory);\r\n}\r\n\r\n/**\r\n * checks whether the given column or description is a categorical column, i.e. the value is a list of categories\r\n * @param col\r\n * @returns {boolean}\r\n */\r\nexport function isCategoricalColumn(col: Column): col is ICategoricalColumn;\r\nexport function isCategoricalColumn(col: IColumnDesc): col is ICategoricalColumnDesc & IColumnDesc;\r\nexport function isCategoricalColumn(col: Column | IColumnDesc) {\r\n  return (col instanceof Column && typeof (<ICategoricalColumn>col).getCategory === 'function' || (!(col instanceof Column) && (<IColumnDesc>col).type.match(/(categorical|ordinal|hierarchy)/) != null));\r\n}\r\n\r\nexport interface ICategoricalFilter {\r\n  filter: string[] | string | RegExp;\r\n  filterMissing: boolean;\r\n}\r\n\r\nfunction isEmptyFilter(f: ICategoricalFilter | null) {\r\n  return f == null || (!f.filterMissing && (f.filter == null || f.filter === ''));\r\n}\r\n\r\nexport function isEqualCategoricalFilter(a: ICategoricalFilter | null, b: ICategoricalFilter | null) {\r\n  if (a === b) {\r\n    return true;\r\n  }\r\n  if (a == null || b == null) {\r\n    return isEmptyFilter(a) === isEmptyFilter(b);\r\n  }\r\n  if (a.filterMissing !== b.filterMissing || (typeof a.filter !== typeof b.filter)) {\r\n    return false;\r\n  }\r\n  if (Array.isArray(a.filter)) {\r\n    return arrayEquals(<string[]>a.filter, <string[]>b.filter);\r\n  }\r\n  return String(a.filter) === String(b.filter);\r\n}\r\n\r\nfunction arrayEquals<T>(a: T[], b: T[]) {\r\n  const al = a != null ? a.length : 0;\r\n  const bl = b != null ? b.length : 0;\r\n  if (al !== bl) {\r\n    return false;\r\n  }\r\n  if (al === 0) {\r\n    return true;\r\n  }\r\n  return a.every((ai, i) => ai === b[i]);\r\n}\r\n\r\nexport function isCategoryIncluded(filter: ICategoricalFilter | null, category: ICategory | null) {\r\n  if (filter == null) {\r\n    return true;\r\n  }\r\n  if (category == null || isNaN(category.value)) {\r\n    return !filter.filterMissing;\r\n  }\r\n  const filterObj = filter.filter;\r\n  if (Array.isArray(filterObj)) { //array mode\r\n    return filterObj.includes(category.name);\r\n  }\r\n  if (typeof filterObj === 'string' && filterObj.length > 0) { //search mode\r\n    return category.name.toLowerCase().includes(filterObj.toLowerCase());\r\n  }\r\n  if (filterObj instanceof RegExp) { //regex match mode\r\n    return filterObj.test(category.name);\r\n  }\r\n  return true;\r\n}\r\n","var t0 = new Date,\n    t1 = new Date;\n\nexport default function newInterval(floori, offseti, count, field) {\n\n  function interval(date) {\n    return floori(date = arguments.length === 0 ? new Date : new Date(+date)), date;\n  }\n\n  interval.floor = function(date) {\n    return floori(date = new Date(+date)), date;\n  };\n\n  interval.ceil = function(date) {\n    return floori(date = new Date(date - 1)), offseti(date, 1), floori(date), date;\n  };\n\n  interval.round = function(date) {\n    var d0 = interval(date),\n        d1 = interval.ceil(date);\n    return date - d0 < d1 - date ? d0 : d1;\n  };\n\n  interval.offset = function(date, step) {\n    return offseti(date = new Date(+date), step == null ? 1 : Math.floor(step)), date;\n  };\n\n  interval.range = function(start, stop, step) {\n    var range = [], previous;\n    start = interval.ceil(start);\n    step = step == null ? 1 : Math.floor(step);\n    if (!(start < stop) || !(step > 0)) return range; // also handles Invalid Date\n    do range.push(previous = new Date(+start)), offseti(start, step), floori(start);\n    while (previous < start && start < stop);\n    return range;\n  };\n\n  interval.filter = function(test) {\n    return newInterval(function(date) {\n      if (date >= date) while (floori(date), !test(date)) date.setTime(date - 1);\n    }, function(date, step) {\n      if (date >= date) {\n        if (step < 0) while (++step <= 0) {\n          while (offseti(date, -1), !test(date)) {} // eslint-disable-line no-empty\n        } else while (--step >= 0) {\n          while (offseti(date, +1), !test(date)) {} // eslint-disable-line no-empty\n        }\n      }\n    });\n  };\n\n  if (count) {\n    interval.count = function(start, end) {\n      t0.setTime(+start), t1.setTime(+end);\n      floori(t0), floori(t1);\n      return Math.floor(count(t0, t1));\n    };\n\n    interval.every = function(step) {\n      step = Math.floor(step);\n      return !isFinite(step) || !(step > 0) ? null\n          : !(step > 1) ? interval\n          : interval.filter(field\n              ? function(d) { return field(d) % step === 0; }\n              : function(d) { return interval.count(0, d) % step === 0; });\n    };\n  }\n\n  return interval;\n}\n","export var durationSecond = 1e3;\nexport var durationMinute = 6e4;\nexport var durationHour = 36e5;\nexport var durationDay = 864e5;\nexport var durationWeek = 6048e5;\n","import {suffix, IEventListener} from '../internal/AEventDispatcher';\r\nimport Column, {IColumnParent, IFlatColumn, widthChanged, labelChanged, metaDataChanged, dirty, dirtyHeader, dirtyValues, rendererTypeChanged, groupRendererChanged, summaryRendererChanged, visibilityChanged} from './Column';\r\nimport {Category, toolbar} from './annotations';\r\nimport {IDataRow} from './interfaces';\r\nimport {isNumberColumn} from './INumberColumn';\r\nimport ValueColumn from './ValueColumn';\r\n\r\nexport function isMultiLevelColumn(col: Column): col is IMultiLevelColumn {\r\n  return typeof ((<IMultiLevelColumn>col).getCollapsed) === 'function';\r\n}\r\n\r\n/**\r\n * emitted when the filter property changes\r\n * @asMemberOf CompositeColumn\r\n * @event\r\n */\r\nexport declare function filterChanged(previous: any | null, current: any | null): void;\r\n\r\n/**\r\n * emitted when a column has been added\r\n * @asMemberOf CompositeColumn\r\n * @event\r\n */\r\nexport declare function addColumn(col: Column, index: number): void;\r\n\r\n/**\r\n * emitted when a column has been moved within this composite columm\r\n * @asMemberOf CompositeColumn\r\n * @event\r\n */\r\nexport declare function moveColumn(col: Column, index: number, oldIndex: number): void;\r\n\r\n/**\r\n * emitted when a column has been removed\r\n * @asMemberOf CompositeColumn\r\n * @event\r\n */\r\nexport declare function removeColumn(col: Column, index: number): void;\r\n\r\n/**\r\n * implementation of a combine column, standard operations how to select\r\n */\r\n@toolbar('compositeContained', 'splitCombined')\r\n@Category('composite')\r\nexport default class CompositeColumn extends Column implements IColumnParent {\r\n  static readonly EVENT_FILTER_CHANGED = 'filterChanged';\r\n  static readonly EVENT_ADD_COLUMN = 'addColumn';\r\n  static readonly EVENT_MOVE_COLUMN = 'moveColumn';\r\n  static readonly EVENT_REMOVE_COLUMN = 'removeColumn';\r\n\r\n  protected readonly _children: Column[] = [];\r\n\r\n  protected createEventList() {\r\n    return super.createEventList().concat([CompositeColumn.EVENT_FILTER_CHANGED, CompositeColumn.EVENT_ADD_COLUMN, CompositeColumn.EVENT_MOVE_COLUMN, CompositeColumn.EVENT_REMOVE_COLUMN]);\r\n  }\r\n\r\n  on(type: typeof CompositeColumn.EVENT_FILTER_CHANGED, listener: typeof filterChanged | null): this;\r\n  on(type: typeof CompositeColumn.EVENT_ADD_COLUMN, listener: typeof addColumn | null): this;\r\n  on(type: typeof CompositeColumn.EVENT_MOVE_COLUMN, listener: typeof moveColumn | null): this;\r\n  on(type: typeof CompositeColumn.EVENT_REMOVE_COLUMN, listener: typeof removeColumn | null): this;\r\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\r\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\r\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\r\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\r\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\r\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\r\n  on(type: string | string[], listener: IEventListener | null): this {\r\n    return super.on(type, listener);\r\n  }\r\n\r\n  assignNewId(idGenerator: () => string) {\r\n    super.assignNewId(idGenerator);\r\n    this._children.forEach((c) => c.assignNewId(idGenerator));\r\n  }\r\n\r\n  get children() {\r\n    return this._children.slice();\r\n  }\r\n\r\n  get length() {\r\n    return this._children.length;\r\n  }\r\n\r\n  flatten(r: IFlatColumn[], offset: number, levelsToGo = 0, padding = 0) {\r\n    let w = 0;\r\n    //no more levels or just this one\r\n    if (levelsToGo === 0 || levelsToGo <= Column.FLAT_ALL_COLUMNS) {\r\n      w = this.getWidth();\r\n      r.push({col: this, offset, width: w});\r\n      if (levelsToGo === 0) {\r\n        return w;\r\n      }\r\n    }\r\n    //push children\r\n    this._children.forEach((c) => {\r\n      if (c.isVisible() && levelsToGo <= Column.FLAT_ALL_COLUMNS) {\r\n        c.flatten(r, offset, levelsToGo - 1, padding);\r\n      }\r\n    });\r\n    return w;\r\n  }\r\n\r\n  dump(toDescRef: (desc: any) => any) {\r\n    const r = super.dump(toDescRef);\r\n    r.children = this._children.map((d) => d.dump(toDescRef));\r\n    return r;\r\n  }\r\n\r\n  restore(dump: any, factory: (dump: any) => Column | null) {\r\n    dump.children.map((child: any) => {\r\n      const c = factory(child);\r\n      if (c) {\r\n        this.push(c);\r\n      }\r\n    });\r\n    super.restore(dump, factory);\r\n  }\r\n\r\n  /**\r\n   * inserts a column at a the given position\r\n   * @param col\r\n   * @param index\r\n   * @returns {any}\r\n   */\r\n  insert(col: Column, index: number): Column | null {\r\n    if (!isNumberColumn(col) && this.canJustAddNumbers) { //indicator it is a number type\r\n      return null;\r\n    }\r\n    this._children.splice(index, 0, col);\r\n    //listen and propagate events\r\n    return this.insertImpl(col, index);\r\n  }\r\n\r\n  move(col: Column, index: number): Column | null {\r\n    if (col.parent !== this) { //not moving\r\n      return null;\r\n    }\r\n    const old = this._children.indexOf(col);\r\n    if (index === old) {\r\n      // no move needed\r\n      return col;\r\n    }\r\n    //delete first\r\n    this._children.splice(old, 1);\r\n    // adapt target index based on previous index, i.e shift by one\r\n    this._children.splice(old < index ? index - 1 : index, 0, col);\r\n    //listen and propagate events\r\n    return this.moveImpl(col, index, old);\r\n  }\r\n\r\n  protected insertImpl(col: Column, index: number) {\r\n    col.attach(this);\r\n    this.forward(col, ...suffix('.combine', Column.EVENT_DIRTY_HEADER, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY, CompositeColumn.EVENT_FILTER_CHANGED, Column.EVENT_RENDERER_TYPE_CHANGED, Column.EVENT_GROUP_RENDERER_TYPE_CHANGED));\r\n    this.fire([CompositeColumn.EVENT_ADD_COLUMN, Column.EVENT_DIRTY_HEADER, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY], col, index);\r\n    return col;\r\n  }\r\n\r\n  protected moveImpl(col: Column, index: number, oldIndex: number) {\r\n    this.fire([CompositeColumn.EVENT_MOVE_COLUMN, Column.EVENT_DIRTY_HEADER, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY, Column.EVENT_RENDERER_TYPE_CHANGED, Column.EVENT_GROUP_RENDERER_TYPE_CHANGED], col, index, oldIndex);\r\n    return col;\r\n  }\r\n\r\n  push(col: Column) {\r\n    return this.insert(col, this._children.length);\r\n  }\r\n\r\n  at(index: number) {\r\n    return this._children[index];\r\n  }\r\n\r\n  indexOf(col: Column) {\r\n    return this._children.indexOf(col);\r\n  }\r\n\r\n  insertAfter(col: Column, ref: Column) {\r\n    const i = this.indexOf(ref);\r\n    if (i < 0) {\r\n      return null;\r\n    }\r\n    return this.insert(col, i + 1);\r\n  }\r\n\r\n  moveAfter(col: Column, ref: Column) {\r\n    const i = this.indexOf(ref);\r\n    if (i < 0) {\r\n      return null;\r\n    }\r\n    return this.move(col, i + 1);\r\n  }\r\n\r\n\r\n  remove(col: Column) {\r\n    const i = this._children.indexOf(col);\r\n    if (i < 0) {\r\n      return false;\r\n    }\r\n    this._children.splice(i, 1); //remove and deregister listeners\r\n    return this.removeImpl(col, i);\r\n  }\r\n\r\n  protected removeImpl(col: Column, index: number) {\r\n    col.detach();\r\n    this.unforward(col, ...suffix('.combine', Column.EVENT_DIRTY_HEADER, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY, CompositeColumn.EVENT_FILTER_CHANGED));\r\n    const events = [CompositeColumn.EVENT_REMOVE_COLUMN, Column.EVENT_DIRTY_HEADER, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY];\r\n    if (col.isFiltered()) {\r\n      events.splice(1, 0, CompositeColumn.EVENT_FILTER_CHANGED);\r\n    }\r\n    this.fire(events, col, index);\r\n    return true;\r\n  }\r\n\r\n  isFiltered() {\r\n    return this._children.some((d) => d.isFiltered());\r\n  }\r\n\r\n  filter(row: IDataRow) {\r\n    return this._children.every((d) => d.filter(row));\r\n  }\r\n\r\n  isLoaded(): boolean {\r\n    return this._children.every((c) => !(c instanceof ValueColumn || c instanceof CompositeColumn) || (<ValueColumn<any> | CompositeColumn>c).isLoaded());\r\n  }\r\n\r\n  get canJustAddNumbers() {\r\n    return false;\r\n  }\r\n}\r\n\r\nexport interface IMultiLevelColumn extends CompositeColumn {\r\n  getCollapsed(): boolean;\r\n\r\n  setCollapsed(value: boolean): void;\r\n}\r\n","import {LazyBoxPlotData} from '../internal';\r\nimport {IOrderedGroup} from './Group';\r\nimport {IDataRow, IGroup, IGroupParent} from './interfaces';\r\nimport INumberColumn, {numberCompare} from './INumberColumn';\r\n\r\n\r\n/** @internal */\r\nexport function patternFunction(pattern: string, ...args: string[]) {\r\n  return new Function('value', ...args, `\r\n  const escapedValue = encodeURIComponent(String(value));\r\n  return \\`${pattern}\\`;\r\n `);\r\n}\r\n\r\n\r\n/** @internal */\r\nexport function joinGroups(groups: IGroup[]): IGroup {\r\n  console.assert(groups.length > 0);\r\n  if (groups.length === 1) {\r\n    return groups[0];\r\n  }\r\n  // create a chain\r\n  const parents: IGroupParent[] = groups.map((g) => Object.assign({subGroups: []}, g));\r\n  parents.slice(1).forEach((g, i) => {\r\n    g.parent = parents[i];\r\n    parents[i].subGroups.push(g);\r\n  });\r\n  const g = {\r\n    name: parents.map((d) => d.name).join('  '),\r\n    color: parents[0].color,\r\n    parent: parents[parents.length - 1]\r\n  };\r\n  g.parent.subGroups.push(g);\r\n  return g;\r\n}\r\n\r\n/** @internal */\r\nexport function toGroupID(group: IGroup) {\r\n  return group.name;\r\n}\r\n\r\n/** @internal */\r\nexport function unifyParents<T extends IOrderedGroup>(groups: T[]) {\r\n  if (groups.length <= 1) {\r\n    return;\r\n  }\r\n  const lookup = new Map<string, IGroupParent>();\r\n\r\n  const resolve = (g: IGroupParent): { g: IGroupParent, id: string } => {\r\n    let id = g.name;\r\n    if (g.parent) {\r\n      const parent = resolve(g.parent);\r\n      g.parent = parent.g;\r\n      id = `${parent.id}.$[id}`;\r\n    }\r\n    // ensure there is only one instance per id (i.e. share common parents\r\n    if (lookup.has(id)) {\r\n      return {g: lookup.get(id)!, id};\r\n    }\r\n    if (g.parent) {\r\n      g.parent.subGroups.push(g);\r\n    }\r\n    g.subGroups = []; // clear old children\r\n    lookup.set(id, g);\r\n    return {g, id};\r\n  };\r\n  // resolve just parents\r\n  groups.forEach((g) => {\r\n    if (g.parent) {\r\n      g.parent = resolve(g.parent).g;\r\n      g.parent.subGroups.push(g);\r\n    }\r\n  });\r\n}\r\n\r\n// based on https://github.com/d3/d3-scale-chromatic#d3-scale-chromatic\r\nconst schemeCategory10 = ['#1f77b4', '#ff7f0e', '#2ca02c', '#d62728', '#9467bd', '#8c564b', '#e377c2', '#7f7f7f', '#bcbd22', '#17becf'];\r\nconst set3 = ['#8dd3c7', '#ffffb3', '#bebada', '#fb8072', '#80b1d3', '#fdb462', '#b3de69', '#fccde5', '#d9d9d9', '#bc80bd', '#ccebc5', '#ffed6f'];\r\nconst colors = schemeCategory10.concat(set3);\r\n\r\n/** @internal */\r\nexport function colorPool() {\r\n  let act = 0;\r\n  return () => colors[(act++) % colors.length];\r\n}\r\n\r\n\r\n/** @internal */\r\nexport function medianIndex(rows: IDataRow[], col: INumberColumn): number {\r\n  //return the median row\r\n  const data = rows.map((r, i) => ({i, v: col.getNumber(r), m: col.isMissing(r)}));\r\n  const sorted = data.filter((r) => !r.m).sort((a, b) => numberCompare(a.v, b.v));\r\n  const index = sorted[Math.floor(sorted.length / 2.0)];\r\n  if (index === undefined) {\r\n    return 0; //error case\r\n  }\r\n  return index.i;\r\n}\r\n\r\n/** @internal */\r\nexport function groupCompare(a: IDataRow[], b: IDataRow[], col: INumberColumn, sortMethod: keyof LazyBoxPlotData) {\r\n  const va = new LazyBoxPlotData(a.map((row) => col.getNumber(row)));\r\n  const vb = new LazyBoxPlotData(b.map((row) => col.getNumber(row)));\r\n\r\n  return numberCompare(<number>va[sortMethod], <number>vb[sortMethod]);\r\n}\r\n\r\n\r\n","import {interpolateRgbBasis} from \"d3-interpolate\";\n\nexport default function(scheme) {\n  return interpolateRgbBasis(scheme[scheme.length - 1]);\n}\n","import colors from \"../colors.js\";\nimport ramp from \"../ramp.js\";\n\nexport var scheme = new Array(3).concat(\n  \"deebf79ecae13182bd\",\n  \"eff3ffbdd7e76baed62171b5\",\n  \"eff3ffbdd7e76baed63182bd08519c\",\n  \"eff3ffc6dbef9ecae16baed63182bd08519c\",\n  \"eff3ffc6dbef9ecae16baed64292c62171b5084594\",\n  \"f7fbffdeebf7c6dbef9ecae16baed64292c62171b5084594\",\n  \"f7fbffdeebf7c6dbef9ecae16baed64292c62171b508519c08306b\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors.js\";\nimport ramp from \"../ramp.js\";\n\nexport var scheme = new Array(3).concat(\n  \"e5f5e0a1d99b31a354\",\n  \"edf8e9bae4b374c476238b45\",\n  \"edf8e9bae4b374c47631a354006d2c\",\n  \"edf8e9c7e9c0a1d99b74c47631a354006d2c\",\n  \"edf8e9c7e9c0a1d99b74c47641ab5d238b45005a32\",\n  \"f7fcf5e5f5e0c7e9c0a1d99b74c47641ab5d238b45005a32\",\n  \"f7fcf5e5f5e0c7e9c0a1d99b74c47641ab5d238b45006d2c00441b\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors.js\";\nimport ramp from \"../ramp.js\";\n\nexport var scheme = new Array(3).concat(\n  \"f0f0f0bdbdbd636363\",\n  \"f7f7f7cccccc969696525252\",\n  \"f7f7f7cccccc969696636363252525\",\n  \"f7f7f7d9d9d9bdbdbd969696636363252525\",\n  \"f7f7f7d9d9d9bdbdbd969696737373525252252525\",\n  \"fffffff0f0f0d9d9d9bdbdbd969696737373525252252525\",\n  \"fffffff0f0f0d9d9d9bdbdbd969696737373525252252525000000\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors.js\";\nimport ramp from \"../ramp.js\";\n\nexport var scheme = new Array(3).concat(\n  \"fee6cefdae6be6550d\",\n  \"feeddefdbe85fd8d3cd94701\",\n  \"feeddefdbe85fd8d3ce6550da63603\",\n  \"feeddefdd0a2fdae6bfd8d3ce6550da63603\",\n  \"feeddefdd0a2fdae6bfd8d3cf16913d948018c2d04\",\n  \"fff5ebfee6cefdd0a2fdae6bfd8d3cf16913d948018c2d04\",\n  \"fff5ebfee6cefdd0a2fdae6bfd8d3cf16913d94801a636037f2704\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors.js\";\nimport ramp from \"../ramp.js\";\n\nexport var scheme = new Array(3).concat(\n  \"efedf5bcbddc756bb1\",\n  \"f2f0f7cbc9e29e9ac86a51a3\",\n  \"f2f0f7cbc9e29e9ac8756bb154278f\",\n  \"f2f0f7dadaebbcbddc9e9ac8756bb154278f\",\n  \"f2f0f7dadaebbcbddc9e9ac8807dba6a51a34a1486\",\n  \"fcfbfdefedf5dadaebbcbddc9e9ac8807dba6a51a34a1486\",\n  \"fcfbfdefedf5dadaebbcbddc9e9ac8807dba6a51a354278f3f007d\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors.js\";\nimport ramp from \"../ramp.js\";\n\nexport var scheme = new Array(3).concat(\n  \"fee0d2fc9272de2d26\",\n  \"fee5d9fcae91fb6a4acb181d\",\n  \"fee5d9fcae91fb6a4ade2d26a50f15\",\n  \"fee5d9fcbba1fc9272fb6a4ade2d26a50f15\",\n  \"fee5d9fcbba1fc9272fb6a4aef3b2ccb181d99000d\",\n  \"fff5f0fee0d2fcbba1fc9272fb6a4aef3b2ccb181d99000d\",\n  \"fff5f0fee0d2fcbba1fc9272fb6a4aef3b2ccb181da50f1567000d\"\n).map(colors);\n\nexport default ramp(scheme);\n","export var deg2rad = Math.PI / 180;\nexport var rad2deg = 180 / Math.PI;\n","import define, {extend} from \"./define.js\";\nimport {Color, rgbConvert, Rgb, darker, brighter} from \"./color.js\";\nimport {deg2rad, rad2deg} from \"./math.js\";\n\nvar A = -0.14861,\n    B = +1.78277,\n    C = -0.29227,\n    D = -0.90649,\n    E = +1.97294,\n    ED = E * D,\n    EB = E * B,\n    BC_DA = B * C - D * A;\n\nfunction cubehelixConvert(o) {\n  if (o instanceof Cubehelix) return new Cubehelix(o.h, o.s, o.l, o.opacity);\n  if (!(o instanceof Rgb)) o = rgbConvert(o);\n  var r = o.r / 255,\n      g = o.g / 255,\n      b = o.b / 255,\n      l = (BC_DA * b + ED * r - EB * g) / (BC_DA + ED - EB),\n      bl = b - l,\n      k = (E * (g - l) - C * bl) / D,\n      s = Math.sqrt(k * k + bl * bl) / (E * l * (1 - l)), // NaN if l=0 or l=1\n      h = s ? Math.atan2(k, bl) * rad2deg - 120 : NaN;\n  return new Cubehelix(h < 0 ? h + 360 : h, s, l, o.opacity);\n}\n\nexport default function cubehelix(h, s, l, opacity) {\n  return arguments.length === 1 ? cubehelixConvert(h) : new Cubehelix(h, s, l, opacity == null ? 1 : opacity);\n}\n\nexport function Cubehelix(h, s, l, opacity) {\n  this.h = +h;\n  this.s = +s;\n  this.l = +l;\n  this.opacity = +opacity;\n}\n\ndefine(Cubehelix, cubehelix, extend(Color, {\n  brighter: function(k) {\n    k = k == null ? brighter : Math.pow(brighter, k);\n    return new Cubehelix(this.h, this.s, this.l * k, this.opacity);\n  },\n  darker: function(k) {\n    k = k == null ? darker : Math.pow(darker, k);\n    return new Cubehelix(this.h, this.s, this.l * k, this.opacity);\n  },\n  rgb: function() {\n    var h = isNaN(this.h) ? 0 : (this.h + 120) * deg2rad,\n        l = +this.l,\n        a = isNaN(this.s) ? 0 : this.s * l * (1 - l),\n        cosh = Math.cos(h),\n        sinh = Math.sin(h);\n    return new Rgb(\n      255 * (l + a * (A * cosh + B * sinh)),\n      255 * (l + a * (C * cosh + D * sinh)),\n      255 * (l + a * (E * cosh)),\n      this.opacity\n    );\n  }\n}));\n","import {cubehelix as colorCubehelix} from \"d3-color\";\nimport color, {hue} from \"./color.js\";\n\nfunction cubehelix(hue) {\n  return (function cubehelixGamma(y) {\n    y = +y;\n\n    function cubehelix(start, end) {\n      var h = hue((start = colorCubehelix(start)).h, (end = colorCubehelix(end)).h),\n          s = color(start.s, end.s),\n          l = color(start.l, end.l),\n          opacity = color(start.opacity, end.opacity);\n      return function(t) {\n        start.h = h(t);\n        start.s = s(t);\n        start.l = l(Math.pow(t, y));\n        start.opacity = opacity(t);\n        return start + \"\";\n      };\n    }\n\n    cubehelix.gamma = cubehelixGamma;\n\n    return cubehelix;\n  })(1);\n}\n\nexport default cubehelix(hue);\nexport var cubehelixLong = cubehelix(color);\n","import {cubehelix} from \"d3-color\";\nimport {interpolateCubehelixLong} from \"d3-interpolate\";\n\nexport var warm = interpolateCubehelixLong(cubehelix(-100, 0.75, 0.35), cubehelix(80, 1.50, 0.8));\n\nexport var cool = interpolateCubehelixLong(cubehelix(260, 0.75, 0.35), cubehelix(80, 1.50, 0.8));\n\nvar c = cubehelix();\n\nexport default function(t) {\n  if (t < 0 || t > 1) t -= Math.floor(t);\n  var ts = Math.abs(t - 0.5);\n  c.h = 360 * t - 100;\n  c.s = 1.5 - 1.5 * ts;\n  c.l = 0.8 - 0.9 * ts;\n  return c + \"\";\n}\n","import {cubehelix} from \"d3-color\";\nimport {interpolateCubehelixLong} from \"d3-interpolate\";\n\nexport default interpolateCubehelixLong(cubehelix(300, 0.5, 0.0), cubehelix(-240, 0.5, 1.0));\n","import colors from \"../colors.js\";\n\nfunction ramp(range) {\n  var n = range.length;\n  return function(t) {\n    return range[Math.max(0, Math.min(n - 1, Math.floor(t * n)))];\n  };\n}\n\nexport default ramp(colors(\"44015444025645045745055946075a46085c460a5d460b5e470d60470e6147106347116447136548146748166848176948186a481a6c481b6d481c6e481d6f481f70482071482173482374482475482576482677482878482979472a7a472c7a472d7b472e7c472f7d46307e46327e46337f463480453581453781453882443983443a83443b84433d84433e85423f854240864241864142874144874045884046883f47883f48893e49893e4a893e4c8a3d4d8a3d4e8a3c4f8a3c508b3b518b3b528b3a538b3a548c39558c39568c38588c38598c375a8c375b8d365c8d365d8d355e8d355f8d34608d34618d33628d33638d32648e32658e31668e31678e31688e30698e306a8e2f6b8e2f6c8e2e6d8e2e6e8e2e6f8e2d708e2d718e2c718e2c728e2c738e2b748e2b758e2a768e2a778e2a788e29798e297a8e297b8e287c8e287d8e277e8e277f8e27808e26818e26828e26828e25838e25848e25858e24868e24878e23888e23898e238a8d228b8d228c8d228d8d218e8d218f8d21908d21918c20928c20928c20938c1f948c1f958b1f968b1f978b1f988b1f998a1f9a8a1e9b8a1e9c891e9d891f9e891f9f881fa0881fa1881fa1871fa28720a38620a48621a58521a68522a78522a88423a98324aa8325ab8225ac8226ad8127ad8128ae8029af7f2ab07f2cb17e2db27d2eb37c2fb47c31b57b32b67a34b67935b77937b87838b9773aba763bbb753dbc743fbc7340bd7242be7144bf7046c06f48c16e4ac16d4cc26c4ec36b50c46a52c56954c56856c66758c7655ac8645cc8635ec96260ca6063cb5f65cb5e67cc5c69cd5b6ccd5a6ece5870cf5773d05675d05477d1537ad1517cd2507fd34e81d34d84d44b86d54989d5488bd6468ed64590d74393d74195d84098d83e9bd93c9dd93ba0da39a2da37a5db36a8db34aadc32addc30b0dd2fb2dd2db5de2bb8de29bade28bddf26c0df25c2df23c5e021c8e020cae11fcde11dd0e11cd2e21bd5e21ad8e219dae319dde318dfe318e2e418e5e419e7e419eae51aece51befe51cf1e51df4e61ef6e620f8e621fbe723fde725\"));\n\nexport var magma = ramp(colors(\"00000401000501010601010802010902020b02020d03030f03031204041405041606051806051a07061c08071e0907200a08220b09240c09260d0a290e0b2b100b2d110c2f120d31130d34140e36150e38160f3b180f3d19103f1a10421c10441d11471e114920114b21114e22115024125325125527125829115a2a115c2c115f2d11612f116331116533106734106936106b38106c390f6e3b0f703d0f713f0f72400f74420f75440f764510774710784910784a10794c117a4e117b4f127b51127c52137c54137d56147d57157e59157e5a167e5c167f5d177f5f187f601880621980641a80651a80671b80681c816a1c816b1d816d1d816e1e81701f81721f817320817521817621817822817922827b23827c23827e24828025828125818326818426818627818827818928818b29818c29818e2a81902a81912b81932b80942c80962c80982d80992d809b2e7f9c2e7f9e2f7fa02f7fa1307ea3307ea5317ea6317da8327daa337dab337cad347cae347bb0357bb2357bb3367ab5367ab73779b83779ba3878bc3978bd3977bf3a77c03a76c23b75c43c75c53c74c73d73c83e73ca3e72cc3f71cd4071cf4070d0416fd2426fd3436ed5446dd6456cd8456cd9466bdb476adc4869de4968df4a68e04c67e24d66e34e65e44f64e55064e75263e85362e95462ea5661eb5760ec5860ed5a5fee5b5eef5d5ef05f5ef1605df2625df2645cf3655cf4675cf4695cf56b5cf66c5cf66e5cf7705cf7725cf8745cf8765cf9785df9795df97b5dfa7d5efa7f5efa815ffb835ffb8560fb8761fc8961fc8a62fc8c63fc8e64fc9065fd9266fd9467fd9668fd9869fd9a6afd9b6bfe9d6cfe9f6dfea16efea36ffea571fea772fea973feaa74feac76feae77feb078feb27afeb47bfeb67cfeb77efeb97ffebb81febd82febf84fec185fec287fec488fec68afec88cfeca8dfecc8ffecd90fecf92fed194fed395fed597fed799fed89afdda9cfddc9efddea0fde0a1fde2a3fde3a5fde5a7fde7a9fde9aafdebacfcecaefceeb0fcf0b2fcf2b4fcf4b6fcf6b8fcf7b9fcf9bbfcfbbdfcfdbf\"));\n\nexport var inferno = ramp(colors(\"00000401000501010601010802010a02020c02020e03021004031204031405041706041907051b08051d09061f0a07220b07240c08260d08290e092b10092d110a30120a32140b34150b37160b39180c3c190c3e1b0c411c0c431e0c451f0c48210c4a230c4c240c4f260c51280b53290b552b0b572d0b592f0a5b310a5c320a5e340a5f3609613809623909633b09643d09653e0966400a67420a68440a68450a69470b6a490b6a4a0c6b4c0c6b4d0d6c4f0d6c510e6c520e6d540f6d550f6d57106e59106e5a116e5c126e5d126e5f136e61136e62146e64156e65156e67166e69166e6a176e6c186e6d186e6f196e71196e721a6e741a6e751b6e771c6d781c6d7a1d6d7c1d6d7d1e6d7f1e6c801f6c82206c84206b85216b87216b88226a8a226a8c23698d23698f24699025689225689326679526679727669827669a28659b29649d29649f2a63a02a63a22b62a32c61a52c60a62d60a82e5fa92e5eab2f5ead305dae305cb0315bb1325ab3325ab43359b63458b73557b93556ba3655bc3754bd3853bf3952c03a51c13a50c33b4fc43c4ec63d4dc73e4cc83f4bca404acb4149cc4248ce4347cf4446d04545d24644d34743d44842d54a41d74b3fd84c3ed94d3dda4e3cdb503bdd513ade5238df5337e05536e15635e25734e35933e45a31e55c30e65d2fe75e2ee8602de9612bea632aeb6429eb6628ec6726ed6925ee6a24ef6c23ef6e21f06f20f1711ff1731df2741cf3761bf37819f47918f57b17f57d15f67e14f68013f78212f78410f8850ff8870ef8890cf98b0bf98c0af98e09fa9008fa9207fa9407fb9606fb9706fb9906fb9b06fb9d07fc9f07fca108fca309fca50afca60cfca80dfcaa0ffcac11fcae12fcb014fcb216fcb418fbb61afbb81dfbba1ffbbc21fbbe23fac026fac228fac42afac62df9c72ff9c932f9cb35f8cd37f8cf3af7d13df7d340f6d543f6d746f5d949f5db4cf4dd4ff4df53f4e156f3e35af3e55df2e661f2e865f2ea69f1ec6df1ed71f1ef75f1f179f2f27df2f482f3f586f3f68af4f88ef5f992f6fa96f8fb9af9fc9dfafda1fcffa4\"));\n\nexport var plasma = ramp(colors(\"0d088710078813078916078a19068c1b068d1d068e20068f2206902406912605912805922a05932c05942e05952f059631059733059735049837049938049a3a049a3c049b3e049c3f049c41049d43039e44039e46039f48039f4903a04b03a14c02a14e02a25002a25102a35302a35502a45601a45801a45901a55b01a55c01a65e01a66001a66100a76300a76400a76600a76700a86900a86a00a86c00a86e00a86f00a87100a87201a87401a87501a87701a87801a87a02a87b02a87d03a87e03a88004a88104a78305a78405a78606a68707a68808a68a09a58b0aa58d0ba58e0ca48f0da4910ea3920fa39410a29511a19613a19814a099159f9a169f9c179e9d189d9e199da01a9ca11b9ba21d9aa31e9aa51f99a62098a72197a82296aa2395ab2494ac2694ad2793ae2892b02991b12a90b22b8fb32c8eb42e8db52f8cb6308bb7318ab83289ba3388bb3488bc3587bd3786be3885bf3984c03a83c13b82c23c81c33d80c43e7fc5407ec6417dc7427cc8437bc9447aca457acb4679cc4778cc4977cd4a76ce4b75cf4c74d04d73d14e72d24f71d35171d45270d5536fd5546ed6556dd7566cd8576bd9586ada5a6ada5b69db5c68dc5d67dd5e66de5f65de6164df6263e06363e16462e26561e26660e3685fe4695ee56a5de56b5de66c5ce76e5be76f5ae87059e97158e97257ea7457eb7556eb7655ec7754ed7953ed7a52ee7b51ef7c51ef7e50f07f4ff0804ef1814df1834cf2844bf3854bf3874af48849f48948f58b47f58c46f68d45f68f44f79044f79143f79342f89441f89540f9973ff9983ef99a3efa9b3dfa9c3cfa9e3bfb9f3afba139fba238fca338fca537fca636fca835fca934fdab33fdac33fdae32fdaf31fdb130fdb22ffdb42ffdb52efeb72dfeb82cfeba2cfebb2bfebd2afebe2afec029fdc229fdc328fdc527fdc627fdc827fdca26fdcb26fccd25fcce25fcd025fcd225fbd324fbd524fbd724fad824fada24f9dc24f9dd25f8df25f8e125f7e225f7e425f6e626f6e826f5e926f5eb27f4ed27f3ee27f3f027f2f227f1f426f1f525f0f724f0f921\"));\n","import colors from \"../colors.js\";\nimport ramp from \"../ramp.js\";\n\nexport var scheme = new Array(3).concat(\n  \"ffeda0feb24cf03b20\",\n  \"ffffb2fecc5cfd8d3ce31a1c\",\n  \"ffffb2fecc5cfd8d3cf03b20bd0026\",\n  \"ffffb2fed976feb24cfd8d3cf03b20bd0026\",\n  \"ffffb2fed976feb24cfd8d3cfc4e2ae31a1cb10026\",\n  \"ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cb10026\",\n  \"ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cbd0026800026\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors.js\";\nimport ramp from \"../ramp.js\";\n\nexport var scheme = new Array(3).concat(\n  \"fff7bcfec44fd95f0e\",\n  \"ffffd4fed98efe9929cc4c02\",\n  \"ffffd4fed98efe9929d95f0e993404\",\n  \"ffffd4fee391fec44ffe9929d95f0e993404\",\n  \"ffffd4fee391fec44ffe9929ec7014cc4c028c2d04\",\n  \"ffffe5fff7bcfee391fec44ffe9929ec7014cc4c028c2d04\",\n  \"ffffe5fff7bcfee391fec44ffe9929ec7014cc4c02993404662506\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors.js\";\nimport ramp from \"../ramp.js\";\n\nexport var scheme = new Array(3).concat(\n  \"e5f5f999d8c92ca25f\",\n  \"edf8fbb2e2e266c2a4238b45\",\n  \"edf8fbb2e2e266c2a42ca25f006d2c\",\n  \"edf8fbccece699d8c966c2a42ca25f006d2c\",\n  \"edf8fbccece699d8c966c2a441ae76238b45005824\",\n  \"f7fcfde5f5f9ccece699d8c966c2a441ae76238b45005824\",\n  \"f7fcfde5f5f9ccece699d8c966c2a441ae76238b45006d2c00441b\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors.js\";\nimport ramp from \"../ramp.js\";\n\nexport var scheme = new Array(3).concat(\n  \"e0ecf49ebcda8856a7\",\n  \"edf8fbb3cde38c96c688419d\",\n  \"edf8fbb3cde38c96c68856a7810f7c\",\n  \"edf8fbbfd3e69ebcda8c96c68856a7810f7c\",\n  \"edf8fbbfd3e69ebcda8c96c68c6bb188419d6e016b\",\n  \"f7fcfde0ecf4bfd3e69ebcda8c96c68c6bb188419d6e016b\",\n  \"f7fcfde0ecf4bfd3e69ebcda8c96c68c6bb188419d810f7c4d004b\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors.js\";\nimport ramp from \"../ramp.js\";\n\nexport var scheme = new Array(3).concat(\n  \"e0f3dba8ddb543a2ca\",\n  \"f0f9e8bae4bc7bccc42b8cbe\",\n  \"f0f9e8bae4bc7bccc443a2ca0868ac\",\n  \"f0f9e8ccebc5a8ddb57bccc443a2ca0868ac\",\n  \"f0f9e8ccebc5a8ddb57bccc44eb3d32b8cbe08589e\",\n  \"f7fcf0e0f3dbccebc5a8ddb57bccc44eb3d32b8cbe08589e\",\n  \"f7fcf0e0f3dbccebc5a8ddb57bccc44eb3d32b8cbe0868ac084081\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors.js\";\nimport ramp from \"../ramp.js\";\n\nexport var scheme = new Array(3).concat(\n  \"fee8c8fdbb84e34a33\",\n  \"fef0d9fdcc8afc8d59d7301f\",\n  \"fef0d9fdcc8afc8d59e34a33b30000\",\n  \"fef0d9fdd49efdbb84fc8d59e34a33b30000\",\n  \"fef0d9fdd49efdbb84fc8d59ef6548d7301f990000\",\n  \"fff7ecfee8c8fdd49efdbb84fc8d59ef6548d7301f990000\",\n  \"fff7ecfee8c8fdd49efdbb84fc8d59ef6548d7301fb300007f0000\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors.js\";\nimport ramp from \"../ramp.js\";\n\nexport var scheme = new Array(3).concat(\n  \"ece2f0a6bddb1c9099\",\n  \"f6eff7bdc9e167a9cf02818a\",\n  \"f6eff7bdc9e167a9cf1c9099016c59\",\n  \"f6eff7d0d1e6a6bddb67a9cf1c9099016c59\",\n  \"f6eff7d0d1e6a6bddb67a9cf3690c002818a016450\",\n  \"fff7fbece2f0d0d1e6a6bddb67a9cf3690c002818a016450\",\n  \"fff7fbece2f0d0d1e6a6bddb67a9cf3690c002818a016c59014636\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors.js\";\nimport ramp from \"../ramp.js\";\n\nexport var scheme = new Array(3).concat(\n  \"ece7f2a6bddb2b8cbe\",\n  \"f1eef6bdc9e174a9cf0570b0\",\n  \"f1eef6bdc9e174a9cf2b8cbe045a8d\",\n  \"f1eef6d0d1e6a6bddb74a9cf2b8cbe045a8d\",\n  \"f1eef6d0d1e6a6bddb74a9cf3690c00570b0034e7b\",\n  \"fff7fbece7f2d0d1e6a6bddb74a9cf3690c00570b0034e7b\",\n  \"fff7fbece7f2d0d1e6a6bddb74a9cf3690c00570b0045a8d023858\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors.js\";\nimport ramp from \"../ramp.js\";\n\nexport var scheme = new Array(3).concat(\n  \"e7e1efc994c7dd1c77\",\n  \"f1eef6d7b5d8df65b0ce1256\",\n  \"f1eef6d7b5d8df65b0dd1c77980043\",\n  \"f1eef6d4b9dac994c7df65b0dd1c77980043\",\n  \"f1eef6d4b9dac994c7df65b0e7298ace125691003f\",\n  \"f7f4f9e7e1efd4b9dac994c7df65b0e7298ace125691003f\",\n  \"f7f4f9e7e1efd4b9dac994c7df65b0e7298ace125698004367001f\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors.js\";\nimport ramp from \"../ramp.js\";\n\nexport var scheme = new Array(3).concat(\n  \"fde0ddfa9fb5c51b8a\",\n  \"feebe2fbb4b9f768a1ae017e\",\n  \"feebe2fbb4b9f768a1c51b8a7a0177\",\n  \"feebe2fcc5c0fa9fb5f768a1c51b8a7a0177\",\n  \"feebe2fcc5c0fa9fb5f768a1dd3497ae017e7a0177\",\n  \"fff7f3fde0ddfcc5c0fa9fb5f768a1dd3497ae017e7a0177\",\n  \"fff7f3fde0ddfcc5c0fa9fb5f768a1dd3497ae017e7a017749006a\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors.js\";\nimport ramp from \"../ramp.js\";\n\nexport var scheme = new Array(3).concat(\n  \"edf8b17fcdbb2c7fb8\",\n  \"ffffcca1dab441b6c4225ea8\",\n  \"ffffcca1dab441b6c42c7fb8253494\",\n  \"ffffccc7e9b47fcdbb41b6c42c7fb8253494\",\n  \"ffffccc7e9b47fcdbb41b6c41d91c0225ea80c2c84\",\n  \"ffffd9edf8b1c7e9b47fcdbb41b6c41d91c0225ea80c2c84\",\n  \"ffffd9edf8b1c7e9b47fcdbb41b6c41d91c0225ea8253494081d58\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors.js\";\nimport ramp from \"../ramp.js\";\n\nexport var scheme = new Array(3).concat(\n  \"f7fcb9addd8e31a354\",\n  \"ffffccc2e69978c679238443\",\n  \"ffffccc2e69978c67931a354006837\",\n  \"ffffccd9f0a3addd8e78c67931a354006837\",\n  \"ffffccd9f0a3addd8e78c67941ab5d238443005a32\",\n  \"ffffe5f7fcb9d9f0a3addd8e78c67941ab5d238443005a32\",\n  \"ffffe5f7fcb9d9f0a3addd8e78c67941ab5d238443006837004529\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors.js\";\nimport ramp from \"../ramp.js\";\n\nexport var scheme = new Array(3).concat(\n  \"d8b365f5f5f55ab4ac\",\n  \"a6611adfc27d80cdc1018571\",\n  \"a6611adfc27df5f5f580cdc1018571\",\n  \"8c510ad8b365f6e8c3c7eae55ab4ac01665e\",\n  \"8c510ad8b365f6e8c3f5f5f5c7eae55ab4ac01665e\",\n  \"8c510abf812ddfc27df6e8c3c7eae580cdc135978f01665e\",\n  \"8c510abf812ddfc27df6e8c3f5f5f5c7eae580cdc135978f01665e\",\n  \"5430058c510abf812ddfc27df6e8c3c7eae580cdc135978f01665e003c30\",\n  \"5430058c510abf812ddfc27df6e8c3f5f5f5c7eae580cdc135978f01665e003c30\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors.js\";\nimport ramp from \"../ramp.js\";\n\nexport var scheme = new Array(3).concat(\n  \"af8dc3f7f7f77fbf7b\",\n  \"7b3294c2a5cfa6dba0008837\",\n  \"7b3294c2a5cff7f7f7a6dba0008837\",\n  \"762a83af8dc3e7d4e8d9f0d37fbf7b1b7837\",\n  \"762a83af8dc3e7d4e8f7f7f7d9f0d37fbf7b1b7837\",\n  \"762a839970abc2a5cfe7d4e8d9f0d3a6dba05aae611b7837\",\n  \"762a839970abc2a5cfe7d4e8f7f7f7d9f0d3a6dba05aae611b7837\",\n  \"40004b762a839970abc2a5cfe7d4e8d9f0d3a6dba05aae611b783700441b\",\n  \"40004b762a839970abc2a5cfe7d4e8f7f7f7d9f0d3a6dba05aae611b783700441b\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors.js\";\nimport ramp from \"../ramp.js\";\n\nexport var scheme = new Array(3).concat(\n  \"e9a3c9f7f7f7a1d76a\",\n  \"d01c8bf1b6dab8e1864dac26\",\n  \"d01c8bf1b6daf7f7f7b8e1864dac26\",\n  \"c51b7de9a3c9fde0efe6f5d0a1d76a4d9221\",\n  \"c51b7de9a3c9fde0eff7f7f7e6f5d0a1d76a4d9221\",\n  \"c51b7dde77aef1b6dafde0efe6f5d0b8e1867fbc414d9221\",\n  \"c51b7dde77aef1b6dafde0eff7f7f7e6f5d0b8e1867fbc414d9221\",\n  \"8e0152c51b7dde77aef1b6dafde0efe6f5d0b8e1867fbc414d9221276419\",\n  \"8e0152c51b7dde77aef1b6dafde0eff7f7f7e6f5d0b8e1867fbc414d9221276419\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors.js\";\nimport ramp from \"../ramp.js\";\n\nexport var scheme = new Array(3).concat(\n  \"998ec3f7f7f7f1a340\",\n  \"5e3c99b2abd2fdb863e66101\",\n  \"5e3c99b2abd2f7f7f7fdb863e66101\",\n  \"542788998ec3d8daebfee0b6f1a340b35806\",\n  \"542788998ec3d8daebf7f7f7fee0b6f1a340b35806\",\n  \"5427888073acb2abd2d8daebfee0b6fdb863e08214b35806\",\n  \"5427888073acb2abd2d8daebf7f7f7fee0b6fdb863e08214b35806\",\n  \"2d004b5427888073acb2abd2d8daebfee0b6fdb863e08214b358067f3b08\",\n  \"2d004b5427888073acb2abd2d8daebf7f7f7fee0b6fdb863e08214b358067f3b08\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors.js\";\nimport ramp from \"../ramp.js\";\n\nexport var scheme = new Array(3).concat(\n  \"ef8a62f7f7f767a9cf\",\n  \"ca0020f4a58292c5de0571b0\",\n  \"ca0020f4a582f7f7f792c5de0571b0\",\n  \"b2182bef8a62fddbc7d1e5f067a9cf2166ac\",\n  \"b2182bef8a62fddbc7f7f7f7d1e5f067a9cf2166ac\",\n  \"b2182bd6604df4a582fddbc7d1e5f092c5de4393c32166ac\",\n  \"b2182bd6604df4a582fddbc7f7f7f7d1e5f092c5de4393c32166ac\",\n  \"67001fb2182bd6604df4a582fddbc7d1e5f092c5de4393c32166ac053061\",\n  \"67001fb2182bd6604df4a582fddbc7f7f7f7d1e5f092c5de4393c32166ac053061\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors.js\";\nimport ramp from \"../ramp.js\";\n\nexport var scheme = new Array(3).concat(\n  \"ef8a62ffffff999999\",\n  \"ca0020f4a582bababa404040\",\n  \"ca0020f4a582ffffffbababa404040\",\n  \"b2182bef8a62fddbc7e0e0e09999994d4d4d\",\n  \"b2182bef8a62fddbc7ffffffe0e0e09999994d4d4d\",\n  \"b2182bd6604df4a582fddbc7e0e0e0bababa8787874d4d4d\",\n  \"b2182bd6604df4a582fddbc7ffffffe0e0e0bababa8787874d4d4d\",\n  \"67001fb2182bd6604df4a582fddbc7e0e0e0bababa8787874d4d4d1a1a1a\",\n  \"67001fb2182bd6604df4a582fddbc7ffffffe0e0e0bababa8787874d4d4d1a1a1a\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors.js\";\nimport ramp from \"../ramp.js\";\n\nexport var scheme = new Array(3).concat(\n  \"fc8d59ffffbf91bfdb\",\n  \"d7191cfdae61abd9e92c7bb6\",\n  \"d7191cfdae61ffffbfabd9e92c7bb6\",\n  \"d73027fc8d59fee090e0f3f891bfdb4575b4\",\n  \"d73027fc8d59fee090ffffbfe0f3f891bfdb4575b4\",\n  \"d73027f46d43fdae61fee090e0f3f8abd9e974add14575b4\",\n  \"d73027f46d43fdae61fee090ffffbfe0f3f8abd9e974add14575b4\",\n  \"a50026d73027f46d43fdae61fee090e0f3f8abd9e974add14575b4313695\",\n  \"a50026d73027f46d43fdae61fee090ffffbfe0f3f8abd9e974add14575b4313695\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors.js\";\nimport ramp from \"../ramp.js\";\n\nexport var scheme = new Array(3).concat(\n  \"fc8d59ffffbf91cf60\",\n  \"d7191cfdae61a6d96a1a9641\",\n  \"d7191cfdae61ffffbfa6d96a1a9641\",\n  \"d73027fc8d59fee08bd9ef8b91cf601a9850\",\n  \"d73027fc8d59fee08bffffbfd9ef8b91cf601a9850\",\n  \"d73027f46d43fdae61fee08bd9ef8ba6d96a66bd631a9850\",\n  \"d73027f46d43fdae61fee08bffffbfd9ef8ba6d96a66bd631a9850\",\n  \"a50026d73027f46d43fdae61fee08bd9ef8ba6d96a66bd631a9850006837\",\n  \"a50026d73027f46d43fdae61fee08bffffbfd9ef8ba6d96a66bd631a9850006837\"\n).map(colors);\n\nexport default ramp(scheme);\n","import colors from \"../colors.js\";\nimport ramp from \"../ramp.js\";\n\nexport var scheme = new Array(3).concat(\n  \"fc8d59ffffbf99d594\",\n  \"d7191cfdae61abdda42b83ba\",\n  \"d7191cfdae61ffffbfabdda42b83ba\",\n  \"d53e4ffc8d59fee08be6f59899d5943288bd\",\n  \"d53e4ffc8d59fee08bffffbfe6f59899d5943288bd\",\n  \"d53e4ff46d43fdae61fee08be6f598abdda466c2a53288bd\",\n  \"d53e4ff46d43fdae61fee08bffffbfe6f598abdda466c2a53288bd\",\n  \"9e0142d53e4ff46d43fdae61fee08be6f598abdda466c2a53288bd5e4fa2\",\n  \"9e0142d53e4ff46d43fdae61fee08bffffbfe6f598abdda466c2a53288bd5e4fa2\"\n).map(colors);\n\nexport default ramp(scheme);\n","import {interpolateBlues, interpolateGreens, interpolateGreys, interpolateOranges, interpolatePurples, interpolateReds, interpolateCool, interpolateCubehelixDefault, interpolateWarm, interpolatePlasma, interpolateMagma, interpolateViridis, interpolateInferno, interpolateYlOrRd, interpolateYlOrBr, interpolateBuGn, interpolateBuPu, interpolateGnBu, interpolateOrRd, interpolatePuBuGn, interpolatePuBu, interpolatePuRd, interpolateRdPu, interpolateYlGnBu, interpolateYlGn, interpolateRainbow, interpolateBrBG, interpolatePRGn, interpolatePiYG, interpolatePuOr, interpolateRdBu, interpolateRdGy, interpolateRdYlBu, interpolateRdYlGn, interpolateSpectral} from 'd3-scale-chromatic';\r\nimport {IMapAbleDesc} from './MappingFunction';\r\nimport Column from './Column';\r\nimport {equal} from '../internal/utils';\r\nimport {scaleLinear} from 'd3-scale';\r\n\r\nexport interface IColorMappingFunctionBase {\r\n  apply(v: number): string;\r\n\r\n  dump(): any;\r\n\r\n  clone(): IColorMappingFunction;\r\n\r\n  eq(other: IColorMappingFunction): boolean;\r\n}\r\n\r\nexport interface IInterpolateColorMappingFunction extends IColorMappingFunctionBase {\r\n  type: 'sequential'|'divergent';\r\n  name: string;\r\n}\r\n\r\nexport interface IQuantizedColorMappingFunction extends IColorMappingFunctionBase {\r\n  type: 'quantized';\r\n  base: IColorMappingFunction;\r\n  steps: number;\r\n}\r\n\r\nexport interface ISolidColorMappingFunction extends IColorMappingFunctionBase {\r\n  type: 'solid';\r\n  color: string;\r\n}\r\n\r\nexport interface ICustomColorMappingFunction extends IColorMappingFunctionBase {\r\n  type: 'custom';\r\n  entries: {value: number, color: string}[];\r\n}\r\n\r\nexport declare type IColorMappingFunction = ISolidColorMappingFunction | ICustomColorMappingFunction | IQuantizedColorMappingFunction | IInterpolateColorMappingFunction;\r\n\r\nexport class InterpolatingColorFunction implements IInterpolateColorMappingFunction {\r\n  constructor(public readonly name: string, public readonly type: 'sequential'|'divergent', public readonly apply: (v: number)=>string) {\r\n\r\n  }\r\n\r\n  dump() {\r\n    return this.name;\r\n  }\r\n\r\n  clone() {\r\n    return this; // no clone needed since not parameterized\r\n  }\r\n\r\n  eq(other: IColorMappingFunction): boolean {\r\n    return other === this;\r\n  }\r\n}\r\n\r\nexport class SolidColorFunction implements ISolidColorMappingFunction {\r\n  constructor(public readonly color: string) {\r\n\r\n  }\r\n\r\n  get type(): 'solid' {\r\n    return 'solid';\r\n  }\r\n\r\n  apply() {\r\n    return this.color;\r\n  }\r\n\r\n  dump() {\r\n    return this.color;\r\n  }\r\n\r\n  clone() {\r\n    return this; // no clone needed since not parameterized\r\n  }\r\n\r\n  eq(other: IColorMappingFunction): boolean {\r\n    return other instanceof SolidColorFunction && other.color === this.color;\r\n  }\r\n}\r\n\r\nexport class QuantizedColorFunction implements IQuantizedColorMappingFunction {\r\n  constructor(public readonly base: IColorMappingFunction, public readonly steps: number) {\r\n\r\n  }\r\n\r\n  get type(): 'quantized' {\r\n    return 'quantized';\r\n  }\r\n\r\n  apply(v: number) {\r\n    return this.base.apply(quantize(v, this.steps));\r\n  }\r\n\r\n  dump() {\r\n    return {\r\n      base: this.base.dump(),\r\n      steps: this.steps\r\n    };\r\n  }\r\n\r\n  clone(): QuantizedColorFunction {\r\n    return this; // no clone needed since not parameterized\r\n  }\r\n\r\n  eq(other: IColorMappingFunction): boolean {\r\n    return other instanceof QuantizedColorFunction && other.base.eq(this.base) && other.steps === this.steps;\r\n  }\r\n}\r\n\r\nexport class CustomColorMappingFunction implements ICustomColorMappingFunction {\r\n  private readonly scale = scaleLinear<string>();\r\n\r\n  constructor(public readonly entries: {value: number, color: string}[]) {\r\n    this.scale\r\n      .domain(entries.map((d) => d.value))\r\n      .range(entries.map((d) => d.color))\r\n      .clamp(true);\r\n  }\r\n\r\n  get type(): 'custom' {\r\n    return 'custom';\r\n  }\r\n\r\n  apply(v: number) {\r\n    return this.scale(v);\r\n  }\r\n\r\n  dump() {\r\n    return this.entries;\r\n  }\r\n\r\n  clone() {\r\n    return new CustomColorMappingFunction(this.entries);\r\n  }\r\n\r\n  eq(other: IColorMappingFunction): boolean {\r\n    return other instanceof CustomColorMappingFunction && equal(this.entries, other.entries);\r\n  }\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport function quantize(v: number, steps: number) {\r\n  const perStep = 1 / steps;\r\n  if (v <= perStep) {\r\n    return 0;\r\n  }\r\n  if (v >= (1 - perStep)) {\r\n    return 1;\r\n  }\r\n  for (let acc = 0; acc < 1; acc += perStep) {\r\n    if (v < acc) {\r\n      return acc - perStep / 2; // center\r\n    }\r\n  }\r\n  return v;\r\n}\r\n\r\nconst cache = new Map<string, SolidColorFunction>();\r\n\r\n/**\r\n * @internal\r\n */\r\nexport function asColorFunction(color: string) {\r\n  if (cache.has(color)) {\r\n    return cache.get(color)!;\r\n  }\r\n  const s = new SolidColorFunction(color);\r\n  cache.set(color, s);\r\n  return s;\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport const DEFAULT_COLOR_FUNCTION = asColorFunction(Column.DEFAULT_COLOR);\r\n\r\n/**\r\n * @internal\r\n */\r\nexport const sequentialColors: InterpolatingColorFunction[] = [];\r\n\r\n/**\r\n * @internal\r\n */\r\nexport const divergentColors: InterpolatingColorFunction[] = [];\r\n\r\n/**\r\n * @internal\r\n */\r\nexport const lookupInterpolatingColor = new Map<string, InterpolatingColorFunction>();\r\n\r\n{\r\n  const sequential: { [key: string]: (v: number)=>string } = {\r\n    interpolateBlues,\r\n    interpolateGreens,\r\n    interpolateGreys,\r\n    interpolateOranges,\r\n    interpolatePurples,\r\n    interpolateReds,\r\n    interpolateCool,\r\n    interpolateCubehelixDefault,\r\n    interpolateWarm,\r\n    interpolatePlasma,\r\n    interpolateMagma,\r\n    interpolateViridis,\r\n    interpolateInferno,\r\n    interpolateYlOrRd,\r\n    interpolateYlOrBr,\r\n    interpolateBuGn,\r\n    interpolateBuPu,\r\n    interpolateGnBu,\r\n    interpolateOrRd,\r\n    interpolatePuBuGn,\r\n    interpolatePuBu,\r\n    interpolatePuRd,\r\n    interpolateRdPu,\r\n    interpolateYlGnBu,\r\n    interpolateYlGn,\r\n    interpolateRainbow\r\n  };\r\n  const divergent: { [key: string]: (v: number)=>string } = {\r\n    interpolateBrBG,\r\n    interpolatePRGn,\r\n    interpolatePiYG,\r\n    interpolatePuOr,\r\n    interpolateRdBu,\r\n    interpolateRdGy,\r\n    interpolateRdYlBu,\r\n    interpolateRdYlGn,\r\n    interpolateSpectral\r\n  };\r\n  for (const key of Object.keys(sequential)) {\r\n    sequentialColors.push(new InterpolatingColorFunction(key, 'sequential', sequential[key]));\r\n  }\r\n  for (const key of Object.keys(divergent)) {\r\n    divergentColors.push(new InterpolatingColorFunction(key, 'divergent', divergent[key]));\r\n  }\r\n\r\n  for (const col of sequentialColors) {\r\n    lookupInterpolatingColor.set(col.name, col);\r\n  }\r\n  for (const col of divergentColors) {\r\n    lookupInterpolatingColor.set(col.name, col);\r\n  }\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport function createColorMappingFunction(dump: any): IColorMappingFunction {\r\n  if (!dump) {\r\n    return DEFAULT_COLOR_FUNCTION;\r\n  }\r\n  if (typeof dump === 'string') {\r\n    const s = lookupInterpolatingColor.get(dump);\r\n    if (s) {\r\n      return s;\r\n    }\r\n    return asColorFunction(dump);\r\n  }\r\n  if (typeof dump === 'function') {\r\n    return new InterpolatingColorFunction('custom', 'sequential', dump);\r\n  }\r\n  if (dump.base && dump.steps) {\r\n    return new QuantizedColorFunction(createColorMappingFunction(dump.base), dump.steps);\r\n  }\r\n  if (Array.isArray(dump)) {\r\n    return new CustomColorMappingFunction(dump);\r\n  }\r\n  return DEFAULT_COLOR_FUNCTION;\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport function restoreColorMapping(desc: IMapAbleDesc): IColorMappingFunction {\r\n  if (desc.colorMapping) {\r\n    return createColorMappingFunction(desc.colorMapping);\r\n  }\r\n  if (desc.color) {\r\n    console.warn('The property `color` in the column description is deprecated and will not work in an upcoming LineUp release. Use the property `colorMapping` instead.');\r\n    return createColorMappingFunction(desc.color);\r\n  }\r\n  return DEFAULT_COLOR_FUNCTION;\r\n}\r\n","import {LazyBoxPlotData} from '../internal';\r\nimport {toolbar, SortByDefault, dialogAddons} from './annotations';\r\nimport ArrayColumn, {IArrayColumnDesc, IArrayDesc, spliceChanged} from './ArrayColumn';\r\nimport Column, {widthChanged, labelChanged, metaDataChanged, dirty, dirtyHeader, dirtyValues, rendererTypeChanged, groupRendererChanged, summaryRendererChanged, visibilityChanged} from './Column';\r\nimport ValueColumn, {dataLoaded} from './ValueColumn';\r\nimport {IDataRow} from './interfaces';\r\nimport {\r\n  compareBoxPlot, DEFAULT_FORMATTER, EAdvancedSortMethod, getBoxPlotNumber, INumberFilter, INumbersColumn,\r\n  noNumberFilter, isDummyNumberFilter, restoreNumberFilter\r\n} from './INumberColumn';\r\nimport {\r\n  createMappingFunction, IMapAbleDesc, IMappingFunction, restoreMapping,\r\n  ScaleMappingFunction\r\n} from './MappingFunction';\r\nimport {isMissingValue} from './missing';\r\nimport NumberColumn, {colorMappingChanged} from './NumberColumn';\r\nimport {IAdvancedBoxPlotData} from '../internal/math';\r\nimport {IEventListener} from '../internal/AEventDispatcher';\r\nimport {IColorMappingFunction, restoreColorMapping, createColorMappingFunction} from './ColorMappingFunction';\r\n\r\n\r\nexport interface INumbersDesc extends IArrayDesc, IMapAbleDesc {\r\n  readonly sort?: EAdvancedSortMethod;\r\n}\r\n\r\nexport declare type INumbersColumnDesc = INumbersDesc & IArrayColumnDesc<number>;\r\n\r\n/**\r\n * emitted when the mapping property changes\r\n * @asMemberOf NumbersColumn\r\n * @event\r\n */\r\nexport declare function mappingChanged(previous: IMappingFunction, current: IMappingFunction): void;\r\n\r\n/**\r\n * emitted when the sort method property changes\r\n * @asMemberOf NumbersColumn\r\n * @event\r\n */\r\nexport declare function sortMethodChanged(previous: EAdvancedSortMethod, current: EAdvancedSortMethod): void;\r\n\r\n/**\r\n * emitted when the filter property changes\r\n * @asMemberOf NumbersColumn\r\n * @event\r\n */\r\nexport declare function filterChanged(previous: INumberFilter | null, current: INumberFilter | null): void;\r\n\r\n@toolbar('filterNumber', 'colorMapped', 'editMapping')\r\n@dialogAddons('sort', 'sortNumbers')\r\n@SortByDefault('descending')\r\nexport default class NumbersColumn extends ArrayColumn<number> implements INumbersColumn {\r\n  static readonly EVENT_MAPPING_CHANGED = NumberColumn.EVENT_MAPPING_CHANGED;\r\n  static readonly EVENT_COLOR_MAPPING_CHANGED = NumberColumn.EVENT_COLOR_MAPPING_CHANGED;\r\n  static readonly EVENT_SORTMETHOD_CHANGED = NumberColumn.EVENT_SORTMETHOD_CHANGED;\r\n  static readonly EVENT_FILTER_CHANGED = NumberColumn.EVENT_FILTER_CHANGED;\r\n\r\n\r\n  static readonly CENTER = 0;\r\n\r\n  private sort: EAdvancedSortMethod;\r\n  private mapping: IMappingFunction;\r\n  private original: IMappingFunction;\r\n  private colorMapping: IColorMappingFunction;\r\n  /**\r\n   * currently active filter\r\n   * @type {{min: number, max: number}}\r\n   * @private\r\n   */\r\n  private currentFilter: INumberFilter = noNumberFilter();\r\n\r\n  constructor(id: string, desc: Readonly<INumbersColumnDesc>) {\r\n    super(id, desc);\r\n    this.mapping = restoreMapping(desc);\r\n    this.original = this.mapping.clone();\r\n    this.colorMapping = restoreColorMapping(desc);\r\n\r\n    this.sort = desc.sort || EAdvancedSortMethod.median;\r\n\r\n    // better initialize the default with based on the data length\r\n    if (this.dataLength) {\r\n      this.setDefaultWidth(Math.min(Math.max(100, this.dataLength! * 10), 500));\r\n    }\r\n    this.setDefaultRenderer('heatmap');\r\n    this.setDefaultGroupRenderer('heatmap');\r\n    this.setDefaultSummaryRenderer('histogram');\r\n  }\r\n\r\n  compare(a: IDataRow, b: IDataRow): number {\r\n    return compareBoxPlot(this, a, b);\r\n  }\r\n\r\n  getRawNumbers(row: IDataRow) {\r\n    return this.getRawValue(row);\r\n  }\r\n\r\n  getBoxPlotData(row: IDataRow): IAdvancedBoxPlotData | null {\r\n    const data = this.getRawValue(row);\r\n    if (data == null) {\r\n      return null;\r\n    }\r\n    return new LazyBoxPlotData(data, this.mapping);\r\n  }\r\n\r\n  getRange() {\r\n    return this.mapping.getRange(DEFAULT_FORMATTER);\r\n  }\r\n\r\n  getRawBoxPlotData(row: IDataRow): IAdvancedBoxPlotData | null {\r\n    const data = this.getRawValue(row);\r\n    if (data == null) {\r\n      return null;\r\n    }\r\n    return new LazyBoxPlotData(data);\r\n  }\r\n\r\n  getNumbers(row: IDataRow) {\r\n    return this.getValue(row);\r\n  }\r\n\r\n  getNumber(row: IDataRow): number {\r\n    return getBoxPlotNumber(this, row, 'normalized');\r\n  }\r\n\r\n  getRawNumber(row: IDataRow): number {\r\n    return getBoxPlotNumber(this, row, 'raw');\r\n  }\r\n\r\n  getValue(row: IDataRow) {\r\n    const values = this.getRawValue(row);\r\n    return values.map((d) => isMissingValue(d) ? NaN : this.mapping.apply(d));\r\n  }\r\n\r\n  getRawValue(row: IDataRow) {\r\n    const r = super.getValue(row);\r\n    return r == null ? [] : r;\r\n  }\r\n\r\n  getExportValue(row: IDataRow, format: 'text' | 'json'): any {\r\n    return format === 'json' ? this.getRawValue(row) : super.getExportValue(row, format);\r\n  }\r\n\r\n  getLabels(row: IDataRow) {\r\n    return this.getValue(row).map(DEFAULT_FORMATTER);\r\n  }\r\n\r\n  getSortMethod() {\r\n    return this.sort;\r\n  }\r\n\r\n  setSortMethod(sort: EAdvancedSortMethod) {\r\n    if (this.sort === sort) {\r\n      return;\r\n    }\r\n    this.fire([NumbersColumn.EVENT_SORTMETHOD_CHANGED], this.sort, this.sort = sort);\r\n    // sort by me if not already sorted by me\r\n    if (!this.isSortedByMe().asc) {\r\n      this.sortByMe();\r\n    }\r\n  }\r\n\r\n  dump(toDescRef: (desc: any) => any): any {\r\n    const r = super.dump(toDescRef);\r\n    r.sortMethod = this.getSortMethod();\r\n    r.filter = !isDummyNumberFilter(this.currentFilter) ? this.currentFilter : null;\r\n    r.map = this.mapping.dump();\r\n    r.colorMapping = this.colorMapping.dump();\r\n    return r;\r\n  }\r\n\r\n  restore(dump: any, factory: (dump: any) => Column | null) {\r\n    super.restore(dump, factory);\r\n    if (dump.sortMethod) {\r\n      this.sort = dump.sortMethod;\r\n    }\r\n    if (dump.filter) {\r\n      this.currentFilter = restoreNumberFilter(dump.filter);\r\n    }\r\n    if (dump.map) {\r\n      this.mapping = createMappingFunction(dump.map);\r\n    } else if (dump.domain) {\r\n      this.mapping = new ScaleMappingFunction(dump.domain, 'linear', dump.range || [0, 1]);\r\n    }\r\n    if (dump.colorMapping) {\r\n      this.colorMapping = createColorMappingFunction(dump.colorMapping);\r\n    }\r\n  }\r\n\r\n  protected createEventList() {\r\n    return super.createEventList().concat([NumbersColumn.EVENT_COLOR_MAPPING_CHANGED, NumbersColumn.EVENT_MAPPING_CHANGED, NumbersColumn.EVENT_SORTMETHOD_CHANGED, NumbersColumn.EVENT_FILTER_CHANGED]);\r\n  }\r\n\r\n  on(type: typeof NumbersColumn.EVENT_COLOR_MAPPING_CHANGED, listener: typeof colorMappingChanged | null): this;\r\n  on(type: typeof NumbersColumn.EVENT_MAPPING_CHANGED, listener: typeof mappingChanged | null): this;\r\n  on(type: typeof NumbersColumn.EVENT_SORTMETHOD_CHANGED, listener: typeof sortMethodChanged | null): this;\r\n  on(type: typeof NumbersColumn.EVENT_FILTER_CHANGED, listener: typeof filterChanged | null): this;\r\n  on(type: typeof ArrayColumn.EVENT_SPLICE_CHANGED, listener: typeof spliceChanged | null): this;\r\n  on(type: typeof ValueColumn.EVENT_DATA_LOADED, listener: typeof dataLoaded | null): this;\r\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\r\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\r\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\r\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\r\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\r\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\r\n  on(type: string | string[], listener: IEventListener | null): this {\r\n    return super.on(<any>type, listener);\r\n  }\r\n\r\n  getOriginalMapping() {\r\n    return this.original.clone();\r\n  }\r\n\r\n  getMapping() {\r\n    return this.mapping.clone();\r\n  }\r\n\r\n  setMapping(mapping: IMappingFunction) {\r\n    if (this.mapping.eq(mapping)) {\r\n      return;\r\n    }\r\n    this.fire([NumbersColumn.EVENT_MAPPING_CHANGED, Column.EVENT_DIRTY_HEADER, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY], this.mapping.clone(), this.mapping = mapping);\r\n  }\r\n\r\n  getColor(row: IDataRow) {\r\n    return NumberColumn.prototype.getColor.call(this, row);\r\n  }\r\n\r\n  getColorMapping() {\r\n    return this.colorMapping.clone();\r\n  }\r\n\r\n  setColorMapping(mapping: IColorMappingFunction) {\r\n    if (this.colorMapping.eq(mapping)) {\r\n      return;\r\n    }\r\n    this.fire([NumbersColumn.EVENT_COLOR_MAPPING_CHANGED, Column.EVENT_DIRTY_HEADER, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY], this.colorMapping.clone(), this.colorMapping = mapping);\r\n  }\r\n\r\n  isFiltered() {\r\n    return NumberColumn.prototype.isFiltered.call(this);\r\n  }\r\n\r\n  getFilter(): INumberFilter {\r\n    return NumberColumn.prototype.getFilter.call(this);\r\n  }\r\n\r\n  setFilter(value: INumberFilter = {min: -Infinity, max: +Infinity, filterMissing: false}) {\r\n    NumberColumn.prototype.setFilter.call(this, value);\r\n  }\r\n\r\n  filter(row: IDataRow) {\r\n    return NumberColumn.prototype.filter.call(this, row);\r\n  }\r\n}\r\n\r\n","import {uniqueId} from './dialogs/utils';\r\n\r\n/** @internal */\r\nexport const filterMissingText = 'Filter rows containing missing values';\r\n\r\n/** @internal */\r\nexport function filterMissingMarkup(bakMissing: boolean, idPrefix: string) {\r\n  const id = uniqueId(idPrefix);\r\n  return `<div class=\"lu-checkbox\"><input type=\"checkbox\" ${bakMissing ? 'checked=\"checked\"' : ''} id=\"${id}\"><label for=\"${id}\" class=\"lu-filter-missing\">${filterMissingText}</label></div>`;\r\n}\r\n\r\n/** @internal */\r\nexport function filterMissingNumberMarkup(bakMissing: boolean, count: number, idPrefix: string) {\r\n  const id = uniqueId(idPrefix);\r\n  return `<div class=\"lu-checkbox\"><input type=\"checkbox\" ${bakMissing ? 'checked=\"checked\"' : ''} ${count === 0 ? 'disabled' : ''} id=\"${id}\"><label for=\"${id}\" class=\"lu-filter-missing\" ${count === 0 ? 'class=\"lu-disabled\"' : ''}>Filter ${count} missing value rows</label></div>`;\r\n}\r\n\r\nexport function findFilterMissing(node: HTMLElement) {\r\n  return <HTMLInputElement>(<HTMLElement>node.querySelector('.lu-filter-missing')).previousElementSibling;\r\n}\r\n\r\n/** @internal */\r\nexport function updateFilterMissingNumberMarkup(element: HTMLElement, count: number) {\r\n  const checked = element.querySelector('input')!;\r\n  checked.disabled = (count === 0 && !checked.checked); // disable checkbox only if there are no missing values and the checkbox is unchecked (i.e., assumes that the checkbox is unchecked at the beginning)\r\n  element.lastElementChild!.classList.toggle('lu-disabled', checked.disabled);\r\n  element.lastElementChild!.textContent = `Filter ${count} missing value rows`;\r\n}\r\n","/*! lineupengine - v1.1.2 - 2018\n* https://sgratzl.github.io/lineupengine/\n* Copyright (c) 2018 Samuel Gratzl; Licensed MIT*/\n!function(t,e){\"object\"==typeof exports&&\"object\"==typeof module?module.exports=e():\"function\"==typeof define&&define.amd?define([],e):\"object\"==typeof exports?exports.lineupengine=e():t.lineupengine=e()}(window,function(){return function(t){var e={};function i(o){if(e[o])return e[o].exports;var n=e[o]={i:o,l:!1,exports:{}};return t[o].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=t,i.c=e,i.d=function(t,e,o){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},i.r=function(t){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(t,\"__esModule\",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&\"object\"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(i.r(o),Object.defineProperty(o,\"default\",{enumerable:!0,value:t}),2&e&&\"string\"!=typeof t)for(var n in t)i.d(o,n,function(e){return t[e]}.bind(null,n));return o},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,\"a\",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p=\"\",i(i.s=2)}([,function(t,e){},function(t,e,i){\"use strict\";i.r(e);\n/*! *****************************************************************************\nCopyright (c) Microsoft Corporation. All rights reserved.\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\nthis file except in compliance with the License. You may obtain a copy of the\nLicense at http://www.apache.org/licenses/LICENSE-2.0\n\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\nMERCHANTABLITY OR NON-INFRINGEMENT.\n\nSee the Apache Version 2.0 License for specific language governing permissions\nand limitations under the License.\n***************************************************************************** */\nvar o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};function n(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}var r=Symbol(\"aborted\");function s(t){return{then:function(e){var i,o=null,n=function(){return null===o},s=new Promise(function(t){return o=t}),a=t.then(function(t){return n()?r:Promise.resolve(e(t)).then(function(t){return n()?r:t})}),l=Promise.race([s,a]);return(i={abort:function(){null!==o&&(o(r),o=null)},then:l.then.bind(l),catch:l.catch.bind(l)})[Symbol.toStringTag]=l[Symbol.toStringTag],i}}}function a(t){return void 0!==t&&null!==t&&t&&\"function\"==typeof t.then&&\"function\"==typeof t.abort}var l,h=function(){function t(t,e){var i=this;this.context=t,this.key=e,this.cache=[],this.lastFilled=0,this.key2index=new Map,this.context.exceptions.forEach(function(t){i.cache[t.index]=t.y,i.key2index.set(e(t.index),t.index)})}return t.prototype.findValidStart=function(t){for(var e=t-1;e>=0;--e)if(void 0!==this.cache[e])return e;return-1},t.prototype.posByKey=function(t){if(this.key2index.has(t)){var e=this.key2index.get(t);return{index:e,pos:this.pos(e)}}return this.fillCacheTillKey(t)},t.prototype.pos=function(t){if(0===this.context.exceptions.length)return t*this.context.defaultRowHeight;var e=this.cache[t];if(void 0!==e)return e;var i=this.findValidStart(t);return i<0?this.fillCache(0,t,0):this.fillCache(i+1,t,this.cache[i]+this.heightOf(i)),this.cache[t]},t.prototype.fillCache=function(t,e,i,o){if(e<=this.lastFilled){if(!o)return;for(var n=t;n<=e;++n)o(n,this.key(n),this.cache[n])}else{var r=i;for(n=t;n<=e;++n){this.cache[n]=r;var s=this.key(n);this.key2index.set(s,n),o&&o(n,s,r),r+=this.heightOf(n)}}},t.prototype.heightOf=function(t){var e=this.context.exceptionsLookup;return e.has(t)?e.get(t):this.context.defaultRowHeight},t.prototype.exceptionHeightOf=function(t,e){void 0===e&&(e=!1);var i=this.context.padding(t),o=this.context.exceptionsLookup;return o.has(t)?o.get(t)-i:e?this.context.defaultRowHeight-i:null},t.prototype.padding=function(t){return this.context.padding(t)},t.prototype.fillCacheTillKey=function(t){for(var e=0,i=this.lastFilled;i<this.context.numberOfRows;++i,++this.lastFilled){var o=this.cache[i];if(void 0===o){var n=this.key(i);if(this.cache[i]=e,this.key2index.set(n,i),n===t)return{index:i,pos:e};e+=this.heightOf(i)}else e=o+this.heightOf(i)}return{index:-1,pos:-1}},t.prototype.positions=function(t,e,i,o){this.fillCache(t,e,i,o)},t}();!function(t){t[t.UPDATE=0]=\"UPDATE\",t[t.UPDATE_CREATE=1]=\"UPDATE_CREATE\",t[t.UPDATE_REMOVE=2]=\"UPDATE_REMOVE\",t[t.SHOW=3]=\"SHOW\",t[t.HIDE=4]=\"HIDE\"}(l||(l={}));var c=1;function u(t,e,i){var o=t.previous,n=t.mode,r=t.nodeY,s=t.current,a=null==o.height?e:o.height,h=null==s.height?i:s.height;return n===l.UPDATE&&Math.abs(o.y-r)<=c&&Math.abs(a-h)<=c}var d,f=[{delay:0,apply:function(t){var e=t.mode,i=t.previous,o=t.nodeY,n=t.current,r=t.node;r.dataset.animation=l[e].toLowerCase(),r.style.transform=\"translate(0, \"+(i.y-o)+\"px)\",e===l.SHOW?r.style.height=null!==n.height?n.height+\"px\":null:r.style.height=i.height+\"px\",r.style.opacity=e===l.SHOW?\"0\":e===l.HIDE?\"1\":null}},{delay:10,apply:function(t){var e=t.mode,i=t.current,o=t.nodeY,n=t.node;n.style.transform=e===l.HIDE||e===l.UPDATE_REMOVE?\"translate(0, \"+(i.y-o)+\"px)\":null,e!==l.HIDE&&(n.style.height=null!==i.height?i.height+\"px\":null),n.style.opacity=e===l.SHOW?\"1\":e===l.HIDE?\"0\":null}},{delay:1100,apply:function(t){var e=t.node;delete e.dataset.animation,e.style.opacity=null,e.style.transform=null}}],p=function(){function t(t,e,i){this.index=t,this.y=e,this.height=i}return Object.defineProperty(t.prototype,\"y2\",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),t}();function m(t,e,i){return void 0===i&&(i=0),{exceptions:[],exceptionsLookup:{keys:function(){return[].values()},get:function(){return e},has:function(){return!1},size:0},totalHeight:t*(e+=i),numberOfRows:t,defaultRowHeight:e,padding:function(){return i}}}function y(t,e,i){void 0===e&&(e=NaN),void 0===i&&(i=0);var o=new Map,n=[],r=\"function\"==typeof i?i:function(){return i};isNaN(e)&&(e=function(t){var e=new Map;if(t.forEach(function(t){e.set(t,(e.get(t)||0)+1)}),0===e.size)return 20;var i=Array.from(e).sort(function(t,e){return t[1]!==e[1]?e[1]-t[1]:t[0]-e[0]}),o=i[0][0];return 0===o?i.length>1?i[1][0]:20:o}(t)),e+=r(-1);var s=-1,a=0,l=0,h=0;return t.forEach(function(t,i){if(t+=r(i),l+=t,h++,t!==e){o.set(i,t);var c=(i-s-1)*e;s=i;var u=a+c;a=u+t,n.push(new p(i,u,t))}}),{exceptionsLookup:o,exceptions:n,totalHeight:l,defaultRowHeight:e,numberOfRows:h,padding:r}}function v(t,e,i,o,n,r){void 0===i&&(i=2),void 0===o&&(o=10*e),void 0===n&&(n=.2),void 0===r&&(r=Date.now());var s=r,a=function(){var t=1e4*Math.sin(s++);return t-Math.floor(t)};return y({forEach:function(r){for(var s=0;s<t;++s)r(a()<n?i+Math.round(a()*(o-i)):e,s)}},e)}function g(t,e,i,o,n){if(0===n)return{first:0,last:-1,firstRowPos:0,endPos:0};if(1===n)return{first:0,last:0,firstRowPos:0,endPos:0===o.length?i:o[0].y2};var r=t,s=r+e;function a(t,e){return Math.min(n-1,e+Math.max(0,Math.floor(t/i)))}function l(t,e,o){void 0===o&&(o=!1);var l=s-t,h=a(r-t,e),c=a(l,e),u=t+(h-e)*i,d=t+(c+1-e)*i;return console.assert(!o||!(u>r||d<s&&c<n-1),\"error\",o,u,d,r,s,e,t),{first:h,last:c,firstRowPos:u,endPos:d}}var h=l(0,0,!0);if(0===o.length)return h;if(h.last<o[0].index)return h;if(h.last===o[0].index&&o[0].height>i)return Object.assign(h,{endPos:o[0].y2});var c=o[o.length-1];if(r>=c.y){var u=l(c.y2,c.index+1);return r<c.y2?Object.assign(u,{first:c.index,firstRowPos:c.y}):u}for(var d=[],f=o[0],p=0,m=o;p<m.length;p++){var y=m[p],v=y.y,g=y.y2;if(v>=s)break;g<=r?f=y:d.push(y)}if(0===d.length)return l(f.y2,f.index+1);var b=d[0],x=d[d.length-1],w=Math.max(0,b.index-Math.max(0,Math.ceil((b.y-r)/i))),C=x.index;s>=x.y2&&(C=a(s-x.y2,x.index+1));var R=b.y-(b.index-w)*i,O=x.y2+(C-x.index)*i;return console.assert(R<=r&&(O>=s||C===n-1),\"error\",R,O,r,s,b,x),{first:w,last:C,firstRowPos:R,endPos:O}}function b(t,e){var i=t.length,o=e.length;if(0===i)return{added:e,removed:[],common:0};if(0===o)return{added:[],removed:t,common:0};if(i===o)return{added:[],removed:[],common:i};var n=t.slice(Math.min(o,i));return{added:e.slice(Math.min(o,i)),removed:n,common:i-n.length}}function x(t,e,i){for(var o=0===t.length?0:t[t.length-1]+1,n=[],r=[],s=t.length-1;s>=0;--s){if(!(t[s]>=i))break;r.push(t.pop())}for(s=o;s<i;++s)e[s].frozen&&(n.push(s),t.push(s));return{target:t,added:n,removed:r}}!function(t){t[t.NONE=0]=\"NONE\",t[t.ALL=1]=\"ALL\",t[t.SOME=2]=\"SOME\",t[t.SOME_BOTTOM=3]=\"SOME_BOTTOM\",t[t.SOME_TOP=4]=\"SOME_TOP\"}(d||(d={}));var w=\"animation\",C=function(){function t(t){var e=this;this.node=t,this.handlers=new Map,this.animationWaiting=!1,this.immediateTimeout=-1,this.timersWaiting=new Set,this.prevs=new Map,t.addEventListener(\"scroll\",function(){e.handle(\"sync\"),e.handleAnimation(),e.handleImmediate(),e.handleTimeouts()},{passive:!0})}return t.prototype.has=function(t){return this.handlers.has(t)&&this.handlers.get(t).length>0},t.prototype.handle=function(t){var e=this.handlers.get(t)||[];if(e&&!(e.length<=0)){var i=this.asInfo();if(this.prevs.has(t)){var o=this.prevs.get(t);if(Math.abs(i.left-o.left)+Math.abs(i.top-o.top)<4)return}this.prevs.set(t,i);for(var n=0,r=e;n<r.length;n++){(0,r[n])(i)}}},t.prototype.handleAnimation=function(){var t=this;!this.animationWaiting&&this.has(\"animation\")&&(this.animationWaiting=!0,requestAnimationFrame(function(){t.animationWaiting&&(t.animationWaiting=!1,t.handle(\"animation\"))}))},t.prototype.handleImmediate=function(){var t=this;this.immediateTimeout>=0||!this.has(\"immediate\")||(this.immediateTimeout=self.setImmediate(function(){t.immediateTimeout<0||(t.immediateTimeout=-1,t.handle(\"immediate\"))}))},t.prototype.handleTimeouts=function(){var t=this,e=Array.from(this.handlers.keys()).filter(function(e){return\"number\"==typeof e&&!t.timersWaiting.has(e)});if(0!==e.length)for(var i=function(e){o.timersWaiting.add(e),self.setTimeout(function(){t.timersWaiting.delete(e),t.handle(e)},e)},o=this,n=0,r=e;n<r.length;n++){i(r[n])}},t.prototype.asInfo=function(){return{left:this.node.scrollLeft,top:this.node.scrollTop,width:this.node.clientWidth,height:this.node.clientHeight}},t.prototype.push=function(t,e){\"immediate\"===t&&\"function\"!=typeof self.setImmediate&&(t=0),this.handlers.has(t)?this.handlers.get(t).push(e):this.handlers.set(t,[e])},t.prototype.remove=function(t){return Array.from(this.handlers.values()).some(function(e){var i=e.indexOf(t);return i>=0&&e.splice(i,1),i>=0})},t}();function R(t,e,i){t.__le_scroller__||(t.__le_scroller__=new C(t));var o=t.__le_scroller__;return o.push(e,i),o.asInfo()}var O=function(){function t(t,e){void 0===e&&(e={});var i=this;this.body=t,this.pool=[],this.loadingPool=[],this.loading=new Map,this.visible={first:0,forcedFirst:0,last:-1,forcedLast:-1},this.visibleFirstRowPos=0,this.scrollListener=null,this.abortAnimation=function(){},this.options={async:w,minScrollDelta:10,mixins:[],scrollingHint:!1,batchSize:5},this.adapter=this.createAdapter(),Object.assign(this.options,e),this.mixins=this.options.mixins.map(function(t){return new t(i.adapter)}),this.fragment=t.ownerDocument.createDocumentFragment()}return t.prototype.addMixin=function(t,e){this.mixins.push(new t(this.adapter,e))},t.prototype.createAdapter=function(){var t=this,e={visible:this.visible,addAtBeginning:this.addAtBeginning.bind(this),addAtBottom:this.addAtBottom.bind(this),removeFromBeginning:this.removeFromBeginning.bind(this),removeFromBottom:this.removeFromBottom.bind(this),updateOffset:this.updateOffset.bind(this),scroller:this.bodyScroller};return Object.defineProperties(e,{visibleFirstRowPos:{get:function(){return t.visibleFirstRowPos},enumerable:!0},context:{get:function(){return t.context},enumerable:!0}}),e},Object.defineProperty(t.prototype,\"bodyScroller\",{get:function(){return this.body.parentElement},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"bodySizer\",{get:function(){var t=this.bodyScroller,e=Array.from(t.children).find(function(t){return\"footer\"===t.tagName.toLowerCase()});if(e)return e;var i=t.ownerDocument.createElement(\"footer\");return t.insertBefore(i,t.firstChild),i},enumerable:!0,configurable:!0}),t.prototype.init=function(){var t=this,e=this.bodyScroller,i=R(e,this.options.async,this.scrollListener=function(o){if(!(Math.abs(i.top-o.top)<t.options.minScrollDelta&&Math.abs(i.height-o.height)<t.options.minScrollDelta)){var n=o.top>i.top;i=o,t.onScrolledVertically(o.top,o.height,n),t.options.scrollingHint&&e.classList.remove(\"le-scrolling\")}});this.options.scrollingHint&&R(e,\"animation\",function(){return e.classList.add(\"le-scrolling\")}),this.recreate()},t.prototype.destroy=function(){!function(t,e){t.__le_scroller__&&t.__le_scroller__.remove(e)}(this.bodyScroller,this.scrollListener),this.body.remove()},t.cleanUp=function(t){t.style.height&&(t.style.height=null)},t.prototype.select=function(t){var e,i;return this.pool.length>0?(e=this.pool.pop(),i=this.updateRow(e,t)):this.loadingPool.length>0?((e=this.loadingPool.pop()).classList.remove(\"loading\"),i=this.createRow(e,t)):(e=this.body.ownerDocument.createElement(\"div\"),i=this.createRow(e,t)),e.dataset.index=String(t),{item:e,result:i}},t.prototype.selectProxy=function(){var t;return this.loadingPool.length>0?t=this.loadingPool.pop():(t=this.body.ownerDocument.createElement(\"div\")).classList.add(\"loading\"),t},t.prototype.recycle=function(e){(t.cleanUp(e),this.loading.has(e))?this.loading.get(e).abort():this.pool.push(e)},t.prototype.proxy=function(e,i){var o=this;if(!a(i))return e;var n=i,s=e,l=this.selectProxy();return l.dataset.index=s.dataset.index,l.style.height=s.style.height,this.loading.set(l,n),n.then(function(e){e===r?(t.cleanUp(s),o.pool.push(s)):o.body.replaceChild(s,l),o.loading.delete(l),t.cleanUp(l),o.loadingPool.push(l)}),l},t.prototype.create=function(t){var e=this.select(t),i=e.item,o=e.result,n=this.context,r=n.exceptionsLookup,s=n.padding;return r.has(t)&&(i.style.height=r.get(t)-s(t)+\"px\"),this.proxy(i,o)},t.prototype.removeAll=function(){var t=this,e=Array.from(this.body.children);this.body.innerHTML=\"\",e.forEach(function(e){t.recycle(e)})},t.prototype.update=function(){var t=this,e=this.visible.first,i=this.fragment,o=Array.from(this.body.children);this.body.innerHTML=\"\",o.forEach(function(o,n){if(!t.loading.has(o)){var r=t.updateRow(o,n+e);i.appendChild(t.proxy(o,r))}}),this.body.appendChild(i)},t.prototype.forEachRow=function(t,e){var i=this;void 0===e&&(e=!1);var o=Array.from(this.body.children),n=this.fragment;e||(this.body.innerHTML=\"\"),o.forEach(function(o,r){o.classList.contains(\"loading\")||\"update_remove\"===o.dataset.animation||\"hide\"===o.dataset.animation||t(o,r+i.visible.first),e||n.appendChild(o)}),e||this.body.appendChild(n)},t.prototype.removeFromBeginning=function(t,e){return this.remove(t,e,!0)},t.prototype.removeFromBottom=function(t,e){return this.remove(t,e,!1)},t.prototype.remove=function(t,e,i){if(!(e<t))for(var o=t;o<=e;++o){var n=i?this.body.firstChild:this.body.lastChild;n.remove(),this.recycle(n)}},t.prototype.addAtBeginning=function(t,e){if(!(e<t))if(t!==e){for(var i=this.fragment,o=t;o<=e;++o)i.appendChild(this.create(o));this.body.insertBefore(i,this.body.firstChild)}else this.body.insertBefore(this.create(t),this.body.firstChild)},t.prototype.addAtBottom=function(t,e){if(!(e<t))if(t!==e){for(var i=this.fragment,o=t;o<=e;++o)i.appendChild(this.create(o));this.body.appendChild(i)}else this.body.appendChild(this.create(t))},t.prototype.updateOffset=function(t){this.visibleFirstRowPos=t,this.body.classList.toggle(\"odd\",this.visible.first%2==1),this.updateSizer(t)},t.prototype.updateSizer=function(t){var e=this.context.totalHeight;this.body.style.transform=\"translate(0, \"+t.toFixed(0)+\"px)\",this.bodySizer.style.transform=\"translate(0, \"+Math.max(0,e-1).toFixed(0)+\"px)\"},t.prototype.recreate=function(t){return this.abortAnimation(),t?this.recreateAnimated(t):this.recreatePure()},t.prototype.recreatePure=function(){var t=this.context,e=this.bodyScroller;this.updateOffset(0),this.removeAll(),this.clearPool();var i=g(e.scrollTop,e.clientHeight,t.defaultRowHeight,t.exceptions,t.numberOfRows),o=i.first,n=i.last,r=i.firstRowPos;this.visible.first=this.visible.forcedFirst=o,this.visible.last=this.visible.forcedLast=n,o<0?this.updateOffset(0):(this.addAtBottom(o,n),this.updateOffset(r))},t.prototype.recreateAnimated=function(t){var e=this,i=new Map,o=new h(t.previous,t.previousKey),n=new h(this.context,t.currentKey),r=g(this.bodyScroller.scrollTop,this.bodyScroller.clientHeight,n.context.defaultRowHeight,n.context.exceptions,n.context.numberOfRows),s=Array.from(this.body.children),a=Object.assign({},this.visible);this.body.innerHTML=\"\",o.positions(a.first,Math.min(a.last,a.first+s.length),this.visibleFirstRowPos,function(t,e,o){var n=s[t];n&&i.set(e,{n:n,pos:o,i:t})}),this.visible.first=this.visible.forcedFirst=r.first,this.visible.last=this.visible.forcedLast=r.last;var c=this.fragment,u=[],d=r.firstRowPos;n.positions(r.first,r.last,r.firstRowPos,function(t,r,s){var a,h,f=l.UPDATE;if(i.has(r)){var p=i.get(r);i.delete(r),p.n.dataset.index=String(t),a=e.proxy(p.n,e.updateRow(p.n,t)),h={index:p.i,y:p.pos,height:o.exceptionHeightOf(p.i,!0)}}else{var m=o.posByKey(r);a=e.create(t),f=m.index<0?l.SHOW:l.UPDATE_CREATE,h={index:m.index,y:m.pos>=0?m.pos:s,height:m.index<0?n.exceptionHeightOf(t,!0):o.exceptionHeightOf(m.index,!0)}}u.push({node:a,key:r,mode:f,previous:h,nodeY:d,nodeYCurrentHeight:s,current:{index:t,y:s,height:n.exceptionHeightOf(t)}}),a.style.transform=\"translate(0, \"+(d-s)+\"px)\",d+=h.height+(h.index<0?n.padding(t):o.padding(h.index)),c.appendChild(a)});var p=r.endPos;i.forEach(function(t,e){var i=n.posByKey(e),r=i.pos>=0?i.pos:t.pos,s=t.n;s.style.transform=\"translate(0, \"+(t.pos-d)+\"px)\",c.appendChild(s);var a=o.exceptionHeightOf(t.i,!0);u.push({node:t.n,key:e,mode:i.index<0?l.HIDE:l.UPDATE_REMOVE,previous:{index:t.i,y:t.pos,height:a},nodeY:d,nodeYCurrentHeight:p,current:{index:i.index,y:r,height:i.index<0?null:n.exceptionHeightOf(i.index)}}),p+=i.index<0?n.context.defaultRowHeight:n.exceptionHeightOf(i.index,!0)+n.padding(i.index),d+=a+o.padding(t.i)}),this.updateOffset(r.firstRowPos),this.animate(u,t.phases||f,o,n,c)},t.prototype.animate=function(t,e,i,o,n){var r=this;if(t.length<=0)this.body.appendChild(n);else{for(var s=-1,a=0,h=function(e,n){void 0===n&&(n=t),n.forEach(function(t){return e.apply(t,i,o)})},c=function(){if(console.assert(t[0].node.offsetTop>=0,\"dummy log for forcing dom update\"),h(e[a++]),a<e.length){var i=e[a];s=self.setTimeout(c,i.delay)}else{var o=r.body.classList;Array.from(o).forEach(function(t){t.startsWith(\"le-\")&&t.endsWith(\"-animation\")&&o.remove(t)}),t.forEach(function(t){var e=t.node,i=t.mode;i!==l.UPDATE_REMOVE&&i!==l.HIDE||(e.remove(),e.style.transform=null,r.recycle(e))}),r.abortAnimation=function(){},s=-1}};0===e[a].delay;)h(e[a++]);var d=this.body;this.body.appendChild(n);var f=[];t=t.filter(function(t){return!u(t,i.context.defaultRowHeight,o.context.defaultRowHeight)||(f.push(t),!1)}),f.length>0&&e.slice(a).forEach(function(t){return h(t,f)}),0!==t.length&&(d.classList.add(\"le-row-animation\"),new Set(t.map(function(t){return t.mode})).forEach(function(t){d.classList.add(\"le-\"+l[t].toLowerCase().split(\"_\")[0]+\"-animation\")}),this.abortAnimation=function(){s<=0||(clearTimeout(s),s=-1,a=e.length-1,c())},s=self.setTimeout(c,e[a].delay))}},t.prototype.clearPool=function(){this.pool.splice(0,this.pool.length)},t.prototype.revalidate=function(){var t=this.bodyScroller;this.onScrolledVertically(t.scrollTop,t.clientHeight,!0),this.updateOffset(this.visibleFirstRowPos)},t.prototype.onScrolledVertically=function(t,e,i){var o=this.onScrolledImpl(t,e);return this.mixins.forEach(function(t){return t.onScrolled(i,o)}),o},t.prototype.shiftLast=function(t,e){if(e>=this.options.batchSize)return t;var i=this.context.numberOfRows;return Math.min(i-1,t+(this.options.batchSize-e))},t.prototype.shiftFirst=function(t,e,i){if(i>=this.options.batchSize||t<=0)return{first:t,firstRowPos:e};for(var o=Math.max(0,t-(this.options.batchSize-i)),n=this.context,r=n.exceptionsLookup,s=n.defaultRowHeight,a=e,l=o;l<t;++l)r.has(l)?a-=r.get(l):a-=s;return{first:o,firstRowPos:a}},t.prototype.onScrolledImpl=function(t,e){var i=this.context,o=g(t,e,i.defaultRowHeight,i.exceptions,i.numberOfRows),n=o.first,r=o.last,s=o.firstRowPos,a=this.visible;if(a.forcedFirst=n,a.forcedLast=r,n-a.first>=0&&r-a.last<=0)return d.NONE;var l=d.SOME;if(n>a.last||r<a.first)this.removeAll(),this.addAtBottom(n,r),l=d.ALL;else if(n<a.first){a.last-(r+1)>=this.options.batchSize?this.removeFromBottom(r+1,a.last):r=a.last;var h=this.shiftFirst(n,s,a.first-1-n);n=h.first,s=h.firstRowPos,this.addAtBeginning(n,a.first-1),l=d.SOME_TOP}else{n-1-a.first>=this.options.batchSize?this.removeFromBeginning(a.first,n-1):(n=a.first,s=this.visibleFirstRowPos),r=this.shiftLast(r,r-a.last+1),this.addAtBottom(a.last+1,r),l=d.SOME_BOTTOM}return a.first=n,a.last=r,this.updateOffset(s),l},t}(),S=O,E=function(){function t(t){this.rules=new Map,this.node=t.ownerDocument.createElement(\"style\"),t.appendChild(this.node)}return t.prototype.destroy=function(){this.node.remove()},t.prototype.updateRules=function(){this.node.innerHTML=Array.from(this.rules.values()).join(\"\\n\")},t.prototype.addRule=function(t,e,i){return void 0===i&&(i=!0),this.rules.set(t,e),i&&this.updateRules(),t},t.prototype.updateRule=function(t,e,i){return void 0===i&&(i=!0),this.rules.set(t,e),i&&this.updateRules(),t},t.prototype.deleteRule=function(t,e){void 0===e&&(e=!0),this.rules.get(t)&&e&&this.updateRules()},Object.defineProperty(t.prototype,\"ruleNames\",{get:function(){return Array.from(this.rules.keys())},enumerable:!0,configurable:!0}),t}(),P=\"\\n  <header>\\n    <article></article>\\n  </header>\\n  <main>\\n    <footer>&nbsp;</footer>\\n    <article></article>\\n  </main>\";function H(t){return t.innerHTML=P,t}function A(t,e){t.dataset.id=e.id}var M=function(t){function e(e,i){var o=t.call(this,e)||this;o.id=i;var n=e.querySelector(\"header\"),r=e.querySelector(\"main\");return self.setTimeout(function(){var t=function(t){var e=t.ownerDocument.body;e.insertAdjacentHTML(\"beforeend\",'\\n    <div class=\"lineup-engine-scrollbar-tester\"><div></div></div>\\n  ');var i=e.lastElementChild,o=i.offsetWidth-i.clientWidth,n=i.offsetHeight-i.clientHeight;return i.remove(),{width:o,height:n}}(e).width;o.updateRule(\"__scollBarFix2\",o.hashedId+\" > header > article:last-of-type {\\n        border-right: \"+t+\"px solid transparent;\\n      }\")},20),R(r,\"animation\",function(t){var i=n.scrollLeft,o=t.left;i!==o&&(n.scrollLeft=o),e.classList.toggle(\"le-shifted\",t.left>0)}),o}return n(e,t),Object.defineProperty(e.prototype,\"hashedId\",{get:function(){return this.id.startsWith(\"#\")?this.id:\"#\"+this.id},enumerable:!0,configurable:!0}),e.prototype.update=function(t,e,i,o,n){void 0===n&&(n=\"px\");var r=void 0!==o?this.tableIds(o,!0):{header:this.id+\" > header > article\",body:this.id+\" > main > article\"};this.updateRule(\"__heightsRule\"+r.body,r.body+\" > div {\\n      height: \"+t+\"px;\\n    }\",!1),this.updateColumns(e,r,i,n),this.updateRules()},e.prototype.remove=function(t){var e=this.tableIds(t,!0);this.deleteRule(\"__heightsRule\"+e.body,!1),this.deleteRule(\"__widthRule\"+e.body,!1);for(var i=\"__col\"+e.body+\"_\",o=this.ruleNames.reduce(function(t,e){return t+(e.startsWith(i)?1:0)},0),n=0;n<o;++n)this.deleteRule(\"\"+i+n,!1);this.updateRules()},e.prototype.tableIds=function(t,e){void 0===e&&(e=!1);var i=this.id.startsWith(\"#\")?this.id.slice(1):this.id;return{header:(e?\"#\":\"\")+i+\"_H\"+t,body:(e?\"#\":\"\")+i+\"_B\"+t}},e.prototype.updateColumns=function(t,e,i,o){var n=this;void 0===o&&(o=\"px\");var r=\"__col\"+e.body+\"_\",s=this.ruleNames.reduce(function(t,e){return t+(e.startsWith(r)?1:0)},0),a=0,l=0;t.forEach(function(t){var s=e.body+' > div > [data-id=\"'+t.id+'\"], '+e.header+' [data-id=\"'+t.id+'\"] {\\n        width: '+t.width+o+\";\\n        \"+(t.frozen?\"left: \"+a+\"px;\":\"\")+\"\\n      }\";if(0!==i&&t.frozen){var h=e.body+' > div > [data-id=\"'+t.id+'\"] {\\n          width: '+t.width+o+\";\\n          left: \"+(a+i)+\"px;\\n        }\";s=e.header+' [data-id=\"'+t.id+'\"] {\\n          width: '+t.width+o+\";\\n          left: \"+a+\"px;\\n        }\",n.updateRule(\"\"+r+l++,h,!1)}t.frozen&&(a+=t.width),n.updateRule(\"\"+r+l++,s,!1)});for(var h=l-1;h<s;++h)this.deleteRule(\"\"+r+h,!1)},e}(E);var F=function(){function t(t,e,i){for(var o=[],n=3;n<arguments.length;n++)o[n-3]=arguments[n];var r=this;this.header=t,this.style=e,this.tableId=i,this.cellPool=[],this.visibleColumns={frozen:[],first:0,forcedFirst:0,last:-1,forcedLast:-1},this.visibleFirstColumnPos=0,this.columnAdapter=this.createColumnAdapter(),this.columnMixins=o.map(function(t){return new t(r.columnAdapter)}),this.columnFragment=t.ownerDocument.createDocumentFragment()}return t.prototype.leftShift=function(){var t=this.context,e=this.visibleColumns.frozen.reduce(function(e,i){return e+t.columns[i].width+t.column.padding(i)},0);return this.visibleFirstColumnPos-e},Object.defineProperty(t.prototype,\"headerScroller\",{get:function(){return this.header.parentElement},enumerable:!0,configurable:!0}),t.prototype.addColumnMixin=function(t,e){this.columnMixins.push(new t(this.columnAdapter,e))},t.prototype.createColumnAdapter=function(){var t=this,e={visible:this.visibleColumns,addAtBeginning:this.addColumnAtStart.bind(this),addAtBottom:this.addColumnAtEnd.bind(this),removeFromBeginning:this.removeColumnFromStart.bind(this),removeFromBottom:this.removeColumnFromEnd.bind(this),updateOffset:this.updateColumnOffset.bind(this),scroller:this.headerScroller,syncFrozen:this.syncFrozen.bind(this)};return Object.defineProperties(e,{visibleFirstRowPos:{get:function(){return t.visibleFirstColumnPos},enumerable:!0},context:{get:function(){return t.context.column},enumerable:!0}}),e},t.prototype.init=function(){var t=this,e=this.context;this.style.update(e.defaultRowHeight-e.padding(-1),e.columns,0,this.tableId),e.columns.forEach(function(){t.cellPool.push([])})},t.prototype.onScrolledHorizontally=function(t,e,i){var o=this.onScrolledHorizontallyImpl(t,e);return this.columnMixins.forEach(function(t){return t.onScrolled(i,o)}),o},t.prototype.removeColumnFromStart=function(t,e,i){var o=this;void 0===i&&(i=this.visibleColumns.frozen.length),this.forEachRow(function(n){o.removeCellFromStart(n,t,e,i)})},t.prototype.removeCellFromStart=function(t,e,i,o){for(var n=e;n<=i;++n){var r=0===o?t.firstElementChild:t.children[o];r.remove(),this.recycleCell(r,n)}},t.prototype.removeColumnFromEnd=function(t,e){var i=this;this.forEachRow(function(o){i.removeCellFromEnd(o,t,e)})},t.prototype.removeCellFromEnd=function(t,e,i){for(var o=i;o>=e;--o){var n=t.lastElementChild;n.remove(),this.recycleCell(n,o)}},t.prototype.removeFrozenCells=function(t,e,i){for(var o=0,n=e;o<n.length;o++){var r=n[o],s=t.children[i];s.remove(),this.recycleCell(s,r)}},t.prototype.removeFrozenColumns=function(t,e){var i=this;this.forEachRow(function(o){i.removeFrozenCells(o,t,e)})},t.prototype.removeAllColumns=function(t){var e=this;this.forEachRow(function(i){e.removeAllCells(i,t)})},t.prototype.removeAllCells=function(t,e,i){var o=this;void 0===i&&(i=this.visibleColumns.first);var n=Array.from(t.children),r=this.visibleColumns.frozen;if(t.innerHTML=\"\",e||0===r.length)for(var s=0,a=r;s<a.length;s++){var l=a[s];this.recycleCell(n.shift(),l)}else for(var h=0,c=r;h<c.length;h++){c[h];t.appendChild(n.shift())}n.forEach(function(t,e){o.recycleCell(t,e+i)})},t.prototype.selectCell=function(t,e,i){var o=this.cellPool[e],n=i[e];if(o.length>0){var r=o.pop(),s=this.updateCell(r,t,n);return s&&s!==r&&A(s,n),s||r}var a=this.createCell(this.header.ownerDocument,t,n);return A(a,n),a},t.prototype.recycleCell=function(t,e){this.cellPool[e].push(t)},t.prototype.addColumnAtStart=function(t,e,i){var o=this;void 0===i&&(i=this.visibleColumns.frozen.length);var n=this.context.columns;this.forEachRow(function(r,s){o.addCellAtStart(r,s,t,e,i,n)})},t.prototype.addCellAtStart=function(t,e,i,o,n,r){for(var s=o;s>=i;--s){var a=this.selectCell(e,s,r);t.insertBefore(a,n>0?t.children[n]:t.firstChild)}},t.prototype.insertFrozenCells=function(t,e,i,o,n){for(var r=t.children[o],s=0,a=i;s<a.length;s++){var l=a[s],h=this.selectCell(e,l,n);r?t.insertBefore(h,r):t.appendChild(h)}},t.prototype.insertFrozenColumns=function(t,e){var i=this,o=this.context.columns;this.forEachRow(function(n,r){i.insertFrozenCells(n,r,t,e,o)})},t.prototype.addColumnAtEnd=function(t,e){var i=this,o=this.context.columns;this.forEachRow(function(n,r){i.addCellAtEnd(n,r,t,e,o)})},t.prototype.verifyRows=function(){var t=this.context.columns;this.forEachRow(function(e,i){return T(e,i,t)})},t.prototype.addCellAtEnd=function(t,e,i,o,n){for(var r=i;r<=o;++r){var s=this.selectCell(e,r,n);t.appendChild(s)}},t.prototype.updateHeaders=function(){var t=this,e=this.context.columns;Array.from(this.header.children).forEach(function(i,o){t.updateHeader(i,e[o])})},t.prototype.recreate=function(t,e){var i=this,o=this.context;this.style.update(o.defaultRowHeight-o.padding(-1),o.columns,-this.leftShift(),this.tableId),this.clearPool();for(var n=this.cellPool.length;n<o.columns.length;++n)this.cellPool.push([]);var r=this.columnFragment,s=r.ownerDocument;this.header.innerHTML=\"\",o.columns.forEach(function(t){var e=i.createHeader(s,t);A(e,t),r.appendChild(e)}),this.header.appendChild(r);var a=g(t,e,o.column.defaultRowHeight,o.column.exceptions,o.column.numberOfRows),l=a.first,h=a.last,c=a.firstRowPos;if(this.visibleColumns.first=this.visibleColumns.forcedFirst=l,this.visibleColumns.last=this.visibleColumns.forcedLast=h,o.columns.some(function(t){return t.frozen})){var u=x([],o.columns,l).target;this.visibleColumns.frozen=u}else this.visibleColumns.frozen=[];this.updateColumnOffset(c)},t.prototype.clearPool=function(){this.cellPool.forEach(function(t){return t.splice(0,t.length)})},t.prototype.updateColumnOffset=function(t){var e=t!==this.visibleFirstColumnPos;if(this.visibleFirstColumnPos=t,e){var i=this.context;this.style.update(i.defaultRowHeight-i.padding(-1),i.columns,-this.leftShift(),this.tableId)}},t.prototype.createRow=function(t,e){var i=this.context.columns,o=this.visibleColumns;if(o.frozen.length>0)for(var n=0,r=o.frozen;n<r.length;n++){var s=r[n],a=this.selectCell(e,s,i);t.appendChild(a)}for(s=o.first;s<=o.last;++s){a=this.selectCell(e,s,i);t.appendChild(a)}},t.prototype.updateRow=function(t,e){var i=this.context.columns,o=this.visibleColumns,n=Array.from(t.children);switch(n.length){case 0:o.frozen.length>0&&this.insertFrozenCells(t,e,o.frozen,0,i),this.addCellAtEnd(t,e,o.first,o.last,i);break;case 1:var r=n[0],s=r.dataset.id,a=i.findIndex(function(t){return t.id===s});t.removeChild(r),a>=0&&this.recycleCell(r,a),o.frozen.length>0&&this.insertFrozenCells(t,e,o.frozen,0,i),this.addCellAtEnd(t,e,o.first,o.last,i);break;default:this.mergeColumns(t,e,n)}},t.prototype.mergeColumns=function(t,e,i){var o=this,n=this.context.columns,r=this.visibleColumns;t.innerHTML=\"\";var s=new Map(i.map(function(t){return[t.dataset.id,t]})),a=function(i){var r=n[i],a=s.get(r.id);if(a){var l=o.updateCell(a,e,r);l&&l!==a&&A(l,r),t.appendChild(l||a)}else{var h=o.selectCell(e,i,n);t.appendChild(h)}};r.frozen.forEach(a);for(var l=r.first;l<=r.last;++l)a(l)},t.prototype.syncFrozen=function(t){var e=this.context.columns,i=this.visibleColumns;if(!e.some(function(t){return t.frozen}))return 0;if(0===t)return i.frozen.length>0&&(this.removeFrozenColumns(i.frozen,0),i.frozen=[]),0;var o=i.frozen.length,n=x(i.frozen,e,t),r=n.target,s=n.added,a=n.removed;return a.length>0&&this.removeFrozenColumns(a,o-a.length),s.length>0&&this.insertFrozenColumns(s,o-a.length),i.frozen=r,r.length},t.prototype.onScrolledHorizontallyImpl=function(t,e){var i=this.context.column,o=g(t,e,i.defaultRowHeight,i.exceptions,i.numberOfRows),n=o.first,r=o.last,s=o.firstRowPos,a=this.visibleColumns;if(a.forcedFirst=n,a.forcedLast=r,n-a.first>=0&&r-a.last<=0)return d.NONE;var l=d.SOME,h=this.syncFrozen(n);return n>a.last||r<a.first?(this.removeAllColumns(!1),this.addColumnAtEnd(n,r),l=d.ALL):n<a.first?(this.removeColumnFromEnd(r+1,a.last),this.addColumnAtStart(n,a.first-1,h),l=d.SOME_TOP):(this.removeColumnFromStart(a.first,n-1,h),this.addColumnAtEnd(a.last+1,r),l=d.SOME_BOTTOM),a.first=n,a.last=r,this.updateColumnOffset(s),l},t}();function T(t,e,i){var o=Array.from(t.children);if(!(o.length<=1)){var n=o.map(function(t){return i.find(function(e){return e.id===t.dataset.id})});console.assert(n.every(function(t){return Boolean(t)}),\"all columns must exist\",e),console.assert(n.every(function(t,e){return 0===e||t.index>=n[e-1].index}),\"all columns in ascending order\",e),console.assert(new Set(n).size===n.length,\"unique columns\",n)}}var z=function(t){function e(e,i,o){void 0===o&&(o={});var r=t.call(this,H(e).querySelector(\"main > article\"),o)||this;r.root=e,e.classList.add(\"lineup-engine\"),r.style=new M(r.root,i);var s=r,a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),Object.defineProperty(e.prototype,\"context\",{get:function(){return s.context},enumerable:!0,configurable:!0}),e.prototype.createHeader=function(t,e){return s.createHeader(t,e)},e.prototype.updateHeader=function(t,e){return s.updateHeader(t,e)},e.prototype.createCell=function(t,e,i){return s.createCell(t,e,i)},e.prototype.updateCell=function(t,e,i){return s.updateCell(t,e,i)},e.prototype.updateColumnOffset=function(e){t.prototype.updateColumnOffset.call(this,e),s.updateOffset(s.visibleFirstRowPos)},e.prototype.forEachRow=function(t){return s.forEachRow(t)},e}(F);return r.cell=new(a.bind.apply(a,[void 0,r.header,r.style,void 0].concat(o.mixins||[]))),r}return n(e,t),Object.defineProperty(e.prototype,\"header\",{get:function(){return this.root.querySelector(\"header > article\")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"headerScroller\",{get:function(){return this.root.querySelector(\"header\")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"visibleColumns\",{get:function(){return this.cell.visibleColumns},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"visibleFirstColumnPos\",{get:function(){return this.cell.visibleFirstColumnPos},enumerable:!0,configurable:!0}),e.prototype.addColumnMixin=function(t,e){this.cell.addColumnMixin(t,e)},e.prototype.init=function(){var e=this;this.cell.init();var i=R(this.body.parentElement,this.options.async,function(t){if(!(Math.abs(i.left-t.left)<e.options.minScrollDelta&&Math.abs(i.width-t.width)<e.options.minScrollDelta)){var o=t.left>i.left;i=t,e.onScrolledHorizontally(t.left,t.width,o)}});t.prototype.init.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this),this.root.remove()},e.prototype.onScrolledHorizontally=function(t,e,i){return this.cell.onScrolledHorizontally(t,e,i)},e.prototype.updateHeaders=function(){this.cell.updateHeaders()},e.prototype.updateColumnWidths=function(){var t=this.context;this.style.update(t.defaultRowHeight-t.padding(-1),t.columns,-this.cell.leftShift())},e.prototype.updateSizer=function(t){var e=this.context,i=e.totalHeight,o=e.column.totalHeight;this.updateShifts(t,this.cell.leftShift()),this.bodySizer.style.transform=\"translate(\"+Math.max(0,o-1).toFixed(0)+\"px, \"+Math.max(0,i-1).toFixed(0)+\"px)\"},e.prototype.updateShifts=function(t,e){this.body.style.transform=\"translate(\"+e.toFixed(0)+\"px, \"+t.toFixed(0)+\"px)\"},e.prototype.recreate=function(e){var i=this.bodyScroller,o=i.scrollLeft;this.cell.recreate(o,i.clientWidth),t.prototype.recreate.call(this,e),i.scrollLeft=o},e.prototype.clearPool=function(){t.prototype.clearPool.call(this),this.cell.clearPool()},e.prototype.createRow=function(t,e){this.cell.createRow(t,e)},e.prototype.updateRow=function(t,e){this.cell.updateRow(t,e)},e}(O),L=i(1),_=function(){function t(t,e){return this.adapter=t,this.prefetchTimeout=-1,this.cleanupTimeout=-1,this.options={prefetchRows:20,cleanUpRows:3,delay:50},Object.assign(this.options,e),this}return t.prototype.prefetchDown=function(){this.prefetchTimeout=-1;var t=this.adapter.context,e=Math.min(this.adapter.visible.forcedLast+this.options.prefetchRows,t.numberOfRows-1);this.adapter.visible.last===e&&this.adapter.visible.last>=this.adapter.visible.forcedLast+this.options.prefetchRows||(this.adapter.addAtBottom(this.adapter.visible.last+1,e),this.adapter.visible.last=e)},t.prototype.prefetchUp=function(){if(this.prefetchTimeout=-1,!(this.adapter.visible.first<=this.adapter.visible.forcedFirst-this.options.prefetchRows)){var t=this.adapter.context,e=this.adapter.scroller,i=g(Math.max(e.scrollTop-this.options.prefetchRows*t.defaultRowHeight,0),e.clientHeight,t.defaultRowHeight,t.exceptions,t.numberOfRows),o=i.first,n=i.firstRowPos;if(o!==this.adapter.visible.first){var r=this.adapter.syncFrozen?this.adapter.syncFrozen(o):0;this.adapter.addAtBeginning(o,this.adapter.visible.first-1,r),this.adapter.visible.first=o,this.adapter.updateOffset(n)}}},t.prototype.triggerPrefetch=function(t){this.prefetchTimeout>=0&&clearTimeout(this.prefetchTimeout);var e=this.adapter.visible.last<this.adapter.visible.forcedLast+this.options.prefetchRows,i=this.adapter.visible.first>this.adapter.visible.forcedFirst-this.options.prefetchRows,o=this.adapter.visible.last===this.adapter.context.numberOfRows,n=0===this.adapter.visible.first;if((!t||e||o)&&(t||i||n)){var r=t||n?this.prefetchDown.bind(this):this.prefetchUp.bind(this);this.prefetchTimeout=self.setTimeout(r,this.options.delay)}},t.prototype.cleanUpTop=function(t){this.cleanupTimeout=-1;var e=Math.max(0,t-this.options.cleanUpRows);if(!(e<=this.adapter.visible.first)){var i=this.adapter.syncFrozen?this.adapter.syncFrozen(e):0;this.adapter.removeFromBeginning(this.adapter.visible.first,e-1,i);var o=this.adapter.context,n=(e-this.adapter.visible.first)*o.defaultRowHeight;if(o.exceptions.length>0)for(var r=this.adapter.visible.first;r<e;++r)o.exceptionsLookup.has(r)&&(n+=o.exceptionsLookup.get(r)-o.defaultRowHeight);this.adapter.visible.first=e,this.adapter.updateOffset(this.adapter.visibleFirstRowPos+n),this.prefetchDown()}},t.prototype.cleanUpBottom=function(t){this.cleanupTimeout=-1;var e=t+this.options.cleanUpRows;this.adapter.visible.last<=e||(this.adapter.removeFromBottom(e+1,this.adapter.visible.last),this.adapter.visible.last=e,this.prefetchUp())},t.prototype.triggerCleanUp=function(t,e,i){this.cleanupTimeout>=0&&clearTimeout(this.cleanupTimeout),i&&t-this.options.cleanUpRows<=this.adapter.visible.first||!i&&this.adapter.visible.last<=e+this.options.cleanUpRows||(this.cleanupTimeout=self.setTimeout(i?this.cleanUpTop.bind(this):this.cleanUpBottom.bind(this),this.options.delay,i?t:e))},t.prototype.onScrolled=function(t,e){e!==d.ALL&&this.options.cleanUpRows>0&&this.triggerCleanUp(this.adapter.visible.forcedFirst,this.adapter.visible.forcedLast,t),e!==d.NONE&&this.options.prefetchRows>0&&this.triggerPrefetch(t)},t}(),B=function(t){function e(e,i,o,r,s){void 0===s&&(s={});var a=t.call(this,i,s)||this;a.header=e,a.body=i,a.tableId=o,a.style=r;var l=a,h=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),Object.defineProperty(e.prototype,\"context\",{get:function(){return l.context},enumerable:!0,configurable:!0}),e.prototype.createHeader=function(t,e){return l.createHeader(t,e)},e.prototype.updateHeader=function(t,e){return l.updateHeader(t,e)},e.prototype.createCell=function(t,e,i){return l.createCell(t,e,i)},e.prototype.updateColumnOffset=function(e){t.prototype.updateColumnOffset.call(this,e),l.updateOffset(l.visibleFirstRowPos)},e.prototype.updateCell=function(t,e,i){return l.updateCell(t,e,i)},e.prototype.forEachRow=function(t){return l.forEachRow(t)},e}(F);return a.cell=new(h.bind.apply(h,[void 0,a.header,a.style,o].concat(s.mixins||[]))),a}return n(e,t),e.prototype.addColumnMixin=function(t,e){this.cell.addColumnMixin(t,e)},Object.defineProperty(e.prototype,\"width\",{get:function(){return this.context.column.totalHeight},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"visibleColumns\",{get:function(){return this.cell.visibleColumns},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"visibleFirstColumnPos\",{get:function(){return this.cell.visibleFirstColumnPos},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"height\",{get:function(){return this.context.totalHeight},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"hidden\",{get:function(){return this.header.classList.contains(\"loading\")},set:function(t){this.hidden!==t&&(this.header.classList.toggle(\"loading\",t),this.body.classList.toggle(\"loading\",t),this.onVisibilityChanged(!t))},enumerable:!0,configurable:!0}),e.prototype.updateSizer=function(t){this.updateShifts(t,this.cell.leftShift())},e.prototype.updateShifts=function(t,e){this.body.style.transform=\"translate(\"+e.toFixed(0)+\"px, \"+t.toFixed(0)+\"px)\"},e.prototype.onVisibilityChanged=function(t){},e.prototype.hide=function(){this.hidden=!0},e.prototype.show=function(t,e,i){var o=this.hidden;this.hidden=!1,o?this.revalidate():this.onScrolledHorizontally(t,e,i)},e.prototype.init=function(){this.hide(),this.cell.init(),t.prototype.init.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this),this.header.remove(),this.style.remove(this.tableId)},e.prototype.onScrolledVertically=function(e,i,o){return this.hidden?d.NONE:t.prototype.onScrolledVertically.call(this,e,i,o)},e.prototype.onScrolledHorizontally=function(t,e,i){var o=this.cell.onScrolledHorizontally(t,e,i);return this.updateSizer(this.visibleFirstRowPos),o},e.prototype.updateHeaders=function(){this.cell.updateHeaders()},e.prototype.updateColumnWidths=function(){var t=this.context;this.style.update(t.defaultRowHeight-t.padding(-1),t.columns,-this.cell.leftShift(),this.tableId)},e.prototype.recreate=function(e){var i=this.bodyScroller,o=i.scrollLeft;this.cell.recreate(o,i.clientWidth),t.prototype.recreate.call(this,e),i.scrollLeft=o},e.prototype.clearPool=function(){t.prototype.clearPool.call(this),this.cell.clearPool()},e.prototype.createRow=function(t,e){this.cell.createRow(t,e)},e.prototype.updateRow=function(t,e){this.cell.updateRow(t,e)},e}(S),D=function(){function t(t,e,i){void 0===i&&(i={});var o=this;this.node=t,this.tableId=0,this.sections=[],this.options={columnPadding:0,async:w,minScrollDelta:30},Object.assign(this.options,i),t.id=e.startsWith(\"#\")?e.slice(1):e,t.innerHTML=\"<header><footer>&nbsp;</footer></header><main><footer>&nbsp;</footer></main>\",t.classList.add(\"lineup-engine\",\"lineup-multi-engine\"),this.style=new M(this.node,e);var n=R(this.main,this.options.async,function(t){if(!(Math.abs(n.left-t.left)<o.options.minScrollDelta&&Math.abs(n.width-t.width)<o.options.minScrollDelta)){var e=t.left>n.left;n=t,o.onScrolledHorizontally(t.left,t.width,e)}})}return t.prototype.update=function(){var t=this;this.onScrolledHorizontally(this.main.scrollLeft,this.main.clientWidth,!1);var e=0;this.sections.forEach(function(i){i.body.style.left=i.header.style.left=e+\"px\",e+=i.width+t.options.columnPadding})},t.prototype.onScrolledHorizontally=function(t,e,i){var o=this,n=0,r=t+e;this.sections.forEach(function(e){var s=n+e.width;s<t||n>r?e.hide():e.show(Math.max(0,t-n),Math.min(r-n,e.width),i),n=s+o.options.columnPadding}),this.updateOffset()},t.prototype.updateOffset=function(){var t=this,e=this.header.querySelector(\"footer\"),i=this.main.querySelector(\"footer\"),o=Math.max.apply(Math,[0].concat(this.sections.map(function(t){return t.height}))),n=this.sections.reduce(function(e,i){return e+i.width+t.options.columnPadding},0);e.style.transform=\"translate(\"+n+\"px,0)\",i.style.transform=\"translate(\"+n+\"px, \"+o+\"px)\"},t.prototype.destroy=function(){this.sections.forEach(function(t){return t.destroy()}),this.node.remove()},Object.defineProperty(t.prototype,\"doc\",{get:function(){return this.node.ownerDocument},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"header\",{get:function(){return this.node.querySelector(\"header\")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"main\",{get:function(){return this.node.querySelector(\"main\")},enumerable:!0,configurable:!0}),t.prototype.pushTable=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];var o=this.doc.createElement(\"article\"),n=this.doc.createElement(\"article\"),r=\"T\"+this.tableId++,s=this.style.tableIds(r);o.id=s.header,n.id=s.body,this.header.insertBefore(o,this.header.lastElementChild),this.main.appendChild(n);var a=t.apply(void 0,[o,n,r,this.style].concat(e));return a.init(),this.sections.push(a),this.update(),a},t.prototype.pushSeparator=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];var o=this.doc.createElement(\"section\"),n=this.doc.createElement(\"section\");this.header.insertBefore(o,this.header.lastElementChild),this.main.appendChild(n);var r=t.apply(void 0,[o,n,this.style].concat(e));return r.init(),this.sections.push(r),this.update(),r},t.prototype.remove=function(t){var e=this.sections.indexOf(t);return!(e<0)&&(this.sections.splice(e,1),t.destroy(),this.update(),!0)},t.prototype.clear=function(){this.sections.splice(0,this.sections.length).forEach(function(t){return t.destroy()}),this.update()},t.prototype.widthChanged=function(){this.update()},t}();i.d(e,\"version\",function(){return I}),i.d(e,\"ACellRenderer\",function(){return z}),i.d(e,\"ARowRenderer\",function(){return O}),i.d(e,\"uniformContext\",function(){return m}),i.d(e,\"nonUniformContext\",function(){return y}),i.d(e,\"randomContext\",function(){return v}),i.d(e,\"range\",function(){return g}),i.d(e,\"frozenDelta\",function(){return b}),i.d(e,\"updateFrozen\",function(){return x}),i.d(e,\"ABORTED\",function(){return r}),i.d(e,\"isAbortAble\",function(){return a}),i.d(e,\"abortAble\",function(){return s}),i.d(e,\"IColumn\",function(){return L.IColumn}),i.d(e,\"GridStyleManager\",function(){return M}),i.d(e,\"setColumn\",function(){return A}),i.d(e,\"TEMPLATE\",function(){return P}),i.d(e,\"setTemplate\",function(){return H}),i.d(e,\"StyleManager\",function(){return E}),i.d(e,\"IMixin\",function(){}),i.d(e,\"IMixinAdapter\",function(){}),i.d(e,\"IMixinClass\",function(){}),i.d(e,\"EScrollResult\",function(){return d}),i.d(e,\"PrefetchMixin\",function(){return _}),i.d(e,\"ITableCellRenderContext\",function(){}),i.d(e,\"ACellTableSection\",function(){return B}),i.d(e,\"IMultiTableRowRendererOptions\",function(){}),i.d(e,\"ISeparatorFactory\",function(){}),i.d(e,\"ITableFactory\",function(){}),i.d(e,\"ITableSection\",function(){}),i.d(e,\"MultiTableRowRenderer\",function(){return D}),i.d(e,\"KeyFinder\",function(){return h}),i.d(e,\"EAnimationMode\",function(){return l}),i.d(e,\"noAnimationChange\",function(){return u}),i.d(e,\"defaultPhases\",function(){return f});var I=\"1.1.2\"}])});","import Column from '../../model';\r\nimport {forEach, uniqueId} from '../../renderer/utils';\r\nimport {isMapAbleColumn} from '../../model/MappingFunction';\r\n\r\n/** @internal */\r\nexport function updateFilterState(attachment: HTMLElement, column: Column, filtered: boolean) {\r\n  const toggle = (e: Element) => {\r\n    const n = <HTMLElement>e;\r\n    if (filtered) {\r\n      n.dataset.active = '';\r\n    } else {\r\n      delete n.dataset.active;\r\n    }\r\n  };\r\n\r\n  toggle(attachment);\r\n  const root = attachment.closest('.lu');\r\n  if (!root) {\r\n    return;\r\n  }\r\n  Array.from(root.querySelectorAll(`[data-col-id=\"${column.id}\"] i[title^=Filter]`)).forEach(toggle);\r\n}\r\n\r\n/** @internal */\r\nexport function sortMethods(node: HTMLElement, column: {setSortMethod(v: string): void, getSortMethod(): string}, methods: string[], idPrefix: string) {\r\n  const id = uniqueId(idPrefix);\r\n  const bak = column.getSortMethod();\r\n  methods.forEach((d) => node.insertAdjacentHTML('beforeend', `<div class=\"checkbox\"><input id=\"${id}${d}\" type=\"radio\" name=\"multivaluesort\" value=\"${d}\"  ${(bak === d) ? 'checked' : ''} ><label for=\"${id}${d}\">${d.slice(0, 1).toUpperCase() + d.slice(1)}</label></div>`));\r\n\r\n  forEach(node, 'input[name=multivaluesort]', (n: HTMLInputElement) => {\r\n    n.addEventListener('change', () => column.setSortMethod(n.value), {\r\n      passive: true\r\n    });\r\n  });\r\n}\r\n\r\n/** @internal */\r\nexport function colorOf(col: Column) {\r\n  if (isMapAbleColumn(col)) {\r\n    return col.getColorMapping().apply(0);\r\n  }\r\n  return Column.DEFAULT_COLOR;\r\n}\r\n\r\n\r\nexport {uniqueId, forEach, forEachChild} from '../../renderer/utils';\r\n","import {\n  timeDay,\n  timeSunday,\n  timeMonday,\n  timeThursday,\n  timeYear,\n  utcDay,\n  utcSunday,\n  utcMonday,\n  utcThursday,\n  utcYear\n} from \"d3-time\";\n\nfunction localDate(d) {\n  if (0 <= d.y && d.y < 100) {\n    var date = new Date(-1, d.m, d.d, d.H, d.M, d.S, d.L);\n    date.setFullYear(d.y);\n    return date;\n  }\n  return new Date(d.y, d.m, d.d, d.H, d.M, d.S, d.L);\n}\n\nfunction utcDate(d) {\n  if (0 <= d.y && d.y < 100) {\n    var date = new Date(Date.UTC(-1, d.m, d.d, d.H, d.M, d.S, d.L));\n    date.setUTCFullYear(d.y);\n    return date;\n  }\n  return new Date(Date.UTC(d.y, d.m, d.d, d.H, d.M, d.S, d.L));\n}\n\nfunction newDate(y, m, d) {\n  return {y: y, m: m, d: d, H: 0, M: 0, S: 0, L: 0};\n}\n\nexport default function formatLocale(locale) {\n  var locale_dateTime = locale.dateTime,\n      locale_date = locale.date,\n      locale_time = locale.time,\n      locale_periods = locale.periods,\n      locale_weekdays = locale.days,\n      locale_shortWeekdays = locale.shortDays,\n      locale_months = locale.months,\n      locale_shortMonths = locale.shortMonths;\n\n  var periodRe = formatRe(locale_periods),\n      periodLookup = formatLookup(locale_periods),\n      weekdayRe = formatRe(locale_weekdays),\n      weekdayLookup = formatLookup(locale_weekdays),\n      shortWeekdayRe = formatRe(locale_shortWeekdays),\n      shortWeekdayLookup = formatLookup(locale_shortWeekdays),\n      monthRe = formatRe(locale_months),\n      monthLookup = formatLookup(locale_months),\n      shortMonthRe = formatRe(locale_shortMonths),\n      shortMonthLookup = formatLookup(locale_shortMonths);\n\n  var formats = {\n    \"a\": formatShortWeekday,\n    \"A\": formatWeekday,\n    \"b\": formatShortMonth,\n    \"B\": formatMonth,\n    \"c\": null,\n    \"d\": formatDayOfMonth,\n    \"e\": formatDayOfMonth,\n    \"f\": formatMicroseconds,\n    \"H\": formatHour24,\n    \"I\": formatHour12,\n    \"j\": formatDayOfYear,\n    \"L\": formatMilliseconds,\n    \"m\": formatMonthNumber,\n    \"M\": formatMinutes,\n    \"p\": formatPeriod,\n    \"q\": formatQuarter,\n    \"Q\": formatUnixTimestamp,\n    \"s\": formatUnixTimestampSeconds,\n    \"S\": formatSeconds,\n    \"u\": formatWeekdayNumberMonday,\n    \"U\": formatWeekNumberSunday,\n    \"V\": formatWeekNumberISO,\n    \"w\": formatWeekdayNumberSunday,\n    \"W\": formatWeekNumberMonday,\n    \"x\": null,\n    \"X\": null,\n    \"y\": formatYear,\n    \"Y\": formatFullYear,\n    \"Z\": formatZone,\n    \"%\": formatLiteralPercent\n  };\n\n  var utcFormats = {\n    \"a\": formatUTCShortWeekday,\n    \"A\": formatUTCWeekday,\n    \"b\": formatUTCShortMonth,\n    \"B\": formatUTCMonth,\n    \"c\": null,\n    \"d\": formatUTCDayOfMonth,\n    \"e\": formatUTCDayOfMonth,\n    \"f\": formatUTCMicroseconds,\n    \"H\": formatUTCHour24,\n    \"I\": formatUTCHour12,\n    \"j\": formatUTCDayOfYear,\n    \"L\": formatUTCMilliseconds,\n    \"m\": formatUTCMonthNumber,\n    \"M\": formatUTCMinutes,\n    \"p\": formatUTCPeriod,\n    \"q\": formatUTCQuarter,\n    \"Q\": formatUnixTimestamp,\n    \"s\": formatUnixTimestampSeconds,\n    \"S\": formatUTCSeconds,\n    \"u\": formatUTCWeekdayNumberMonday,\n    \"U\": formatUTCWeekNumberSunday,\n    \"V\": formatUTCWeekNumberISO,\n    \"w\": formatUTCWeekdayNumberSunday,\n    \"W\": formatUTCWeekNumberMonday,\n    \"x\": null,\n    \"X\": null,\n    \"y\": formatUTCYear,\n    \"Y\": formatUTCFullYear,\n    \"Z\": formatUTCZone,\n    \"%\": formatLiteralPercent\n  };\n\n  var parses = {\n    \"a\": parseShortWeekday,\n    \"A\": parseWeekday,\n    \"b\": parseShortMonth,\n    \"B\": parseMonth,\n    \"c\": parseLocaleDateTime,\n    \"d\": parseDayOfMonth,\n    \"e\": parseDayOfMonth,\n    \"f\": parseMicroseconds,\n    \"H\": parseHour24,\n    \"I\": parseHour24,\n    \"j\": parseDayOfYear,\n    \"L\": parseMilliseconds,\n    \"m\": parseMonthNumber,\n    \"M\": parseMinutes,\n    \"p\": parsePeriod,\n    \"q\": parseQuarter,\n    \"Q\": parseUnixTimestamp,\n    \"s\": parseUnixTimestampSeconds,\n    \"S\": parseSeconds,\n    \"u\": parseWeekdayNumberMonday,\n    \"U\": parseWeekNumberSunday,\n    \"V\": parseWeekNumberISO,\n    \"w\": parseWeekdayNumberSunday,\n    \"W\": parseWeekNumberMonday,\n    \"x\": parseLocaleDate,\n    \"X\": parseLocaleTime,\n    \"y\": parseYear,\n    \"Y\": parseFullYear,\n    \"Z\": parseZone,\n    \"%\": parseLiteralPercent\n  };\n\n  // These recursive directive definitions must be deferred.\n  formats.x = newFormat(locale_date, formats);\n  formats.X = newFormat(locale_time, formats);\n  formats.c = newFormat(locale_dateTime, formats);\n  utcFormats.x = newFormat(locale_date, utcFormats);\n  utcFormats.X = newFormat(locale_time, utcFormats);\n  utcFormats.c = newFormat(locale_dateTime, utcFormats);\n\n  function newFormat(specifier, formats) {\n    return function(date) {\n      var string = [],\n          i = -1,\n          j = 0,\n          n = specifier.length,\n          c,\n          pad,\n          format;\n\n      if (!(date instanceof Date)) date = new Date(+date);\n\n      while (++i < n) {\n        if (specifier.charCodeAt(i) === 37) {\n          string.push(specifier.slice(j, i));\n          if ((pad = pads[c = specifier.charAt(++i)]) != null) c = specifier.charAt(++i);\n          else pad = c === \"e\" ? \" \" : \"0\";\n          if (format = formats[c]) c = format(date, pad);\n          string.push(c);\n          j = i + 1;\n        }\n      }\n\n      string.push(specifier.slice(j, i));\n      return string.join(\"\");\n    };\n  }\n\n  function newParse(specifier, Z) {\n    return function(string) {\n      var d = newDate(1900, undefined, 1),\n          i = parseSpecifier(d, specifier, string += \"\", 0),\n          week, day;\n      if (i != string.length) return null;\n\n      // If a UNIX timestamp is specified, return it.\n      if (\"Q\" in d) return new Date(d.Q);\n      if (\"s\" in d) return new Date(d.s * 1000 + (\"L\" in d ? d.L : 0));\n\n      // If this is utcParse, never use the local timezone.\n      if (Z && !(\"Z\" in d)) d.Z = 0;\n\n      // The am-pm flag is 0 for AM, and 1 for PM.\n      if (\"p\" in d) d.H = d.H % 12 + d.p * 12;\n\n      // If the month was not specified, inherit from the quarter.\n      if (d.m === undefined) d.m = \"q\" in d ? d.q : 0;\n\n      // Convert day-of-week and week-of-year to day-of-year.\n      if (\"V\" in d) {\n        if (d.V < 1 || d.V > 53) return null;\n        if (!(\"w\" in d)) d.w = 1;\n        if (\"Z\" in d) {\n          week = utcDate(newDate(d.y, 0, 1)), day = week.getUTCDay();\n          week = day > 4 || day === 0 ? utcMonday.ceil(week) : utcMonday(week);\n          week = utcDay.offset(week, (d.V - 1) * 7);\n          d.y = week.getUTCFullYear();\n          d.m = week.getUTCMonth();\n          d.d = week.getUTCDate() + (d.w + 6) % 7;\n        } else {\n          week = localDate(newDate(d.y, 0, 1)), day = week.getDay();\n          week = day > 4 || day === 0 ? timeMonday.ceil(week) : timeMonday(week);\n          week = timeDay.offset(week, (d.V - 1) * 7);\n          d.y = week.getFullYear();\n          d.m = week.getMonth();\n          d.d = week.getDate() + (d.w + 6) % 7;\n        }\n      } else if (\"W\" in d || \"U\" in d) {\n        if (!(\"w\" in d)) d.w = \"u\" in d ? d.u % 7 : \"W\" in d ? 1 : 0;\n        day = \"Z\" in d ? utcDate(newDate(d.y, 0, 1)).getUTCDay() : localDate(newDate(d.y, 0, 1)).getDay();\n        d.m = 0;\n        d.d = \"W\" in d ? (d.w + 6) % 7 + d.W * 7 - (day + 5) % 7 : d.w + d.U * 7 - (day + 6) % 7;\n      }\n\n      // If a time zone is specified, all fields are interpreted as UTC and then\n      // offset according to the specified time zone.\n      if (\"Z\" in d) {\n        d.H += d.Z / 100 | 0;\n        d.M += d.Z % 100;\n        return utcDate(d);\n      }\n\n      // Otherwise, all fields are in local time.\n      return localDate(d);\n    };\n  }\n\n  function parseSpecifier(d, specifier, string, j) {\n    var i = 0,\n        n = specifier.length,\n        m = string.length,\n        c,\n        parse;\n\n    while (i < n) {\n      if (j >= m) return -1;\n      c = specifier.charCodeAt(i++);\n      if (c === 37) {\n        c = specifier.charAt(i++);\n        parse = parses[c in pads ? specifier.charAt(i++) : c];\n        if (!parse || ((j = parse(d, string, j)) < 0)) return -1;\n      } else if (c != string.charCodeAt(j++)) {\n        return -1;\n      }\n    }\n\n    return j;\n  }\n\n  function parsePeriod(d, string, i) {\n    var n = periodRe.exec(string.slice(i));\n    return n ? (d.p = periodLookup[n[0].toLowerCase()], i + n[0].length) : -1;\n  }\n\n  function parseShortWeekday(d, string, i) {\n    var n = shortWeekdayRe.exec(string.slice(i));\n    return n ? (d.w = shortWeekdayLookup[n[0].toLowerCase()], i + n[0].length) : -1;\n  }\n\n  function parseWeekday(d, string, i) {\n    var n = weekdayRe.exec(string.slice(i));\n    return n ? (d.w = weekdayLookup[n[0].toLowerCase()], i + n[0].length) : -1;\n  }\n\n  function parseShortMonth(d, string, i) {\n    var n = shortMonthRe.exec(string.slice(i));\n    return n ? (d.m = shortMonthLookup[n[0].toLowerCase()], i + n[0].length) : -1;\n  }\n\n  function parseMonth(d, string, i) {\n    var n = monthRe.exec(string.slice(i));\n    return n ? (d.m = monthLookup[n[0].toLowerCase()], i + n[0].length) : -1;\n  }\n\n  function parseLocaleDateTime(d, string, i) {\n    return parseSpecifier(d, locale_dateTime, string, i);\n  }\n\n  function parseLocaleDate(d, string, i) {\n    return parseSpecifier(d, locale_date, string, i);\n  }\n\n  function parseLocaleTime(d, string, i) {\n    return parseSpecifier(d, locale_time, string, i);\n  }\n\n  function formatShortWeekday(d) {\n    return locale_shortWeekdays[d.getDay()];\n  }\n\n  function formatWeekday(d) {\n    return locale_weekdays[d.getDay()];\n  }\n\n  function formatShortMonth(d) {\n    return locale_shortMonths[d.getMonth()];\n  }\n\n  function formatMonth(d) {\n    return locale_months[d.getMonth()];\n  }\n\n  function formatPeriod(d) {\n    return locale_periods[+(d.getHours() >= 12)];\n  }\n\n  function formatQuarter(d) {\n    return 1 + ~~(d.getMonth() / 3);\n  }\n\n  function formatUTCShortWeekday(d) {\n    return locale_shortWeekdays[d.getUTCDay()];\n  }\n\n  function formatUTCWeekday(d) {\n    return locale_weekdays[d.getUTCDay()];\n  }\n\n  function formatUTCShortMonth(d) {\n    return locale_shortMonths[d.getUTCMonth()];\n  }\n\n  function formatUTCMonth(d) {\n    return locale_months[d.getUTCMonth()];\n  }\n\n  function formatUTCPeriod(d) {\n    return locale_periods[+(d.getUTCHours() >= 12)];\n  }\n\n  function formatUTCQuarter(d) {\n    return 1 + ~~(d.getUTCMonth() / 3);\n  }\n\n  return {\n    format: function(specifier) {\n      var f = newFormat(specifier += \"\", formats);\n      f.toString = function() { return specifier; };\n      return f;\n    },\n    parse: function(specifier) {\n      var p = newParse(specifier += \"\", false);\n      p.toString = function() { return specifier; };\n      return p;\n    },\n    utcFormat: function(specifier) {\n      var f = newFormat(specifier += \"\", utcFormats);\n      f.toString = function() { return specifier; };\n      return f;\n    },\n    utcParse: function(specifier) {\n      var p = newParse(specifier += \"\", true);\n      p.toString = function() { return specifier; };\n      return p;\n    }\n  };\n}\n\nvar pads = {\"-\": \"\", \"_\": \" \", \"0\": \"0\"},\n    numberRe = /^\\s*\\d+/, // note: ignores next directive\n    percentRe = /^%/,\n    requoteRe = /[\\\\^$*+?|[\\]().{}]/g;\n\nfunction pad(value, fill, width) {\n  var sign = value < 0 ? \"-\" : \"\",\n      string = (sign ? -value : value) + \"\",\n      length = string.length;\n  return sign + (length < width ? new Array(width - length + 1).join(fill) + string : string);\n}\n\nfunction requote(s) {\n  return s.replace(requoteRe, \"\\\\$&\");\n}\n\nfunction formatRe(names) {\n  return new RegExp(\"^(?:\" + names.map(requote).join(\"|\") + \")\", \"i\");\n}\n\nfunction formatLookup(names) {\n  var map = {}, i = -1, n = names.length;\n  while (++i < n) map[names[i].toLowerCase()] = i;\n  return map;\n}\n\nfunction parseWeekdayNumberSunday(d, string, i) {\n  var n = numberRe.exec(string.slice(i, i + 1));\n  return n ? (d.w = +n[0], i + n[0].length) : -1;\n}\n\nfunction parseWeekdayNumberMonday(d, string, i) {\n  var n = numberRe.exec(string.slice(i, i + 1));\n  return n ? (d.u = +n[0], i + n[0].length) : -1;\n}\n\nfunction parseWeekNumberSunday(d, string, i) {\n  var n = numberRe.exec(string.slice(i, i + 2));\n  return n ? (d.U = +n[0], i + n[0].length) : -1;\n}\n\nfunction parseWeekNumberISO(d, string, i) {\n  var n = numberRe.exec(string.slice(i, i + 2));\n  return n ? (d.V = +n[0], i + n[0].length) : -1;\n}\n\nfunction parseWeekNumberMonday(d, string, i) {\n  var n = numberRe.exec(string.slice(i, i + 2));\n  return n ? (d.W = +n[0], i + n[0].length) : -1;\n}\n\nfunction parseFullYear(d, string, i) {\n  var n = numberRe.exec(string.slice(i, i + 4));\n  return n ? (d.y = +n[0], i + n[0].length) : -1;\n}\n\nfunction parseYear(d, string, i) {\n  var n = numberRe.exec(string.slice(i, i + 2));\n  return n ? (d.y = +n[0] + (+n[0] > 68 ? 1900 : 2000), i + n[0].length) : -1;\n}\n\nfunction parseZone(d, string, i) {\n  var n = /^(Z)|([+-]\\d\\d)(?::?(\\d\\d))?/.exec(string.slice(i, i + 6));\n  return n ? (d.Z = n[1] ? 0 : -(n[2] + (n[3] || \"00\")), i + n[0].length) : -1;\n}\n\nfunction parseQuarter(d, string, i) {\n  var n = numberRe.exec(string.slice(i, i + 1));\n  return n ? (d.q = n[0] * 3 - 3, i + n[0].length) : -1;\n}\n\nfunction parseMonthNumber(d, string, i) {\n  var n = numberRe.exec(string.slice(i, i + 2));\n  return n ? (d.m = n[0] - 1, i + n[0].length) : -1;\n}\n\nfunction parseDayOfMonth(d, string, i) {\n  var n = numberRe.exec(string.slice(i, i + 2));\n  return n ? (d.d = +n[0], i + n[0].length) : -1;\n}\n\nfunction parseDayOfYear(d, string, i) {\n  var n = numberRe.exec(string.slice(i, i + 3));\n  return n ? (d.m = 0, d.d = +n[0], i + n[0].length) : -1;\n}\n\nfunction parseHour24(d, string, i) {\n  var n = numberRe.exec(string.slice(i, i + 2));\n  return n ? (d.H = +n[0], i + n[0].length) : -1;\n}\n\nfunction parseMinutes(d, string, i) {\n  var n = numberRe.exec(string.slice(i, i + 2));\n  return n ? (d.M = +n[0], i + n[0].length) : -1;\n}\n\nfunction parseSeconds(d, string, i) {\n  var n = numberRe.exec(string.slice(i, i + 2));\n  return n ? (d.S = +n[0], i + n[0].length) : -1;\n}\n\nfunction parseMilliseconds(d, string, i) {\n  var n = numberRe.exec(string.slice(i, i + 3));\n  return n ? (d.L = +n[0], i + n[0].length) : -1;\n}\n\nfunction parseMicroseconds(d, string, i) {\n  var n = numberRe.exec(string.slice(i, i + 6));\n  return n ? (d.L = Math.floor(n[0] / 1000), i + n[0].length) : -1;\n}\n\nfunction parseLiteralPercent(d, string, i) {\n  var n = percentRe.exec(string.slice(i, i + 1));\n  return n ? i + n[0].length : -1;\n}\n\nfunction parseUnixTimestamp(d, string, i) {\n  var n = numberRe.exec(string.slice(i));\n  return n ? (d.Q = +n[0], i + n[0].length) : -1;\n}\n\nfunction parseUnixTimestampSeconds(d, string, i) {\n  var n = numberRe.exec(string.slice(i));\n  return n ? (d.s = +n[0], i + n[0].length) : -1;\n}\n\nfunction formatDayOfMonth(d, p) {\n  return pad(d.getDate(), p, 2);\n}\n\nfunction formatHour24(d, p) {\n  return pad(d.getHours(), p, 2);\n}\n\nfunction formatHour12(d, p) {\n  return pad(d.getHours() % 12 || 12, p, 2);\n}\n\nfunction formatDayOfYear(d, p) {\n  return pad(1 + timeDay.count(timeYear(d), d), p, 3);\n}\n\nfunction formatMilliseconds(d, p) {\n  return pad(d.getMilliseconds(), p, 3);\n}\n\nfunction formatMicroseconds(d, p) {\n  return formatMilliseconds(d, p) + \"000\";\n}\n\nfunction formatMonthNumber(d, p) {\n  return pad(d.getMonth() + 1, p, 2);\n}\n\nfunction formatMinutes(d, p) {\n  return pad(d.getMinutes(), p, 2);\n}\n\nfunction formatSeconds(d, p) {\n  return pad(d.getSeconds(), p, 2);\n}\n\nfunction formatWeekdayNumberMonday(d) {\n  var day = d.getDay();\n  return day === 0 ? 7 : day;\n}\n\nfunction formatWeekNumberSunday(d, p) {\n  return pad(timeSunday.count(timeYear(d) - 1, d), p, 2);\n}\n\nfunction formatWeekNumberISO(d, p) {\n  var day = d.getDay();\n  d = (day >= 4 || day === 0) ? timeThursday(d) : timeThursday.ceil(d);\n  return pad(timeThursday.count(timeYear(d), d) + (timeYear(d).getDay() === 4), p, 2);\n}\n\nfunction formatWeekdayNumberSunday(d) {\n  return d.getDay();\n}\n\nfunction formatWeekNumberMonday(d, p) {\n  return pad(timeMonday.count(timeYear(d) - 1, d), p, 2);\n}\n\nfunction formatYear(d, p) {\n  return pad(d.getFullYear() % 100, p, 2);\n}\n\nfunction formatFullYear(d, p) {\n  return pad(d.getFullYear() % 10000, p, 4);\n}\n\nfunction formatZone(d) {\n  var z = d.getTimezoneOffset();\n  return (z > 0 ? \"-\" : (z *= -1, \"+\"))\n      + pad(z / 60 | 0, \"0\", 2)\n      + pad(z % 60, \"0\", 2);\n}\n\nfunction formatUTCDayOfMonth(d, p) {\n  return pad(d.getUTCDate(), p, 2);\n}\n\nfunction formatUTCHour24(d, p) {\n  return pad(d.getUTCHours(), p, 2);\n}\n\nfunction formatUTCHour12(d, p) {\n  return pad(d.getUTCHours() % 12 || 12, p, 2);\n}\n\nfunction formatUTCDayOfYear(d, p) {\n  return pad(1 + utcDay.count(utcYear(d), d), p, 3);\n}\n\nfunction formatUTCMilliseconds(d, p) {\n  return pad(d.getUTCMilliseconds(), p, 3);\n}\n\nfunction formatUTCMicroseconds(d, p) {\n  return formatUTCMilliseconds(d, p) + \"000\";\n}\n\nfunction formatUTCMonthNumber(d, p) {\n  return pad(d.getUTCMonth() + 1, p, 2);\n}\n\nfunction formatUTCMinutes(d, p) {\n  return pad(d.getUTCMinutes(), p, 2);\n}\n\nfunction formatUTCSeconds(d, p) {\n  return pad(d.getUTCSeconds(), p, 2);\n}\n\nfunction formatUTCWeekdayNumberMonday(d) {\n  var dow = d.getUTCDay();\n  return dow === 0 ? 7 : dow;\n}\n\nfunction formatUTCWeekNumberSunday(d, p) {\n  return pad(utcSunday.count(utcYear(d) - 1, d), p, 2);\n}\n\nfunction formatUTCWeekNumberISO(d, p) {\n  var day = d.getUTCDay();\n  d = (day >= 4 || day === 0) ? utcThursday(d) : utcThursday.ceil(d);\n  return pad(utcThursday.count(utcYear(d), d) + (utcYear(d).getUTCDay() === 4), p, 2);\n}\n\nfunction formatUTCWeekdayNumberSunday(d) {\n  return d.getUTCDay();\n}\n\nfunction formatUTCWeekNumberMonday(d, p) {\n  return pad(utcMonday.count(utcYear(d) - 1, d), p, 2);\n}\n\nfunction formatUTCYear(d, p) {\n  return pad(d.getUTCFullYear() % 100, p, 2);\n}\n\nfunction formatUTCFullYear(d, p) {\n  return pad(d.getUTCFullYear() % 10000, p, 4);\n}\n\nfunction formatUTCZone() {\n  return \"+0000\";\n}\n\nfunction formatLiteralPercent() {\n  return \"%\";\n}\n\nfunction formatUnixTimestamp(d) {\n  return +d;\n}\n\nfunction formatUnixTimestampSeconds(d) {\n  return Math.floor(+d / 1000);\n}\n","import formatLocale from \"./locale.js\";\n\nvar locale;\nexport var timeFormat;\nexport var timeParse;\nexport var utcFormat;\nexport var utcParse;\n\ndefaultLocale({\n  dateTime: \"%x, %X\",\n  date: \"%-m/%-d/%Y\",\n  time: \"%-I:%M:%S %p\",\n  periods: [\"AM\", \"PM\"],\n  days: [\"Sunday\", \"Monday\", \"Tuesday\", \"Wednesday\", \"Thursday\", \"Friday\", \"Saturday\"],\n  shortDays: [\"Sun\", \"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\", \"Sat\"],\n  months: [\"January\", \"February\", \"March\", \"April\", \"May\", \"June\", \"July\", \"August\", \"September\", \"October\", \"November\", \"December\"],\n  shortMonths: [\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"May\", \"Jun\", \"Jul\", \"Aug\", \"Sep\", \"Oct\", \"Nov\", \"Dec\"]\n});\n\nexport default function defaultLocale(definition) {\n  locale = formatLocale(definition);\n  timeFormat = locale.format;\n  timeParse = locale.parse;\n  utcFormat = locale.utcFormat;\n  utcParse = locale.utcParse;\n  return locale;\n}\n","import {timeFormat, timeParse} from 'd3-time-format';\r\nimport {Category, toolbar, dialogAddons} from './annotations';\r\nimport {IDataRow, IGroupData, IGroup} from './interfaces';\r\nimport {FIRST_IS_MISSING, isMissingValue, missingGroup, isUnknown} from './missing';\r\nimport ValueColumn, {IValueColumnDesc, dataLoaded} from './ValueColumn';\r\nimport {widthChanged, labelChanged, metaDataChanged, dirty, dirtyHeader, dirtyValues, rendererTypeChanged, groupRendererChanged, summaryRendererChanged, visibilityChanged} from './Column';\r\nimport {IEventListener} from '../internal/AEventDispatcher';\r\nimport Column from './Column';\r\nimport {IDateFilter, IDateDesc, noDateFilter, isDateIncluded, isDummyDateFilter, isEqualDateFilter, IDateGrouper, restoreDateFilter, IDateColumn, toDateGroup, isDefaultDateGrouper, defaultDateGrouper} from './IDateColumn';\r\nimport {median} from 'd3-array';\r\nimport {defaultGroup} from './Group';\r\nimport {equal} from '../internal/utils';\r\nimport {numberCompare} from './INumberColumn';\r\n\r\n\r\nexport declare type IDateColumnDesc = IValueColumnDesc<Date> & IDateDesc;\r\n\r\n/**\r\n * emitted when the filter property changes\r\n * @asMemberOf DateColumn\r\n * @event\r\n */\r\nexport declare function filterChanged(previous: IDateFilter | null, current: IDateFilter | null): void;\r\n\r\n/**\r\n * emitted when the grouping property changes\r\n * @asMemberOf DateColumn\r\n * @event\r\n */\r\nexport declare function groupingChanged(previous: IDateGrouper | null, current: IDateGrouper | null): void;\r\n\r\n\r\n@toolbar('groupBy', 'sortGroupBy', 'filterDate')\r\n@dialogAddons('group', 'groupDate')\r\n@Category('date')\r\nexport default class DateColumn extends ValueColumn<Date> implements IDateColumn {\r\n  static readonly EVENT_FILTER_CHANGED = 'filterChanged';\r\n  static readonly EVENT_GROUPING_CHANGED = 'groupingChanged';\r\n\r\n  private readonly format: (date: Date) => string;\r\n  private readonly parse: (date: string) => Date | null;\r\n\r\n  /**\r\n   * currently active filter\r\n   * @type {{min: number, max: number}}\r\n   * @private\r\n   */\r\n  private currentFilter: IDateFilter = noDateFilter();\r\n  private currentGrouper: IDateGrouper = defaultDateGrouper();\r\n\r\n  constructor(id: string, desc: Readonly<IDateColumnDesc>) {\r\n    super(id, desc);\r\n    this.format = timeFormat(desc.dateFormat || '%x');\r\n    this.parse = desc.dateParse ? timeParse(desc.dateParse) : timeParse(desc.dateFormat || '%x');\r\n  }\r\n\r\n  dump(toDescRef: (desc: any) => any) {\r\n    const r = super.dump(toDescRef);\r\n    r.filter = isDummyDateFilter(this.currentFilter) ? null : this.currentFilter;\r\n    if (this.currentGrouper && !isDefaultDateGrouper(this.currentGrouper)) {\r\n      r.grouper = this.currentGrouper;\r\n    }\r\n    return r;\r\n  }\r\n\r\n  restore(dump: any, factory: (dump: any) => Column | null) {\r\n    super.restore(dump, factory);\r\n    if (dump.filter) {\r\n      this.currentFilter = restoreDateFilter(dump.filter);\r\n    }\r\n    if (dump.grouper) {\r\n      this.currentGrouper = dump.grouper;\r\n    }\r\n  }\r\n\r\n  protected createEventList() {\r\n    return super.createEventList().concat([DateColumn.EVENT_FILTER_CHANGED, DateColumn.EVENT_GROUPING_CHANGED]);\r\n  }\r\n\r\n  on(type: typeof DateColumn.EVENT_FILTER_CHANGED, listener: typeof filterChanged | null): this;\r\n  on(type: typeof DateColumn.EVENT_GROUPING_CHANGED, listener: typeof groupingChanged | null): this;\r\n  on(type: typeof ValueColumn.EVENT_DATA_LOADED, listener: typeof dataLoaded | null): this;\r\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\r\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\r\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\r\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\r\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\r\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\r\n  on(type: string | string[], listener: IEventListener | null): this {\r\n    return super.on(<any>type, listener);\r\n  }\r\n\r\n  getValue(row: IDataRow): Date | null {\r\n    return this.getDate(row);\r\n  }\r\n\r\n  getDate(row: IDataRow) {\r\n    const v = super.getValue(row);\r\n    if (isMissingValue(v)) {\r\n      return null;\r\n    }\r\n    if (v instanceof Date) {\r\n      return v;\r\n    }\r\n    return this.parse(String(v));\r\n  }\r\n\r\n  getLabel(row: IDataRow) {\r\n    const v = this.getValue(row);\r\n    if (!(v instanceof Date)) {\r\n      return '';\r\n    }\r\n    return this.format(v);\r\n  }\r\n\r\n  isFiltered() {\r\n    return !isDummyDateFilter(this.currentFilter);\r\n  }\r\n\r\n  getFilter(): IDateFilter {\r\n    return Object.assign({}, this.currentFilter);\r\n  }\r\n\r\n  setFilter(value: IDateFilter = {min: -Infinity, max: +Infinity, filterMissing: false}) {\r\n    if (isEqualDateFilter(value, this.currentFilter)) {\r\n      return;\r\n    }\r\n    const bak = this.getFilter();\r\n    this.currentFilter.min = isUnknown(value.min) ? -Infinity : value.min;\r\n    this.currentFilter.max = isUnknown(value.max) ? Infinity : value.max;\r\n    this.currentFilter.filterMissing = value.filterMissing;\r\n    this.fire([DateColumn.EVENT_FILTER_CHANGED, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY], bak, this.getFilter());\r\n  }\r\n\r\n  /**\r\n   * filter the current row if any filter is set\r\n   * @param row\r\n   * @returns {boolean}\r\n   */\r\n  filter(row: IDataRow) {\r\n    return isDateIncluded(this.currentFilter, this.getDate(row));\r\n  }\r\n\r\n  compare(a: IDataRow, b: IDataRow) {\r\n    const av = this.getDate(a);\r\n    const bv = this.getDate(b);\r\n    if (av === bv) {\r\n      return 0;\r\n    }\r\n    if (!(av instanceof Date)) {\r\n      return (bv instanceof Date) ? FIRST_IS_MISSING : 0;\r\n    }\r\n    if (!(bv instanceof Date)) {\r\n      return FIRST_IS_MISSING * -1;\r\n    }\r\n    return av.getTime() - bv.getTime();\r\n  }\r\n\r\n  getDateGrouper() {\r\n    return Object.assign({}, this.currentGrouper);\r\n  }\r\n\r\n  setDateGrouper(value: IDateGrouper) {\r\n    if (equal(this.currentGrouper, value)) {\r\n      return;\r\n    }\r\n    const bak = this.getDateGrouper();\r\n    this.currentGrouper = Object.assign({}, value);\r\n    this.fire([DateColumn.EVENT_GROUPING_CHANGED, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY], bak, value);\r\n  }\r\n\r\n  group(row: IDataRow): IGroup {\r\n    const v = this.getDate(row);\r\n    if (!v || !(v instanceof Date)) {\r\n      return missingGroup;\r\n    }\r\n    if (!this.currentGrouper) {\r\n      return defaultGroup;\r\n    }\r\n    const g = toDateGroup(this.currentGrouper, v);\r\n    return {\r\n      name: g.name,\r\n      color: Column.DEFAULT_COLOR\r\n    };\r\n  }\r\n\r\n  groupCompare(a: IGroupData, b: IGroupData): number {\r\n    const av = choose(a.rows, this.currentGrouper, this).value;\r\n    const bv = choose(b.rows, this.currentGrouper, this).value;\r\n    return numberCompare(av, bv, false, false);\r\n  }\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport function choose(rows: IDataRow[], grouper: IDateGrouper | null, col: IDateColumn): { value: number | null, name: string } {\r\n  const vs = <Date[]>rows.map((d) => col.getDate(d)).filter((d) => d instanceof Date);\r\n  if (vs.length === 0) {\r\n    return {value: null, name: ''};\r\n  }\r\n  const median = trueMedian(vs, (d) => d.getTime())!;\r\n  if (!grouper) {\r\n    return {value: median, name: (new Date(median)).toString()};\r\n  }\r\n  return toDateGroup(grouper, new Date(median));\r\n}\r\n\r\nfunction trueMedian(dates: Date[], acc: (d: Date) => number) {\r\n  if (dates.length % 2 === 1) {\r\n    return median(dates, acc);\r\n  }\r\n  // to avoid interpolating between the centers do it manually\r\n  const s = dates.slice().sort((a, b) => a.getTime() - b.getTime());\r\n  return s[Math.floor(s.length / 2)].getTime();\r\n}\r\n","import Column from '../../model/Column';\r\nimport {IRankingHeaderContext} from '../interfaces';\r\nimport ADialog, {IDialogContext} from './ADialog';\r\nimport {uniqueId} from './utils';\r\n\r\n/** @internal */\r\nexport default class ChangeRendererDialog extends ADialog {\r\n  constructor(private readonly column: Column, dialog: IDialogContext, private readonly ctx: IRankingHeaderContext) {\r\n    super(dialog);\r\n  }\r\n\r\n  protected build(node: HTMLElement) {\r\n    const current = this.column.getRenderer();\r\n    const currentGroup = this.column.getGroupRenderer();\r\n    const currentSummary = this.column.getSummaryRenderer();\r\n    const {item, group, summary} = this.ctx.getPossibleRenderer(this.column);\r\n\r\n    console.assert(item.length > 1 || group.length > 1 || summary.length > 1); // otherwise no need to show this\r\n\r\n    const id = uniqueId(this.dialog.idPrefix);\r\n    node.insertAdjacentHTML('beforeend', `\r\n      <strong>Item Visualization</strong>\r\n      ${item.sort((a, b) => a.label.localeCompare(b.label)).map((d) => ` <div class=\"lu-checkbox\"><input id=\"${id}0${d.type}\" type=\"radio\" name=\"renderer\" value=\"${d.type}\" ${(current === d.type) ? 'checked' : ''}><label for=\"${id}0${d.type}\">${d.label}</label></div>`).join('')}\r\n      <strong>Group Visualization</strong>\r\n      ${group.sort((a, b) => a.label.localeCompare(b.label)).map((d) => ` <div class=\"lu-checkbox\"><input id=\"${id}1${d.type}\" type=\"radio\" name=\"group\" value=\"${d.type}\" ${(currentGroup === d.type) ? 'checked' : ''}><label for=\"${id}1${d.type}\">${d.label}</label></div>`).join('')}\r\n      <strong>Summary Visualization</strong>\r\n      ${summary.sort((a, b) => a.label.localeCompare(b.label)).map((d) => ` <div class=\"lu-checkbox\"><input id=\"${id}2${d.type}\" type=\"radio\" name=\"summary\" value=\"${d.type}\" ${(currentSummary === d.type) ? 'checked' : ''}><label for=\"${id}2${d.type}\">${d.label}</label></div>`).join('')}\r\n    `);\r\n    this.forEach('input[name=\"renderer\"]', (n: HTMLInputElement) => {\r\n      n.addEventListener('change', () => this.column.setRenderer(n.value), { passive: true });\r\n    });\r\n    this.forEach('input[name=\"group\"]', (n: HTMLInputElement) => {\r\n      n.addEventListener('change', () => this.column.setGroupRenderer(n.value), { passive: true });\r\n    });\r\n    this.forEach('input[name=\"summary\"]', (n: HTMLInputElement) => {\r\n      n.addEventListener('change', () => this.column.setSummaryRenderer(n.value), { passive: true });\r\n    });\r\n  }\r\n\r\n}\r\n","import colors from \"../colors.js\";\n\nexport default colors(\"1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf\");\n","import {IColumnMetaData} from '../../model';\r\nimport Column from '../../model/Column';\r\nimport ADialog, {IDialogContext} from './ADialog';\r\nimport {uniqueId} from '../../renderer/utils';\r\nimport {schemeCategory10} from 'd3-scale-chromatic';\r\n\r\n/** @internal */\r\nexport default class RenameDialog extends ADialog {\r\n\r\n  private readonly before: IColumnMetaData;\r\n\r\n  constructor(private readonly column: Column, dialog: IDialogContext) {\r\n    super(dialog, {\r\n      fullDialog: true\r\n    });\r\n    this.before = column.getMetaData();\r\n  }\r\n\r\n  protected build(node: HTMLElement) {\r\n    node.classList.add('lu-rename-dialog');\r\n    const id = uniqueId('col');\r\n    node.insertAdjacentHTML('beforeend', `\r\n      <datalist id=\"${id}L\"><option value=\"${Column.DEFAULT_COLOR}\"></option>${schemeCategory10.slice(1).map((d) => `<option>${d}</option>`).join('')}</datalist>\r\n      <input type=\"text\" value=\"${this.column.label}\" required autofocus placeholder=\"name\">\r\n      <textarea rows=\"5\" placeholder=\"Description\">${this.column.description}</textarea>`);\r\n  }\r\n\r\n  protected reset() {\r\n    this.findInput('input[type=\"text\"]').value = this.before.label;\r\n    this.node.querySelector('textarea')!.value = this.before.description;\r\n    this.column.setMetaData(this.before);\r\n  }\r\n\r\n  protected submit() {\r\n    const newValue = this.findInput('input[type=\"text\"]').value;\r\n    const newDescription = this.node.querySelector('textarea')!.value;\r\n    this.column.setMetaData({label: newValue, description: newDescription});\r\n    return true;\r\n  }\r\n}\r\n","import BooleanColumn from '../../model/BooleanColumn';\r\nimport ADialog, {IDialogContext} from './ADialog';\r\nimport {updateFilterState, uniqueId} from './utils';\r\n\r\n/** @internal */\r\nexport default class BooleanFilterDialog extends ADialog {\r\n\r\n  private readonly before: boolean | null;\r\n\r\n  constructor(private readonly column: BooleanColumn, dialog: IDialogContext) {\r\n    super(dialog, {\r\n      fullDialog: true\r\n    });\r\n    this.before = this.column.getFilter();\r\n  }\r\n\r\n  protected build(node: HTMLElement) {\r\n    const id = uniqueId(this.dialog.idPrefix);\r\n    node.insertAdjacentHTML('beforeend', `\r\n     <div class=\"lu-checkbox\"><input id=\"${id}0\" type=\"radio\" name=\"boolean_check\" value=\"null\" ${this.before == null ? 'checked=\"checked\"' : ''}><label id=\"${id}0\">No Filter</label></div>\r\n     <div class=\"lu-checkbox\"><input id=\"${id}1\" type=\"radio\" name=\"boolean_check\" value=\"true\" ${this.before === true ? 'checked=\"checked\"' : ''}><label id=\"${id}1\">True</label></div>\r\n     <div class=\"lu-checkbox\"><input id=\"${id}2\" type=\"radio\" name=\"boolean_check\" value=\"false\" ${this.before === false ? 'checked=\"checked\"' : ''}><label id=\"${id}2\">False</label></div>\r\n    `);\r\n  }\r\n\r\n  private updateFilter(filter: boolean | null) {\r\n    updateFilterState(this.attachment, this.column, filter != null);\r\n    this.column.setFilter(filter);\r\n  }\r\n\r\n  reset() {\r\n    const v = 'null';\r\n    this.forEach('input[type=\"radio\"]', (d: HTMLInputElement) => d.checked = d.value === v);\r\n    this.updateFilter(null);\r\n  }\r\n\r\n  submit() {\r\n    const isTrue = this.findInput('input[type=\"radio\"][value=\"true\"]').checked;\r\n    const isFalse = this.findInput('input[type=\"radio\"][value=\"false\"]').checked;\r\n    this.updateFilter(isTrue ? true : (isFalse ? false : null));\r\n    return true;\r\n  }\r\n}\r\n","import CategoricalColumn from '../../model/CategoricalColumn';\r\nimport {ICategoricalFilter, isCategoryIncluded} from '../../model/ICategoricalColumn';\r\nimport SetColumn from '../../model/SetColumn';\r\nimport {filterMissingMarkup, findFilterMissing} from '../missing';\r\nimport ADialog, {IDialogContext} from './ADialog';\r\nimport {updateFilterState, uniqueId, forEach} from './utils';\r\n\r\n/** @internal */\r\nexport default class CategoricalFilterDialog extends ADialog {\r\n\r\n  private readonly before: ICategoricalFilter;\r\n\r\n  constructor(private readonly column: CategoricalColumn | SetColumn, dialog: IDialogContext) {\r\n    super(dialog, {\r\n      fullDialog: true\r\n    });\r\n    this.before = this.column.getFilter() || {filter: this.column.categories.map((d) => d.name), filterMissing: false};\r\n  }\r\n\r\n  protected build(node: HTMLElement) {\r\n    node.classList.add('lu-filter-table');\r\n\r\n    const id = uniqueId(this.dialog.idPrefix);\r\n\r\n    node.insertAdjacentHTML('beforeend', `<div>\r\n        <div class=\"lu-checkbox\"><input id=\"${id}\" type=\"checkbox\" checked><label for=\"${id}\"><span></span><div>Un/Select All</div></label></div>\r\n        ${this.column.categories.map((c) => `<div class=\"lu-checkbox\"><input id=\"${id}${c.name}\" data-cat=\"${c.name}\" type=\"checkbox\"${isCategoryIncluded(this.before, c) ? 'checked' : ''}><label for=\"${id}${c.name}\"><span style=\"background-color: ${c.color}\"></span><div>${c.label}</div></label></div>`).join('')}\r\n    </div>`);\r\n    // selectAll\r\n    this.findInput('input:not([data-cat])').onchange = function (this: GlobalEventHandlers) {\r\n      const input = <HTMLInputElement>this;\r\n      forEach(node, 'input[data-cat]', (n: HTMLInputElement) => n.checked = input.checked);\r\n    };\r\n    node.insertAdjacentHTML('beforeend', filterMissingMarkup(this.before.filterMissing, this.dialog.idPrefix));\r\n  }\r\n\r\n  private updateFilter(filter: string[] | null, filterMissing: boolean) {\r\n    const noFilter = filter == null && filterMissing === false;\r\n    updateFilterState(this.attachment, this.column, !noFilter);\r\n    this.column.setFilter(noFilter ? null : {filter: filter!, filterMissing});\r\n  }\r\n\r\n  reset() {\r\n    this.forEach('input[data-cat]', (n: HTMLInputElement) => n.checked = true);\r\n    this.updateFilter(null, false);\r\n  }\r\n\r\n  submit() {\r\n    let f: string[] | null = this.forEach('input[data-cat]', (n: HTMLInputElement) => n.checked ? n.dataset.cat! : '').filter(Boolean);\r\n    if (f.length === this.column.categories.length) { // all checked = no filter\r\n      f = null;\r\n    }\r\n    const filterMissing = findFilterMissing(this.node).checked;\r\n    this.updateFilter(f, filterMissing);\r\n    return true;\r\n  }\r\n}\r\n","import {round} from '../../internal';\r\nimport OrdinalColumn from '../../model/OrdinalColumn';\r\nimport {ICategoricalFilter, isCategoryIncluded} from '../../model/ICategoricalColumn';\r\nimport {filterMissingMarkup, findFilterMissing} from '../missing';\r\nimport ADialog, {IDialogContext} from './ADialog';\r\nimport {updateFilterState, uniqueId, forEach} from './utils';\r\n\r\n/** @internal */\r\nexport default class CategoricalMappingFilterDialog extends ADialog {\r\n\r\n  private readonly before: ICategoricalFilter;\r\n\r\n  constructor(private readonly column: OrdinalColumn, dialog: IDialogContext) {\r\n    super(dialog, {\r\n      fullDialog: true\r\n    });\r\n    this.before = this.column.getFilter() || {filter: this.column.categories.map((d) => d.name), filterMissing: false};\r\n  }\r\n\r\n  protected build(node: HTMLElement) {\r\n    node.classList.add('lu-filter-table');\r\n    const joint = this.column.categories.map((d) => Object.assign({\r\n      range: round(d.value * 100, 2)\r\n    }));\r\n    joint.sort((a, b) => a.label.localeCompare(b.label));\r\n\r\n    const id = uniqueId(this.dialog.idPrefix);\r\n    node.insertAdjacentHTML('beforeend', `<div>\r\n        <div class=\"lu-checkbox\"><input id=\"${id}\" type=\"checkbox\" checked><label for=\"${id}\"><div>Un/Select All</div></label></div>\r\n        ${joint.map(({name, color, label, range}) => `<input id=\"${id}${name}\" data-cat=\"${name}\" type=\"checkbox\"${isCategoryIncluded(this.before, name) ? 'checked' : ''}>\r\n        <div class=\"lu-checkbox\"><input type=\"number\" value=\"${range}\" min=\"0\" max=\"100\" size=\"5\"><label for=\"${id}${name}\"><div><div style=\"background-color: ${color}; width: ${range}%\"></div></div><div>${label}</div></label></div>`).join('')}\r\n    </div>`);\r\n    // selectAll\r\n    this.findInput('input[type=checkbox]:not([data-cat])').onchange = function (this: GlobalEventHandlers) {\r\n      const input = <HTMLInputElement>this;\r\n      forEach(node, '[data-cat]', (n: HTMLInputElement) => n.checked = input.checked);\r\n    };\r\n    this.forEach('input[type=number]', (d: HTMLInputElement) => {\r\n      d.oninput = () => {\r\n        (<HTMLElement>d.nextElementSibling!.firstElementChild).style.width = `${d.value}%`;\r\n      };\r\n    });\r\n    node.insertAdjacentHTML('beforeend', filterMissingMarkup(this.before.filterMissing, this.dialog.idPrefix));\r\n  }\r\n\r\n  private updateFilter(filter: string[] | null, filterMissing: boolean) {\r\n    const noFilter = filter == null && filterMissing === false;\r\n    updateFilterState(this.attachment, this.column, !noFilter);\r\n    this.column.setFilter(noFilter ? null : {filter: filter!, filterMissing});\r\n  }\r\n\r\n  reset() {\r\n    this.forEach('[data-cat]', (n: HTMLInputElement) => {\r\n      n.checked = false;\r\n      (<HTMLInputElement>n.nextElementSibling!).value = '50';\r\n    });\r\n    this.updateFilter(null, false);\r\n    this.column.setMapping(this.column.categories.map(() => 1));\r\n  }\r\n\r\n  submit() {\r\n    const items = this.forEach('input[data-cat]', (n: HTMLInputElement) => ({\r\n      checked: n.checked,\r\n      cat: n.dataset.cat!,\r\n      range: parseFloat((<HTMLInputElement>n.nextElementSibling)!.value)\r\n    }));\r\n    let f: string[] | null = items.filter((d) => d.checked).map((d) => d.cat);\r\n    if (f.length === this.column.categories.length) { // all checked = no filter\r\n      f = null;\r\n    }\r\n    const filterMissing = findFilterMissing(this.node).checked;\r\n    this.updateFilter(f, filterMissing);\r\n    this.column.setMapping(items.map((d) => d.range / 100));\r\n    return true;\r\n  }\r\n}\r\n","import {suffix} from '../../internal/AEventDispatcher';\r\nimport debounce from '../../internal/debounce';\r\nimport CompositeColumn from '../../model/CompositeColumn';\r\nimport {createHeader, updateHeader} from '../header';\r\nimport {IRankingHeaderContext} from '../interfaces';\r\nimport ADialog, {IDialogContext} from './ADialog';\r\n\r\n/** @internal */\r\nexport default class CompositeChildrenDialog extends ADialog {\r\n\r\n  private readonly id: string;\r\n\r\n  constructor(private readonly column: CompositeColumn, dialog: IDialogContext, private ctx: IRankingHeaderContext) {\r\n    super(dialog);\r\n    this.id = `.dialog${Math.random().toString(36).slice(-8).substr(0, 3)}`;\r\n  }\r\n\r\n  destroy() {\r\n    this.column.on(suffix(this.id, CompositeColumn.EVENT_ADD_COLUMN, CompositeColumn.EVENT_REMOVE_COLUMN), null);\r\n    super.destroy();\r\n  }\r\n\r\n  protected build(node: HTMLElement) {\r\n    node.classList.add('lu-sub-nested');\r\n    const createChildren = () => {\r\n      this.column.children.forEach((c) => {\r\n        const n = createHeader(c, this.ctx, {\r\n          mergeDropAble: false,\r\n          resizeable: false,\r\n          level: this.dialog.level + 1\r\n        });\r\n        n.className = `lu-header`;\r\n        updateHeader(n, c);\r\n        const summary = this.ctx.summaryRenderer(c, false);\r\n        n.insertAdjacentHTML('beforeend', summary.template);\r\n        const summaryNode = <HTMLElement>n.lastElementChild!;\r\n        summaryNode.dataset.renderer = c.getSummaryRenderer();\r\n        summaryNode.classList.add('lu-summary');\r\n        summary.update(summaryNode, this.ctx.statsOf(<any>c));\r\n        node.appendChild(n);\r\n      });\r\n    };\r\n    createChildren();\r\n\r\n    this.column.on(suffix(this.id, CompositeColumn.EVENT_ADD_COLUMN, CompositeColumn.EVENT_REMOVE_COLUMN), debounce(() => {\r\n      if (!node.parentElement) {\r\n        // already closed\r\n        this.destroy();\r\n        return;\r\n      }\r\n      node.innerHTML = '';\r\n      createChildren();\r\n    }));\r\n  }\r\n}\r\n","import HierarchyColumn, {ICategoryInternalNode, ICutOffNode, resolveInnerNodes} from '../../model/HierarchyColumn';\r\nimport ADialog, {IDialogContext} from './ADialog';\r\n\r\n/** @internal */\r\nexport default class CutOffHierarchyDialog extends ADialog {\r\n\r\n  private readonly innerNodes: ICategoryInternalNode[];\r\n  private readonly innerNodePaths: string[];\r\n\r\n  private readonly before: ICutOffNode;\r\n\r\n\r\n  constructor(private readonly column: HierarchyColumn, dialog: IDialogContext, private readonly idPrefix: string) {\r\n    super(dialog, {\r\n      fullDialog: true\r\n    });\r\n\r\n    this.innerNodes = resolveInnerNodes(this.column.hierarchy);\r\n    this.innerNodePaths = this.innerNodes.map((n) => n.path);\r\n    this.before = column.getCutOff();\r\n  }\r\n\r\n  protected build(node: HTMLElement) {\r\n    node.insertAdjacentHTML('beforeend', `\r\n        <input type=\"text\" value=\"${this.before.node.label}\" required=\"required\" autofocus=\"autofocus\" list=\"ui${this.idPrefix}lineupHierarchyList\" placeholder=\"cut off node\">\r\n        <input type=\"number\" value=\"${isFinite(this.before.maxDepth) ? this.before.maxDepth : ''}\" placeholder=\"max depth (&infin;)\">\r\n        <datalist id=\"ui${this.idPrefix}lineupHierarchyList\">${this.innerNodes.map((node) => `<option value=\"${node.path}\">${node.label}</option>`)}</datalist>`);\r\n\r\n    //custom validation\r\n    const innerNodePaths = this.innerNodePaths;\r\n    this.findInput('input[type=\"text\"]').addEventListener('change', function (this: HTMLInputElement) {\r\n      const value = this.value;\r\n      if (innerNodePaths.indexOf(value) < 0) {\r\n        this.setCustomValidity('invalid node');\r\n      } else {\r\n        this.setCustomValidity('');\r\n      }\r\n    }, {\r\n      passive: true\r\n    });\r\n  }\r\n\r\n  protected reset() {\r\n    this.findInput('input[type=\"text\"]').value = this.before.node.label;\r\n    this.findInput('input[type=\"number\"]').value = isFinite(this.before.maxDepth) ? String(this.before.maxDepth) : '';\r\n    this.column.setCutOff(this.before);\r\n  }\r\n\r\n  protected submit() {\r\n    const newNode = this.findInput('input[type=\"text\"]').value;\r\n    const newNodeIndex = this.innerNodePaths.indexOf(newNode);\r\n    const node = this.innerNodes[newNodeIndex];\r\n    const maxDepthText = this.findInput('input[type=\"number\"]').value;\r\n    const maxDepth = maxDepthText === '' ? Infinity : parseInt(maxDepthText, 10);\r\n    this.column.setCutOff({node, maxDepth});\r\n    return true;\r\n  }\r\n}\r\n","import LinkColumn from '../../model/LinkColumn';\r\nimport LinkMapColumn from '../../model/LinkMapColumn';\r\nimport LinksColumn from '../../model/LinksColumn';\r\nimport ADialog, {IDialogContext} from './ADialog';\r\n\r\n/** @internal */\r\nexport default class EditPatternDialog extends ADialog {\r\n\r\n  constructor(private readonly column: LinkColumn | LinksColumn | LinkMapColumn, dialog: IDialogContext, private readonly idPrefix: string) {\r\n    super(dialog, {\r\n      fullDialog: true\r\n    });\r\n  }\r\n\r\n  protected build(node: HTMLElement) {\r\n    const templates = this.column.patternTemplates;\r\n    node.insertAdjacentHTML('beforeend', `<strong>Edit Pattern (access via $\\{value}, $\\{item})</strong><input\r\n        type=\"text\"\r\n        size=\"30\"\r\n        value=\"${this.column.getPattern()}\"\r\n        required\r\n        autofocus\r\n        placeholder=\"pattern (access via $\\{value}, $\\{item})\"\r\n        ${templates.length > 0 ? `list=\"ui${this.idPrefix}lineupPatternList\"` : ''}\r\n      >`);\r\n    if (templates.length > 0) {\r\n      node.insertAdjacentHTML('beforeend', `<datalist id=\"ui${this.idPrefix}lineupPatternList\">${templates.map((t) => `<option value=\"${t}\">`)}</datalist>`);\r\n    }\r\n  }\r\n\r\n  protected reset() {\r\n    this.node.querySelector('input')!.value = '';\r\n    this.column.setPattern('');\r\n  }\r\n\r\n  protected submit() {\r\n    const newValue = this.node.querySelector('input')!.value;\r\n    this.column.setPattern(newValue);\r\n    return true;\r\n  }\r\n}\r\n","import {IMapAbleColumn} from '../../model';\r\nimport {ISummaryRenderer} from '../../renderer/interfaces';\r\nimport {IRankingHeaderContext} from '../interfaces';\r\nimport ADialog, {IDialogContext} from './ADialog';\r\n\r\n/** @internal */\r\nexport default class NumberFilterDialog extends ADialog {\r\n  private readonly summary: ISummaryRenderer;\r\n\r\n  constructor(private readonly column: IMapAbleColumn, dialog: IDialogContext, private readonly ctx: IRankingHeaderContext) {\r\n    super(dialog);\r\n\r\n    this.summary = ctx.summaryRenderer(this.column, true);\r\n  }\r\n\r\n  build(node: HTMLElement) {\r\n    node.classList.add('lu-dialog-mapper');\r\n\r\n    // patch in lu-summary and renderer\r\n    node.insertAdjacentHTML('beforeend', this.summary.template);\r\n    const summary = <HTMLElement>node.lastElementChild!;\r\n    summary.classList.add('lu-summary', 'lu-renderer');\r\n    summary.dataset.renderer = this.column.getSummaryRenderer();\r\n    summary.dataset.interactive = '';\r\n    node.appendChild(summary);\r\n\r\n    this.summary.update(<HTMLElement>this.node.querySelector('.lu-summary')!, this.ctx.statsOf(this.column));\r\n  }\r\n}\r\n","import {EAdvancedSortMethod} from '../../model/INumberColumn';\r\nimport ReduceColumn from '../../model/ReduceColumn';\r\nimport ADialog, {IDialogContext} from './ADialog';\r\nimport {sortMethods} from './utils';\r\n\r\n/** @internal */\r\nexport default class ReduceDialog extends ADialog {\r\n  constructor(private readonly column: ReduceColumn, dialog: IDialogContext) {\r\n    super(dialog);\r\n  }\r\n\r\n  protected build(node: HTMLElement) {\r\n    const wrapper = {\r\n      getSortMethod: () => this.column.getReduce(),\r\n      setSortMethod: (s: EAdvancedSortMethod) => this.column.setReduce(s)\r\n    };\r\n    sortMethods(node, wrapper, Object.keys(EAdvancedSortMethod), this.dialog.idPrefix);\r\n  }\r\n}\r\n","import ScriptColumn from '../../model/ScriptColumn';\r\nimport ADialog, {IDialogContext} from './ADialog';\r\n//\r\n// const help = `<div class=\"script-description\">\r\n//       <p>You can write any valid JavaScript code. It will be embedded in a function. Therefore the last statement has to return a value.\r\n//       In case of a single line statement the code piece statement <code>return</code> will be automatically prefixed.</p>\r\n//       <p>The function signature is: <br><code>(row: any, index: number, children: Column[], values: any[], raws: (number|null)[]) => number</code>\r\n//       <dl>\r\n//         <dt>param: <code>row</code></dt>\r\n//         <dd>the row in the dataset to compute the value for</dd>\r\n//         <dt>param: <code>index</code></dt>\r\n//         <dd>the index of the row</dd>\r\n//         <dt>param: <code>children</code></dt>\r\n//         <dd>the list of LineUp columns that are part of this ScriptColumn</dd>\r\n//         <dt>param: <code>values</code></dt>\r\n//         <dd>the computed value of each column (see <code>children</code>) for the current row</dd>\r\n//         <dt>param: <code>raws</code></dt>\r\n//         <dd>similar to <code>values</code>. Numeric columns return by default the normalized value, this array gives access to the original \"raw\" values before mapping is applied</dd>\r\n//         <dt>returns:</dt>\r\n//         <dd>the computed number <strong>in the range [0, 1] or NaN</strong></dd>\r\n//       </dl>\r\n//       <p>In addition to the standard JavaScript functions and objects (Math, ...) a couple of utility functions are available: </p>\r\n//       <dl>\r\n//         <dt><code>max(arr: number[]) => number</code></dt>\r\n//         <dd>computes the maximum of the given array of numbers</dd>\r\n//         <dt><code>min(arr: number[]) => number</code></dt>\r\n//         <dd>computes the minimum of the given array of numbers</dd>\r\n//         <dt><code>extent(arr: number[]) => [number, number]</code></dt>\r\n//         <dd>computes both minimum and maximum and returning an array with the first element the minimum and the second the maximum</dd>\r\n//         <dt><code>clamp(v: number, min: number, max: number) => number</code></dt>\r\n//         <dd>ensures that the given value is within the given min/max value</dd>\r\n//         <dt><code>normalize(v: number, min: number, max: number) => number</code></dt>\r\n//         <dd>normalizes the given value <code>(v - min) / (max - min)</code></dd>\r\n//         <dt><code>denormalize(v: number, min: number, max: number) => number</code></dt>\r\n//         <dd>inverts a normalized value <code>v * (max - min) + min</code></dd>\r\n//         <dt><code>linear(v: number, input: [number, number], output: [number, number]) => number</code></dt>\r\n//         <dd>performs a linear mapping from input domain to output domain both given as an array of [min, max] values. <code>denormalize(normalize(v, input[0], input[1]), output[0], output[1])</code></dd>\r\n//       </dl>\r\n//       </div>`;\r\n\r\n/** @internal */\r\nexport default class ScriptEditDialog extends ADialog {\r\n  private readonly before: string;\r\n\r\n  constructor(private readonly column: ScriptColumn, dialog: IDialogContext) {\r\n    super(dialog, {\r\n      fullDialog: true\r\n    });\r\n    this.before = column.getScript();\r\n  }\r\n\r\n  protected build(node: HTMLElement) {\r\n    node.insertAdjacentHTML('beforeend', `<textarea autofocus=\"true\" rows=\"5\" autofocus=\"autofocus\" style=\"width: 95%;\">${this.column.getScript()}</textarea>`);\r\n  }\r\n\r\n  protected reset() {\r\n    this.node.querySelector('textarea')!.value = this.before;\r\n    this.column.setScript(this.before);\r\n  }\r\n\r\n  protected submit() {\r\n    this.column.setScript(this.node.querySelector('textarea')!.value);\r\n    return true;\r\n  }\r\n}\r\n","import Column from '../../model/Column';\r\nimport {IDataProvider} from '../../provider/ADataProvider';\r\nimport ADialog, { IDialogContext} from './ADialog';\r\nimport {uniqueId} from './utils';\r\n\r\n/** @internal */\r\nexport default class SearchDialog extends ADialog {\r\n\r\n  constructor(private readonly column: Column, dialog: IDialogContext, private readonly provider: IDataProvider) {\r\n    super(dialog);\r\n  }\r\n\r\n  protected build(node: HTMLElement) {\r\n    const id = uniqueId(this.dialog.idPrefix);\r\n    node.insertAdjacentHTML('beforeend', `<input type=\"text\" size=\"20\" value=\"\" required autofocus placeholder=\"search... (>= 3 chars)\"><div class=\"lu-checkbox\"><input id=\"${id}\" type=\"checkbox\"><label for=\"${id}\">Use regular expressions</label></div>`);\r\n\r\n    const input = <HTMLInputElement>node.querySelector('input[type=\"text\"]')!;\r\n    const checkbox = <HTMLInputElement>node.querySelector('input[type=\"checkbox\"]')!;\r\n    const update = () => {\r\n      let search: any = input.value;\r\n      if (search.length < 3) {\r\n        input.setCustomValidity('at least 3 characters');\r\n        return;\r\n      }\r\n      input.setCustomValidity('');\r\n      const isRegex = checkbox.checked;\r\n      if (isRegex) {\r\n        search = new RegExp(search);\r\n      }\r\n      this.provider.searchAndJump(search, this.column);\r\n    };\r\n    input.addEventListener('input', update, {\r\n      passive: true\r\n    });\r\n    checkbox.addEventListener('change', update, {\r\n      passive: true\r\n    });\r\n  }\r\n}\r\n","import StringColumn from '../../model/StringColumn';\r\nimport {filterMissingMarkup, findFilterMissing} from '../missing';\r\nimport ADialog, {IDialogContext} from './ADialog';\r\nimport {updateFilterState, uniqueId} from './utils';\r\n\r\n/** @internal */\r\nexport default class StringFilterDialog extends ADialog {\r\n\r\n  constructor(private readonly column: StringColumn, dialog: IDialogContext) {\r\n    super(dialog, {\r\n      fullDialog: true\r\n    });\r\n  }\r\n\r\n  private updateFilter(filter: string | RegExp | null) {\r\n    updateFilterState(this.attachment, this.column, filter != null && filter !== '');\r\n    this.column.setFilter(filter);\r\n  }\r\n\r\n  reset() {\r\n    this.findInput('input[type=\"text\"]').value = '';\r\n    this.forEach('input[type=checkbox]', (n: HTMLInputElement) => n.checked = false);\r\n    this.updateFilter(null);\r\n  }\r\n\r\n  submit() {\r\n    const filterMissing = findFilterMissing(this.node).checked;\r\n    if (filterMissing) {\r\n      this.updateFilter(StringColumn.FILTER_MISSING);\r\n      return true;\r\n    }\r\n    const input = this.findInput('input[type=\"text\"]').value;\r\n    const isRegex = this.findInput('input[type=\"checkbox\"]').checked;\r\n    this.updateFilter(isRegex ? new RegExp(input,'gm') : input);\r\n    return true;\r\n  }\r\n\r\n  protected build(node: HTMLElement) {\r\n    let bak = this.column.getFilter() || '';\r\n    const bakMissing = bak === StringColumn.FILTER_MISSING;\r\n    if (bakMissing) {\r\n      bak = '';\r\n    }\r\n    const id = uniqueId(this.dialog.idPrefix);\r\n    node.insertAdjacentHTML('beforeend', `<input type=\"text\" placeholder=\"Filter ${this.column.desc.label}...\" autofocus value=\"${(bak instanceof RegExp) ? bak.source : bak}\" style=\"width: 100%\">\r\n    <span class=\"lu-checkbox\"><input id=\"${id}\" type=\"checkbox\" ${(bak instanceof RegExp) ? 'checked=\"checked\"' : ''}><label for=\"${id}\">Use regular expressions</label></span>\r\n    ${filterMissingMarkup(bakMissing, this.dialog.idPrefix)}`);\r\n\r\n    const filterMissing = findFilterMissing(node);\r\n    const input = <HTMLInputElement>node.querySelector('input[type=\"text\"]');\r\n    const isRegex = <HTMLInputElement>node.querySelector('input[type=\"checkbox\"]');\r\n\r\n    const update = () => {\r\n      input.disabled = filterMissing.checked;\r\n      isRegex.disabled = filterMissing.checked;\r\n\r\n      if (filterMissing.checked) {\r\n        this.updateFilter(StringColumn.FILTER_MISSING);\r\n        return;\r\n      }\r\n      const valid = input.value.trim();\r\n      filterMissing.disabled = valid.length > 0;\r\n      if (valid.length <= 0) {\r\n        this.updateFilter(null);\r\n        return;\r\n      }\r\n      this.updateFilter(isRegex.checked ? new RegExp(input.value, 'gm') : input.value);\r\n    };\r\n\r\n    filterMissing.onchange = update;\r\n    input.onchange = update;\r\n    isRegex.onchange = update;\r\n  }\r\n}\r\n","import {round} from '../../internal';\r\nimport StackColumn from '../../model/StackColumn';\r\nimport ADialog, {IDialogContext} from './ADialog';\r\nimport {forEach, colorOf} from './utils';\r\n\r\n/** @internal */\r\nexport default class WeightsEditDialog extends ADialog {\r\n\r\n  private readonly weights: number[];\r\n\r\n  constructor(private readonly column: StackColumn, dialog: IDialogContext) {\r\n    super(dialog, {\r\n      fullDialog: true\r\n    });\r\n\r\n    this.weights = this.column.getWeights();\r\n  }\r\n\r\n  protected reset() {\r\n    forEach(this.node, 'input[type=number]', (n: HTMLInputElement) => {\r\n      const v = round(100 / this.weights.length, 2);\r\n      n.value = String(v);\r\n      (<HTMLElement>n.nextElementSibling!.firstElementChild!).style.width = `${v}%`;\r\n    });\r\n    this.column.setWeights(this.weights.slice().fill(100 / this.weights.length));\r\n  }\r\n\r\n  protected build(node: HTMLElement) {\r\n    node.classList.add('lu-filter-table', 'lu-weights-table');\r\n\r\n    const children = this.column.children;\r\n    node.insertAdjacentHTML('beforeend', `<div>\r\n        ${this.weights.map((weight, i) => `<div><input type=\"number\" value=\"${round(weight * 100, 2)}\" min=\"0\" max=\"100\" step=\"any\"><span><span style=\"background-color: ${colorOf(children[i])}; width: ${round(weight * 100, 2)}%\"></span></span>${children[i].label}</div>`).join('')}\r\n    </div>`);\r\n    this.forEach('input[type=number]', (d: HTMLInputElement) => {\r\n      d.oninput = () => {\r\n        (<HTMLElement>d.nextElementSibling!.firstElementChild!).style.width = `${d.value}%`;\r\n      };\r\n    });\r\n  }\r\n\r\n  submit() {\r\n    const items = this.forEach('input[type=number]', (n: HTMLInputElement) => parseFloat(n.value) / 100);\r\n    this.column.setWeights(items);\r\n    return true;\r\n  }\r\n}\r\n","import Column from '../../model/Column';\r\nimport ADialog, {IDialogContext} from './ADialog';\r\nimport {uniqueId, forEach} from './utils';\r\nimport {getToolbarDialogAddons, IToolbarDialogAddon} from '../toolbar';\r\nimport {IRankingHeaderContext} from '../interfaces';\r\n\r\n/** @internal */\r\nexport default class GroupDialog extends ADialog {\r\n  private readonly addons: IToolbarDialogAddon[];\r\n\r\n  constructor(private readonly column: Column, dialog: IDialogContext, private readonly ctx: IRankingHeaderContext) {\r\n    super(dialog);\r\n    this.addons = getToolbarDialogAddons(this.column, 'group', ctx);\r\n  }\r\n\r\n  protected build(node: HTMLElement) {\r\n    for(const addon of this.addons) {\r\n      this.node.insertAdjacentHTML('beforeend', `<strong>${addon.title}</strong>`);\r\n      addon.append(this.column, this.node, this.dialog, this.ctx);\r\n    }\r\n\r\n    sortOrder(node, this.column, this.dialog.idPrefix);\r\n  }\r\n}\r\n\r\nfunction sortOrder(node: HTMLElement, column: Column, idPrefix: string) {\r\n  const ranking = column.findMyRanker()!;\r\n  const current = ranking.getGroupCriteria();\r\n  let order = current.indexOf(column);\r\n  let enabled = order >= 0;\r\n\r\n  if (order < 0) {\r\n    order = current.length;\r\n  }\r\n\r\n  const id = uniqueId(idPrefix);\r\n  node.insertAdjacentHTML('afterbegin', `\r\n        <strong>Group By</strong>\r\n        <div class=\"lu-checkbox\"><input id=\"${id}B\" type=\"radio\" name=\"grouped\" value=\"true\" ${enabled ? 'checked' : ''} ><label for=\"${id}B\">Enabled</label></div>\r\n        <div class=\"lu-checkbox\"><input id=\"${id}N\" type=\"radio\" name=\"grouped\" value=\"false\" ${!enabled ? 'checked' : ''} ><label for=\"${id}N\">Disabled</label></div>\r\n        <strong>Group Priority</strong>\r\n        <input type=\"number\" id=\"${id}P\" step=\"1\" min=\"1\" max=\"${current.length + 1}\" value=\"${order + 1}\">\r\n    `);\r\n\r\n  const updateDisabled = (disable: boolean) => {\r\n    forEach(node, 'input:not([name=grouped]), select, textarea', (d: HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement) => {\r\n      d.disabled = disable;\r\n    });\r\n  };\r\n  updateDisabled(!enabled);\r\n\r\n  const trigger = () => {\r\n    ranking.groupBy(column, !enabled ? -1 : order);\r\n    updateDisabled(!enabled);\r\n  };\r\n\r\n  forEach(node, 'input[name=grouped]', (n: HTMLInputElement) => {\r\n    n.addEventListener('change', () => {\r\n      enabled = n.value === 'true';\r\n      trigger();\r\n    }, {\r\n      passive: true\r\n    });\r\n  });\r\n  {\r\n    const priority = (<HTMLInputElement>node.querySelector(`#${id}P`));\r\n    priority.addEventListener('change', () => {\r\n      order = parseInt(priority.value, 10) - 1;\r\n      trigger();\r\n    }, {\r\n      passive: true\r\n    });\r\n  }\r\n}\r\n","import Column from '../../model/Column';\r\nimport ADialog, {IDialogContext} from './ADialog';\r\nimport {uniqueId, forEach} from './utils';\r\nimport {getToolbarDialogAddons, IToolbarDialogAddon} from '../toolbar';\r\nimport {IRankingHeaderContext} from '../interfaces';\r\n\r\n/** @internal */\r\nexport default class SortDialog extends ADialog {\r\n  private readonly addons: IToolbarDialogAddon[];\r\n\r\n  constructor(private readonly column: Column, private readonly group: boolean, dialog: IDialogContext, private readonly ctx: IRankingHeaderContext) {\r\n    super(dialog);\r\n    this.addons = getToolbarDialogAddons(this.column, group ? 'sortGroup' : 'sort', ctx);\r\n  }\r\n\r\n  protected build(node: HTMLElement) {\r\n    for(const addon of this.addons) {\r\n      this.node.insertAdjacentHTML('beforeend', `<strong>${addon.title}</strong>`);\r\n      addon.append(this.column, this.node, this.dialog, this.ctx);\r\n    }\r\n\r\n    sortOrder(node, this.column, this.dialog.idPrefix, this.group);\r\n  }\r\n}\r\n\r\nfunction sortOrder(node: HTMLElement, column: Column, idPrefix: string, groupSortBy: boolean = false) {\r\n  const ranking = column.findMyRanker()!;\r\n  const current = groupSortBy  ? ranking.getGroupSortCriteria() : ranking.getSortCriteria();\r\n  const order = Object.assign({}, groupSortBy ? column.isGroupSortedByMe() : column.isSortedByMe());\r\n\r\n  if (order.priority === undefined) {\r\n    order.priority = current.length;\r\n  }\r\n\r\n  const id = uniqueId(idPrefix);\r\n  node.insertAdjacentHTML('afterbegin', `\r\n        <strong>Sort Order</strong>\r\n        <div class=\"lu-checkbox\"><input id=\"${id}B\" type=\"radio\" name=\"sortorder\" value=\"asc\"  ${(order.asc === 'asc') ? 'checked' : ''} ><label for=\"${id}B\">Ascending</label></div>\r\n        <div class=\"lu-checkbox\"><input id=\"${id}D\" type=\"radio\" name=\"sortorder\" value=\"desc\"  ${(order.asc === 'desc') ? 'checked' : ''} ><label for=\"${id}D\">Decending</label></div>\r\n        <div class=\"lu-checkbox\"><input id=\"${id}N\" type=\"radio\" name=\"sortorder\" value=\"none\"  ${(order.asc === undefined) ? 'checked' : ''} ><label for=\"${id}N\">Unsorted</label></div>\r\n        <strong>Sort Priority</strong>\r\n        <input type=\"number\" id=\"${id}P\" step=\"1\" min=\"1\" max=\"${current.length + 1}\" value=\"${order.priority + 1}\">\r\n    `);\r\n\r\n  const updateDisabled = (disable: boolean) => {\r\n    forEach(node, 'input:not([name=sortorder]), select, textarea', (d: HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement) => {\r\n      d.disabled = disable;\r\n    });\r\n  };\r\n  updateDisabled(order.asc === undefined);\r\n\r\n  const trigger = () => {\r\n    if (groupSortBy) {\r\n      ranking.groupSortBy(column, order.asc === 'asc', order.asc === undefined ? -1 : order.priority);\r\n    } else {\r\n      ranking.sortBy(column, order.asc === 'asc', order.asc === undefined ? -1 : order.priority);\r\n    }\r\n\r\n    updateDisabled(order.asc === undefined);\r\n  };\r\n\r\n  forEach(node, 'input[name=sortorder]', (n: HTMLInputElement) => {\r\n    n.addEventListener('change', () => {\r\n      order.asc = n.value === 'none' ? undefined : <'asc'|'desc'>n.value;\r\n      trigger();\r\n    }, {\r\n      passive: true\r\n    });\r\n  });\r\n  {\r\n    const priority = (<HTMLInputElement>node.querySelector(`#${id}P`));\r\n    priority.addEventListener('change', () => {\r\n      order.priority = parseInt(priority.value, 10) - 1;\r\n      trigger();\r\n    }, {\r\n      passive: true\r\n    });\r\n  }\r\n}\r\n","import colors from \"../colors.js\";\n\nexport default colors(\"7fc97fbeaed4fdc086ffff99386cb0f0027fbf5b17666666\");\n","import colors from \"../colors.js\";\n\nexport default colors(\"1b9e77d95f027570b3e7298a66a61ee6ab02a6761d666666\");\n","import colors from \"../colors.js\";\n\nexport default colors(\"fbb4aeb3cde3ccebc5decbe4fed9a6ffffcce5d8bdfddaecf2f2f2\");\n","import colors from \"../colors.js\";\n\nexport default colors(\"b3e2cdfdcdaccbd5e8f4cae4e6f5c9fff2aef1e2cccccccc\");\n","import colors from \"../colors.js\";\n\nexport default colors(\"e41a1c377eb84daf4a984ea3ff7f00ffff33a65628f781bf999999\");\n","import colors from \"../colors.js\";\n\nexport default colors(\"66c2a5fc8d628da0cbe78ac3a6d854ffd92fe5c494b3b3b3\");\n","import colors from \"../colors.js\";\n\nexport default colors(\"8dd3c7ffffb3bebadafb807280b1d3fdb462b3de69fccde5d9d9d9bc80bdccebc5ffed6f\");\n","import ADialog from './ADialog';\r\nimport {IDialogContext} from './ADialog';\r\nimport {schemeCategory10, schemeSet1, schemeSet2, schemeSet3, schemeAccent, schemeDark2, schemePastel2, schemePastel1} from 'd3-scale-chromatic';\r\nimport {round, fixCSS} from '../../internal';\r\nimport {uniqueId} from '../../renderer/utils';\r\nimport {sequentialColors, divergentColors, createColorMappingFunction, lookupInterpolatingColor, QuantizedColorFunction, asColorFunction, CustomColorMappingFunction} from '../../model/ColorMappingFunction';\r\nimport Column, {IMapAbleColumn} from '../../model';\r\n\r\n/** @internal */\r\nexport default class ColorMappingDialog extends ADialog {\r\n  constructor(private readonly column: IMapAbleColumn, dialog: IDialogContext) {\r\n    super(dialog);\r\n  }\r\n\r\n  protected build(node: HTMLElement) {\r\n    node.classList.add('lu-dialog-color');\r\n    const id = uniqueId('col');\r\n\r\n    const current = this.column.getColorMapping();\r\n    const entries = current.type === 'custom' ? current.entries : [];\r\n\r\n    let h = '';\r\n    h += `<datalist id=\"${id}L\">${schemeCategory10.map((d) => `<option>${d}\"</option>`).join('')}</datalist>`;\r\n    h += `<datalist id=\"${id}LW\"><option>#FFFFFF\"</option>${schemeCategory10.slice(0, -1).map((d) => `<option>${d}</option>`).join('')}</datalist>`;\r\n\r\n    h += `<strong>Quantization</strong>\r\n    <div class=\"lu-checkbox\">\r\n      <input id=\"${id}KC\" name=\"kind\" type=\"radio\" value=\"continuous\" ${current.type !== 'quantized' ? 'checked': ''}>\r\n      <label for=\"${id}CK\">Continuous</label>\r\n    </div>\r\n    <div class=\"lu-checkbox\">\r\n      <input id=\"${id}KQ\" name=\"kind\" type=\"radio\" value=\"quantized\" ${current.type === 'quantized' ? 'checked': ''}>\r\n      <label for=\"${id}KQ\"><input type=\"number\" id=\"${id}KQS\" min=\"2\" step=\"1\" value=\"${current.type === 'quantized' ? current.steps : 5}\">&nbsp; steps</label>\r\n    </div>`;\r\n\r\n    h += `<strong data-toggle=\"${current.type === 'solid' ? 'open' : ''}\">Solid Color</strong>`;\r\n    h += `<div>`;\r\n    {\r\n      const refColor = current.type === 'solid' ? current.color : '';\r\n      let has = false;\r\n      const colorsets = [schemeCategory10, schemeAccent, schemeDark2, schemePastel1, schemePastel2, schemeSet1, schemeSet2, schemeSet3];\r\n      for (const colors of colorsets) {\r\n        has = has || colors.includes(refColor);\r\n        h += `<div class=\"lu-color-line\">\r\n          ${colors.map((d) => `<div class=\"lu-checkbox-color\">\r\n              <input id=\"${id}${fixCSS(d)}\" name=\"color\" type=\"radio\" value=\"${d}\" ${d === refColor ? 'checked=\"checked\"': ''}>\r\n              <label for=\"${id}${fixCSS(d)}\" style=\"background: ${d}\"></label>\r\n            </div>`).join('')}\r\n        </div>`;\r\n      }\r\n      h += `<div class=\"lu-checkbox\"><input id=\"${id}O\" name=\"color\" type=\"radio\" value=\"custom:solid\" ${refColor && !has ? 'checked=\"checked\"' : ''}>\r\n        <label for=\"${id}O\"><input type=\"color\" name=\"solid\" list=\"${id}L\" value=\"${current.type === 'solid' ? current.color : Column.DEFAULT_COLOR}\" ${refColor && !has ? '' : 'disabled'}></label>\r\n      </div>`;\r\n    }\r\n    h += '</div>';\r\n\r\n    h += `<strong data-toggle=\"${current.type === 'sequential' || (current.type === 'custom' && entries.length === 2) ? 'open' : ''}\">Sequential Color</strong>`;\r\n    h += '<div>';\r\n    {\r\n      const name = current.type === 'sequential' ? current.name : '';\r\n      for (const colors of sequentialColors) {\r\n        h += `<div class=\"lu-checkbox lu-color-gradient\"><input id=\"${id}${colors.name}\" name=\"color\" type=\"radio\" value=\"${colors.name}\" ${colors.name === name ? 'checked=\"checked\"' : ''}>\r\n        <label for=\"${id}${colors.name}\" data-c=\"${colors.name}\" style=\"background: ${gradient(colors.apply, 9)}\"></label>\r\n      </div>`;\r\n      }\r\n      const isCustom = entries.length === 2;\r\n      h += `<div class=\"lu-checkbox lu-color-gradient\">\r\n        <input id=\"${id}S\" name=\"color\" type=\"radio\" value=\"custom:sequential\" ${isCustom ? 'checked': ''}>\r\n        <label for=\"${id}S\" class=\"lu-color-custom\">\r\n          <input type=\"color\" name=\"interpolate0\" list=\"${id}LW\" ${!isCustom ? 'disabled': `value=\"${entries[0].color}\"`}>\r\n          <input type=\"color\" name=\"interpolate1\" list=\"${id}LW\" ${!isCustom ? 'disabled': `value=\"${entries[entries.length - 1].color}\"`}>\r\n        </label>\r\n      </div>`;\r\n    }\r\n    h += '</div>';\r\n    h += `<strong data-toggle=\"${current.type === 'divergent' || (current.type === 'custom' && entries.length === 3) ? 'open' : ''}\">Diverging Color</strong>`;\r\n    h += '<div>';\r\n    {\r\n      const name = current.type === 'sequential' ? current.name : '';\r\n      for (const colors of divergentColors) {\r\n        h += `<div class=\"lu-checkbox lu-color-gradient\"><input id=\"${id}${colors.name}\" name=\"color\" type=\"radio\" value=\"${colors.name}\" ${colors.name === name ? 'checked=\"checked\"' : ''}>\r\n        <label for=\"${id}${colors.name}\" data-c=\"${colors.name}\" style=\"background: ${gradient(colors.apply, 11)}\"></label>\r\n      </div>`;\r\n      }\r\n      const isCustom = entries.length === 3;\r\n      h += `<div class=\"lu-checkbox lu-color-gradient\"><input id=\"${id}D\" name=\"color\" type=\"radio\" value=\"custom:divergent\" ${isCustom ? 'checked': ''}>\r\n        <label for=\"${id}D\" class=\"lu-color-custom\">\r\n          <input type=\"color\" name=\"divergingm1\" list=\"${id}L\" ${!isCustom ? 'disabled': `value=\"${entries[0].color}\"`}>\r\n          <input type=\"color\" name=\"diverging0\" list=\"${id}LW\" ${!isCustom ? 'disabled': `value=\"${entries[1].color}\"`}>\r\n          <input type=\"color\" name=\"diverging1\" list=\"${id}L\" ${!isCustom ? 'disabled': `value=\"${entries[2].color}\"`}>\r\n          </label>\r\n      </div>`;\r\n    }\r\n    h += '</div>';\r\n\r\n    node.insertAdjacentHTML('beforeend', h);\r\n\r\n    this.interactive(node, id);\r\n  }\r\n\r\n  private interactive(node: HTMLElement, id: string) {\r\n    const continuouos = this.findInput(`#${id}KC`);\r\n    const quantized = this.findInput(`#${id}KQ`);\r\n    const steps = this.findInput(`#${id}KQS`);\r\n    const toggles = <HTMLElement[]>Array.from(node.querySelectorAll('strong[data-toggle]'));\r\n\r\n    continuouos.onchange = () => {\r\n      if (continuouos.checked) {\r\n        this.updateGradients(-1);\r\n      }\r\n    };\r\n    quantized.onchange = steps.onchange = () => {\r\n      if (!quantized.checked) {\r\n        this.updateGradients(-1);\r\n        return;\r\n      }\r\n      if (toggles[0].dataset.toggle === 'open') {\r\n        // auto open sequential\r\n        toggles[0].dataset.toggle = '';\r\n        toggles[1].dataset.toggle = 'open';\r\n      }\r\n      this.updateGradients(parseInt(steps.value, 10));\r\n    };\r\n\r\n    for (const toggle of toggles) {\r\n      toggle.onclick = (evt) => {\r\n        evt.preventDefault();\r\n        evt.stopPropagation();\r\n        for (const t2 of toggles) {\r\n          t2.dataset.toggle = t2.dataset.toggle === 'open' || toggle !== t2 ? '' : 'open';\r\n        }\r\n      };\r\n    }\r\n\r\n    const customs: HTMLElement[] = [];\r\n\r\n    const toColor = (input: HTMLInputElement) => {\r\n      switch (input.value) {\r\n        case 'custom:solid':\r\n          return asColorFunction((<HTMLInputElement>node.querySelector('input[name=solid]')!).value);\r\n        case 'custom:sequential':\r\n          const s0 = (<HTMLInputElement>node.querySelector('input[name=interpolate0]')!).value;\r\n          const s1 = (<HTMLInputElement>node.querySelector('input[name=interpolate1]')!).value;\r\n          return new CustomColorMappingFunction([{color: s0, value: 0}, {color: s1, value: 1}]);\r\n        case 'custom:diverging':\r\n          const dm1 = (<HTMLInputElement>node.querySelector('input[name=divergentm1]')!).value;\r\n          const d0 = (<HTMLInputElement>node.querySelector('input[name=divergent0]')!).value;\r\n          const d1 = (<HTMLInputElement>node.querySelector('input[name=divergent1]')!).value;\r\n          return new CustomColorMappingFunction([{color: dm1, value: 0}, {color: d0, value: 0.5}, {color: d1, value: 1}]);\r\n      }\r\n      return createColorMappingFunction(input.value);\r\n    };\r\n\r\n    this.forEach('input[name=color]', (d: HTMLInputElement) => {\r\n      if (d.value.startsWith('custom:')) {\r\n        customs.push(d);\r\n      }\r\n      d.onchange = () => {\r\n        if (!d.checked) {\r\n          return;\r\n        }\r\n        // disable customs\r\n        for (const custom of customs) {\r\n          Array.from(custom.nextElementSibling!.querySelectorAll('input')).forEach((s) => s.disabled = custom !== d);\r\n        }\r\n        const base = toColor(d);\r\n        if (quantized.checked && base.type !== 'solid') {\r\n          this.column.setColorMapping(new QuantizedColorFunction(base, parseInt(steps.value, 10)));\r\n        } else {\r\n          this.column.setColorMapping(base);\r\n        }\r\n      };\r\n    });\r\n\r\n    // upon changing custom parameter trigger an update\r\n    this.forEach('label > input[type=color]', (d: HTMLInputElement) => {\r\n      d.onchange = () => {\r\n        const item = (<HTMLInputElement>d.parentElement!.previousElementSibling!);\r\n        item.onchange!.call(item, null);\r\n      };\r\n    });\r\n  }\r\n\r\n  private updateGradients(steps: number) {\r\n    this.forEach(`label[data-c]`, (d: HTMLElement) => {\r\n      const f = lookupInterpolatingColor.get(d.dataset.c!)!;\r\n      d.style.background = steps < 0 ? gradient(f.apply, f.type === 'sequential' ? 9 : 11) : steppedGradient(f.apply, steps);\r\n    });\r\n  }\r\n}\r\n\r\nfunction gradient(interpolate: (v: number)=>string, steps = 2) {\r\n  if (steps <= 1) {\r\n    return `${interpolate(0)}`;\r\n  }\r\n  const stepSize = 1 / (steps - 1);\r\n  let r = `linear-gradient(to right`;\r\n  for (let i = 0; i < steps; ++i) {\r\n    r += `, ${interpolate(i * stepSize)} ${round((i * stepSize) * 100, 2)}%`;\r\n  }\r\n  r += ')';\r\n  return r;\r\n}\r\n\r\nfunction steppedGradient(color: (v: number)=>string, count = 2) {\r\n  if (count === 1) {\r\n    return `${color(0)}`;\r\n  }\r\n  let r = `linear-gradient(to right`;\r\n  const stepSize = 1 / count;\r\n  const half = stepSize / 2;\r\n  for (let i = 0; i < count; ++i) {\r\n    // stepped\r\n    // first and last at border else center\r\n    const shift = i === 0 ? 0 : (i === (count - 1) ? stepSize : half);\r\n    const c = color(i * stepSize + shift);\r\n    r += `, ${c} ${round((i * stepSize) * 100, 2)}%, ${c} ${round(((i + 1) * stepSize) * 100, 2)}%`;\r\n  }\r\n  r += ')';\r\n  return r;\r\n}\r\n","import {round, similar} from '../../internal/math';\r\nimport ADialog, {IDialogContext} from './ADialog';\r\nimport {dragHandle, IDragHandleOptions} from '../../internal/drag';\r\n\r\nfunction clamp(v: number) {\r\n  return Math.max(Math.min(v, 100), 0);\r\n}\r\n\r\n/** @internal */\r\nexport interface IMappingAdapter {\r\n  destroyed(self: MappingLine): void;\r\n\r\n  updated(self: MappingLine): void;\r\n\r\n  domain(): number[];\r\n\r\n  normalizeRaw(v: number): number;\r\n\r\n  unnormalizeRaw(v: number): number;\r\n\r\n  dialog: IDialogContext;\r\n}\r\n\r\n/** @internal */\r\nexport default class MappingLineDialog extends ADialog {\r\n  constructor(private readonly line: {destroy(): void, domain: number, range: number, frozen: boolean, update(domain: number, range: number): void}, dialog: IDialogContext, private readonly adapter: IMappingAdapter) {\r\n    super(dialog);\r\n  }\r\n\r\n  build(node: HTMLElement) {\r\n    const domain = this.adapter.domain();\r\n    node.insertAdjacentHTML('beforeend', `\r\n        <strong>Input Domain Value (min ... max)</strong>\r\n        <input type=\"number\" value=\"${round(this.adapter.unnormalizeRaw(this.line.domain), 3)}\" ${this.line.frozen ? 'readonly' : ''} autofocus required min=\"${domain[0]}\" max=\"${domain[1]}\" step=\"any\">\r\n        <strong>Output Normalized Value (0 ... 1)</strong>\r\n        <input type=\"number\" value=\"${round(this.line.range / 100, 3)}\" required min=\"0\" max=\"1\" step=\"any\">\r\n        <button type=\"button\" ${this.line.frozen ? 'disabled' : ''} >Remove Mapping Line</button>\r\n      `);\r\n\r\n    this.forEach('input', (d: HTMLInputElement) => d.onchange = () => this.submit());\r\n    this.find('button').addEventListener('click', () => {\r\n      this.destroy();\r\n      this.line.destroy();\r\n    }, {\r\n      passive: true\r\n    });\r\n  }\r\n\r\n  protected submit() {\r\n    if (!this.node.checkValidity()) {\r\n      return false;\r\n    }\r\n    const domain = this.adapter.normalizeRaw(parseFloat(this.findInput('input[type=number]').value));\r\n    const range = parseFloat(this.findInput('input[type=number]:last-of-type').value) * 100;\r\n    this.line.update(domain, range);\r\n    return true;\r\n  }\r\n}\r\n\r\n/** @internal */\r\nexport class MappingLine {\r\n  readonly node: SVGGElement;\r\n\r\n  constructor(g: SVGGElement, public domain: number, public range: number, private readonly adapter: IMappingAdapter) {\r\n    g.insertAdjacentHTML('beforeend', `<g class=\"lu-mapping\" transform=\"translate(${domain},0)\">\r\n      <line x1=\"0\" x2=\"${range - domain}\" y2=\"60\"></line>\r\n      <line x1=\"0\" x2=\"${range - domain}\" y2=\"60\"></line>\r\n      <circle r=\"3\"></circle>\r\n      <circle cx=\"${range - domain}\" cy=\"60\" r=\"3\"></circle>\r\n      <title>Drag the anchor circle to change the mapping, shift click to edit</title>\r\n    </g>`);\r\n    this.node = <SVGGElement>g.lastElementChild!;\r\n\r\n    // freeze 0 and 100 domain = raw domain ones\r\n    this.node.classList.toggle('lu-frozen', similar(0, domain) || similar(domain, 100));\r\n    {\r\n      let beforeDomain: number;\r\n      let beforeRange: number;\r\n      let shiftDomain: number;\r\n      let shiftRange: number;\r\n\r\n      const normalize = (x: number) => x * 100 / g.getBoundingClientRect().width;\r\n\r\n      const common: Partial<IDragHandleOptions> =  {\r\n        container: g.parentElement!,\r\n        filter: (evt) => evt.button === 0 && !evt.shiftKey,\r\n        onStart: (_, x) => {\r\n          beforeDomain = this.domain;\r\n          beforeRange = this.range;\r\n          const normalized = normalize(x);\r\n          shiftDomain = this.domain - normalized;\r\n          shiftRange = this.range - normalized;\r\n        } ,\r\n        onEnd: () => {\r\n          if (!similar(beforeDomain, this.domain) || !similar(beforeRange, this.range)) {\r\n            this.adapter.updated(this);\r\n          }\r\n        }\r\n      };\r\n\r\n      const line = this.node.querySelector<SVGLineElement>('line:first-of-type')!;\r\n      dragHandle(line, { // line\r\n        ...common,\r\n        onDrag: (_, x) => {\r\n          const normalized = normalize(x);\r\n          this.update(clamp(normalized + shiftDomain), clamp(normalized + shiftRange));\r\n        },\r\n      });\r\n\r\n      const domainCircle = this.node.querySelector<SVGLineElement>('circle:first-of-type')!;\r\n      dragHandle(domainCircle, {\r\n        ...common,\r\n        onDrag: (_, x) => {\r\n          const normalized = normalize(x);\r\n          this.update(clamp(normalized), this.range);\r\n        },\r\n      });\r\n      const rangeCircle = this.node.querySelector<SVGLineElement>('circle:last-of-type')!;\r\n      dragHandle(rangeCircle, {\r\n        ...common,\r\n        onDrag: (_, x) => {\r\n          const normalized = normalize(x);\r\n          this.update(this.domain, clamp(normalized));\r\n        },\r\n      });\r\n    }\r\n\r\n    this.node.onclick = (evt) => {\r\n      if (!evt.shiftKey) {\r\n        return;\r\n      }\r\n      const ctx = {\r\n        manager: this.adapter.dialog.manager,\r\n        level: this.adapter.dialog.level + 1,\r\n        attachment: <any>this.node,\r\n        idPrefix: this.adapter.dialog.idPrefix\r\n      };\r\n      const dialog = new MappingLineDialog(this, ctx, this.adapter);\r\n      dialog.open();\r\n    };\r\n  }\r\n\r\n  get frozen() {\r\n    return this.node.classList.contains('lu-frozen');\r\n  }\r\n\r\n  destroy() {\r\n    this.node.remove();\r\n    this.adapter.destroyed(this);\r\n  }\r\n\r\n  update(domain: number, range: number) {\r\n    if (similar(domain, this.domain) && similar(range, this.range)) {\r\n      return;\r\n    }\r\n    if (this.frozen) {\r\n      domain = this.domain;\r\n    }\r\n    this.domain = domain;\r\n    this.range = range;\r\n    this.node.setAttribute('transform', `translate(${domain},0)`);\r\n    const shift = range - domain;\r\n    Array.from(this.node.querySelectorAll<SVGLineElement>('line')).forEach((d) => d.setAttribute('x2', String(shift)));\r\n    this.node.querySelector<SVGCircleElement>('circle[cx]')!.setAttribute('cx', String(shift));\r\n  }\r\n}\r\n","import {round} from '../../internal';\r\nimport {\r\n  IMapAbleColumn, IMappingFunction, isMissingValue, ScaleMappingFunction,\r\n  ScriptMappingFunction,\r\n  isMapAbleColumn\r\n} from '../../model';\r\nimport {IRankingHeaderContext} from '../interfaces';\r\nimport ADialog, {IDialogContext} from './ADialog';\r\nimport {IMappingAdapter, MappingLine} from './MappingLineDialog';\r\n\r\n/** @internal */\r\nexport default class MappingDialog extends ADialog {\r\n\r\n  private scale: IMappingFunction;\r\n\r\n  private readonly mappingLines: MappingLine[] = [];\r\n  private rawDomain: [number, number];\r\n\r\n  private readonly data: Promise<number[]>;\r\n  private readonly idPrefix: string;\r\n  private loadedData: number[] | null = null;\r\n\r\n  private readonly mappingAdapter: IMappingAdapter = {\r\n    destroyed: (self: MappingLine) => {\r\n      this.mappingLines.splice(this.mappingLines.indexOf(self), 1);\r\n    },\r\n    updated: () => this.updateLines(this.computeScale()),\r\n    domain: () => this.rawDomain,\r\n    normalizeRaw: this.normalizeRaw.bind(this),\r\n    unnormalizeRaw: this.unnormalizeRaw.bind(this),\r\n    dialog: this.dialog\r\n  };\r\n\r\n  constructor(private readonly column: IMapAbleColumn, dialog: IDialogContext, ctx: IRankingHeaderContext) {\r\n    super(dialog, {\r\n      fullDialog: true\r\n    });\r\n\r\n    this.idPrefix = `me${ctx.idPrefix}`;\r\n    this.scale = this.column.getMapping().clone();\r\n    const domain = this.scale.domain;\r\n    this.rawDomain = [domain[0], domain[domain.length - 1]];\r\n\r\n    this.data = Promise.resolve(ctx.provider.mappingSample(column));\r\n  }\r\n\r\n  private get scaleType() {\r\n    if (!(this.scale instanceof ScaleMappingFunction)) {\r\n      return 'script';\r\n    }\r\n    const base = this.scale.scaleType;\r\n    if (base !== 'linear') {\r\n      return base;\r\n    }\r\n    // check if invert or absolute\r\n    const r = this.scale.range;\r\n    if (r.length === 2 && r[0] === 1 && r[1] === 0) {\r\n      return 'linear_invert';\r\n    }\r\n    if (r.length === 3 && r[0] === 1 && r[1] === 0 && r[2] === 1) {\r\n      return 'linear_abs';\r\n    }\r\n    return 'linear';\r\n  }\r\n\r\n  build(node: HTMLElement) {\r\n    node.classList.add('lu-dialog-mapper');\r\n\r\n    const r = this.column.findMyRanker();\r\n    const others = !r ? [] : r.flatColumns.filter((d) => isMapAbleColumn(d) && d !== this.column);\r\n\r\n    node.insertAdjacentHTML('beforeend', `\r\n        <div><label for=\"${this.idPrefix}mapping_type\"><strong>Normalization Scaling:</strong></label><select id=\"${this.idPrefix}mapping_type\" class=\"browser-default\">\r\n        <option value=\"linear\">Linear</option>\r\n        <option value=\"linear_invert\">Invert</option>\r\n        <option value=\"linear_abs\">Absolute</option>\r\n        <option value=\"log\">Log</option>\r\n        <option value=\"pow1.1\">Pow 1.1</option>\r\n        <option value=\"pow2\">Pow 2</option>\r\n        <option value=\"pow3\">Pow 3</option>\r\n        <option value=\"sqrt\">Sqrt</option>\r\n        <option value=\"script\">Custom Script</option>\r\n        ${others.length > 0 ? `<optgroup label=\"Copy From\">${others.map((d) => `<option value=\"copy_${d.id}\">${d.label}</option>`).join('')}</optgroup>`: ''}\r\n      </select>\r\n      </div>\r\n        <div class=\"lu-details\"><strong>Domain (min - max): </strong><input id=\"${this.idPrefix}min\" required type=\"number\" value=\"${round(this.rawDomain[0], 3)}\" step=\"any\"> - <input id=\"${this.idPrefix}max\" required type=\"number\" value=\"${round(this.rawDomain[1], 3)}\" step=\"any\"></div>\r\n        <strong class=\"lu-details\" style=\"text-align: center\">Input Domain (min - max)</strong>\r\n        <svg class=\"lu-details\" viewBox=\"0 0 106 66\">\r\n           <g transform=\"translate(3,3)\">\r\n              <line x2=\"100\"></line>\r\n              <rect y=\"-3\" width=\"100\" height=\"10\"></rect>\r\n              <line y1=\"60\" x2=\"100\" y2=\"60\"></line>\r\n              <rect y=\"36\" width=\"100\" height=\"10\"></rect>\r\n           </g>\r\n        </svg>\r\n        <strong class=\"lu-details\" style=\"text-align: center; margin-top: 0\">Output Normalized Domain (0 - 1)</strong>\r\n        <div class=\"lu-script\">\r\n          <strong>Custom Normalization Script</strong>\r\n          <textarea></textarea>\r\n        </div>`);\r\n\r\n    const g = <SVGGElement>node.querySelector('.lu-details > g');\r\n\r\n    this.forEach('.lu-details rect', (d: SVGRectElement) => d.onclick = (evt) => {\r\n      evt.preventDefault();\r\n      evt.stopPropagation();\r\n      const bb = d.getBoundingClientRect();\r\n      const x = round((evt.x - bb.left) * 100 / bb.width, 2);\r\n      const m = new MappingLine(g, x, x, this.mappingAdapter);\r\n      this.mappingLines.push(m);\r\n    });\r\n\r\n    {\r\n\r\n      const select = <HTMLSelectElement>this.find('select');\r\n      const textarea = <HTMLTextAreaElement>this.find('textarea');\r\n      select.onchange = (evt) => {\r\n        const select = <HTMLSelectElement>evt.currentTarget;\r\n        switch (select.value) {\r\n          case 'linear_invert':\r\n            this.scale = new ScaleMappingFunction(this.rawDomain.slice(), 'linear', [1, 0]);\r\n            break;\r\n          case 'linear_abs':\r\n            this.scale = new ScaleMappingFunction([this.rawDomain[0], (this.rawDomain[1] - this.rawDomain[0]) / 2, this.rawDomain[1]], 'linear', [1, 0, 1]);\r\n            break;\r\n          case 'script':\r\n            const s = new ScriptMappingFunction(this.rawDomain.slice());\r\n            this.scale = s;\r\n            textarea.value = s.code;\r\n            break;\r\n          default:\r\n            if (select.value.startsWith('copy_')) {\r\n              this.copyMapping(select.value.slice('copy_'.length));\r\n              return;\r\n            }\r\n            this.scale = new ScaleMappingFunction(this.rawDomain.slice(), select.value);\r\n            break;\r\n        }\r\n        this.createMappings();\r\n        node.dataset.scale = select.value;\r\n        this.updateLines();\r\n      };\r\n      const scaleType = node.dataset.scale = this.scaleType;\r\n      select.selectedIndex = Array.from(select.options).findIndex((d) => d.value === scaleType);\r\n\r\n      if (scaleType === 'script') {\r\n        textarea.value = (<ScriptMappingFunction>this.scale).code;\r\n      }\r\n      this.createMappings();\r\n    }\r\n\r\n    {\r\n      this.forEach('.lu-details input[type=number]', (d: HTMLInputElement, i) => d.onchange = () => {\r\n        const v = parseFloat(d.value);\r\n        if (v === this.rawDomain[i]) {\r\n          d.setCustomValidity('');\r\n          return;\r\n        }\r\n        const other = this.rawDomain[1 - i];\r\n        if (isNaN(v) || (i === 0 && v >= other) || (i === 1 && v <= other)) {\r\n          d.setCustomValidity(`value has to be ${i === 0 ? '<= max' : '>= min'}`);\r\n          return;\r\n        }\r\n        d.setCustomValidity('');\r\n        this.rawDomain[i] = v;\r\n        this.scale.domain = this.rawDomain.slice();\r\n\r\n        if (!this.loadedData) {\r\n          return;\r\n        }\r\n        this.applyMapping(this.scale);\r\n        this.updateLines();\r\n      });\r\n    }\r\n\r\n    this.data.then((values) => {\r\n      this.loadedData = values;\r\n\r\n      Array.from(values).forEach((v) => {\r\n        if (!isMissingValue(v)) {\r\n          g.insertAdjacentHTML('afterbegin', `<line data-v=\"${v}\" x1=\"${round(this.normalizeRaw(v), 2)}\" x2=\"${round(this.scale.apply(v) * 100, 2)}\" y2=\"60\"></line>`);\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  private createMappings() {\r\n    this.mappingLines.splice(0, this.mappingLines.length).forEach((d) => d.destroy());\r\n    if (!(this.scale instanceof ScaleMappingFunction)) {\r\n      return;\r\n    }\r\n    const g = <SVGGElement>this.node.querySelector('.lu-details > g');\r\n    const domain = this.scale.domain;\r\n    const range = this.scale.range;\r\n    this.mappingLines.push(...domain.map((d, i) => new MappingLine(g, this.normalizeRaw(d), range[i] * 100, this.mappingAdapter)));\r\n  }\r\n\r\n  private update() {\r\n    const scaleType = this.node.dataset.scale = this.scaleType;\r\n    const select = <HTMLSelectElement>this.find('select');\r\n    select.selectedIndex = Array.from(select.options).findIndex((d) => d.value === scaleType);\r\n    if (scaleType === 'script') {\r\n      (<HTMLTextAreaElement>this.find('textarea')).value = (<ScriptMappingFunction>this.scale).code;\r\n    }\r\n    const domain = this.scale.domain;\r\n    this.forEach('.lu-details input[type=number]', (d: HTMLInputElement, i) => {\r\n      d.value = String(domain[i]);\r\n    });\r\n  }\r\n\r\n  private updateLines(scale = this.scale) {\r\n    this.forEach('.lu-details > g > line[x1]', (d: SVGLineElement) => {\r\n      const v = parseFloat(d.getAttribute('data-v')!);\r\n      d.setAttribute('x1', round(this.normalizeRaw(v), 2).toString());\r\n      d.setAttribute('x2', round(scale.apply(v) * 100, 2).toString());\r\n    });\r\n  }\r\n\r\n  private applyMapping(newScale: IMappingFunction) {\r\n    this.column.setMapping(newScale);\r\n  }\r\n\r\n  protected reset() {\r\n    this.scale = this.column.getOriginalMapping();\r\n    this.rawDomain = <[number, number]>this.scale.domain.slice();\r\n    this.applyMapping(this.scale);\r\n    this.update();\r\n    this.updateLines();\r\n    this.createMappings();\r\n  }\r\n\r\n  private copyMapping(columnId: string) {\r\n    const r = this.column.findMyRanker();\r\n    if (!r) {\r\n      return;\r\n    }\r\n    const ref = <IMapAbleColumn>r.find(columnId)!;\r\n    this.scale = ref.getMapping().clone();\r\n    this.rawDomain = <[number, number]>this.scale.domain.slice();\r\n    this.applyMapping(this.scale);\r\n    this.update();\r\n    this.updateLines();\r\n  }\r\n\r\n  private normalizeRaw(d: number) {\r\n    const v = (d - this.rawDomain[0]) * 100 / (this.rawDomain[1] - this.rawDomain[0]);\r\n    return Math.max(Math.min(v, 100), 0); // clamp\r\n  }\r\n\r\n  private unnormalizeRaw(d: number) {\r\n    return (d) * (this.rawDomain[1] - this.rawDomain[0]) / 100 + this.rawDomain[0];\r\n  }\r\n\r\n  private computeScale() {\r\n    const s = this.scale.clone();\r\n    if (this.scaleType === 'script') {\r\n      (<ScriptMappingFunction>s).code = this.node.querySelector('textarea')!.value;\r\n      s.domain = this.rawDomain.slice();\r\n    }\r\n    if (s instanceof ScaleMappingFunction) {\r\n      this.mappingLines.sort((a, b) => a.domain - b.domain);\r\n      s.domain = this.mappingLines.map((d) => this.unnormalizeRaw(d.domain));\r\n      s.range = this.mappingLines.map((d) => d.range / 100);\r\n    }\r\n    return s;\r\n  }\r\n\r\n  protected submit() {\r\n    if (!this.node.checkValidity()) {\r\n      return false;\r\n    }\r\n    if (this.scaleType === 'script') {\r\n      (<ScriptMappingFunction>this.scale).code = this.node.querySelector('textarea')!.value;\r\n      this.scale.domain = this.rawDomain.slice();\r\n    }\r\n    if (this.scale instanceof ScaleMappingFunction) {\r\n      this.mappingLines.sort((a, b) => a.domain - b.domain);\r\n      this.scale.domain = this.mappingLines.map((d) => this.unnormalizeRaw(d.domain));\r\n      this.scale.range = this.mappingLines.map((d) => d.range / 100);\r\n    }\r\n    this.applyMapping(this.scale);\r\n    return true;\r\n  }\r\n}\r\n","import {filterMissingMarkup, findFilterMissing} from '../missing';\r\nimport ADialog, {IDialogContext} from './ADialog';\r\nimport {updateFilterState, uniqueId} from './utils';\r\nimport DateColumn from '../../model/DateColumn';\r\nimport {IDateFilter, isDummyDateFilter, noDateFilter} from '../../model/IDateColumn';\r\nimport {timeFormat} from 'd3-time-format';\r\n\r\n/** @internal */\r\nexport default class DateFilterDialog extends ADialog {\r\n\r\n  constructor(private readonly column: DateColumn, dialog: IDialogContext) {\r\n    super(dialog);\r\n  }\r\n\r\n  private updateFilter(filter: IDateFilter | null) {\r\n    updateFilterState(this.attachment, this.column, filter != null && !isDummyDateFilter(filter));\r\n    this.column.setFilter(filter != null ? filter : undefined);\r\n  }\r\n\r\n  reset() {\r\n    this.forEach('input[type=date]', (n: HTMLInputElement) => n.value = '');\r\n    this.forEach('input[type=checkbox]', (n: HTMLInputElement) => n.checked = false);\r\n    this.updateFilter(null);\r\n  }\r\n\r\n  submit() {\r\n    const filterMissing = findFilterMissing(this.node).checked;\r\n    const from: Date | null = this.findInput('input[name=\"from\"]').valueAsDate;\r\n    const to: Date | null = this.findInput('input[name=\"to\"]').valueAsDate;\r\n    this.updateFilter({filterMissing, min: from == null ? -Infinity : from.getTime(), max: to == null ? +Infinity : to.getTime()});\r\n    return true;\r\n  }\r\n\r\n  protected build(node: HTMLElement) {\r\n    const act = this.column.getFilter() || noDateFilter();\r\n    const id = uniqueId(this.dialog.idPrefix);\r\n\r\n    const f = timeFormat('%Y-%m-%d');\r\n\r\n    node.insertAdjacentHTML('beforeend', `\r\n    <label for=\"${id}F\">From: </label>\r\n    <input type=\"date\" id=\"${id}F\" name=\"from\" placeholder=\"From...\" autofocus value=\"${isFinite(act.min) ? f(new Date(act.min)) : ''}\">\r\n    <label for=\"${id}T\">To: </label>\r\n    <input type=\"date\" id=\"${id}T\" name=\"to\" placeholder=\"To...\" value=\"${isFinite(act.max) ? f(new Date(act.max)) : ''}\">\r\n    ${filterMissingMarkup(act.filterMissing, this.dialog.idPrefix)}`);\r\n\r\n    const update = () => {\r\n      this.submit();\r\n    };\r\n\r\n    this.forEach('input', (n: HTMLInputElement) => n.onchange = update);\r\n  }\r\n}\r\n","import {getAllToolbarActions, isSupportType, getAllToolbarDialogAddons, isSortingAscByDefault} from '../model/annotations';\r\nimport Column from '../model/Column';\r\nimport CompositeColumn, {IMultiLevelColumn} from '../model/CompositeColumn';\r\nimport ADialog, {IDialogContext} from './dialogs/ADialog';\r\nimport ChangeRendererDialog from './dialogs/ChangeRendererDialog';\r\nimport RenameDialog from './dialogs/RenameDialog';\r\nimport BooleanFilterDialog from './dialogs/BooleanFilterDialog';\r\nimport CategoricalFilterDialog from './dialogs/CategoricalFilterDialog';\r\nimport CategoricalMappingFilterDialog from './dialogs/CategoricalMappingFilterDialog';\r\nimport CompositeChildrenDialog from './dialogs/CompositeChildrenDialog';\r\nimport CutOffHierarchyDialog from './dialogs/CutOffHierarchyDialog';\r\nimport EditPatternDialog from './dialogs/EditPatternDialog';\r\nimport NumberFilterDialog from './dialogs/NumberFilterDialog';\r\nimport ReduceDialog from './dialogs/ReduceDialog';\r\nimport ScriptEditDialog from './dialogs/ScriptEditDialog';\r\nimport SearchDialog from './dialogs/SearchDialog';\r\nimport StringFilterDialog from './dialogs/StringFilterDialog';\r\nimport WeightsEditDialog from './dialogs/WeightsEditDialog';\r\nimport GroupDialog from './dialogs/GroupDialog';\r\nimport {sortMethods} from './dialogs/utils';\r\nimport {IRankingHeaderContext} from './interfaces';\r\nimport SortDialog from './dialogs/SortDialog';\r\nimport {EAdvancedSortMethod, ESortMethod} from '../model/INumberColumn';\r\nimport {EDateSort} from '../model/DatesColumn';\r\nimport appendNumber from './dialogs/groupNumber';\r\nimport appendString from './dialogs/groupString';\r\nimport appendDate from './dialogs/groupDate';\r\nimport ColorMappingDialog from './dialogs/ColorMappingDialog';\r\nimport MappingDialog from './dialogs/MappingDialog';\r\nimport DateFilterDialog from './dialogs/DateFilterDialog';\r\n\r\nexport interface IUIOptions {\r\n  shortcut: boolean|'only';\r\n  order: number;\r\n  featureLevel: 'basic' | 'advanced';\r\n  featureCategory: 'ranking' | 'model' | 'ui';\r\n}\r\n\r\nexport interface IMouseEvent {\r\n  stopPropagation(): void;\r\n  currentTarget: Element;\r\n  shiftKey: boolean;\r\n  altKey: boolean;\r\n  ctrlKey: boolean;\r\n  [key: string]: any;\r\n}\r\n\r\nexport interface IOnClickHandler {\r\n  (col: Column, evt: IMouseEvent, ctx: IRankingHeaderContext, level: number, viaShortcut: boolean): any;\r\n}\r\n\r\nexport interface IToolbarAction {\r\n  title: string;\r\n\r\n  onClick: IOnClickHandler;\r\n\r\n  options: Partial<IUIOptions>;\r\n}\r\n\r\nexport interface IToolbarDialogAddon {\r\n  title: string;\r\n\r\n  order: number;\r\n\r\n  append(col: Column, node: HTMLElement, dialog: IDialogContext, ctx: IRankingHeaderContext): void;\r\n}\r\n\r\nexport interface IDialogClass {\r\n  new(col: any, dialog: IDialogContext, ...args: any[]): ADialog;\r\n}\r\n\r\nfunction ui(title: string, onClick: IOnClickHandler, options: Partial<IUIOptions> = {}): IToolbarAction {\r\n  return { title, onClick, options };\r\n}\r\n\r\nexport function dialogContext(ctx: IRankingHeaderContext, level: number, evt: { currentTarget: Element }): IDialogContext {\r\n  return {\r\n    attachment: <HTMLElement>evt.currentTarget,\r\n    level,\r\n    manager: ctx.dialogManager,\r\n    idPrefix: ctx.idPrefix\r\n  };\r\n}\r\n\r\nfunction uiDialog(title: string, dialogClass: IDialogClass, extraArgs: ((ctx: IRankingHeaderContext) => any[]) = () => [], options: Partial<IUIOptions> = {}): IToolbarAction {\r\n  return {\r\n    title,\r\n    onClick: (col, evt, ctx, level) => {\r\n      const dialog = new dialogClass(col, dialogContext(ctx, level, evt), ...extraArgs(ctx));\r\n      dialog.open();\r\n    }, options\r\n  };\r\n}\r\n\r\nfunction uiSortMethod(methods: string[]): IToolbarDialogAddon {\r\n  methods = methods.sort((a, b) => a.toLowerCase().localeCompare(b.toLowerCase()));\r\n  return {\r\n    title: 'Sort By',\r\n    order: 2,\r\n    append(col, node, dialog) {\r\n      sortMethods(node, <any>col, methods, dialog.idPrefix);\r\n    }\r\n  };\r\n}\r\n\r\nconst sort: IToolbarAction = {\r\n  title: 'Sort', // basic ranking\r\n  onClick: (col, evt, ctx, level) => {\r\n    ctx.dialogManager.removeAboveLevel(level);\r\n    if (!evt.ctrlKey) {\r\n      col.toggleMySorting();\r\n      return;\r\n    }\r\n    const ranking = col.findMyRanker()!;\r\n    const current = ranking.getSortCriteria();\r\n    const order = col.isSortedByMe();\r\n\r\n    const isAscByDefault = isSortingAscByDefault(col);\r\n\r\n    if (order.priority === undefined) {\r\n      ranking.sortBy(col, isAscByDefault, current.length);\r\n      return;\r\n    }\r\n    let next: string|undefined = undefined;\r\n    if (isAscByDefault) {\r\n      next = order.asc ? 'desc' : undefined;\r\n    } else {\r\n      next = !order.asc ? 'asc' : undefined;\r\n    }\r\n    ranking.sortBy(col, next === 'asc', next ? order.priority : -1);\r\n  },\r\n  options: {\r\n    shortcut: 'only',\r\n    order: 1,\r\n    featureCategory: 'ranking',\r\n    featureLevel: 'basic'\r\n  }\r\n};\r\n\r\nconst sortBy: IToolbarAction = {\r\n  title: 'Sort By &hellip;', // advanced ranking\r\n  onClick: (col, evt, ctx, level) => {\r\n    const dialog = new SortDialog(col, false, dialogContext(ctx, level, evt), ctx);\r\n    dialog.open();\r\n  },\r\n  options: {\r\n    shortcut: false,\r\n    order: 1,\r\n    featureCategory: 'ranking',\r\n    featureLevel: 'advanced'\r\n  }\r\n};\r\n\r\nconst sortGroupBy: IToolbarAction = {\r\n  title: 'Sort Groups By &hellip;', // advanced ranking\r\n  onClick: (col, evt, ctx, level) => {\r\n    const dialog = new SortDialog(col, true, dialogContext(ctx, level, evt), ctx);\r\n    dialog.open();\r\n  },\r\n  options: {\r\n    shortcut: false,\r\n    order: 3,\r\n    featureCategory: 'ranking',\r\n    featureLevel: 'advanced'\r\n  }\r\n};\r\n\r\nconst rename: IToolbarAction = {\r\n  title: 'Rename &hellip;', // advanced\r\n  onClick: (col, evt, ctx, level) => {\r\n    const dialog = new RenameDialog(col, dialogContext(ctx, level, evt));\r\n    dialog.open();\r\n  },\r\n  options: {\r\n    order: 4,\r\n    featureCategory: 'ui',\r\n    featureLevel: 'advanced'\r\n  }\r\n};\r\n\r\nconst vis: IToolbarAction = {\r\n  title: 'Visualization &hellip;', // advanced view\r\n  onClick: (col, evt, ctx, level) => {\r\n    const dialog = new ChangeRendererDialog(col, dialogContext(ctx, level, evt), ctx);\r\n    dialog.open();\r\n  },\r\n  options: {\r\n    featureCategory: 'ui',\r\n    featureLevel: 'advanced'\r\n  }\r\n};\r\n\r\nconst clone: IToolbarAction = {\r\n  title: 'Clone', // advanced model\r\n  onClick: (col, _evt, ctx) => {\r\n    ctx.dialogManager.removeAll(); // since the column will be removed\r\n    ctx.provider.takeSnapshot(col);\r\n  },\r\n  options: {\r\n    order: 80,\r\n    featureCategory: 'model',\r\n    featureLevel: 'advanced'\r\n  }\r\n};\r\n\r\nconst remove: IToolbarAction = {\r\n  title: 'Remove', // advanced model\r\n  onClick: (col, _evt, ctx) => {\r\n    ctx.dialogManager.removeAll(); // since the column will be removed\r\n    const ranking = col.findMyRanker()!;\r\n    const last = ranking.children.every((d) => isSupportType(d) || d.fixed || d === col);\r\n    if (!last) {\r\n      col.removeMe();\r\n      return;\r\n    }\r\n    ctx.provider.removeRanking(ranking);\r\n    ctx.provider.ensureOneRanking();\r\n  },\r\n  options: {\r\n    order: 90,\r\n    featureCategory: 'model',\r\n    featureLevel: 'advanced'\r\n  }\r\n};\r\n\r\n// basic ranking\r\nconst group = ui('Group', (col, evt, ctx, level) => {\r\n  ctx.dialogManager.removeAboveLevel(level);\r\n\r\n  if (!evt.ctrlKey) {\r\n    col.groupByMe();\r\n    return;\r\n  }\r\n  const ranking = col.findMyRanker()!;\r\n  const current = ranking.getGroupCriteria();\r\n  const order = current.indexOf(col);\r\n\r\n  ranking.groupBy(col, order >= 0 ? -1 : current.length);\r\n}, { shortcut: 'only', order: 2, featureCategory: 'ranking', featureLevel: 'basic' });\r\n\r\n// advanced ranking\r\nconst groupBy = ui('Group By &hellip;', (col, evt, ctx, level) => {\r\n  const dialog = new GroupDialog(col, dialogContext(ctx, level, evt), ctx);\r\n  dialog.open();\r\n}, { shortcut: false, order: 2, featureCategory: 'ranking', featureLevel: 'advanced' });\r\n\r\n\r\n\r\nconst collapse = ui('Compress', (col, evt, ctx, level) => {\r\n  ctx.dialogManager.removeAboveLevel(level);\r\n  const mcol = <IMultiLevelColumn>col;\r\n  mcol.setCollapsed(!mcol.getCollapsed());\r\n  const i = <HTMLElement>evt.currentTarget;\r\n  i.title = mcol.getCollapsed() ? 'Expand' : 'Compress';\r\n}, { featureCategory: 'model', featureLevel: 'advanced' });\r\n\r\nconst toolbarAddons: { [key: string]: IToolbarDialogAddon } = {\r\n  sortNumber: uiSortMethod(Object.keys(EAdvancedSortMethod)),\r\n  sortNumbers: uiSortMethod(Object.keys(EAdvancedSortMethod)),\r\n  sortBoxPlot: uiSortMethod(Object.keys(ESortMethod)),\r\n  sortDates: uiSortMethod(Object.keys(EDateSort)),\r\n  sortGroup: uiSortMethod(['count', 'name']),\r\n  groupNumber: <IToolbarDialogAddon>{\r\n    title: 'Split',\r\n    order: 2,\r\n    append: appendNumber\r\n  },\r\n  groupString: <IToolbarDialogAddon>{\r\n    title: 'Groups',\r\n    order: 2,\r\n    append: appendString\r\n  },\r\n  groupDate: <IToolbarDialogAddon>{\r\n    title: 'Granularity',\r\n    order: 2,\r\n    append: appendDate\r\n  },\r\n};\r\n\r\nexport const toolbarActions: { [key: string]: IToolbarAction | IToolbarDialogAddon } = Object.assign({\r\n  group,\r\n  groupBy,\r\n  collapse,\r\n  sort,\r\n  sortBy,\r\n  sortGroupBy,\r\n  clone,\r\n  remove,\r\n  rename,\r\n  search: uiDialog('Search &hellip;', SearchDialog, (ctx) => [ctx.provider], { shortcut: true, order: 3, featureCategory: 'ranking', featureLevel: 'basic' }),\r\n  filterNumber: uiDialog('Filter &hellip;', NumberFilterDialog, (ctx) => [ctx], { shortcut: true, featureCategory: 'ranking', featureLevel: 'basic' }),\r\n  filterDate: uiDialog('Filter &hellip;', DateFilterDialog, (ctx) => [ctx], { shortcut: true, featureCategory: 'ranking', featureLevel: 'basic' }),\r\n  filterString: uiDialog('Filter &hellip;', StringFilterDialog, () => [], { shortcut: true, featureCategory: 'ranking', featureLevel: 'basic' }),\r\n  filterCategorical: uiDialog('Filter &hellip;', CategoricalFilterDialog, () => [], { shortcut: true, featureCategory: 'ranking', featureLevel: 'basic' }),\r\n  filterOrdinal: uiDialog('Filter &hellip;', CategoricalMappingFilterDialog, () => [], { shortcut: true, featureCategory: 'ranking', featureLevel: 'basic' }),\r\n  filterBoolean: uiDialog('Filter &hellip;', BooleanFilterDialog, () => [], { shortcut: true, featureCategory: 'ranking', featureLevel: 'basic' }),\r\n  colorMapped: uiDialog('Color Mapping &hellip;', ColorMappingDialog, () => [], { shortcut: false, featureCategory: 'ui', featureLevel: 'advanced' }),\r\n  script: uiDialog('Edit Combine Script &hellip;', ScriptEditDialog, () => [], { shortcut: true, featureCategory: 'model', featureLevel: 'advanced' }),\r\n  reduce: uiDialog('Reduce by &hellip;', ReduceDialog, () => [], { featureCategory: 'model', featureLevel: 'advanced' }),\r\n  cutoff: uiDialog('Set Cut Off &hellip;', CutOffHierarchyDialog, (ctx) => [ctx.idPrefix], { featureCategory: 'model', featureLevel: 'advanced' }),\r\n  editMapping: uiDialog('Data Mapping &hellip;', MappingDialog, (ctx) => [ctx], { featureCategory: 'model', featureLevel: 'advanced' }),\r\n  editPattern: uiDialog('Edit Pattern &hellip;', EditPatternDialog, (ctx) => [ctx.idPrefix], { featureCategory: 'model', featureLevel: 'advanced' }),\r\n  editWeights: uiDialog('Edit Weights &hellip;', WeightsEditDialog, () => [], { shortcut: true, featureCategory: 'model', featureLevel: 'advanced' }),\r\n  compositeContained: uiDialog('Contained Columns &hellip;', CompositeChildrenDialog, (ctx) => [ctx], { featureCategory: 'model', featureLevel: 'advanced' }),\r\n  splitCombined: ui('Split Combined Column', (col, _evt, ctx, level) => {\r\n    ctx.dialogManager.removeAboveLevel(level);\r\n    // split the combined column into its children\r\n    (<CompositeColumn>col).children.reverse().forEach((c) => col.insertAfterMe(c));\r\n    col.removeMe();\r\n  }, { featureCategory: 'model', featureLevel: 'advanced' }),\r\n  invertSelection: ui('Invert Selection', (col, _evt, ctx, level) => {\r\n    ctx.dialogManager.removeAboveLevel(level - 1); // close itself\r\n    const s = ctx.provider.getSelection();\r\n    const order = col.findMyRanker()!.getOrder();\r\n    if (s.length === 0) {\r\n      ctx.provider.setSelection(order);\r\n      return;\r\n    }\r\n    const ss = new Set(s);\r\n    const others = order.filter((d) => !ss.has(d));\r\n    ctx.provider.setSelection(others);\r\n  }, { featureCategory: 'model', featureLevel: 'advanced' })\r\n}, toolbarAddons);\r\n\r\nfunction sortActions(a: IToolbarAction, b: IToolbarAction) {\r\n  if (a.options.order === b.options.order) {\r\n    return a.title.localeCompare(b.title);\r\n  }\r\n  return (a.options.order || 50) - (b.options.order || 50);\r\n}\r\n\r\nconst cache = new Map<string, IToolbarAction[]>();\r\nconst cacheAddon = new Map<string, IToolbarDialogAddon[]>();\r\n\r\nfunction getFullToolbar(col: Column, ctx: IRankingHeaderContext) {\r\n  if (cache.has(col.desc.type)) {\r\n    return cache.get(col.desc.type)!;\r\n  }\r\n  const icons = <{ [key: string]: IToolbarAction }>ctx.toolbar;\r\n  const actions = new Set<IToolbarAction>();\r\n  if (!col.fixed) {\r\n    actions.add(remove);\r\n  }\r\n  {\r\n    const possible = ctx.getPossibleRenderer(col);\r\n    if (possible.item.length > 2 || possible.group.length > 2 || possible.summary.length > 2) { // default always possible\r\n      actions.add(vis);\r\n    }\r\n  }\r\n\r\n  if (!isSupportType(col)) {\r\n    actions.add(sort);\r\n    actions.add(sortBy);\r\n    actions.add(rename);\r\n    actions.add(clone);\r\n  }\r\n\r\n  const keys = getAllToolbarActions(col);\r\n\r\n  keys.forEach((key) => {\r\n    if (icons.hasOwnProperty(key)) {\r\n      actions.add(icons[key]);\r\n    } else {\r\n      console.warn('cannot find: ', col.desc.type, key);\r\n    }\r\n  });\r\n\r\n  const r = Array.from(actions).sort(sortActions);\r\n  cache.set(col.desc.type, r);\r\n  return r;\r\n}\r\n\r\n\r\nexport function getToolbar(col: Column, ctx: IRankingHeaderContext) {\r\n  const toolbar = getFullToolbar(col, ctx);\r\n  const flags = ctx.flags;\r\n\r\n  return toolbar.filter((a) => {\r\n    // level is basic or not one of disabled features\r\n    return a.options.featureLevel === 'basic' || !((flags.advancedModelFeatures === false && a.options.featureCategory === 'model') || (flags.advancedRankingFeatures === false && a.options.featureCategory === 'ranking') || (flags.advancedUIFeatures === false && a.options.featureCategory === 'ui'));\r\n  });\r\n}\r\n\r\nexport function getToolbarDialogAddons(col: Column, key: string, ctx: IRankingHeaderContext) {\r\n  const cacheKey = `${col.desc.type}@${key}`;\r\n  if (cacheAddon.has(cacheKey)) {\r\n    return cacheAddon.get(cacheKey)!;\r\n  }\r\n  const icons = <{ [key: string]: IToolbarDialogAddon }>ctx.toolbar;\r\n  const actions = new Set<IToolbarDialogAddon>();\r\n\r\n  const keys = getAllToolbarDialogAddons(col, key);\r\n\r\n  keys.forEach((key) => {\r\n    if (icons.hasOwnProperty(key)) {\r\n      actions.add(icons[key]);\r\n    } else {\r\n      console.warn('cannot find: ', col.desc.type, key);\r\n    }\r\n  });\r\n\r\n  const r = Array.from(actions).sort((a, b) => {\r\n    if (a.order === b.order) {\r\n      return a.title.localeCompare(b.title);\r\n    }\r\n    return (a.order || 50) - (b.order || 50);\r\n  });\r\n  cacheAddon.set(cacheKey, r);\r\n  return r;\r\n}\r\n\r\nexport function isSortAble(col: Column, ctx: IRankingHeaderContext) {\r\n  const toolbar = getFullToolbar(col, ctx);\r\n  return toolbar.includes(sortBy);\r\n}\r\n\r\nexport function isGroupAble(col: Column, ctx: IRankingHeaderContext) {\r\n  const toolbar = getFullToolbar(col, ctx);\r\n  return toolbar.includes(groupBy);\r\n}\r\n\r\nexport function isGroupSortAble(col: Column, ctx: IRankingHeaderContext) {\r\n  const toolbar = getFullToolbar(col, ctx);\r\n  return toolbar.includes(sortGroupBy);\r\n}\r\n","import NumberColumn from '../../model/NumberColumn';\r\nimport {IDialogContext} from './ADialog';\r\nimport {round, getNumberOfBins} from '../../internal/math';\r\nimport {forEach} from '../../renderer/utils';\r\n\r\n\r\n/** @internal */\r\nexport default function append(col: NumberColumn, node: HTMLElement, dialog: IDialogContext) {\r\n  const domain = col.getMapping().domain;\r\n  const current = col.getGroupThresholds();\r\n  let isThreshold = current.length <= 1;\r\n  const ranking =  col.findMyRanker()!;\r\n  node.insertAdjacentHTML('beforeend', `\r\n    <div class=\"lu-checkbox\">\r\n      <input type=\"radio\" name=\"threshold\" value=\"threshold\" id=\"${dialog.idPrefix}T1\" ${isThreshold ? 'checked' : ''}>\r\n      <label for=\"${dialog.idPrefix}T1\">at&nbsp;<input type=\"number\" size=\"10\" id=\"${dialog.idPrefix}N1\" value=\"${current.length > 0 ? current[0] : round((domain[1] - domain[0]) / 2, 2)}\"\r\n          required min=\"${domain[0]}\" max=\"${domain[1]}\" step=\"any\" ${!isThreshold ? 'disabled': ''}>\r\n      </label>\r\n    </div>\r\n    <div class=\"lu-checkbox\">\r\n      <input type=\"radio\" name=\"threshold\" value=\"bins\" id=\"${dialog.idPrefix}T2\" ${!isThreshold ? 'checked' : ''}>\r\n      <label for=\"${dialog.idPrefix}T2\"> in&nbsp;<input type=\"number\" size=\"5\" id=\"${dialog.idPrefix}N2\" value=\"${current.length > 1 ? current.length : getNumberOfBins(ranking.getOrder().length)}\"\r\n          required min=\"2\" step=\"1\" ${isThreshold ? 'disabled': ''}>&nbsp;bins\r\n      </label>\r\n    </div>\r\n  `);\r\n\r\n  const threshold = <HTMLInputElement>node.querySelector(`#${dialog.idPrefix}N1`);\r\n  const bins = <HTMLInputElement>node.querySelector(`#${dialog.idPrefix}N2`);\r\n\r\n  const update = () => {\r\n    threshold.disabled = !isThreshold;\r\n    bins.disabled = isThreshold;\r\n\r\n    if (isThreshold) {\r\n      col.setGroupThresholds([parseFloat(threshold.value)]);\r\n      return;\r\n    }\r\n\r\n    const count = parseInt(bins.value, 10);\r\n    const delta = (domain[1] - domain[0]) / count;\r\n    let act = domain[0] + delta;\r\n    const thresholds = [act];\r\n    for(let i = 1; i < count - 1; ++i) {\r\n      act += delta;\r\n      thresholds.push(act);\r\n    }\r\n    col.setGroupThresholds(thresholds);\r\n  };\r\n\r\n  threshold.addEventListener('change', update, { passive: true });\r\n  bins.addEventListener('change', update, { passive: true });\r\n\r\n\r\n  forEach(node, 'input[name=threshold]', (d: HTMLInputElement) => {\r\n    d.addEventListener('change', () => {\r\n      isThreshold = d.value === 'threshold';\r\n      update();\r\n    }, { passive: true });\r\n  });\r\n}\r\n","import {IDialogContext} from './ADialog';\r\nimport StringColumn from '../../model/StringColumn';\r\nimport {EStringGroupCriteriaType} from '../../model/StringColumn';\r\n\r\n/** @internal */\r\nexport default function append(col: StringColumn, node: HTMLElement, dialog: IDialogContext) {\r\n  const current = col.getGroupCriteria();\r\n  const {type, values} = current;\r\n\r\n  node.insertAdjacentHTML('beforeend', `\r\n    <div class=\"lu-checkbox\">\r\n      <input type=\"radio\" name=\"${dialog.idPrefix}groupString\" value=\"${EStringGroupCriteriaType.value}\" id=\"${dialog.idPrefix}VAL\" ${type === EStringGroupCriteriaType.value ? 'checked' : ''}>\r\n      <label for=\"${dialog.idPrefix}VAL\">Use text value</label>\r\n    </div>\r\n    <div class=\"lu-checkbox\">\r\n      <input type=\"radio\" name=\"${dialog.idPrefix}groupString\" value=\"${EStringGroupCriteriaType.startsWith}\" id=\"${dialog.idPrefix}RW\" ${type === EStringGroupCriteriaType.startsWith ? 'checked' : ''}>\r\n      <label for=\"${dialog.idPrefix}RW\">Text starts with &hellip;</label>\r\n    </div>\r\n    <div class=\"lu-checkbox\">\r\n      <input type=\"radio\" name=\"${dialog.idPrefix}groupString\" value=\"${EStringGroupCriteriaType.regex}\" id=\"${dialog.idPrefix}RE\" ${type === EStringGroupCriteriaType.regex ? 'checked' : ''}>\r\n      <label for=\"${dialog.idPrefix}RE\">Use regular expressions</label>\r\n    </div>\r\n    <textarea required rows=\"5\" placeholder=\"e.g. Test,a.*\" id=\"${dialog.idPrefix}T\">${values.map((value) => value instanceof RegExp ? value.source : value).join('\\n')}</textarea>\r\n    <button id=\"${dialog.idPrefix}A\">Apply</button>\r\n  `);\r\n\r\n  const button = node.querySelector<HTMLButtonElement>(`#${dialog.idPrefix}A`)!;\r\n  const valueRadioButton = node.querySelector<HTMLInputElement>(`#${dialog.idPrefix}VAL`)!;\r\n  const startsWithRadioButton = node.querySelector<HTMLInputElement>(`#${dialog.idPrefix}RW`)!;\r\n  const regexRadioButton = node.querySelector<HTMLInputElement>(`#${dialog.idPrefix}RE`)!;\r\n  const text = node.querySelector<HTMLTextAreaElement>(`#${dialog.idPrefix}T`)!;\r\n\r\n  const showOrHideTextarea = (show: boolean) => {\r\n    text.style.display = show ? null : 'none';\r\n  };\r\n\r\n  showOrHideTextarea(type !== EStringGroupCriteriaType.value);\r\n  valueRadioButton.onchange = () => showOrHideTextarea(!valueRadioButton.checked);\r\n  startsWithRadioButton.onchange = () => showOrHideTextarea(startsWithRadioButton.checked);\r\n  regexRadioButton.onchange = () => showOrHideTextarea(regexRadioButton.checked);\r\n\r\n  button.onclick = (evt) => {\r\n    evt.preventDefault();\r\n    evt.stopPropagation();\r\n    const checkedNode = node.querySelector<HTMLInputElement>(`input[name=\"${dialog.idPrefix}groupString\"]:checked`)!;\r\n    const newType = <EStringGroupCriteriaType>checkedNode.value;\r\n    let items: (string | RegExp)[] = text.value.trim().split('\\n').map((d) => d.trim()).filter((d) => d.length > 0);\r\n\r\n    if (newType !== EStringGroupCriteriaType.value) {\r\n      const invalid = items.length === 0;\r\n      text.setCustomValidity(invalid ? 'At least one entry is required' : '');\r\n      if (invalid) {\r\n        (<any>text).reportValidity(); // typedoc not uptodate\r\n        return;\r\n      }\r\n    }\r\n    if (newType === EStringGroupCriteriaType.regex) {\r\n      items = items.map((d) => new RegExp(d.toString(), 'gm'));\r\n    }\r\n    col.setGroupCriteria({\r\n      type: newType,\r\n      values: items\r\n    });\r\n  };\r\n}\r\n","import {IDialogContext} from './ADialog';\r\nimport {forEach} from '../../renderer/utils';\r\nimport DateColumn from '../../model/DateColumn';\r\nimport {IDateGranularity} from '../../model';\r\n\r\n\r\n/** @internal */\r\nexport default function appendDate(col: DateColumn, node: HTMLElement, dialog: IDialogContext) {\r\n  const current = col.getDateGrouper();\r\n\r\n  let granularity = current.granularity;\r\n  let circular = current.circular;\r\n\r\n  let html: string = '';\r\n  for (const g of ['century', 'decade', 'year', 'month', 'week', 'day_of_week', 'day_of_month', 'day_of_year', 'hour', 'minute', 'second']) {\r\n    html += `<div class=\"lu-checkbox\">\r\n    <input type=\"radio\" name=\"granularity\" value=\"${g}\" id=\"${dialog.idPrefix}D${g}\" ${granularity === g ? 'checked' : ''}>\r\n    <label for=\"${dialog.idPrefix}D${g}\"> by ${g}\r\n    </label>\r\n  </div>`;\r\n  }\r\n  html += `<div class=\"lu-checkbox\">\r\n    <input type=\"checkbox\" name=\"circular\" id=\"${dialog.idPrefix}DC\" ${circular ? 'checked' : ''}>\r\n    <label for=\"${dialog.idPrefix}DC\"> Circular\r\n    </label>\r\n  </div>`;\r\n\r\n  node.insertAdjacentHTML('beforeend', html);\r\n\r\n  const update = () => {\r\n    col.setDateGrouper({granularity, circular});\r\n  };\r\n\r\n\r\n  node.querySelector<HTMLInputElement>(`#${dialog.idPrefix}DC`)!.addEventListener('change', (evt) => {\r\n    circular = (<HTMLInputElement>evt.currentTarget).checked;\r\n    update();\r\n  }, { passive: true });\r\n\r\n  forEach(node, 'input[name=granularity]', (d: HTMLInputElement) => {\r\n    d.addEventListener('change', () => {\r\n      granularity = <IDateGranularity>d.value;\r\n      update();\r\n    }, { passive: true });\r\n  });\r\n}\r\n","import {IGroup} from './interfaces';\r\n\r\n\r\nexport interface IOrderedGroup extends IGroup {\r\n  order: number[];\r\n}\r\n\r\nexport const defaultGroup: IGroup = {\r\n  name: 'Default',\r\n  color: 'gray'\r\n};\r\n","import {Category, toolbar, dialogAddons} from './annotations';\r\nimport Column, {widthChanged, labelChanged, metaDataChanged, dirty, dirtyHeader, dirtyValues, rendererTypeChanged, groupRendererChanged, summaryRendererChanged, visibilityChanged} from './Column';\r\nimport {IDataRow, IGroup} from './interfaces';\r\nimport {patternFunction} from './internal';\r\nimport ValueColumn, {IValueColumnDesc, dataLoaded} from './ValueColumn';\r\nimport {IEventListener} from '../internal/AEventDispatcher';\r\nimport {IStringDesc, EAlignment, IStringGroupCriteria, EStringGroupCriteriaType} from './StringColumn';\r\nimport StringColumn from './StringColumn';\r\n\r\nexport interface ILinkDesc extends IStringDesc {\r\n  /**\r\n   * replacement pattern, use use <code>${value}</code> for the current value, <code>${escapedValue}</code> for an url safe value and <code>${item}</code> for the whole item\r\n   */\r\n  pattern?: string;\r\n\r\n  /**\r\n   * optional list of pattern templates\r\n   */\r\n  patternTemplates?: string[];\r\n}\r\n\r\nexport interface ILink {\r\n  alt: string;\r\n  href: string;\r\n}\r\n\r\nexport declare type ILinkColumnDesc = ILinkDesc & IValueColumnDesc<string | ILink>;\r\n\r\n/**\r\n * emitted when the filter property changes\r\n * @asMemberOf LinkColumn\r\n * @event\r\n */\r\nexport declare function filterChanged(previous: string | RegExp | null, current: string | RegExp | null): void;\r\n\r\n\r\n/**\r\n * emitted when the grouping property changes\r\n * @asMemberOf LinkColumn\r\n * @event\r\n */\r\nexport declare function groupingChanged(previous: (RegExp | string)[][], current: (RegExp | string)[][]): void;\r\n\r\n/**\r\n * emitted when the pattern property changes\r\n * @asMemberOf LinkColumn\r\n * @event\r\n */\r\nexport declare function patternChanged(previous: string, current: string): void;\r\n\r\n/**\r\n * a string column with optional alignment\r\n */\r\n@toolbar('search', 'groupBy', 'filterString', 'editPattern')\r\n@dialogAddons('group', 'groupString')\r\n@Category('string')\r\nexport default class LinkColumn extends ValueColumn<string | ILink> {\r\n  static readonly EVENT_FILTER_CHANGED = StringColumn.EVENT_FILTER_CHANGED;\r\n  static readonly EVENT_GROUPING_CHANGED = StringColumn.EVENT_GROUPING_CHANGED;\r\n  static readonly EVENT_PATTERN_CHANGED = 'patternChanged';\r\n\r\n  private pattern: string;\r\n  private patternFunction: Function | null = null;\r\n  readonly patternTemplates: string[];\r\n\r\n  private currentFilter: string | RegExp | null = null;\r\n  private currentGroupCriteria: IStringGroupCriteria = {\r\n    type: EStringGroupCriteriaType.startsWith,\r\n    values: []\r\n  };\r\n\r\n  readonly alignment: EAlignment;\r\n  readonly escape: boolean;\r\n\r\n  constructor(id: string, desc: Readonly<ILinkColumnDesc>) {\r\n    super(id, desc);\r\n    this.setDefaultWidth(200); //by default 200\r\n    this.alignment = <any>desc.alignment || EAlignment.left;\r\n    this.escape = desc.escape !== false;\r\n\r\n    this.pattern = desc.pattern || '';\r\n    this.patternTemplates = desc.patternTemplates || [];\r\n\r\n    if (this.pattern) {\r\n      this.setDefaultRenderer('link');\r\n      this.setDefaultGroupRenderer('link');\r\n    }\r\n  }\r\n\r\n  setPattern(pattern: string) {\r\n    if (pattern === this.pattern) {\r\n      return;\r\n    }\r\n    this.patternFunction = null; // reset cache\r\n    this.fire([LinkColumn.EVENT_PATTERN_CHANGED, Column.EVENT_DIRTY_HEADER, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY], this.pattern, this.pattern = pattern);\r\n  }\r\n\r\n  getPattern() {\r\n    return this.pattern;\r\n  }\r\n\r\n  protected createEventList() {\r\n    return super.createEventList().concat([LinkColumn.EVENT_PATTERN_CHANGED, LinkColumn.EVENT_GROUPING_CHANGED, LinkColumn.EVENT_FILTER_CHANGED]);\r\n  }\r\n\r\n  on(type: typeof LinkColumn.EVENT_PATTERN_CHANGED, listener: typeof patternChanged | null): this;\r\n  on(type: typeof LinkColumn.EVENT_FILTER_CHANGED, listener: typeof filterChanged | null): this;\r\n  on(type: typeof ValueColumn.EVENT_DATA_LOADED, listener: typeof dataLoaded | null): this;\r\n  on(type: typeof LinkColumn.EVENT_GROUPING_CHANGED, listener: typeof groupingChanged | null): this;\r\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\r\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\r\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\r\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\r\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\r\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\r\n  on(type: string | string[], listener: IEventListener | null): this {\r\n    return super.on(<any>type, listener);\r\n  }\r\n\r\n  getValue(row: IDataRow) {\r\n    const l = this.getLink(row);\r\n    return l == null ? '' : l.href;\r\n  }\r\n\r\n  getLink(row: IDataRow): ILink | null {\r\n    const v: string | null | ILink = super.getValue(row);\r\n    return this.transformValue(v, row);\r\n  }\r\n\r\n  private transformValue(v: any, row: IDataRow) {\r\n    if (v == null || v === '') {\r\n      return null;\r\n    }\r\n    if (typeof v === 'string') {\r\n      if (!this.pattern) {\r\n        return {\r\n          alt: v,\r\n          href: v\r\n        };\r\n      }\r\n      if (!this.patternFunction) {\r\n        this.patternFunction = patternFunction(this.pattern, 'item');\r\n      }\r\n      return {\r\n        alt: v,\r\n        href: this.patternFunction.call(this, v, row.v)\r\n      };\r\n    }\r\n    return v;\r\n  }\r\n\r\n  getLabel(row: IDataRow) {\r\n    const l = this.getLink(row);\r\n    return l == null ? '' : l.alt;\r\n  }\r\n\r\n  dump(toDescRef: (desc: any) => any): any {\r\n    const r = StringColumn.prototype.dump.call(this, toDescRef);\r\n    if (this.pattern !== (<any>this.desc).pattern) {\r\n      r.pattern = this.pattern;\r\n    }\r\n    return r;\r\n  }\r\n\r\n  restore(dump: any, factory: (dump: any) => Column | null) {\r\n    StringColumn.prototype.restore.call(this, dump, factory);\r\n    if (dump.pattern) {\r\n      this.pattern = dump.pattern;\r\n    }\r\n  }\r\n\r\n  isFiltered() {\r\n    return this.currentFilter != null;\r\n  }\r\n\r\n  filter(row: IDataRow) {\r\n    return StringColumn.prototype.filter.call(this, row);\r\n  }\r\n\r\n  getFilter() {\r\n    return this.currentFilter;\r\n  }\r\n\r\n  setFilter(filter: string | RegExp | null) {\r\n    return StringColumn.prototype.setFilter.call(this, filter);\r\n  }\r\n\r\n  getGroupCriteria() {\r\n    return this.currentGroupCriteria;\r\n  }\r\n\r\n  setGroupCriteria(value: IStringGroupCriteria) {\r\n    return StringColumn.prototype.setGroupCriteria.call(this, value);\r\n  }\r\n\r\n  compare(a: IDataRow, b: IDataRow) {\r\n    return StringColumn.prototype.compare.call(this, a, b);\r\n  }\r\n\r\n  group(row: IDataRow): IGroup {\r\n    return StringColumn.prototype.group.call(this, row);\r\n  }\r\n}\r\n\r\n","import {format} from 'd3-format';\r\nimport {IBoxPlotData} from '../internal';\r\nimport {Category, toolbar, SortByDefault, dialogAddons} from './annotations';\r\nimport Column, {widthChanged, labelChanged, metaDataChanged, dirty, dirtyHeader, dirtyValues, rendererTypeChanged, groupRendererChanged, summaryRendererChanged, visibilityChanged} from './Column';\r\nimport ValueColumn, {IValueColumnDesc, dataLoaded} from './ValueColumn';\r\nimport {IDataRow} from './interfaces';\r\nimport {\r\n  compareBoxPlot, ESortMethod, getBoxPlotNumber, IBoxPlotColumn, INumberFilter, noNumberFilter, isDummyNumberFilter, restoreNumberFilter\r\n} from './INumberColumn';\r\nimport {\r\n  createMappingFunction, IMapAbleDesc, IMappingFunction, restoreMapping,\r\n  ScaleMappingFunction\r\n} from './MappingFunction';\r\nimport NumberColumn, {colorMappingChanged} from './NumberColumn';\r\nimport {IEventListener} from '../internal/AEventDispatcher';\r\nimport {IColorMappingFunction, restoreColorMapping, createColorMappingFunction} from './ColorMappingFunction';\r\n\r\n\r\nexport interface IBoxPlotDesc extends IMapAbleDesc {\r\n  sort?: ESortMethod;\r\n}\r\n\r\nexport declare type IBoxPlotColumnDesc = IBoxPlotDesc & IValueColumnDesc<IBoxPlotData>;\r\n\r\n\r\n/**\r\n * emitted when the sort method property changes\r\n * @asMemberOf BoxPlotColumn\r\n * @event\r\n */\r\nexport declare function sortMethodChanged(previous: ESortMethod, current: ESortMethod): void;\r\n\r\n/**\r\n * emitted when the mapping property changes\r\n * @asMemberOf BoxPlotColumn\r\n * @event\r\n */\r\nexport declare function mappingChanged(previous: IMappingFunction, current: IMappingFunction): void;\r\n\r\n/**\r\n * emitted when the filter property changes\r\n * @asMemberOf BoxPlotColumn\r\n * @event\r\n */\r\nexport declare function filterChanged(previous: INumberFilter | null, current: INumberFilter | null): void;\r\n\r\n\r\n@toolbar('filterNumber', 'colorMapped', 'editMapping')\r\n@dialogAddons('sort', 'sortBoxPlot')\r\n@Category('array')\r\n@SortByDefault('descending')\r\nexport default class BoxPlotColumn extends ValueColumn<IBoxPlotData> implements IBoxPlotColumn {\r\n  static readonly EVENT_MAPPING_CHANGED = NumberColumn.EVENT_MAPPING_CHANGED;\r\n  static readonly EVENT_COLOR_MAPPING_CHANGED = NumberColumn.EVENT_COLOR_MAPPING_CHANGED;\r\n  static readonly EVENT_SORTMETHOD_CHANGED = NumberColumn.EVENT_SORTMETHOD_CHANGED;\r\n  static readonly EVENT_FILTER_CHANGED = NumberColumn.EVENT_FILTER_CHANGED;\r\n\r\n  static readonly DEFAULT_FORMATTER = format('.3n');\r\n\r\n  private sort: ESortMethod;\r\n\r\n  private mapping: IMappingFunction;\r\n  private colorMapping: IColorMappingFunction;\r\n\r\n  private original: Readonly<IMappingFunction>;\r\n  /**\r\n   * currently active filter\r\n   * @type {{min: number, max: number}}\r\n   * @private\r\n   */\r\n  private currentFilter: INumberFilter = noNumberFilter();\r\n\r\n\r\n  constructor(id: string, desc: Readonly<IBoxPlotColumnDesc>) {\r\n    super(id, desc);\r\n    this.mapping = restoreMapping(desc);\r\n    this.original = this.mapping.clone();\r\n    this.colorMapping = restoreColorMapping(desc);\r\n\r\n    this.sort = desc.sort || ESortMethod.min;\r\n\r\n  }\r\n\r\n  compare(a: IDataRow, b: IDataRow): number {\r\n    return compareBoxPlot(this, a, b);\r\n  }\r\n\r\n  getBoxPlotData(row: IDataRow): IBoxPlotData | null {\r\n    return this.getValue(row);\r\n  }\r\n\r\n  getRange() {\r\n    return this.mapping.getRange(BoxPlotColumn.DEFAULT_FORMATTER);\r\n  }\r\n\r\n  getRawBoxPlotData(row: IDataRow): IBoxPlotData | null {\r\n    return this.getRawValue(row);\r\n  }\r\n\r\n  getRawValue(row: IDataRow) {\r\n    return super.getValue(row);\r\n  }\r\n\r\n  getExportValue(row: IDataRow, format: 'text' | 'json'): any {\r\n    return format === 'json' ? this.getRawValue(row) : super.getExportValue(row, format);\r\n  }\r\n\r\n  getValue(row: IDataRow) {\r\n    const v = this.getRawValue(row);\r\n    if (v == null) {\r\n      return v;\r\n    }\r\n    const r: IBoxPlotData = {\r\n      min: this.mapping.apply(v.min),\r\n      max: this.mapping.apply(v.max),\r\n      median: this.mapping.apply(v.median),\r\n      q1: this.mapping.apply(v.q1),\r\n      q3: this.mapping.apply(v.q3)\r\n    };\r\n    if (v.outlier) {\r\n      Object.assign(r, {\r\n        outlier: v.outlier.map((d) => this.mapping.apply(d))\r\n      });\r\n    }\r\n    if (v.whiskerLow != null) {\r\n      Object.assign(r, {\r\n        whiskerLow: this.mapping.apply(v.whiskerLow)\r\n      });\r\n    }\r\n    if (v.whiskerHigh != null) {\r\n      Object.assign(r, {\r\n        whiskerHigh: this.mapping.apply(v.whiskerHigh)\r\n      });\r\n    }\r\n    return r;\r\n  }\r\n\r\n  getNumber(row: IDataRow): number {\r\n    return getBoxPlotNumber(this, row, 'normalized');\r\n  }\r\n\r\n  getRawNumber(row: IDataRow): number {\r\n    return getBoxPlotNumber(this, row, 'raw');\r\n  }\r\n\r\n  getLabel(row: IDataRow): string {\r\n    const v = this.getRawValue(row);\r\n    if (v == null) {\r\n      return '';\r\n    }\r\n    const f = BoxPlotColumn.DEFAULT_FORMATTER;\r\n    return `BoxPlot(min = ${f(v.min)}, q1 = ${f(v.q1)}, median = ${f(v.median)}, q3 = ${f(v.q3)}, max = ${f(v.max)})`;\r\n  }\r\n\r\n  getSortMethod() {\r\n    return this.sort;\r\n  }\r\n\r\n  setSortMethod(sort: ESortMethod) {\r\n    if (this.sort === sort) {\r\n      return;\r\n    }\r\n    this.fire(BoxPlotColumn.EVENT_SORTMETHOD_CHANGED, this.sort, this.sort = sort);\r\n    // sort by me if not already sorted by me\r\n    if (!this.isSortedByMe().asc) {\r\n      this.sortByMe();\r\n    }\r\n  }\r\n\r\n  dump(toDescRef: (desc: any) => any): any {\r\n    const r = super.dump(toDescRef);\r\n    r.sortMethod = this.getSortMethod();\r\n    r.filter = !isDummyNumberFilter(this.currentFilter) ? this.currentFilter : null;\r\n    r.map = this.mapping.dump();\r\n    r.colorMapping = this.colorMapping.dump();\r\n    return r;\r\n  }\r\n\r\n  restore(dump: any, factory: (dump: any) => Column | null) {\r\n    super.restore(dump, factory);\r\n    if (dump.sortMethod) {\r\n      this.sort = dump.sortMethod;\r\n    }\r\n    if (dump.filter) {\r\n      this.currentFilter = restoreNumberFilter(dump.filter);\r\n    }\r\n    if (dump.map) {\r\n      this.mapping = createMappingFunction(dump.map);\r\n    } else if (dump.domain) {\r\n      this.mapping = new ScaleMappingFunction(dump.domain, 'linear', dump.range || [0, 1]);\r\n    }\r\n    if (dump.colorMapping) {\r\n      this.colorMapping = createColorMappingFunction(dump.colorMapping);\r\n    }\r\n  }\r\n\r\n  protected createEventList() {\r\n    return super.createEventList().concat([BoxPlotColumn.EVENT_SORTMETHOD_CHANGED, BoxPlotColumn.EVENT_COLOR_MAPPING_CHANGED, BoxPlotColumn.EVENT_MAPPING_CHANGED, BoxPlotColumn.EVENT_FILTER_CHANGED]);\r\n  }\r\n\r\n  on(type: typeof BoxPlotColumn.EVENT_COLOR_MAPPING_CHANGED, listener: typeof colorMappingChanged | null): this;\r\n  on(type: typeof BoxPlotColumn.EVENT_MAPPING_CHANGED, listener: typeof mappingChanged | null): this;\r\n  on(type: typeof BoxPlotColumn.EVENT_SORTMETHOD_CHANGED, listener: typeof sortMethodChanged | null): this;\r\n  on(type: typeof BoxPlotColumn.EVENT_FILTER_CHANGED, listener: typeof filterChanged | null): this;\r\n  on(type: typeof ValueColumn.EVENT_DATA_LOADED, listener: typeof dataLoaded | null): this;\r\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\r\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\r\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\r\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\r\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\r\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\r\n  on(type: string | string[], listener: IEventListener | null): this {\r\n    return super.on(<any>type, listener);\r\n  }\r\n\r\n  getOriginalMapping() {\r\n    return this.original.clone();\r\n  }\r\n\r\n  getMapping() {\r\n    return this.mapping.clone();\r\n  }\r\n\r\n  setMapping(mapping: IMappingFunction) {\r\n    if (this.mapping.eq(mapping)) {\r\n      return;\r\n    }\r\n    this.fire([BoxPlotColumn.EVENT_MAPPING_CHANGED, Column.EVENT_DIRTY_HEADER, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY], this.mapping.clone(), this.mapping = mapping);\r\n  }\r\n\r\n  getColor(row: IDataRow) {\r\n    return NumberColumn.prototype.getColor.call(this, row);\r\n  }\r\n\r\n  getColorMapping() {\r\n    return this.colorMapping.clone();\r\n  }\r\n\r\n  setColorMapping(mapping: IColorMappingFunction) {\r\n    if (this.colorMapping.eq(mapping)) {\r\n      return;\r\n    }\r\n    this.fire([BoxPlotColumn.EVENT_COLOR_MAPPING_CHANGED, Column.EVENT_DIRTY_HEADER, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY], this.colorMapping.clone(), this.colorMapping = mapping);\r\n  }\r\n\r\n  isFiltered() {\r\n    return NumberColumn.prototype.isFiltered.call(this);\r\n  }\r\n\r\n  getFilter(): INumberFilter {\r\n    return NumberColumn.prototype.getFilter.call(this);\r\n  }\r\n\r\n  setFilter(value: INumberFilter = {min: -Infinity, max: +Infinity, filterMissing: false}) {\r\n    NumberColumn.prototype.setFilter.call(this, value);\r\n  }\r\n\r\n  filter(row: IDataRow) {\r\n    return NumberColumn.prototype.filter.call(this, row);\r\n  }\r\n}\r\n\r\n","import {Category, SupportType} from './annotations';\r\nimport ValueColumn, {IValueColumnDesc} from './ValueColumn';\r\n\r\n/**\r\n * factory for creating a description creating a rank column\r\n * @param label\r\n * @returns {{type: string, label: string}}\r\n */\r\nexport function createRankDesc(label: string = 'Rank') {\r\n  return {type: 'rank', label};\r\n}\r\n\r\n/**\r\n * a rank column\r\n */\r\n@SupportType()\r\n@Category('support')\r\nexport default class RankColumn extends ValueColumn<number> {\r\n\r\n  constructor(id: string, desc: IValueColumnDesc<number>) {\r\n    super(id, desc);\r\n    this.setDefaultWidth(50);\r\n  }\r\n\r\n  get frozen() {\r\n    return this.desc.frozen !== false;\r\n  }\r\n}\r\n","import {Category} from './annotations';\r\nimport Column, {widthChanged, labelChanged, metaDataChanged, dirty, dirtyHeader, dirtyValues, rendererTypeChanged, groupRendererChanged, summaryRendererChanged, visibilityChanged} from './Column';\r\nimport ValueColumn, {IValueColumnDesc, dataLoaded} from './ValueColumn';\r\nimport {range} from 'd3-array';\r\nimport {IArrayColumn} from './IArrayColumn';\r\nimport {IDataRow} from './interfaces';\r\nimport {IEventListener} from '../internal/AEventDispatcher';\r\n\r\n\r\nexport interface IArrayDesc {\r\n  dataLength?: number;\r\n  labels?: string[];\r\n}\r\n\r\nexport interface ISplicer {\r\n  length: number | null;\r\n\r\n  splice<T>(values: T[]): T[];\r\n}\r\n\r\nexport interface IArrayColumnDesc<T> extends IArrayDesc, IValueColumnDesc<T[]> {\r\n  // dummy\r\n}\r\n\r\n/**\r\n * emitted when the splicer property changes\r\n * @asMemberOf ArrayColumn\r\n * @event\r\n */\r\nexport declare function spliceChanged(previous: ISplicer, current: ISplicer): void;\r\n\r\n\r\n@Category('array')\r\nexport default class ArrayColumn<T> extends ValueColumn<T[]> implements IArrayColumn<T> {\r\n  static readonly EVENT_SPLICE_CHANGED = 'spliceChanged';\r\n\r\n  private readonly _dataLength: number | null;\r\n\r\n  private splicer: Readonly<ISplicer>;\r\n\r\n  private readonly originalLabels: string[];\r\n\r\n  constructor(id: string, desc: Readonly<IArrayColumnDesc<T>>) {\r\n    super(id, desc);\r\n    this._dataLength = desc.dataLength == null || isNaN(desc.dataLength) ? null : desc.dataLength;\r\n    this.originalLabels = desc.labels || (range(this._dataLength == null ? 0 : this._dataLength).map((_d, i) => `Column ${i}`));\r\n    this.splicer = {\r\n      length: this._dataLength,\r\n      splice: (v) => v\r\n    };\r\n  }\r\n\r\n  setSplicer(splicer: Readonly<ISplicer>) {\r\n    this.fire([ArrayColumn.EVENT_SPLICE_CHANGED, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY_HEADER, Column.EVENT_DIRTY], this.splicer, this.splicer = splicer);\r\n  }\r\n\r\n  get labels() {\r\n    if (this.splicer) {\r\n      return this.splicer.splice(this.originalLabels);\r\n    }\r\n    return this.originalLabels;\r\n  }\r\n\r\n  getSplicer() {\r\n    return this.splicer;\r\n  }\r\n\r\n  get dataLength() {\r\n    if (this.splicer) {\r\n      return this.splicer.length;\r\n    }\r\n    return this._dataLength;\r\n  }\r\n\r\n  getValue(row: IDataRow) {\r\n    return this.getValues(row);\r\n  }\r\n\r\n  getValues(row: IDataRow) {\r\n    let r = super.getValue(row);\r\n    if (this.splicer && r != null) {\r\n      r = this.splicer.splice(r);\r\n    }\r\n    return r == null ? [] : r;\r\n  }\r\n\r\n  getLabels(row: IDataRow) {\r\n    return this.getValues(row).map(String);\r\n  }\r\n\r\n  getLabel(row: IDataRow): string {\r\n    const v = this.getLabels(row);\r\n    if (!v) {\r\n      return '';\r\n    }\r\n    return v.toString();\r\n  }\r\n\r\n  getMap(row: IDataRow) {\r\n    const labels = this.labels;\r\n    return this.getValues(row).map((value, i) => ({key: labels[i], value}));\r\n  }\r\n\r\n  getMapLabel(row: IDataRow) {\r\n    const labels = this.labels;\r\n    return this.getLabels(row).map((value, i) => ({key: labels[i], value}));\r\n  }\r\n\r\n  protected createEventList() {\r\n    return super.createEventList().concat([ArrayColumn.EVENT_SPLICE_CHANGED]);\r\n  }\r\n\r\n  on(type: typeof ArrayColumn.EVENT_SPLICE_CHANGED, listener: typeof spliceChanged | null): this;\r\n  on(type: typeof ValueColumn.EVENT_DATA_LOADED, listener: typeof dataLoaded | null): this;\r\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\r\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\r\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\r\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\r\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\r\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\r\n  on(type: string | string[], listener: IEventListener | null): this {\r\n    return super.on(<any>type, listener);\r\n  }\r\n\r\n}\r\n\r\n","import * as equalImpl from 'fast-deep-equal';\r\n\r\nexport const equal: (a: any, b: any) => boolean = (typeof equalImpl === 'function' ? equalImpl : (<any>equalImpl).default);\r\n\r\n/** @internal */\r\nexport function findOption(options: any) {\r\n  return (key: string, defaultValue: any): any => {\r\n    if (key in options) {\r\n      return options[key];\r\n    }\r\n    if (key.indexOf('.') > 0) {\r\n      const p = key.substring(0, key.indexOf('.'));\r\n      key = key.substring(key.indexOf('.') + 1);\r\n      if (p in options && key in options[p]) {\r\n        return options[p][key];\r\n      }\r\n    }\r\n    return defaultValue;\r\n  };\r\n}\r\n\r\n/** @internal */\r\nexport function equalArrays<T>(a: T[], b: T[]) {\r\n  if (a.length !== b.length) {\r\n    return false;\r\n  }\r\n  return a.every((ai, i) => ai === b[i]);\r\n}\r\n\r\n\r\n/**\r\n * converts a given id to css compatible one\r\n * @param id\r\n * @return {string|void}\r\n * @internal\r\n */\r\nexport function fixCSS(id: string) {\r\n  return id.replace(/[\\s!#$%&'()*+,.\\/:;<=>?@\\[\\\\\\]^`{|}~]+/g, '_'); //replace non css stuff to _\r\n}\r\n","import {round, similar} from '../internal';\r\nimport {toolbar} from './annotations';\r\nimport Column, {IFlatColumn, widthChanged, labelChanged, metaDataChanged, dirty, dirtyHeader, dirtyValues, rendererTypeChanged, groupRendererChanged, summaryRendererChanged, visibilityChanged} from './Column';\r\nimport CompositeColumn, {IMultiLevelColumn, addColumn, filterChanged, moveColumn, removeColumn} from './CompositeColumn';\r\nimport CompositeNumberColumn, {ICompositeNumberDesc} from './CompositeNumberColumn';\r\nimport {IDataRow} from './interfaces';\r\nimport {isNumberColumn} from './INumberColumn';\r\nimport {IEventListener} from '../internal/AEventDispatcher';\r\n\r\n/**\r\n * factory for creating a description creating a stacked column\r\n * @param label\r\n * @returns {{type: string, label: string}}\r\n */\r\nexport function createStackDesc(label: string = 'Weighted Sum') {\r\n  return {type: 'stack', label};\r\n}\r\n\r\n\r\n/**\r\n * emitted when the collapse property changes\r\n * @asMemberOf StackColumn\r\n * @event\r\n */\r\nexport declare function collapseChanged(previous: boolean, current: boolean): void;\r\n\r\n\r\n/**\r\n * emitted when the weights change\r\n * @asMemberOf StackColumn\r\n * @event\r\n */\r\nexport declare function weightsChanged(previous: number[], current: number[]): void;\r\n\r\n\r\n/**\r\n * emitted when the ratios between the children changes\r\n * @asMemberOf StackColumn\r\n * @event\r\n */\r\nexport declare function nestedChildRatio(previous: number[], current: number[]): void;\r\n\r\n/**\r\n * implementation of the stacked column\r\n */\r\n@toolbar('editWeights', 'collapse')\r\nexport default class StackColumn extends CompositeNumberColumn implements IMultiLevelColumn {\r\n  static readonly EVENT_COLLAPSE_CHANGED = 'collapseChanged';\r\n  static readonly EVENT_WEIGHTS_CHANGED = 'weightsChanged';\r\n  static readonly EVENT_MULTI_LEVEL_CHANGED = 'nestedChildRatio';\r\n\r\n  static readonly COLLAPSED_RENDERER = 'number';\r\n\r\n  private readonly adaptChange: (old: number, newValue: number) => void;\r\n\r\n  /**\r\n   * whether this stack column is collapsed i.e. just looks like an ordinary number column\r\n   * @type {boolean}\r\n   * @private\r\n   */\r\n  private collapsed = false;\r\n\r\n  constructor(id: string, desc: ICompositeNumberDesc) {\r\n    super(id, desc);\r\n\r\n    const that = this;\r\n    this.adaptChange = function (this: {source: Column}, oldValue, newValue) {\r\n      that.adaptWidthChange(this.source, oldValue, newValue);\r\n    };\r\n\r\n    this.setDefaultRenderer('stack');\r\n    this.setDefaultGroupRenderer('stack');\r\n    this.setDefaultSummaryRenderer('default');\r\n  }\r\n\r\n  get label() {\r\n    const l = super.getMetaData().label;\r\n    const c = this._children;\r\n    if (l !== 'Weighted Sum' || c.length === 0) {\r\n      return l;\r\n    }\r\n    const weights = this.getWeights();\r\n    return c.map((c, i) => `${c.label} (${round(100 * weights[i], 1)}%)`).join(' + ');\r\n  }\r\n\r\n  protected createEventList() {\r\n    return super.createEventList().concat([StackColumn.EVENT_COLLAPSE_CHANGED, StackColumn.EVENT_WEIGHTS_CHANGED, StackColumn.EVENT_MULTI_LEVEL_CHANGED]);\r\n  }\r\n\r\n  on(type: typeof StackColumn.EVENT_COLLAPSE_CHANGED, listener: typeof collapseChanged | null): this;\r\n  on(type: typeof StackColumn.EVENT_WEIGHTS_CHANGED, listener: typeof weightsChanged | null): this;\r\n  on(type: typeof StackColumn.EVENT_MULTI_LEVEL_CHANGED, listener: typeof nestedChildRatio | null): this;\r\n  on(type: typeof CompositeColumn.EVENT_FILTER_CHANGED, listener: typeof filterChanged | null): this;\r\n  on(type: typeof CompositeColumn.EVENT_ADD_COLUMN, listener: typeof addColumn | null): this;\r\n  on(type: typeof CompositeColumn.EVENT_MOVE_COLUMN, listener: typeof moveColumn | null): this;\r\n  on(type: typeof CompositeColumn.EVENT_REMOVE_COLUMN, listener: typeof removeColumn | null): this;\r\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\r\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\r\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\r\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\r\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\r\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\r\n  on(type: string | string[], listener: IEventListener | null): this {\r\n    return super.on(type, listener);\r\n  }\r\n\r\n  setCollapsed(value: boolean) {\r\n    if (this.collapsed === value) {\r\n      return;\r\n    }\r\n    this.fire([StackColumn.EVENT_COLLAPSE_CHANGED, Column.EVENT_DIRTY_HEADER, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY], this.collapsed, this.collapsed = value);\r\n  }\r\n\r\n  getCollapsed() {\r\n    return this.collapsed;\r\n  }\r\n\r\n  get canJustAddNumbers() {\r\n    return true;\r\n  }\r\n\r\n  flatten(r: IFlatColumn[], offset: number, levelsToGo = 0, padding = 0) {\r\n    let self = null;\r\n    const children = levelsToGo <= Column.FLAT_ALL_COLUMNS ? this._children : this._children.filter((c) => c.isVisible());\r\n    //no more levels or just this one\r\n    if (levelsToGo === 0 || levelsToGo <= Column.FLAT_ALL_COLUMNS) {\r\n      let w = this.getWidth();\r\n      if (!this.collapsed) {\r\n        w += (children.length - 1) * padding;\r\n      }\r\n      r.push(self = {col: this, offset, width: w});\r\n      if (levelsToGo === 0) {\r\n        return w;\r\n      }\r\n    }\r\n    //push children\r\n    let acc = offset;\r\n    children.forEach((c) => {\r\n      acc += c.flatten(r, acc, levelsToGo - 1, padding) + padding;\r\n    });\r\n    if (self) { //nesting my even increase my width\r\n      self.width = acc - offset - padding;\r\n    }\r\n    return acc - offset - padding;\r\n  }\r\n\r\n  dump(toDescRef: (desc: any) => any) {\r\n    const r = super.dump(toDescRef);\r\n    r.collapsed = this.collapsed;\r\n    return r;\r\n  }\r\n\r\n  restore(dump: any, factory: (dump: any) => Column | null) {\r\n    this.collapsed = dump.collapsed === true;\r\n    super.restore(dump, factory);\r\n  }\r\n\r\n  /**\r\n   * inserts a column at a the given position\r\n   */\r\n  insert(col: Column, index: number, weight = NaN) {\r\n    if (!isNaN(weight)) {\r\n      col.setWidth((weight / (1 - weight) * this.getWidth()));\r\n    }\r\n    col.on(`${Column.EVENT_WIDTH_CHANGED}.stack`, this.adaptChange);\r\n    //increase my width\r\n    super.setWidth(this.length === 0 ? col.getWidth() : (this.getWidth() + col.getWidth()));\r\n\r\n    return super.insert(col, index);\r\n  }\r\n\r\n  push(col: Column, weight = NaN) {\r\n    return this.insert(col, this.length, weight);\r\n  }\r\n\r\n  insertAfter(col: Column, ref: Column, weight = NaN) {\r\n    const i = this.indexOf(ref);\r\n    if (i < 0) {\r\n      return null;\r\n    }\r\n    return this.insert(col, i + 1, weight);\r\n  }\r\n\r\n  /**\r\n   * adapts weights according to an own width change\r\n   * @param col\r\n   * @param oldValue\r\n   * @param newValue\r\n   */\r\n  private adaptWidthChange(col: Column, oldValue: number, newValue: number) {\r\n    if (similar(oldValue, newValue, 0.5)) {\r\n      return;\r\n    }\r\n    const bak = this.getWeights();\r\n    const full = this.getWidth(),\r\n      change = (newValue - oldValue) / full;\r\n    const oldWeight = oldValue / full;\r\n    const factor = (1 - oldWeight - change) / (1 - oldWeight);\r\n    const widths = this._children.map((c) => {\r\n      if (c === col) {\r\n        //c.weight += change;\r\n        return newValue;\r\n      }\r\n      const guess = c.getWidth() * factor;\r\n      const w = isNaN(guess) || guess < 1 ? 0 : guess;\r\n      c.setWidthImpl(w);\r\n      return w;\r\n    });\r\n    //adapt width if needed\r\n    super.setWidth(widths.reduce((a, b) => a + b, 0));\r\n\r\n    this.fire([StackColumn.EVENT_WEIGHTS_CHANGED, StackColumn.EVENT_MULTI_LEVEL_CHANGED, Column.EVENT_DIRTY_HEADER, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY], bak, this.getWeights());\r\n  }\r\n\r\n  getWeights() {\r\n    const w = this.getWidth();\r\n    return this._children.map((d) => d.getWidth() / w);\r\n  }\r\n\r\n  setWeights(weights: number[]) {\r\n    const bak = this.getWeights();\r\n    const delta = weights.length - this.length;\r\n    let s: number;\r\n    if (delta < 0) {\r\n      s = weights.reduce((p, a) => p + a, 0);\r\n      if (s <= 1) {\r\n        for (let i = 0; i < -delta; ++i) {\r\n          weights.push((1 - s) * (1 / -delta));\r\n        }\r\n      } else if (s <= 100) {\r\n        for (let i = 0; i < -delta; ++i) {\r\n          weights.push((100 - s) * (1 / -delta));\r\n        }\r\n      }\r\n    }\r\n    weights = weights.slice(0, this.length);\r\n    s = weights.reduce((p, a) => p + a, 0) / this.getWidth();\r\n    weights = weights.map((d) => d / s);\r\n\r\n    this._children.forEach((c, i) => {\r\n      c.setWidthImpl(weights[i]);\r\n    });\r\n    this.fire([StackColumn.EVENT_WEIGHTS_CHANGED, StackColumn.EVENT_MULTI_LEVEL_CHANGED, Column.EVENT_DIRTY_HEADER, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY], bak, weights);\r\n\r\n  }\r\n\r\n  removeImpl(child: Column, index: number) {\r\n    child.on(`${Column.EVENT_WIDTH_CHANGED}.stack`, null);\r\n    super.setWidth(this.length === 0 ? 100 : this.getWidth() - child.getWidth());\r\n    return super.removeImpl(child, index);\r\n  }\r\n\r\n  setWidth(value: number) {\r\n    const factor = value / this.getWidth();\r\n    this._children.forEach((child) => {\r\n      //disable since we change it\r\n      child.setWidthImpl(child.getWidth() * factor);\r\n    });\r\n    super.setWidth(value);\r\n  }\r\n\r\n  protected compute(row: IDataRow) {\r\n    const w = this.getWidth();\r\n    return this._children.reduce((acc, d) => acc + d.getValue(row) * (d.getWidth() / w), 0);\r\n  }\r\n\r\n  getRenderer() {\r\n    if (this.getCollapsed() && this.isLoaded()) {\r\n      return StackColumn.COLLAPSED_RENDERER;\r\n    }\r\n    return super.getRenderer();\r\n  }\r\n\r\n  isMissing(row: IDataRow) {\r\n    return this._children.some((c) => isNumberColumn(c) && c.isMissing(row));\r\n  }\r\n\r\n  getExportValue(row: IDataRow, format: 'text' | 'json'): any {\r\n    if (format === 'json') {\r\n      return {\r\n        value: this.getRawNumber(row),\r\n        children: this.children.map((d) => d.getExportValue(row, format))\r\n      };\r\n    }\r\n    return super.getExportValue(row, format);\r\n  }\r\n}\r\n","\r\nimport get from 'lodash.get';\r\n\r\n/** @internal */\r\nexport function resolveValue(row: any, column: string | number) {\r\n  if (row.hasOwnProperty(column)) { // well complex but a direct hit\r\n    return row[column];\r\n  }\r\n  return get(row, column);\r\n}\r\n","export function hasDnDType(e: DragEvent, ...typesToCheck: string[]) {\r\n  console.assert(e.dataTransfer != null);\r\n  const available: any = e.dataTransfer!.types;\r\n\r\n  /*\r\n   * In Chrome datatransfer.types is an Array,\r\n   * while in Firefox it is a DOMStringList\r\n   * that only implements a contains-method!\r\n   */\r\n  if (typeof available.indexOf === 'function') {\r\n    return typesToCheck.some((type) => available.indexOf(type) >= 0);\r\n  }\r\n  if (typeof available.includes === 'function') {\r\n    return typesToCheck.some((type) => available.includes(type));\r\n  }\r\n  if (typeof available.contains === 'function') {\r\n    return typesToCheck.some((type) => available.contains(type));\r\n  }\r\n  return false;\r\n}\r\n\r\n\r\n/**\r\n * helper storage for dnd in edge since edge doesn't support custom mime-types\r\n * @type {Map<number, {[p: string]: string}>}\r\n */\r\nconst dndTransferStorage = new Map<number, { [key: string]: string }>();\r\n\r\nfunction isEdgeDnD(e: DragEvent) {\r\n  return dndTransferStorage.size > 0 && hasDnDType(e, 'text/plain');\r\n}\r\n\r\n/**\r\n * checks whether it is a copy operation\r\n * @param e\r\n * @returns {boolean|RegExpMatchArray}\r\n * @internal\r\n */\r\nexport function copyDnD(e: DragEvent) {\r\n  console.assert(e.dataTransfer != null);\r\n  const dT = e.dataTransfer!;\r\n  return Boolean((e.ctrlKey && dT.effectAllowed.match(/copy/gi)) || (!dT.effectAllowed.match(/move/gi)));\r\n}\r\n\r\n/**\r\n * updates the drop effect accoriding to the current copyDnD state\r\n * @param e\r\n * @internal\r\n */\r\nexport function updateDropEffect(e: DragEvent) {\r\n  console.assert(e.dataTransfer != null);\r\n  const dT = e.dataTransfer!;\r\n  if (copyDnD(e)) {\r\n    dT.dropEffect = 'copy';\r\n  } else {\r\n    dT.dropEffect = 'move';\r\n  }\r\n}\r\n\r\nexport type IDragEffect = 'none' | 'copy' | 'copyLink' | 'copyMove' | 'link' | 'linkMove' | 'move' | 'all';\r\n\r\nexport interface IDragStartResult {\r\n  effectAllowed: IDragEffect;\r\n  data: { [mimeType: string]: string };\r\n}\r\n\r\nexport interface IDropResult {\r\n  effect: IDragEffect;\r\n  data: { [mimeType: string]: string };\r\n}\r\n\r\nlet idCounter = 0;\r\n\r\n/**\r\n * add drag support for the given element\r\n * @param {HTMLElement} node\r\n * @param {() => IDragStartResult} onDragStart callback to compute the payload an object of mime types\r\n * @param {boolean} stopPropagation whether to stop propagation in case of success\r\n * @internal\r\n */\r\nexport function dragAble(node: HTMLElement, onDragStart: () => IDragStartResult, stopPropagation: boolean = false) {\r\n  const id = ++idCounter;\r\n  node.draggable = true;\r\n  node.addEventListener('dragstart', (e) => {\r\n    node.classList.add('lu-dragging');\r\n    const payload = onDragStart();\r\n    console.assert(e.dataTransfer != null);\r\n    const dT = e.dataTransfer!;\r\n    dT.effectAllowed = payload.effectAllowed;\r\n\r\n    if (stopPropagation) {\r\n      e.stopPropagation();\r\n    }\r\n\r\n    const keys = Object.keys(payload.data);\r\n    const allSucceded = keys.every((k) => {\r\n      try {\r\n        dT.setData(k, payload.data[k]);\r\n        return true;\r\n      } catch (e) {\r\n        return false;\r\n      }\r\n    });\r\n    if (allSucceded) {\r\n      return;\r\n    }\r\n    //compatibility mode for edge\r\n    const text = payload.data['text/plain'] || '';\r\n    dT.setData('text/plain', `${id}${text ? `: ${text}` : ''}`);\r\n    dndTransferStorage.set(id, payload.data);\r\n  });\r\n  node.addEventListener('dragend', (e) => {\r\n    node.classList.remove('lu-dragging');\r\n    if (stopPropagation) {\r\n      e.stopPropagation();\r\n    }\r\n    if (dndTransferStorage.size > 0) {\r\n      //clear the id\r\n      dndTransferStorage.delete(id);\r\n    }\r\n\r\n    // remove all\r\n    const over = <HTMLElement>node.ownerDocument!.querySelector('.lu-dragover');\r\n    if (over) {\r\n      over.classList.remove('lu-dragover');\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * add dropable support for the given node\r\n * @param {HTMLElement} node\r\n * @param {string[]} mimeTypes mimeTypes to look for\r\n * @param {(result: IDropResult, e: DragEvent) => boolean} onDrop callback when dropped, returns true if the drop was successful\r\n * @param {(e: DragEvent) => void} onDragOver optional drag over handler, e.g. for special effects\r\n * @param {boolean} stopPropagation flag if the event propagation should be stopped in case of success\r\n * @internal\r\n */\r\nexport function dropAble(node: HTMLElement, mimeTypes: string[], onDrop: (result: IDropResult, e: DragEvent) => boolean, onDragOver: null | ((e: DragEvent) => void) = null, stopPropagation: boolean = false) {\r\n  node.addEventListener('dragenter', (e) => {\r\n    //var xy = mouse($node.node());\r\n    if (!node.classList.contains('lu-dragging') && (hasDnDType(e, ...mimeTypes) || isEdgeDnD(e))) {\r\n      node.classList.add('lu-dragover');\r\n      if (stopPropagation) {\r\n        e.stopPropagation();\r\n      }\r\n      //sounds good\r\n      return false;\r\n    }\r\n    //not a valid mime type\r\n    node.classList.remove('lu-dragover');\r\n    return;\r\n  });\r\n  node.addEventListener('dragover', (e) => {\r\n    if (!node.classList.contains('lu-dragging') && (hasDnDType(e, ...mimeTypes) || isEdgeDnD(e))) {\r\n      e.preventDefault();\r\n      updateDropEffect(e);\r\n      node.classList.add('lu-dragover');\r\n\r\n      if (stopPropagation) {\r\n        e.stopPropagation();\r\n      }\r\n      if (onDragOver) {\r\n        onDragOver(e);\r\n      }\r\n      //sound good\r\n      return false;\r\n    }\r\n    return;\r\n  });\r\n  node.addEventListener('dragleave', (evt) => {\r\n    // same fix as in phovea\r\n    (<HTMLElement>evt.target).classList.remove('lu-dragover');\r\n  });\r\n  node.addEventListener('drop', (e) => {\r\n    e.preventDefault();\r\n    if (stopPropagation) {\r\n      e.stopPropagation();\r\n    }\r\n    updateDropEffect(e);\r\n    console.assert(e.dataTransfer != null);\r\n    const dT = e.dataTransfer!;\r\n    const effect = <IDragEffect>dT.dropEffect;\r\n\r\n    node.classList.remove('lu-dragover');\r\n\r\n    if (isEdgeDnD(e)) {\r\n      const base = dT.getData('text/plain');\r\n      const id = parseInt(base.indexOf(':') >= 0 ? base.substring(0, base.indexOf(':')) : base, 10);\r\n      if (dndTransferStorage.has(id)) {\r\n        const data = dndTransferStorage.get(id)!;\r\n        dndTransferStorage.delete(id);\r\n        return !onDrop({effect, data}, e);\r\n      }\r\n      return;\r\n    }\r\n    if (hasDnDType(e, ...mimeTypes)) {\r\n      const data: any = {};\r\n      //selects the data contained in the data transfer\r\n      mimeTypes.forEach((mime) => {\r\n        const value = dT.getData(mime);\r\n        if (value !== '') {\r\n          data[mime] = value;\r\n        }\r\n      });\r\n      return !onDrop({effect, data}, e);\r\n    }\r\n    return;\r\n  });\r\n}\r\n","import Column from '../../model/Column';\r\nimport {createToolbarMenuItems, updateIconState} from '../header';\r\nimport {IRankingHeaderContext} from '../interfaces';\r\nimport ADialog, {IDialogContext} from './ADialog';\r\n\r\n/** @internal */\r\nexport default class MoreColumnOptionsDialog extends ADialog {\r\n\r\n  constructor(private readonly column: Column, dialog: IDialogContext, private readonly ctx: IRankingHeaderContext) {\r\n    super(dialog);\r\n  }\r\n\r\n  protected build(node: HTMLElement) {\r\n    node.classList.add('lu-more-options');\r\n    createToolbarMenuItems(node, this.dialog.level + 1, this.column, this.ctx);\r\n\r\n    updateIconState(node, this.column);\r\n  }\r\n}\r\n","// import Popper from 'popper.js';\r\nimport {MIN_LABEL_WIDTH} from '../config';\r\nimport {equalArrays} from '../internal';\r\nimport {dragAble, dropAble, hasDnDType, IDropResult} from '../internal/dnd';\r\nimport {\r\n  createImpositionBoxPlotDesc, createImpositionDesc, createImpositionsDesc, createNestedDesc, createReduceDesc,\r\n  createStackDesc, IColumnDesc, isArrayColumn, isBoxPlotColumn, isCategoricalColumn, isMapColumn, isNumberColumn,\r\n  isNumbersColumn\r\n} from '../model';\r\nimport {categoryOf} from '../model/annotations';\r\nimport Column from '../model/Column';\r\nimport {default as CompositeColumn, IMultiLevelColumn, isMultiLevelColumn} from '../model/CompositeColumn';\r\nimport ImpositionBoxPlotColumn from '../model/ImpositionBoxPlotColumn';\r\nimport ImpositionCompositeColumn from '../model/ImpositionCompositeColumn';\r\nimport ImpositionCompositesColumn from '../model/ImpositionCompositesColumn';\r\nimport {IRankingHeaderContext} from './interfaces';\r\nimport {IOnClickHandler, getToolbar, dialogContext} from './toolbar';\r\nimport {IToolbarAction} from './toolbar';\r\nimport MoreColumnOptionsDialog from './dialogs/MoreColumnOptionsDialog';\r\n\r\n/** @internal */\r\nexport interface IHeaderOptions {\r\n  dragAble: boolean;\r\n  mergeDropAble: boolean;\r\n  rearrangeAble: boolean;\r\n  resizeable: boolean;\r\n  level: number;\r\n}\r\n\r\n/** @internal */\r\nexport function createHeader(col: Column, ctx: IRankingHeaderContext, options: Partial<IHeaderOptions> = {}) {\r\n  options = Object.assign({\r\n    dragAble: true,\r\n    mergeDropAble: true,\r\n    rearrangeAble: true,\r\n    resizeable: true,\r\n    level: 0\r\n  }, options);\r\n  const node = ctx.document.createElement('section');\r\n  node.innerHTML = `\r\n    <div class=\"lu-label\">${col.getWidth() < MIN_LABEL_WIDTH ? '&nbsp;' : col.label}</div>\r\n    <div class=\"lu-toolbar\"></div>\r\n    <div class=\"lu-spacing\"></div>\r\n    <div class=\"lu-handle lu-feature-advanced lu-feature-ui\"></div>\r\n  `;\r\n\r\n  // addTooltip(node, col);\r\n\r\n  createShortcutMenuItems(<HTMLElement>node.querySelector('div.lu-toolbar')!, options.level!, col, ctx);\r\n\r\n  toggleToolbarIcons(node, col);\r\n\r\n  if (options.dragAble) {\r\n    dragAbleColumn(node, col, ctx);\r\n  }\r\n  if (options.mergeDropAble) {\r\n    mergeDropAble(node, col, ctx);\r\n  }\r\n  if (options.rearrangeAble) {\r\n    rearrangeDropAble(<HTMLElement>node.querySelector('.lu-handle')!, col, ctx);\r\n  }\r\n  if (options.resizeable) {\r\n    dragWidth(col, node);\r\n  }\r\n  return node;\r\n}\r\n\r\n\r\n/** @internal */\r\nexport function updateHeader(node: HTMLElement, col: Column) {\r\n  const label = <HTMLElement>node.querySelector('.lu-label')!;\r\n  label.innerHTML = col.getWidth() < MIN_LABEL_WIDTH ? '&nbsp;' : col.label;\r\n  node.title = col.description ? `${col.label}\\n${col.description}` : col.label;\r\n  node.dataset.colId = col.id;\r\n  node.dataset.type = col.desc.type;\r\n  node.dataset.typeCat = categoryOf(col).name;\r\n\r\n  updateIconState(node, col);\r\n}\r\n\r\n\r\n/** @internal */\r\nexport function updateIconState(node: HTMLElement, col: Column) {\r\n  const sort = <HTMLElement>node.querySelector(`i[title='Sort']`)!;\r\n  if (sort) {\r\n    const {asc, priority} = col.isSortedByMe();\r\n    sort.dataset.sort = asc !== undefined ? asc : '';\r\n    if (priority !== undefined) {\r\n      sort.dataset.priority = (priority + 1).toString();\r\n    } else {\r\n      delete sort.dataset.priority;\r\n    }\r\n  }\r\n\r\n  const sortGroups = <HTMLElement>node.querySelector(`i[title='Sort Group']`)!;\r\n  if (sortGroups) {\r\n    const {asc, priority} = col.isGroupSortedByMe();\r\n    sortGroups.dataset.sort = asc !== undefined ? asc : '';\r\n    if (priority !== undefined) {\r\n      sortGroups.dataset.priority = (priority + 1).toString();\r\n    } else {\r\n      delete sortGroups.dataset.priority;\r\n    }\r\n  }\r\n\r\n  const group = <HTMLElement>node.querySelector(`i[title^='Group']`)!;\r\n  if (group) {\r\n    const groupedBy = col.isGroupedBy();\r\n    group.dataset.group = groupedBy >= 0 ? 'true' : 'false';\r\n    if (groupedBy >= 0) {\r\n      group.dataset.priority = (groupedBy + 1).toString();\r\n    } else {\r\n      delete group.dataset.priority;\r\n    }\r\n  }\r\n\r\n  const filter = <HTMLElement>node.querySelector(`i[title^='Filter']`)!;\r\n  if (!filter) {\r\n    return;\r\n  }\r\n  if (col.isFiltered()) {\r\n    filter.dataset.active = '';\r\n  } else {\r\n    delete filter.dataset.active;\r\n  }\r\n}\r\n\r\nfunction addIconDOM(node: HTMLElement, col: Column, ctx: IRankingHeaderContext, level: number, showLabel: boolean) {\r\n  return (action: IToolbarAction) => {\r\n    node.insertAdjacentHTML('beforeend', `<i data-a=\"${action.options.shortcut === 'only' ? 'o' : action.options.shortcut ? 's' : 'r'}\" title=\"${action.title}\" class=\"lu-action lu-feature-${action.options.featureLevel || 'basic'} lu-feature-${action.options.featureCategory || 'others'}\"><span${!showLabel ? ' aria-hidden=\"true\"' : ''}>${action.title}</span> </i>`);\r\n    const i = <HTMLElement>node.lastElementChild;\r\n    i.onclick = (evt) => {\r\n      evt.stopPropagation();\r\n      ctx.dialogManager.setHighlightColumn(col);\r\n      action.onClick(col, <any>evt, ctx, level, !showLabel);\r\n    };\r\n    return i;\r\n  };\r\n}\r\n\r\nexport interface IAddIcon {\r\n  (title: string, onClick: IOnClickHandler): void;\r\n}\r\n\r\nexport function createShortcutMenuItems(node: HTMLElement, level: number, col: Column, ctx: IRankingHeaderContext, willAutoHide: boolean = true) {\r\n  const addIcon = addIconDOM(node, col, ctx, level, false);\r\n  const toolbar = getToolbar(col, ctx);\r\n  const shortcuts = toolbar.filter((d) => d.options.shortcut);\r\n  const hybrids = shortcuts.reduce((a, b) => a + (b.options.shortcut === true ? 1 : 0), 0);\r\n\r\n  shortcuts.forEach(addIcon);\r\n  const moreEntries = toolbar.length - shortcuts.length + hybrids;\r\n\r\n  if (shortcuts.length === toolbar.length || (moreEntries === hybrids && !willAutoHide)) {\r\n    // all visible or just hybrids that will always be visible\r\n    return;\r\n  }\r\n\r\n  // need a more entry\r\n  node.insertAdjacentHTML('beforeend', `<i data-a=\"m\" data-m=\"${moreEntries}\" title=\"More &hellip;\" class=\"lu-action\"><span aria-hidden=\"true\">More &hellip;</span></i>`);\r\n  const i = <HTMLElement>node.lastElementChild;\r\n  i.onclick = (evt) => {\r\n    evt.stopPropagation();\r\n    ctx.dialogManager.setHighlightColumn(col);\r\n    const dialog = new MoreColumnOptionsDialog(col, dialogContext(ctx, level, <any>evt), ctx);\r\n    dialog.open();\r\n  };\r\n}\r\n\r\nexport function createToolbarMenuItems(node: HTMLElement, level: number, col: Column, ctx: IRankingHeaderContext) {\r\n  const addIcon = addIconDOM(node, col, ctx, level, true);\r\n  getToolbar(col, ctx).filter((d) => d.options.shortcut !== 'only').forEach(addIcon);\r\n}\r\n\r\n/** @internal */\r\nfunction toggleRotatedHeader(node: HTMLElement, col: Column, defaultVisibleClientWidth: number) {\r\n  // rotate header flag if needed\r\n  const label = <HTMLElement>node.querySelector('.lu-label');\r\n  if (col.getWidth() < MIN_LABEL_WIDTH) {\r\n    label.classList.remove('lu-rotated');\r\n    return;\r\n  }\r\n  const width = label.clientWidth;\r\n  const rotated = width <= 0 ? (col.label.length * defaultVisibleClientWidth / 3 * 0.6 > col.getWidth()) : (label.scrollWidth * 0.6 > label.clientWidth);\r\n  label.classList.toggle('lu-rotated', rotated);\r\n}\r\n\r\n/** @internal */\r\nfunction toggleToolbarIcons(node: HTMLElement, col: Column, defaultVisibleClientWidth = 22.5) {\r\n  toggleRotatedHeader(node, col, defaultVisibleClientWidth);\r\n\r\n  const toolbar = <HTMLElement>node.querySelector('.lu-toolbar');\r\n  if (toolbar.childElementCount === 0) {\r\n    return;\r\n  }\r\n  const availableWidth = col.getWidth();\r\n  const actions = Array.from(toolbar.children).map((d) => ({node: <HTMLElement>d, width: d.clientWidth > 0 ? d.clientWidth : defaultVisibleClientWidth}));\r\n\r\n  const shortCuts =  actions.filter((d) => d.node.dataset.a === 'o');\r\n  const hybrids = actions.filter((d) => d.node.dataset.a === 's');\r\n  const moreIcon = actions.find((d) => d.node.dataset.a === 'm');\r\n  const moreEntries = moreIcon ? parseInt(moreIcon.node.dataset.m!, 10) : 0;\r\n  const needMore = moreEntries > hybrids.length;\r\n\r\n  let total = actions.reduce((a, b) => a + b.width, 0);\r\n\r\n  for (const action of actions) {\r\n    // maybe hide not needed \"more\"\r\n    action.node.classList.remove('hidden');\r\n  }\r\n\r\n  // all visible\r\n  if (total < availableWidth) {\r\n    return;\r\n  }\r\n  if (moreIcon && !needMore && (total - moreIcon.width) < availableWidth) {\r\n    // available space is enougth we can skip the \"more\" and then it fits\r\n    moreIcon.node.classList.add('hidden');\r\n    return;\r\n  }\r\n\r\n  for (const action of hybrids.reverse().concat(shortCuts.reverse())) { // back to forth and hybrids earlier than pure shortcuts\r\n    // hide and check if enough\r\n    action.node.classList.add('hidden');\r\n    total -= action.width;\r\n    if (total < availableWidth) {\r\n      return;\r\n    }\r\n  }\r\n}\r\n\r\n\r\n// function addTooltip(node: HTMLElement, col: Column) {\r\n//   let timer = -1;\r\n//   let popper: Popper | null = null;\r\n\r\n//   const showTooltip = () => {\r\n//     timer = -1;\r\n//     // no tooltip if no description\r\n//     if (col.description.length <= 0) {\r\n//       return;\r\n//     }\r\n//     const parent = <HTMLElement>node.closest('.lu')!;\r\n//     parent.insertAdjacentHTML('beforeend', `<div class=\"lu-tooltip\" data-type=\"${col.desc.type}\" data-type-cat=\"${categoryOf(col).name}\">\r\n//         <div x-arrow></div>\r\n//         <strong class=\"lu-label\">${col.label}</strong>\r\n//         <p>${col.description.replace('\\n', `<br/>`)}</p>\r\n//     </div>`);\r\n//     popper = new Popper(node, parent.lastElementChild!, {\r\n//       removeOnDestroy: true,\r\n//       placement: 'auto',\r\n//       modifiers: {\r\n//         flip: {\r\n//           enabled: false\r\n//         },\r\n//         preventOverflow: {\r\n//           enabled: false\r\n//         }\r\n//       }\r\n//     });\r\n//   };\r\n\r\n//   node.addEventListener('mouseenter', () => {\r\n//     if (col.description.length > 0) {\r\n//       timer = self.setTimeout(showTooltip, HOVER_DELAY_SHOW_DETAIL);\r\n//     }\r\n//   });\r\n//   node.addEventListener('mouseleave', () => {\r\n//     if (timer >= 0) {\r\n//       clearTimeout(timer);\r\n//       timer = -1;\r\n//     }\r\n//     if (popper) {\r\n//       popper.destroy();\r\n//       popper = null;\r\n//     }\r\n//   });\r\n// }\r\n\r\n/**\r\n * allow to change the width of a column using dragging the handle\r\n * @internal\r\n */\r\nexport function dragWidth(col: Column, node: HTMLElement) {\r\n  let ueberElement: HTMLElement;\r\n  const handle = <HTMLElement>node.querySelector('.lu-handle');\r\n\r\n\r\n  let start = 0;\r\n  const mouseMove = (evt: MouseEvent) => {\r\n    evt.stopPropagation();\r\n    evt.preventDefault();\r\n    const end = evt.clientX;\r\n    const delta = end - start;\r\n    const width = Math.max(0, col.getWidth() + delta);\r\n\r\n    if (Math.abs(start - end) < 2) {\r\n      //ignore\r\n      return;\r\n    }\r\n    start = end;\r\n    node.style.width = `${width}px`;\r\n    col.setWidth(width);\r\n    toggleToolbarIcons(node, col);\r\n  };\r\n\r\n  const mouseUp = (evt: MouseEvent) => {\r\n    evt.stopPropagation();\r\n    evt.preventDefault();\r\n    const end = evt.clientX;\r\n    node.classList.remove('lu-change-width');\r\n\r\n    ueberElement.removeEventListener('mousemove', mouseMove);\r\n    ueberElement.removeEventListener('mouseup', mouseUp);\r\n    ueberElement.removeEventListener('mouseleave', mouseUp);\r\n    node.style.width = null;\r\n\r\n    if (Math.abs(start - end) < 2) {\r\n      //ignore\r\n      return;\r\n    }\r\n    const delta = end - start;\r\n    const width = Math.max(0, col.getWidth() + delta);\r\n    col.setWidth(width);\r\n    toggleToolbarIcons(node, col);\r\n  };\r\n  handle.onmousedown = (evt) => {\r\n    evt.stopPropagation();\r\n    evt.preventDefault();\r\n    node.classList.add('lu-change-width');\r\n\r\n    start = evt.clientX;\r\n    ueberElement = <HTMLElement>node.closest('header')!;\r\n    ueberElement.addEventListener('mousemove', mouseMove);\r\n    ueberElement.addEventListener('mouseup', mouseUp);\r\n    ueberElement.addEventListener('mouseleave', mouseUp);\r\n  };\r\n  handle.onclick = (evt) => {\r\n    // avoid resorting\r\n    evt.stopPropagation();\r\n    evt.preventDefault();\r\n  };\r\n}\r\n\r\nexport const MIMETYPE_PREFIX = 'text/x-caleydo-lineup-column';\r\n\r\n/**\r\n * allow to drag the column away\r\n * @internal\r\n */\r\nexport function dragAbleColumn(node: HTMLElement, column: Column, ctx: IRankingHeaderContext) {\r\n  dragAble(node, () => {\r\n    const ref = JSON.stringify(ctx.provider.toDescRef(column.desc));\r\n    const data: any = {\r\n      'text/plain': column.label,\r\n      [`${MIMETYPE_PREFIX}-ref`]: column.id,\r\n      [MIMETYPE_PREFIX]: ref\r\n    };\r\n    if (isNumberColumn(column)) {\r\n      data[`${MIMETYPE_PREFIX}-number`] = ref;\r\n      data[`${MIMETYPE_PREFIX}-number-ref`] = column.id;\r\n    }\r\n    if (isCategoricalColumn(column)) {\r\n      data[`${MIMETYPE_PREFIX}-categorical`] = ref;\r\n      data[`${MIMETYPE_PREFIX}-categorical-ref`] = column.id;\r\n    }\r\n    if (isBoxPlotColumn(column)) {\r\n      data[`${MIMETYPE_PREFIX}-boxplot`] = ref;\r\n      data[`${MIMETYPE_PREFIX}-boxplot-ref`] = column.id;\r\n    }\r\n    if (isMapColumn(column)) {\r\n      data[`${MIMETYPE_PREFIX}-map`] = ref;\r\n      data[`${MIMETYPE_PREFIX}-map-ref`] = column.id;\r\n    }\r\n    if (isArrayColumn(column)) {\r\n      data[`${MIMETYPE_PREFIX}-array`] = ref;\r\n      data[`${MIMETYPE_PREFIX}-array-ref`] = column.id;\r\n    }\r\n    if (isNumbersColumn(column)) {\r\n      data[`${MIMETYPE_PREFIX}-numbers`] = ref;\r\n      data[`${MIMETYPE_PREFIX}-numbers-ref`] = column.id;\r\n    }\r\n    return {\r\n      effectAllowed: 'copyMove',\r\n      data\r\n    };\r\n  }, true);\r\n}\r\n\r\n/**\r\n * dropper for allowing to rearrange (move, copy) columns\r\n * @internal\r\n */\r\nexport function rearrangeDropAble(node: HTMLElement, column: Column, ctx: IRankingHeaderContext) {\r\n  dropAble(node, [`${MIMETYPE_PREFIX}-ref`, MIMETYPE_PREFIX], (result) => {\r\n    let col: Column | null = null;\r\n    const data = result.data;\r\n    if (!(`${MIMETYPE_PREFIX}-ref` in data)) {\r\n      const desc = JSON.parse(data[MIMETYPE_PREFIX]);\r\n      col = ctx.provider.create(ctx.provider.fromDescRef(desc));\r\n      return col != null && column.insertAfterMe(col) != null;\r\n    }\r\n\r\n    // find by reference\r\n    const id = data[`${MIMETYPE_PREFIX}-ref`];\r\n    col = ctx.provider.find(id);\r\n    if (!col || (col === column && !result.effect.startsWith('copy'))) {\r\n      return false;\r\n    }\r\n    if (result.effect.startsWith('copy')) {\r\n      col = ctx.provider.clone(col!);\r\n      return col != null && column.insertAfterMe(col) != null;\r\n    }\r\n    // detect whether it is an internal move operation or an real remove/insert operation\r\n    const toInsertParent = col.parent;\r\n    if (!toInsertParent) { // no parent will always be a move\r\n      return column.insertAfterMe(col) != null;\r\n    }\r\n    if (toInsertParent === column.parent) {\r\n      // move operation\r\n      return toInsertParent.moveAfter(col, column) != null;\r\n    }\r\n    col.removeMe();\r\n    return column.insertAfterMe(col) != null;\r\n  }, null, true);\r\n}\r\n\r\n/**\r\n * dropper for allowing to change the order by dropping it at a certain position\r\n * @internal\r\n */\r\nexport function resortDropAble(node: HTMLElement, column: Column, ctx: IRankingHeaderContext, where: 'before' | 'after', autoGroup: boolean) {\r\n  dropAble(node, [`${MIMETYPE_PREFIX}-ref`, MIMETYPE_PREFIX], (result) => {\r\n    let col: Column | null = null;\r\n    const data = result.data;\r\n    if (`${MIMETYPE_PREFIX}-ref` in data) {\r\n      const id = data[`${MIMETYPE_PREFIX}-ref`];\r\n      col = ctx.provider.find(id);\r\n      if (!col || col === column) {\r\n        return false;\r\n      }\r\n    } else {\r\n      const desc = JSON.parse(data[MIMETYPE_PREFIX]);\r\n      col = ctx.provider.create(ctx.provider.fromDescRef(desc));\r\n      if (col) {\r\n        column.findMyRanker()!.push(col);\r\n      }\r\n    }\r\n    const ranking = column.findMyRanker()!;\r\n    if (!col || col === column || !ranking) {\r\n      return false;\r\n    }\r\n\r\n    const criteria = ranking.getSortCriteria();\r\n    const groups = ranking.getGroupCriteria();\r\n\r\n    const removeFromSort = (col: Column) => {\r\n      const existing = criteria.findIndex((d) => d.col === col);\r\n      if (existing >= 0) { // remove existing column but keep asc state\r\n        return criteria.splice(existing, 1)[0].asc;\r\n      }\r\n      return false;\r\n    };\r\n\r\n    // remove the one to add\r\n    const asc = removeFromSort(col);\r\n\r\n    const groupIndex = groups.indexOf(column);\r\n    const index = criteria.findIndex((d) => d.col === column);\r\n\r\n    if (autoGroup && groupIndex >= 0) {\r\n      // before the grouping, so either ungroup or regroup\r\n      removeFromSort(column);\r\n      if (isCategoricalColumn(col)) { // we can group by it\r\n        groups.splice(groupIndex + (where === 'after' ? 1 : 0), 0, col);\r\n        if (groups.length > ranking.getMaxGroupColumns()) {\r\n          // move the rest to sorting\r\n          const removed = groups.splice(0, groups.length - ranking.getMaxGroupColumns());\r\n          criteria.unshift(...removed.reverse().map((d) => ({asc: false, col: d}))); // now a first sorting criteria\r\n        }\r\n      } else {\r\n        // remove all before and shift to sorting + sorting\r\n        const removed = groups.splice(0, groups.length - groupIndex);\r\n        criteria.unshift(...removed.reverse().map((d) => ({asc: false, col: d}))); // now a first sorting criteria\r\n        criteria.unshift({asc, col});\r\n      }\r\n    } else if (index < 0) {\r\n      criteria.push({asc, col});\r\n    } else if (index === 0 && autoGroup && isCategoricalColumn(col)) {\r\n      // make group criteria\r\n      groups.push(col);\r\n    } else {\r\n      criteria.splice(index + (where === 'after' ? 1 : 0), 0, {asc, col});\r\n    }\r\n\r\n    if (!equalArrays(groups, ranking.getGroupCriteria())) {\r\n      ranking.setGroupCriteria(groups);\r\n    }\r\n    ranking.setSortCriteria(criteria);\r\n    return true;\r\n  }, null, true);\r\n}\r\n\r\n/**\r\n * dropper for merging columns\r\n * @internal\r\n */\r\nexport function mergeDropAble(node: HTMLElement, column: Column, ctx: IRankingHeaderContext) {\r\n  const resolveDrop = (result: IDropResult) => {\r\n    const data = result.data;\r\n    const copy = result.effect === 'copy';\r\n    const prefix = MIMETYPE_PREFIX;\r\n    const key = Object.keys(data).find((d) => d.startsWith(prefix) && d.endsWith('-ref'));\r\n    if (key) {\r\n      const id = data[key];\r\n      let col: Column = ctx.provider.find(id)!;\r\n      if (copy) {\r\n        col = ctx.provider.clone(col);\r\n      } else if (col === column) {\r\n        return null;\r\n      } else {\r\n        col.removeMe();\r\n      }\r\n      return col;\r\n    }\r\n    const alternative = Object.keys(data).find((d) => d.startsWith(prefix));\r\n    if (!alternative) {\r\n      return null;\r\n    }\r\n    const desc = JSON.parse(alternative);\r\n    return ctx.provider.create(ctx.provider.fromDescRef(desc))!;\r\n  };\r\n\r\n  const pushChild = (result: IDropResult) => {\r\n    const col: Column | null = resolveDrop(result);\r\n    return col != null && (<CompositeColumn>column).push(col) != null;\r\n  };\r\n\r\n  const mergeImpl = (col: Column | null, desc: IColumnDesc) => {\r\n    if (col == null) {\r\n      return false;\r\n    }\r\n    const ranking = column.findMyRanker()!;\r\n    const index = ranking.indexOf(column);\r\n    const parent = <CompositeColumn>ctx.provider.create(desc);\r\n    column.removeMe();\r\n    parent.push(column);\r\n    parent.push(col);\r\n    return ranking.insert(parent, index) != null;\r\n  };\r\n\r\n  const mergeWith = (desc: IColumnDesc) => (result: IDropResult) => {\r\n    const col: Column | null = resolveDrop(result);\r\n    return mergeImpl(col, desc);\r\n  };\r\n\r\n  const all = [`${MIMETYPE_PREFIX}-ref`, MIMETYPE_PREFIX];\r\n  const numberish = [`${MIMETYPE_PREFIX}-number-ref`, `${MIMETYPE_PREFIX}-number`];\r\n  const categorical = [`${MIMETYPE_PREFIX}-categorical-ref`, `${MIMETYPE_PREFIX}-categorical`];\r\n  const boxplot = [`${MIMETYPE_PREFIX}-boxplot-ref`, `${MIMETYPE_PREFIX}-boxplot`];\r\n  const numbers = [`${MIMETYPE_PREFIX}-numbers-ref`, `${MIMETYPE_PREFIX}-numbers`];\r\n\r\n  node.dataset.draginfo = '+';\r\n  if (column instanceof ImpositionCompositeColumn) {\r\n    return dropAble(node, categorical.concat(numberish), pushChild, (e) => {\r\n      if (hasDnDType(e, ...categorical)) {\r\n        node.dataset.draginfo = 'Color by';\r\n        return;\r\n      }\r\n      if (hasDnDType(e, ...numberish)) {\r\n        node.dataset.draginfo = 'Wrap';\r\n      }\r\n    });\r\n  }\r\n  if (column instanceof ImpositionBoxPlotColumn) {\r\n    return dropAble(node, categorical.concat(boxplot), pushChild, (e) => {\r\n      if (hasDnDType(e, ...categorical)) {\r\n        node.dataset.draginfo = 'Color by';\r\n        return;\r\n      }\r\n      if (hasDnDType(e, ...boxplot)) {\r\n        node.dataset.draginfo = 'Wrap';\r\n      }\r\n    });\r\n  }\r\n  if (column instanceof ImpositionCompositesColumn) {\r\n    return dropAble(node, categorical.concat(numbers), pushChild, (e) => {\r\n      if (hasDnDType(e, ...categorical)) {\r\n        node.dataset.draginfo = 'Color by';\r\n        return;\r\n      }\r\n      if (hasDnDType(e, ...numbers)) {\r\n        node.dataset.draginfo = 'Wrap';\r\n      }\r\n    });\r\n  }\r\n  if (isMultiLevelColumn(column)) {\r\n    // stack column or nested\r\n    return dropAble(node, (<IMultiLevelColumn>column).canJustAddNumbers ? numberish : all, pushChild);\r\n  }\r\n  if (column instanceof CompositeColumn) {\r\n    return dropAble(node, (<CompositeColumn>column).canJustAddNumbers ? numberish : all, pushChild);\r\n  }\r\n  if (isNumbersColumn(column)) {\r\n    node.dataset.draginfo = 'Color by';\r\n    return dropAble(node, categorical, mergeWith(createImpositionsDesc()));\r\n  }\r\n  if (isBoxPlotColumn(column)) {\r\n    node.dataset.draginfo = 'Color by';\r\n    return dropAble(node, categorical, mergeWith(createImpositionBoxPlotDesc()));\r\n  }\r\n  if (isNumberColumn(column)) {\r\n    node.dataset.draginfo = 'Merge';\r\n    return dropAble(node, categorical.concat(numberish), (result: IDropResult, evt: DragEvent) => {\r\n      const col: Column | null = resolveDrop(result);\r\n      if (col == null) {\r\n        return false;\r\n      }\r\n      if (isCategoricalColumn(col)) {\r\n        return mergeImpl(col, createImpositionDesc());\r\n      }\r\n      if (isNumberColumn(col)) {\r\n        return mergeImpl(col, evt.shiftKey ? createReduceDesc() : createStackDesc());\r\n      }\r\n      return false;\r\n    }, (e) => {\r\n      if (hasDnDType(e, ...categorical)) {\r\n        node.dataset.draginfo = 'Color by';\r\n        return;\r\n      }\r\n      if (hasDnDType(e, ...numberish)) {\r\n        node.dataset.draginfo = e.shiftKey ? 'Min/Max' : 'Sum';\r\n      }\r\n    });\r\n  }\r\n  node.dataset.draginfo = 'Group';\r\n  return dropAble(node, all, mergeWith(createNestedDesc()));\r\n}\r\n","import {Category, toolbar} from './annotations';\r\nimport CategoricalColumn from './CategoricalColumn';\r\nimport Column, {widthChanged, labelChanged, metaDataChanged, dirty, dirtyHeader, dirtyValues, rendererTypeChanged, groupRendererChanged, summaryRendererChanged, visibilityChanged} from './Column';\r\nimport {ICategoricalColumn, ICategory} from './ICategoricalColumn';\r\nimport {IDataRow, IGroup} from './interfaces';\r\nimport {colorPool} from './internal';\r\nimport {missingGroup} from './missing';\r\nimport ValueColumn, {IValueColumnDesc, dataLoaded} from './ValueColumn';\r\nimport {IEventListener} from '../internal/AEventDispatcher';\r\n\r\nexport interface ICategoryNode extends ICategory {\r\n  children: Readonly<ICategoryNode>[];\r\n}\r\n\r\nexport interface IPartialCategoryNode extends Partial<ICategory> {\r\n  children: IPartialCategoryNode[];\r\n}\r\n\r\nexport interface IHierarchyDesc {\r\n  hierarchy: IPartialCategoryNode;\r\n  hierarchySeparator?: string;\r\n}\r\n\r\nexport declare type IHierarchyColumnDesc = IHierarchyDesc & IValueColumnDesc<string>;\r\n\r\nexport interface ICategoryInternalNode extends ICategory {\r\n  path: string;\r\n  children: Readonly<ICategoryInternalNode>[];\r\n}\r\n\r\nexport interface ICutOffNode {\r\n  node: Readonly<ICategoryInternalNode>;\r\n  maxDepth: number;\r\n}\r\n\r\n/**\r\n * emitted when the cut off property changes\r\n * @asMemberOf HierarchyColumn\r\n * @event\r\n */\r\nexport declare function cutOffChanged(previous: ICutOffNode, current: ICutOffNode): void;\r\n\r\n/**\r\n * column for hierarchical categorical values\r\n */\r\n@toolbar('cutoff', 'group', 'groupBy')\r\n@Category('categorical')\r\nexport default class HierarchyColumn extends ValueColumn<string> implements ICategoricalColumn {\r\n  static readonly EVENT_CUTOFF_CHANGED = 'cutOffChanged';\r\n\r\n  private readonly hierarchySeparator: string;\r\n  readonly hierarchy: Readonly<ICategoryInternalNode>;\r\n\r\n  private currentNode: Readonly<ICategoryInternalNode>;\r\n  private currentMaxDepth: number = Infinity;\r\n  private currentLeaves: Readonly<ICategoryInternalNode>[] = [];\r\n  private readonly currentLeavesNameCache = new Map<string, Readonly<ICategoryInternalNode>>();\r\n  private readonly currentLeavesPathCache = new Map<string, Readonly<ICategoryInternalNode>>();\r\n\r\n  constructor(id: string, desc: Readonly<IHierarchyColumnDesc>) {\r\n    super(id, desc);\r\n    this.hierarchySeparator = desc.hierarchySeparator || '.';\r\n    this.hierarchy = this.initHierarchy(desc.hierarchy);\r\n    this.currentNode = this.hierarchy;\r\n    this.currentLeaves = computeLeaves(this.currentNode, this.currentMaxDepth);\r\n    this.updateCaches();\r\n\r\n    this.setDefaultRenderer('categorical');\r\n  }\r\n\r\n  private initHierarchy(root: IPartialCategoryNode) {\r\n    const colors = colorPool();\r\n    const s = this.hierarchySeparator;\r\n    const add = (prefix: string, node: IPartialCategoryNode): ICategoryInternalNode => {\r\n      const name = node.name == null ? String(node.value) : node.name;\r\n      const children = (node.children || []).map((child: IPartialCategoryNode | string): ICategoryInternalNode => {\r\n        if (typeof child === 'string') {\r\n          const path = prefix + child;\r\n          return {\r\n            path,\r\n            name: child,\r\n            label: path,\r\n            color: colors(),\r\n            value: 0,\r\n            children: []\r\n          };\r\n        }\r\n        const r = add(`${prefix}${name}${s}`, child);\r\n        if (!r.color) {\r\n          //hack to inject the next color\r\n          (<any>r).color = colors();\r\n        }\r\n        return r;\r\n      });\r\n      const path = prefix + name;\r\n      const label = node.label ? `${node.label}` : path;\r\n      return {path, name, children, label, color: node.color!, value: 0};\r\n    };\r\n    return add('', root);\r\n  }\r\n\r\n  get categories() {\r\n    return this.currentLeaves;\r\n  }\r\n\r\n  protected createEventList() {\r\n    return super.createEventList().concat([HierarchyColumn.EVENT_CUTOFF_CHANGED]);\r\n  }\r\n\r\n  on(type: typeof HierarchyColumn.EVENT_CUTOFF_CHANGED, listener: typeof cutOffChanged | null): this;\r\n  on(type: typeof ValueColumn.EVENT_DATA_LOADED, listener: typeof dataLoaded | null): this;\r\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\r\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\r\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\r\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\r\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\r\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\r\n  on(type: string | string[], listener: IEventListener | null): this {\r\n    return super.on(<any>type, listener);\r\n  }\r\n\r\n  getCutOff(): ICutOffNode {\r\n    return {\r\n      node: this.currentNode,\r\n      maxDepth: this.currentMaxDepth\r\n    };\r\n  }\r\n\r\n  setCutOff(value: ICutOffNode) {\r\n    const maxDepth = value.maxDepth == null ? Infinity : value.maxDepth;\r\n    if (this.currentNode === value.node && this.currentMaxDepth === maxDepth) {\r\n      return;\r\n    }\r\n    const bak = this.getCutOff();\r\n    this.currentNode = value.node;\r\n    this.currentMaxDepth = maxDepth;\r\n    this.currentLeaves = computeLeaves(value.node, maxDepth);\r\n    this.updateCaches();\r\n    this.fire([HierarchyColumn.EVENT_CUTOFF_CHANGED, Column.EVENT_DIRTY_HEADER, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY], bak, this.getCutOff());\r\n  }\r\n\r\n  getCategory(row: IDataRow) {\r\n    let v = super.getValue(row);\r\n    if (v == null || v === '') {\r\n      return null;\r\n    }\r\n    v = v.trim();\r\n    if (this.currentLeavesNameCache.has(v)) {\r\n      return this.currentLeavesNameCache.get(v)!;\r\n    }\r\n    if (this.currentLeavesPathCache.has(v)) {\r\n      return this.currentLeavesPathCache.get(v)!;\r\n    }\r\n    return this.currentLeaves.find((n) => {\r\n      //direct hit or is a child of it\r\n      return n.path === v || n.name === v || v!.startsWith(n.path + this.hierarchySeparator);\r\n    }) || null;\r\n  }\r\n\r\n  get dataLength() {\r\n    return this.currentLeaves.length;\r\n  }\r\n\r\n  get labels() {\r\n    return this.currentLeaves.map((d) => d.label);\r\n  }\r\n\r\n  getValue(row: IDataRow) {\r\n    const v = this.getCategory(row);\r\n    return v ? v.name : null;\r\n  }\r\n\r\n  getLabel(row: IDataRow) {\r\n    return CategoricalColumn.prototype.getLabel.call(this, row);\r\n  }\r\n\r\n  getColor(row: IDataRow) {\r\n    return CategoricalColumn.prototype.getColor.call(this, row);\r\n  }\r\n\r\n  getLabels(row: IDataRow) {\r\n    return CategoricalColumn.prototype.getLabels.call(this, row);\r\n  }\r\n\r\n  getValues(row: IDataRow) {\r\n    return CategoricalColumn.prototype.getValues.call(this, row);\r\n  }\r\n\r\n  getMap(row: IDataRow) {\r\n    return CategoricalColumn.prototype.getMap.call(this, row);\r\n  }\r\n\r\n  getMapLabel(row: IDataRow) {\r\n    return CategoricalColumn.prototype.getMapLabel.call(this, row);\r\n  }\r\n\r\n  getSet(row: IDataRow) {\r\n    return CategoricalColumn.prototype.getSet.call(this, row);\r\n  }\r\n\r\n  compare(a: IDataRow, b: IDataRow) {\r\n    return CategoricalColumn.prototype.compare.call(this, a, b);\r\n  }\r\n\r\n  group(row: IDataRow): IGroup {\r\n    if (this.isMissing(row)) {\r\n      return missingGroup;\r\n    }\r\n    const base = this.getCategory(row);\r\n    if (!base) {\r\n      return super.group(row);\r\n    }\r\n    return {name: base.label, color: base.color};\r\n  }\r\n\r\n  private updateCaches() {\r\n    this.currentLeavesPathCache.clear();\r\n    this.currentLeavesNameCache.clear();\r\n\r\n    this.currentLeaves.forEach((n) => {\r\n      this.currentLeavesPathCache.set(n.path, n);\r\n      this.currentLeavesNameCache.set(n.name, n);\r\n    });\r\n  }\r\n}\r\n\r\nfunction computeLeaves(node: ICategoryInternalNode, maxDepth: number = Infinity) {\r\n  const leaves: ICategoryInternalNode[] = [];\r\n  //depth first\r\n  const visit = (node: ICategoryInternalNode, depth: number) => {\r\n    //hit or end\r\n    if (depth >= maxDepth || node.children.length === 0) {\r\n      leaves.push(node);\r\n    } else {\r\n      // go down\r\n      node.children.forEach((c) => visit(c, depth + 1));\r\n    }\r\n  };\r\n  visit(node, 0);\r\n  return leaves;\r\n}\r\n\r\nexport function resolveInnerNodes(node: ICategoryInternalNode) {\r\n  //breath first\r\n  const queue: ICategoryInternalNode[] = [node];\r\n  let index = 0;\r\n  while (index < queue.length) {\r\n    const next = queue[index++];\r\n    queue.push(...next.children);\r\n  }\r\n  return queue;\r\n}\r\n\r\nexport function isHierarchical(categories: (string | Partial<ICategory>)[]) {\r\n  if (categories.length === 0 || typeof categories[0] === 'string') {\r\n    return false;\r\n  }\r\n  // check if any has a given parent name\r\n  return categories.some((c) => (<any>c).parent != null);\r\n}\r\n\r\nexport function deriveHierarchy(categories: (Partial<ICategory> & { parent: string | null })[]) {\r\n  const lookup = new Map<string, ICategoryNode>();\r\n  categories.forEach((c) => {\r\n    const p = c.parent || '';\r\n    // set and fill up proxy\r\n    const item = Object.assign(<ICategoryNode>{\r\n      children: [],\r\n      label: c.name!,\r\n      name: c.name!,\r\n      color: Column.DEFAULT_COLOR,\r\n      value: 0\r\n    }, lookup.get(c.name!) || {}, c);\r\n    lookup.set(c.name!, item);\r\n\r\n    if (!lookup.has(p)) {\r\n      // create proxy\r\n      lookup.set(p, {name: p, children: [], label: p, value: 0, color: Column.DEFAULT_COLOR});\r\n    }\r\n    lookup.get(p)!.children.push(item);\r\n  });\r\n  const root = lookup.get('')!;\r\n  console.assert(root !== undefined, 'hierarchy with no root');\r\n  if (root.children.length === 1) {\r\n    return root.children[0];\r\n  }\r\n  return root;\r\n}\r\n","import {Category} from './annotations';\r\nimport {IKeyValue, IMapColumn} from './IArrayColumn';\r\nimport {IDataRow} from './interfaces';\r\nimport ValueColumn, {IValueColumnDesc} from './ValueColumn';\r\n\r\nexport interface IMapColumnDesc<T> extends IValueColumnDesc<IKeyValue<T>[]> {\r\n  // dummy\r\n}\r\n\r\n@Category('map')\r\nexport default class MapColumn<T> extends ValueColumn<IKeyValue<T>[]> implements IMapColumn<T> {\r\n\r\n  constructor(id: string, desc: Readonly<IMapColumnDesc<T>>) {\r\n    super(id, desc);\r\n    this.setDefaultWidth(200); //by default 200\r\n  }\r\n\r\n  getValue(row: IDataRow) {\r\n    return toKeyValue<T>(<any>super.getValue(row));\r\n  }\r\n\r\n  getLabels(row: IDataRow): IKeyValue<string>[] {\r\n    const v = this.getValue(row);\r\n    return v.map(({key, value}) => ({key, value: String(value)}));\r\n  }\r\n\r\n  getMap(row: IDataRow) {\r\n    return this.getValue(row);\r\n  }\r\n\r\n  getMapLabel(row: IDataRow) {\r\n    return this.getLabels(row);\r\n  }\r\n\r\n  getLabel(row: IDataRow) {\r\n    const v = this.getLabels(row);\r\n    return `{${v.map(({key, value}) => `${key}: ${value}`).join(', ')}}`;\r\n  }\r\n}\r\n\r\nfunction byKey(a: IKeyValue<any>, b: IKeyValue<any>) {\r\n  if (a === b) {\r\n    return 0;\r\n  }\r\n  return a.key.localeCompare(b.key);\r\n}\r\n\r\nfunction toKeyValue<T>(v?: Map<string, T> | { [key: string]: T } | IKeyValue<T>[]): IKeyValue<T>[] {\r\n  if (!v) {\r\n    return [];\r\n  }\r\n  if (v instanceof Map) {\r\n    return Array.from(v.entries()).map(([key, value]) => ({key, value})).sort(byKey);\r\n  }\r\n  if (Array.isArray(v)) {\r\n    return v; // keep original order\r\n  }\r\n  // object\r\n  return Object.keys(v).map((key) => ({key, value: v[key]})).sort(byKey);\r\n}\r\n","import {timeFormat, timeParse} from 'd3-time-format';\r\nimport {median, min, max} from 'd3-array';\r\nimport {dialogAddons, toolbar} from './annotations';\r\nimport ArrayColumn, {IArrayColumnDesc, spliceChanged} from './ArrayColumn';\r\nimport Column, {widthChanged, labelChanged, metaDataChanged, dirty, dirtyHeader, dirtyValues, rendererTypeChanged, groupRendererChanged, summaryRendererChanged, visibilityChanged} from './Column';\r\nimport ValueColumn, {dataLoaded} from './ValueColumn';\r\nimport {IDateDesc, IDateColumn, IDateFilter, noDateFilter, restoreDateFilter, isDummyDateFilter} from './IDateColumn';\r\nimport {IDataRow} from './interfaces';\r\nimport {FIRST_IS_MISSING, isMissingValue} from './missing';\r\nimport {IEventListener} from '../internal/AEventDispatcher';\r\nimport DateColumn from './DateColumn';\r\n\r\nexport enum EDateSort {\r\n  min = 'min',\r\n  max = 'max',\r\n  median = 'median'\r\n}\r\n\r\nexport interface IDatesDesc extends IDateDesc {\r\n  sort?: EDateSort;\r\n}\r\n\r\nexport declare type IDatesColumnDesc = IDatesDesc & IArrayColumnDesc<Date>;\r\n\r\n/**\r\n * emitted when the sort method property changes\r\n * @asMemberOf DatesColumn\r\n * @event\r\n */\r\nexport declare function sortMethodChanged(previous: EDateSort, current: EDateSort): void;\r\n\r\n/**\r\n * emitted when the filter property changes\r\n * @asMemberOf DatesColumn\r\n * @event\r\n */\r\nexport declare function filterChanged(previous: IDateFilter | null, current: IDateFilter | null): void;\r\n\r\n@toolbar('filterDate')\r\n@dialogAddons('sort', 'sortDates')\r\nexport default class DatesColumn extends ArrayColumn<Date | null> implements IDateColumn {\r\n  static readonly EVENT_SORTMETHOD_CHANGED = 'sortMethodChanged';\r\n  static readonly EVENT_FILTER_CHANGED = DateColumn.EVENT_FILTER_CHANGED;\r\n\r\n  private readonly format: (date: Date) => string;\r\n  private readonly parse: (date: string) => Date | null;\r\n  private sort: EDateSort;\r\n  private currentFilter: IDateFilter = noDateFilter();\r\n\r\n  constructor(id: string, desc: Readonly<IDatesColumnDesc>) {\r\n    super(id, desc);\r\n    this.format = timeFormat(desc.dateFormat || '%x');\r\n    this.parse = desc.dateParse ? timeParse(desc.dateParse) : timeParse(desc.dateFormat || '%x');\r\n    this.sort = desc.sort || EDateSort.median;\r\n    this.setDefaultRenderer('default');\r\n  }\r\n\r\n  protected createEventList() {\r\n    return super.createEventList().concat([DatesColumn.EVENT_SORTMETHOD_CHANGED, DatesColumn.EVENT_FILTER_CHANGED]);\r\n  }\r\n\r\n  on(type: typeof DatesColumn.EVENT_SORTMETHOD_CHANGED, listener: typeof sortMethodChanged | null): this;\r\n  on(type: typeof DatesColumn.EVENT_FILTER_CHANGED, listener: typeof filterChanged | null): this;\r\n  on(type: typeof ArrayColumn.EVENT_SPLICE_CHANGED, listener: typeof spliceChanged | null): this;\r\n  on(type: typeof ValueColumn.EVENT_DATA_LOADED, listener: typeof dataLoaded | null): this;\r\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\r\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\r\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\r\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\r\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\r\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\r\n  on(type: string | string[], listener: IEventListener | null): this {\r\n    return super.on(<any>type, listener);\r\n  }\r\n\r\n  getValue(row: IDataRow): (Date | null)[] {\r\n    return this.getDates(row);\r\n  }\r\n\r\n  getLabels(row: IDataRow) {\r\n    return this.getValue(row).map((v) => (v instanceof Date) ? this.format(v) : '');\r\n  }\r\n\r\n  getDates(row: IDataRow): (Date | null)[] {\r\n    return super.getValue(row).map((v) => {\r\n      if (isMissingValue(v)) {\r\n        return null;\r\n      }\r\n      if (v instanceof Date) {\r\n        return v;\r\n      }\r\n      return this.parse(String(v));\r\n    });\r\n  }\r\n\r\n  getDate(row: IDataRow) {\r\n    const av = <Date[]>this.getDates(row).filter(Boolean);\r\n    if (av.length === 0) {\r\n      return null;\r\n    }\r\n    return new Date(compute(av, this.sort));\r\n  }\r\n\r\n  getSortMethod() {\r\n    return this.sort;\r\n  }\r\n\r\n  setSortMethod(sort: EDateSort) {\r\n    if (this.sort === sort) {\r\n      return;\r\n    }\r\n    this.fire([DatesColumn.EVENT_SORTMETHOD_CHANGED], this.sort, this.sort = sort);\r\n    // sort by me if not already sorted by me\r\n    if (!this.isSortedByMe().asc) {\r\n      this.sortByMe();\r\n    }\r\n  }\r\n\r\n  dump(toDescRef: (desc: any) => any): any {\r\n    const r = super.dump(toDescRef);\r\n    r.sortMethod = this.getSortMethod();\r\n    r.filter = !isDummyDateFilter(this.currentFilter) ? this.currentFilter : null;\r\n    return r;\r\n  }\r\n\r\n  restore(dump: any, factory: (dump: any) => Column | null) {\r\n    super.restore(dump, factory);\r\n    if (dump.sortMethod) {\r\n      this.sort = dump.sortMethod;\r\n    }\r\n    if (dump.filter) {\r\n      this.currentFilter = restoreDateFilter(dump.filter);\r\n    }\r\n  }\r\n\r\n  compare(a: IDataRow, b: IDataRow) {\r\n    const av = <Date[]>this.getValue(a).filter(Boolean);\r\n    const bv = <Date[]>this.getValue(b).filter(Boolean);\r\n    if (av === bv) {\r\n      return 0;\r\n    }\r\n    if (av.length === 0) {\r\n      return bv.length === 0 ? 0 : FIRST_IS_MISSING;\r\n    }\r\n    if (bv.length === 0) {\r\n      return -FIRST_IS_MISSING;\r\n    }\r\n    const as = compute(av, this.sort);\r\n    const bs = compute(bv, this.sort);\r\n    return as - bs;\r\n  }\r\n\r\n  isFiltered() {\r\n    return DateColumn.prototype.isFiltered.call(this);\r\n  }\r\n\r\n  getFilter(): IDateFilter {\r\n    return DateColumn.prototype.getFilter.call(this);\r\n  }\r\n\r\n  setFilter(value: IDateFilter = {min: -Infinity, max: +Infinity, filterMissing: false}) {\r\n    DateColumn.prototype.setFilter.call(this, value);\r\n  }\r\n\r\n  filter(row: IDataRow) {\r\n    return DateColumn.prototype.filter.call(this, row);\r\n  }\r\n}\r\n\r\nfunction compute(arr: Date[], sort: EDateSort) {\r\n  switch (sort) {\r\n    case EDateSort.min:\r\n      return min(arr, (d) => d.getTime())!;\r\n    case EDateSort.max:\r\n      return max(arr, (d) => d.getTime())!;\r\n    case EDateSort.median:\r\n      return median(arr, (d) => d.getTime())!;\r\n  }\r\n}\r\n","import AEventDispatcher, {IEventListener} from '../../internal/AEventDispatcher';\r\n\r\nexport interface IItem {\r\n  id: string;\r\n  text: string;\r\n}\r\n\r\nexport interface IGroupSearchItem<T extends IItem> {\r\n  text: string;\r\n  children: (T | IGroupSearchItem<T>)[];\r\n}\r\n\r\nfunction isItem<T extends IItem>(v: T | IGroupSearchItem<T>): v is T {\r\n  return (<T>v).id !== undefined;\r\n}\r\n\r\nexport interface ISearchBoxOptions<T extends IItem> {\r\n  doc: Document;\r\n\r\n  formatItem(item: T | IGroupSearchItem<T>, node: HTMLElement): string;\r\n\r\n  placeholder: string;\r\n}\r\n\r\n/**\r\n * @asMemberOf SearchBox\r\n * @event\r\n */\r\nexport declare function select(item: any): void;\r\n\r\n\r\nexport default class SearchBox<T extends IItem> extends AEventDispatcher {\r\n  static readonly EVENT_SELECT = 'select';\r\n\r\n  private readonly options: Readonly<ISearchBoxOptions<T>> = {\r\n    formatItem: (item) => item.text,\r\n    doc: document,\r\n    placeholder: 'Select...',\r\n  };\r\n\r\n  readonly node: HTMLElement;\r\n  private search: HTMLInputElement;\r\n  private body: HTMLElement;\r\n\r\n  private values: (T | IGroupSearchItem<T>)[] = [];\r\n\r\n  constructor(options: Partial<ISearchBoxOptions<T>> = {}) {\r\n    super();\r\n    Object.assign(this.options, options);\r\n\r\n    this.node = this.options.doc.createElement('div');\r\n    this.node.classList.add('lu-search');\r\n    this.node.innerHTML = `<input type=\"search\" placeholder=\"${this.options.placeholder}\"><ul></ul>`;\r\n\r\n    this.search = this.node.querySelector('input')!;\r\n    this.body = this.node.querySelector('ul')!;\r\n\r\n    this.search.onfocus = () => this.focus();\r\n    this.search.onblur = () => this.blur();\r\n    this.search.oninput = () => this.filter();\r\n    this.search.onkeydown = (evt) => this.handleKey(evt);\r\n  }\r\n\r\n  get data() {\r\n    return this.values;\r\n  }\r\n\r\n  set data(data: (T | IGroupSearchItem<T>)[]) {\r\n    this.values = data;\r\n    this.body.innerHTML = '';\r\n    this.buildDialog(this.body, this.values);\r\n  }\r\n\r\n  private buildDialog(node: HTMLElement, values: (T | IGroupSearchItem<T>)[]) {\r\n    values.forEach((v) => {\r\n      if (isItem(v)) {\r\n        node.insertAdjacentHTML('beforeend', `<li class=\"lu-search-item\"><span></span></li>`);\r\n        const span = (<HTMLElement>node.lastElementChild!);\r\n        span.onmousedown = (evt) => {\r\n          // see https://stackoverflow.com/questions/10652852/jquery-fire-click-before-blur-event#10653160\r\n          evt.preventDefault();\r\n        };\r\n        span.onclick = () => this.select(v);\r\n        span.onmouseenter = () => this.highlighted = span;\r\n        span.onmouseleave = () => this.highlighted = null;\r\n      } else {\r\n        node.insertAdjacentHTML('beforeend', `<li class=\"lu-search-group\"><span></span><ul></ul></li>`);\r\n        const ul = <HTMLElement>node.lastElementChild!.lastElementChild!;\r\n        this.buildDialog(ul, v.children);\r\n      }\r\n      const item = <HTMLElement>node.lastElementChild!.firstElementChild!;\r\n      item.innerHTML = this.options.formatItem(v, item);\r\n    });\r\n  }\r\n\r\n  private handleKey(evt: KeyboardEvent) {\r\n    const KEYS = {\r\n      ESC: 27,\r\n      ENTER: 13,\r\n      UP: 38,\r\n      DOWN: 40\r\n    };\r\n    switch (evt.which) {\r\n      case KEYS.ESC:\r\n        this.search.blur();\r\n        break;\r\n      case KEYS.ENTER:\r\n        const h = this.highlighted;\r\n        if (h) {\r\n          h.click();\r\n        }\r\n        break;\r\n      case KEYS.UP:\r\n        this.highlightPrevious();\r\n        break;\r\n      case KEYS.DOWN:\r\n        this.highlightNext();\r\n        break;\r\n    }\r\n  }\r\n\r\n  private select(item: T) {\r\n    this.search.value = ''; // reset\r\n    this.search.blur();\r\n    this.fire(SearchBox.EVENT_SELECT, item);\r\n  }\r\n\r\n  focus() {\r\n    this.body.style.width = `${this.search.offsetWidth}px`;\r\n    this.highlighted = <HTMLElement>this.body.firstElementChild || null;\r\n    this.node.classList.add('lu-search-open');\r\n  }\r\n\r\n  private get highlighted() {\r\n    return <HTMLElement>this.body.querySelector('.lu-search-highlighted') || null;\r\n  }\r\n\r\n  private set highlighted(value: HTMLElement | null) {\r\n    const old = this.highlighted;\r\n    if (old === value) {\r\n      return;\r\n    }\r\n    if (old) {\r\n      old.classList.remove('lu-search-highlighted');\r\n    }\r\n    if (value) {\r\n      value.classList.add('lu-search-highlighted');\r\n    }\r\n  }\r\n\r\n  private highlightNext() {\r\n    const h = this.highlighted;\r\n    if (!h || h.classList.contains('hidden')) {\r\n      this.highlighted = <HTMLElement>this.body.querySelector('.lu-search-item:not(.hidden)') || null;\r\n      return;\r\n    }\r\n\r\n    const items = <HTMLElement[]>Array.from(this.body.querySelectorAll('.lu-search-item:not(.hidden)'));\r\n    const index = items.indexOf(h);\r\n    this.highlighted = items[index + 1] || null;\r\n  }\r\n\r\n  private highlightPrevious() {\r\n    const h = this.highlighted;\r\n    const items = <HTMLElement[]>Array.from(this.body.querySelectorAll('.lu-search-item:not(.hidden)'));\r\n\r\n    if (!h || h.classList.contains('hidden')) {\r\n      this.highlighted = items[items.length - 1] || null;\r\n      return;\r\n    }\r\n    const index = items.indexOf(h);\r\n    this.highlighted = items[index - 1] || null;\r\n  }\r\n\r\n  private blur() {\r\n    this.search.value = '';\r\n    // clear filter\r\n    this.filterResults(this.body, '');\r\n    this.node.classList.remove('lu-search-open');\r\n  }\r\n\r\n  private filter() {\r\n    const empty = this.filterResults(this.body, this.search.value.toLowerCase());\r\n    this.body.classList.toggle('lu-search-empty', empty);\r\n  }\r\n\r\n  private filterResults(node: HTMLElement, text: string) {\r\n    if (text === '') {\r\n      // show all\r\n      (<HTMLElement[]>Array.from(node.querySelectorAll('.hidden'))).forEach((d: HTMLElement) => d.classList.remove('hidden'));\r\n      return false;\r\n    }\r\n    const children = Array.from(node.children);\r\n    children.forEach((d) => {\r\n      const content = d.firstElementChild!.innerHTML.toLowerCase();\r\n      let hidden = !content.includes(text);\r\n      if (d.classList.contains('lu-search-group')) {\r\n        const ul = <HTMLElement>d.lastElementChild!;\r\n        const allChildrenHidden = this.filterResults(ul, text);\r\n        hidden = hidden && allChildrenHidden;\r\n      }\r\n      d.classList.toggle('hidden', hidden);\r\n    });\r\n\r\n    return children.every((d) => d.classList.contains('hidden'));\r\n  }\r\n\r\n  protected createEventList() {\r\n    return super.createEventList().concat([SearchBox.EVENT_SELECT]);\r\n  }\r\n\r\n  on(type: typeof SearchBox.EVENT_SELECT, listener: typeof select | null): this;\r\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\r\n  on(type: string | string[], listener: IEventListener | null): this {\r\n    return super.on(type, listener);\r\n  }\r\n}\r\n","import {format} from 'd3-format';\r\nimport Column, {IColumnDesc} from './Column';\r\nimport CompositeColumn from './CompositeColumn';\r\nimport {IDataRow, IGroupData} from './interfaces';\r\nimport {isMissingValue} from './missing';\r\nimport NumberColumn, {INumberColumn} from './NumberColumn';\r\nimport {SortByDefault} from './annotations';\r\n\r\nexport interface ICompositeNumberDesc extends IColumnDesc {\r\n  /**\r\n   * d3 format number Format\r\n   * @default 0.3n\r\n   */\r\n  numberFormat?: string;\r\n\r\n  /**\r\n   * missing value to use\r\n   * @default 0\r\n   */\r\n  missingValue?: number;\r\n}\r\n\r\nexport declare type ICompositeNumberColumnDesc = ICompositeNumberDesc & IColumnDesc;\r\n\r\n/**\r\n * implementation of a combine column, standard operations how to select\r\n */\r\n@SortByDefault('descending')\r\nexport default class CompositeNumberColumn extends CompositeColumn implements INumberColumn {\r\n  missingValue = NaN;\r\n\r\n  private numberFormat: (n: number) => string = format('.3n');\r\n\r\n  constructor(id: string, desc: Readonly<ICompositeNumberColumnDesc>) {\r\n    super(id, desc);\r\n\r\n    if (desc.numberFormat) {\r\n      this.numberFormat = format(desc.numberFormat);\r\n    }\r\n\r\n    if (desc.missingValue !== undefined) {\r\n      this.missingValue = desc.missingValue;\r\n    }\r\n  }\r\n\r\n  getNumberFormat() {\r\n    return this.numberFormat;\r\n  }\r\n\r\n  dump(toDescRef: (desc: any) => any) {\r\n    const r = super.dump(toDescRef);\r\n    r.missingValue = this.missingValue;\r\n    return r;\r\n  }\r\n\r\n  restore(dump: any, factory: (dump: any) => Column | null) {\r\n    if (dump.missingValue !== undefined) {\r\n      this.missingValue = dump.missingValue;\r\n    }\r\n    if (dump.numberFormat) {\r\n      this.numberFormat = format(dump.numberFormat);\r\n    }\r\n    super.restore(dump, factory);\r\n  }\r\n\r\n  getLabel(row: IDataRow) {\r\n    if (!this.isLoaded()) {\r\n      return '';\r\n    }\r\n    const v = this.getValue(row);\r\n    //keep non number if it is not a number else convert using formatter\r\n    return String(typeof v === 'number' && !isNaN(v) && isFinite(v) ? this.numberFormat(v) : v);\r\n  }\r\n\r\n  getValue(row: IDataRow) {\r\n    if (!this.isLoaded()) {\r\n      return null;\r\n    }\r\n    //weighted sum\r\n    const v = this.compute(row);\r\n    if (isMissingValue(v)) {\r\n      return this.missingValue;\r\n    }\r\n    return v;\r\n  }\r\n\r\n  protected compute(_row: IDataRow) {\r\n    return NaN;\r\n  }\r\n\r\n  getNumber(row: IDataRow) {\r\n    const r = this.getValue(row);\r\n    return r == null ? NaN : r;\r\n  }\r\n\r\n  getRawNumber(row: IDataRow) {\r\n    return this.getNumber(row);\r\n  }\r\n\r\n  getExportValue(row: IDataRow, format: 'text' | 'json'): any {\r\n    if (format === 'json') {\r\n      return {\r\n        value: this.getRawNumber(row),\r\n        children: this.children.map((d) => d.getExportValue(row, format))\r\n      };\r\n    }\r\n    return super.getExportValue(row, format);\r\n  }\r\n\r\n  isMissing(row: IDataRow) {\r\n    return isMissingValue(this.compute(row));\r\n  }\r\n\r\n  compare(a: IDataRow, b: IDataRow) {\r\n    return NumberColumn.prototype.compare.call(this, a, b);\r\n  }\r\n\r\n  groupCompare(a: IGroupData, b: IGroupData) {\r\n    return NumberColumn.prototype.groupCompare.call(this, a, b);\r\n  }\r\n\r\n  getRenderer(): string {\r\n    return NumberColumn.prototype.getRenderer.call(this);\r\n  }\r\n}\r\n","import {Category, SupportType} from './annotations';\r\nimport Column, {IColumnDesc, widthChanged, labelChanged, metaDataChanged, dirty, dirtyHeader, dirtyValues, rendererTypeChanged, groupRendererChanged, summaryRendererChanged, visibilityChanged} from './Column';\r\nimport {IGroup} from './interfaces';\r\nimport Ranking from './Ranking';\r\nimport {IEventListener} from '../internal/AEventDispatcher';\r\n\r\n/**\r\n * factory for creating a description creating a rank column\r\n * @param label\r\n * @returns {{type: string, label: string}}\r\n */\r\nexport function createAggregateDesc(label: string = 'Aggregate Groups') {\r\n  return {type: 'aggregate', label, fixed: true};\r\n}\r\n\r\nexport interface IAggregateGroupColumnDesc extends IColumnDesc {\r\n  isAggregated(ranking: Ranking, group: IGroup): boolean;\r\n\r\n  setAggregated(ranking: Ranking, group: IGroup, value: boolean): void;\r\n}\r\n\r\n/**\r\n * emitted upon changing of the aggregate attribute\r\n * @asMemberOf AggregateGroupColumn\r\n * @event\r\n */\r\nexport declare function aggregate(ranking: Ranking, group: IGroup, value: boolean): void;\r\n\r\n/**\r\n * a checkbox column for selections\r\n */\r\n@SupportType()\r\n@Category('support')\r\nexport default class AggregateGroupColumn extends Column {\r\n  static readonly EVENT_AGGREGATE = 'aggregate';\r\n\r\n  constructor(id: string, desc: Readonly<IAggregateGroupColumnDesc>) {\r\n    super(id, desc);\r\n    this.setDefaultWidth(20);\r\n  }\r\n\r\n  get frozen() {\r\n    return this.desc.frozen !== false;\r\n  }\r\n\r\n  protected createEventList() {\r\n    return super.createEventList().concat([AggregateGroupColumn.EVENT_AGGREGATE]);\r\n  }\r\n\r\n  on(type: typeof AggregateGroupColumn.EVENT_AGGREGATE, listener: typeof aggregate | null): this;\r\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\r\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\r\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\r\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\r\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\r\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\r\n  on(type: string | string[], listener: IEventListener | null): this {\r\n    return super.on(<any>type, listener);\r\n  }\r\n\r\n  isAggregated(group: IGroup) {\r\n    const ranking = this.findMyRanker()!;\r\n    if ((<IAggregateGroupColumnDesc>this.desc).isAggregated) {\r\n      return (<IAggregateGroupColumnDesc>this.desc).isAggregated(ranking, group);\r\n    }\r\n    return false;\r\n  }\r\n\r\n  setAggregated(group: IGroup, value: boolean) {\r\n    const ranking = this.findMyRanker()!;\r\n    const current = ((<IAggregateGroupColumnDesc>this.desc).isAggregated) && (<IAggregateGroupColumnDesc>this.desc).isAggregated(ranking, group);\r\n    if (current === value) {\r\n      return true;\r\n    }\r\n\r\n    if ((<IAggregateGroupColumnDesc>this.desc).setAggregated) {\r\n      (<IAggregateGroupColumnDesc>this.desc).setAggregated(ranking, group, value);\r\n    }\r\n    this.fire(AggregateGroupColumn.EVENT_AGGREGATE, ranking, group, value);\r\n    return false;\r\n  }\r\n}\r\n","import {IGroupData, IGroupItem} from './model';\r\nimport Ranking from './model/Ranking';\r\nimport {IDataProvider} from './provider';\r\nimport {ICellRendererFactory} from './renderer';\r\nimport {IToolbarAction, IToolbarDialogAddon} from './ui';\r\n\r\n\r\n/**\r\n * number of bins before switching to dense mode\r\n */\r\nexport const DENSE_HISTOGRAM = 19;\r\n/**\r\n * minimal witdh of a column to show the label in the header\r\n */\r\nexport const MIN_LABEL_WIDTH = 30;\r\n/**\r\n * number of milliseconds to wait before a hovered canvas row will be replaced with a DOM one\r\n * @type {number}\r\n */\r\nexport const HOVER_DELAY_SHOW_DETAIL = 500;\r\n\r\n/**\r\n * custom height implementation logic\r\n */\r\nexport interface IDynamicHeight {\r\n  /**\r\n   * default height for a row for optimized styling\r\n   */\r\n  defaultHeight: number;\r\n\r\n  /**\r\n   * returns the height in pixel for the given row\r\n   * @param {IGroupItem | IGroupData} item the item to show\r\n   * @returns {number} its height in pixel\r\n   */\r\n  height(item: IGroupItem | IGroupData): number;\r\n\r\n  /**\r\n   * returns the padding in pixel after the given row\r\n   * @param {IGroupItem | IGroupData | null} item item to show\r\n   * @returns {number} its padding in pixel\r\n   */\r\n  padding(item: IGroupItem | IGroupData | null): number;\r\n}\r\n\r\nexport interface ILineUpFlags {\r\n  /**\r\n   * optimization flag to disable frozen columns for optimizing rendering performance\r\n   * @default true\r\n   */\r\n  disableFrozenColumns: boolean;\r\n  /**\r\n   * flag whether advanced ranking features are enabled\r\n   * @default true\r\n   */\r\n  advancedRankingFeatures: boolean;\r\n  /**\r\n   * flag whether advanced model features are enabled\r\n   * @default true\r\n   */\r\n  advancedModelFeatures: boolean;\r\n  /**\r\n   * flag whether advanced UI features are enabled\r\n   * @default true\r\n   */\r\n  advancedUIFeatures: boolean;\r\n}\r\n\r\nexport interface ILineUpOptions {\r\n  /**\r\n   * option to enable/disable showing a summary (histogram, ...) in the header\r\n   * @default true\r\n   */\r\n  summaryHeader: boolean;\r\n  /**\r\n   * option to enable/disable animated transitions\r\n   * @default true\r\n   */\r\n  animated: boolean;\r\n  /**\r\n   * option to enforce that the whole row is shown upon hover without overflow hidden\r\n   * @default false\r\n   */\r\n  expandLineOnHover: boolean;\r\n  /**\r\n   * option to enable/disable the panel\r\n   * @default true\r\n   */\r\n  sidePanel: boolean;\r\n  /**\r\n   * option to specify whether the panel should be collapsed by default\r\n   * @default false\r\n   */\r\n  sidePanelCollapsed: boolean;\r\n  /**\r\n   * show the sorting and grouping hierarchy indicators in the side panel\r\n   * @default true\r\n   */\r\n  hierarchyIndicator: boolean;\r\n\r\n  /**\r\n   * option to specify the default slope graph mode\r\n   * @default 'item'\r\n   */\r\n  defaultSlopeGraphMode: 'item' | 'band';\r\n\r\n  /**\r\n   * how many degrees should a label be rotated in case of narrow columns\r\n   * @default 0 no rotation\r\n   */\r\n  labelRotation: number;\r\n\r\n  /**\r\n   * height of a row\r\n   * @default 18\r\n   */\r\n  rowHeight: number;\r\n  /**\r\n   * padding between two rows\r\n   * @default 2\r\n   */\r\n  rowPadding: number;\r\n  /**\r\n   * height of an aggregated group in pixel\r\n   * @default 40\r\n   */\r\n  groupHeight: number;\r\n  /**\r\n   * padding between two groups in pixel\r\n   * @default 5\r\n   */\r\n  groupPadding: number;\r\n\r\n  /**\r\n   * custom function to compute the level of detail for a row\r\n   * @param {number} rowIndex the current row index to be rendered\r\n   * @returns {\"high\" | \"low\"}\r\n   */\r\n  levelOfDetail: (rowIndex: number) => 'high' | 'low';\r\n  /**\r\n   * custom function to compute the height of a row (group or item)\r\n   * @param {(IGroupItem | IGroupData)[]} data the data to render\r\n   * @param {Ranking} ranking the ranking of the data\r\n   * @returns {IDynamicHeight | null} the height compute function or null to use the default\r\n   */\r\n  dynamicHeight: (data: (IGroupItem | IGroupData)[], ranking: Ranking) => IDynamicHeight | null;\r\n  /**\r\n   * custom function to be called when updating a HTML row\r\n   * @param {HTMLElement} row node element to be updated\r\n   * @param {number} rowIndex row index to be rendered in the row\r\n   */\r\n  customRowUpdate: (row: HTMLElement, rowIndex: number) => void;\r\n\r\n  /**\r\n   * register custom toolbar actions and dialog addons\r\n   */\r\n  toolbar: {[key: string]: IToolbarAction | IToolbarDialogAddon};\r\n  /**\r\n   * register custom renderer factories\r\n   */\r\n  renderers: {[type: string]: ICellRendererFactory};\r\n\r\n  /**\r\n   * custom flags for optimization\r\n   */\r\n  flags: Partial<ILineUpFlags>;\r\n\r\n  /**\r\n   * ignore incompatible browser and always show (on own risk)\r\n   * @default false\r\n   */\r\n  ignoreUnsupportedBrowser: boolean;\r\n}\r\n\r\nexport interface ITaggleOptions extends ILineUpOptions {\r\n  /**\r\n   * whether the overview mode is enabled by default\r\n   * @default false\r\n   */\r\n  overviewMode: boolean;\r\n}\r\n\r\nexport interface ILineUpLike {\r\n  readonly node: HTMLElement;\r\n  readonly data: IDataProvider;\r\n\r\n  dump(): any;\r\n\r\n  destroy(): void;\r\n}\r\n","import {ITaggleOptions} from './interfaces';\r\nimport {renderers} from './renderer';\r\nimport {toolbarActions} from './ui';\r\n\r\nexport * from './interfaces';\r\n\r\n\r\nexport function defaultOptions(): ITaggleOptions {\r\n  return {\r\n    toolbar: Object.assign({}, toolbarActions),\r\n    renderers: Object.assign({}, renderers),\r\n\r\n    labelRotation: 0,\r\n    summaryHeader: true,\r\n    animated: true,\r\n    expandLineOnHover: false,\r\n    sidePanel: true,\r\n    sidePanelCollapsed: false,\r\n    hierarchyIndicator: true,\r\n    defaultSlopeGraphMode: 'item',\r\n    overviewMode: false,\r\n\r\n    rowHeight: 18,\r\n    groupHeight: 40,\r\n    groupPadding: 5,\r\n    rowPadding: 2,\r\n\r\n    levelOfDetail: () => 'high',\r\n    customRowUpdate: () => undefined,\r\n    dynamicHeight: () => null,\r\n    flags: {\r\n      disableFrozenColumns: true, //disable by default for speed navigator.userAgent.includes('Firefox/52') // disable by default in Firefox ESR 52\r\n      advancedRankingFeatures: true,\r\n      advancedModelFeatures: true,\r\n      advancedUIFeatures: true\r\n    },\r\n    ignoreUnsupportedBrowser: false\r\n  };\r\n}\r\n","import {timeFormat} from 'd3-time-format';\r\nimport Column from './Column';\r\nimport {IColumnDesc, IDataRow} from './interfaces';\r\nimport {isNumberIncluded, INumberFilter} from './INumberColumn';\r\nimport {timeDay, timeMonth, timeWeek, timeMinute, timeSecond, timeHour} from 'd3-time';\r\nimport {equal} from '../internal/utils';\r\n\r\nexport {INumberFilter as IDateFilter, restoreNumberFilter as restoreDateFilter,\r\n  noNumberFilter as noDateFilter, isEqualNumberFilter as isEqualDateFilter,\r\n  isDummyNumberFilter as isDummyDateFilter} from './INumberColumn';\r\n\r\nexport interface IDateColumn extends Column {\r\n  getDate(row: IDataRow): Date | null;\r\n}\r\n\r\nexport default IDateColumn;\r\n\r\n\r\nexport interface IDateDesc {\r\n  /**\r\n   * d3 formatting option\r\n   * @default %x\r\n   */\r\n  dateFormat?: string;\r\n\r\n  /**\r\n   * d3 formation option\r\n   * @dfeault dateFormat\r\n   */\r\n  dateParse?: string;\r\n}\r\n\r\n\r\n/**\r\n * checks whether the given column or description is a date column, i.e. the value is a date\r\n * @param col\r\n * @returns {boolean}\r\n */\r\nexport function isDateColumn(col: Column): col is IDateColumn;\r\nexport function isDateColumn(col: IColumnDesc): col is IDateDesc & IColumnDesc;\r\nexport function isDateColumn(col: Column | IColumnDesc) {\r\n  return (col instanceof Column && typeof (<IDateColumn>col).getDate === 'function' || (!(col instanceof Column) && (<IColumnDesc>col).type.startsWith('date')));\r\n}\r\n\r\nexport function isDateIncluded(filter: INumberFilter | null, value: Date | null) {\r\n  if (!filter) {\r\n    return true;\r\n  }\r\n  if (value == null || !(value instanceof Date)) {\r\n    return !filter.filterMissing;\r\n  }\r\n  return isNumberIncluded(filter, value!.getTime());\r\n}\r\n\r\nexport declare type IDateGranularity = 'century' | 'decade' | 'year' | 'month' | 'week' | 'day_of_week' | 'day_of_month' | 'day_of_year' | 'hour' | 'minute' | 'second';\r\n\r\nexport interface IDateGrouper {\r\n  /**\r\n   * granuality level for the grouping\r\n   */\r\n  granularity: IDateGranularity;\r\n  /**\r\n   * whether circular occurrences should be in the same bin\r\n   * e.g. granularity = month\r\n   * circular: 01.2018 == 01.2017\r\n   * not circular: 01.2018 != 01.2017\r\n   */\r\n  circular: boolean;\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport function defaultDateGrouper(): IDateGrouper {\r\n  return { granularity: 'month', circular: false};\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport function isDefaultDateGrouper(grouper: IDateGrouper) {\r\n  return equal(defaultDateGrouper(), grouper);\r\n}\r\n\r\n/**\r\n * convert the given date to the desired grouper\r\n * @internal\r\n */\r\nexport function toDateGroup(grouper: IDateGrouper, value: Date): {value: number, name: string} {\r\n  switch(grouper.granularity) {\r\n  case 'century':\r\n    const centuryP = Math.floor(value.getFullYear() / 100);\r\n    if (grouper.circular) {\r\n      const century = centuryP % 10;\r\n      return {\r\n        value: century,\r\n        name: `*${century}00`\r\n      };\r\n    }\r\n    return {\r\n      value: centuryP,\r\n      name: `${centuryP}00`\r\n    };\r\n  case 'decade':\r\n    const decadeP = Math.floor(value.getFullYear() / 10);\r\n    if (grouper.circular) {\r\n      const decade = decadeP % 10;\r\n      return {\r\n        value: decade,\r\n        name: `**${decade}0`\r\n      };\r\n    }\r\n    return {\r\n      value: decadeP,\r\n      name: `${decadeP}0`\r\n    };\r\n  case 'year':\r\n    if (grouper.circular) {\r\n      const year = value.getFullYear() % 10;\r\n      return {\r\n        value: year,\r\n        name: `***${year}`\r\n      };\r\n    }\r\n    return {\r\n      value: value.getFullYear(),\r\n      name: String(value.getFullYear())\r\n    };\r\n  case 'month':\r\n    if (grouper.circular) {\r\n      return {\r\n        value: value.getMonth(),\r\n        name: timeFormat('%B')(value)\r\n      };\r\n    }\r\n    return {\r\n      value: timeMonth(value).getTime(),\r\n      name: timeFormat('%B %Y')(value)\r\n    };\r\n  case 'week':\r\n    if (grouper.circular) {\r\n      return {\r\n        value: value.getMonth(),\r\n        name: timeFormat('%B')(value) // TODO\r\n      };\r\n    }\r\n    return {\r\n      value: timeWeek(value).getTime(),\r\n      name: timeFormat('%B %Y')(value) // TODO\r\n    };\r\n  case 'day_of_week':\r\n    if (grouper.circular) {\r\n      return {\r\n        value: value.getDay(),\r\n        name: timeFormat('%A')(value)\r\n      };\r\n    }\r\n    return {\r\n      value: timeDay(value).getTime(),\r\n      name: timeFormat('%x')(value)\r\n    };\r\n  case 'day_of_month':\r\n    if (grouper.circular) {\r\n      return {\r\n        value: value.getDate(),\r\n        name: timeFormat('%d')(value)\r\n      };\r\n    }\r\n    return {\r\n      value: timeDay(value).getTime(),\r\n      name: timeFormat('%x')(value)\r\n    };\r\n  case 'day_of_year':\r\n    if (grouper.circular) {\r\n      // %j = day of year\r\n      const v = timeFormat('%j')(value);\r\n      return {\r\n        value: parseInt(v, 10),\r\n        name: v\r\n      };\r\n    }\r\n    return {\r\n      value: timeDay(value).getTime(),\r\n      name: timeFormat('%x')(value)\r\n    };\r\n  case 'hour':\r\n    if (grouper.circular) {\r\n      return {\r\n        value: value.getHours(),\r\n        name: timeFormat('%A')(value)\r\n      };\r\n    }\r\n    return {\r\n      value: timeHour(value).getTime(),\r\n      name: timeFormat('%x')(value)\r\n    };\r\n  case 'minute':\r\n    if (grouper.circular) {\r\n      return {\r\n        value: value.getMinutes(),\r\n        name: timeFormat('%A')(value)\r\n      };\r\n    }\r\n    return {\r\n      value: timeMinute(value).getTime(),\r\n      name: timeFormat('%x')(value)\r\n    };\r\n  case 'second':\r\n    if (grouper.circular) {\r\n      return {\r\n        value: value.getSeconds(),\r\n        name: timeFormat('%A')(value)\r\n      };\r\n    }\r\n    return {\r\n      value: timeSecond(value).getTime(),\r\n      name: timeFormat('%x')(value)\r\n    };\r\n  }\r\n\r\n  return {\r\n    value: value.getTime(),\r\n    name: value.toString()\r\n  };\r\n}\r\n","import {\r\n  defaultPhases, EAnimationMode, IAnimationContext, IAnimationItem, IPhase,\r\n  KeyFinder, IExceptionContext\r\n} from 'lineupengine';\r\nimport {IGroupData, IGroupItem, isGroup} from '../model';\r\n\r\n/** @internal */\r\nexport interface IGroupLookUp {\r\n  item2groupIndex: Map<number, number>;\r\n  group2firstItemIndex: Map<string, number>;\r\n}\r\n\r\nfunction toGroupLookup(items: (IGroupItem | IGroupData)[]): IGroupLookUp {\r\n  const item2groupIndex = new Map<number, number>();\r\n  const group2firstItemIndex = new Map<string, number>();\r\n  items.forEach((item, i) => {\r\n    if (isGroup(item)) {\r\n      item.rows.forEach((d) => item2groupIndex.set(d.i, i));\r\n    } else if (item.group && item.relativeIndex === 0) {\r\n      group2firstItemIndex.set(item.group.name, i);\r\n    }\r\n  });\r\n  return {item2groupIndex, group2firstItemIndex};\r\n}\r\n\r\nfunction toKey(item: IGroupItem | IGroupData) {\r\n  if (isGroup(item)) {\r\n    return item.name;\r\n  }\r\n  return (<IGroupItem>item).i.toString();\r\n}\r\n\r\n/** @internal */\r\nexport function lineupAnimation(previous: IExceptionContext, previousData: (IGroupItem | IGroupData)[], currentData: (IGroupItem | IGroupData)[]): IAnimationContext {\r\n\r\n  const previousKey = (index: number) => toKey(previousData[index]);\r\n  const currentKey = (index: number) => toKey(currentData[index]);\r\n\r\n\r\n  const previousGroupCount = previousData.reduce((acc, i) => acc + (isGroup(i) ? 1 : 0), 0);\r\n  const currentGroupCount = currentData.reduce((acc, i) => acc + (isGroup(i) ? 1 : 0), 0);\r\n\r\n  if (previousGroupCount === currentGroupCount) {\r\n    // reorder or filter only\r\n    return {currentKey, previous, previousKey};\r\n  }\r\n\r\n  // try to appear where the group was uncollapsed and vice versa\r\n  let prevHelper: IGroupLookUp;\r\n  const appearPosition = (currentRowIndex: number, previousFinder: KeyFinder, defaultValue: number) => {\r\n    if (!prevHelper) {\r\n      prevHelper = toGroupLookup(previousData);\r\n    }\r\n    const item = currentData[currentRowIndex];\r\n    const referenceIndex = isGroup(item) ? prevHelper.group2firstItemIndex.get(item.name) : prevHelper.item2groupIndex.get(item.i);\r\n    if (referenceIndex === undefined) {\r\n      return defaultValue;\r\n    }\r\n    const pos = previousFinder.posByKey(previousKey(referenceIndex));\r\n    return pos.pos >= 0 ? pos.pos : defaultValue;\r\n  };\r\n\r\n\r\n  let currHelper: IGroupLookUp;\r\n  const removePosition = (previousRowIndex: number, currentFinder: KeyFinder, defaultValue: number) => {\r\n    if (!currHelper) {\r\n      currHelper = toGroupLookup(currentData);\r\n    }\r\n    const item = previousData[previousRowIndex];\r\n    const referenceIndex = isGroup(item) ? currHelper.group2firstItemIndex.get(item.name) : currHelper.item2groupIndex.get(item.i);\r\n    if (referenceIndex === undefined) {\r\n      return defaultValue;\r\n    }\r\n    const pos = currentFinder.posByKey(currentKey(referenceIndex));\r\n    return pos.pos >= 0 ? pos.pos : defaultValue;\r\n  };\r\n\r\n  const phases: IPhase[] = [\r\n    Object.assign({}, defaultPhases[0], {\r\n      apply(item: Readonly<IAnimationItem>, previousFinder: KeyFinder) {\r\n        defaultPhases[0].apply(item);\r\n        if (item.mode === EAnimationMode.SHOW) {\r\n          item.node.style.transform = `translate(0, ${appearPosition(item.current.index, previousFinder, item.previous.y) - item.nodeY}px)`;\r\n        }\r\n      }\r\n    }),\r\n    Object.assign({}, defaultPhases[1], {\r\n      apply(item: Readonly<IAnimationItem>, _previousFinder: KeyFinder, currentFinder: KeyFinder) {\r\n        defaultPhases[1].apply(item);\r\n        if (item.mode === EAnimationMode.HIDE) {\r\n          item.node.style.transform = `translate(0, ${removePosition(item.previous.index, currentFinder, item.current.y) - item.nodeY}px)`;\r\n        }\r\n      }\r\n    }),\r\n    defaultPhases[defaultPhases.length - 1]\r\n  ];\r\n\r\n  return {previous, previousKey, currentKey, phases};\r\n}\r\n","import {IColumn} from 'lineupengine';\r\nimport Column from '../model/Column';\r\nimport {ICellRenderer, IGroupCellRenderer} from '../renderer';\r\nimport {ISummaryRenderer} from '../renderer/interfaces';\r\nimport {createHeader, updateHeader} from './header';\r\nimport {IRankingContext} from './interfaces';\r\nimport {ILineUpFlags} from '../interfaces';\r\n\r\n\r\nexport interface IRenderers {\r\n  singleId: string;\r\n  single: ICellRenderer;\r\n  groupId: string;\r\n  group: IGroupCellRenderer;\r\n  summaryId: string;\r\n  summary: ISummaryRenderer | null;\r\n  singleTemplate: HTMLElement | null;\r\n  groupTemplate: HTMLElement | null;\r\n  summaryTemplate: HTMLElement | null;\r\n}\r\n\r\nexport default class RenderColumn implements IColumn {\r\n  renderers: IRenderers | null = null;\r\n\r\n  constructor(public readonly c: Column, public index: number, protected ctx: IRankingContext, protected readonly flags: ILineUpFlags) {\r\n\r\n  }\r\n\r\n  get width() {\r\n    return this.c.getWidth();\r\n  }\r\n\r\n  get id() {\r\n    return this.c.id;\r\n  }\r\n\r\n  get frozen() {\r\n    return this.flags.disableFrozenColumns ? false : this.c.frozen;\r\n  }\r\n\r\n  private singleRenderer() {\r\n    if (!this.renderers || !this.renderers.single) {\r\n      return null;\r\n    }\r\n    if (this.renderers.singleTemplate)  {\r\n      return <HTMLElement>this.renderers.singleTemplate.cloneNode(true);\r\n    }\r\n    const elem = asElement(this.ctx.document, this.renderers.single.template);\r\n    elem.dataset.renderer = this.renderers.singleId;\r\n    elem.dataset.group = 'd';\r\n\r\n    this.renderers.singleTemplate = <HTMLElement>elem.cloneNode(true);\r\n    return elem;\r\n  }\r\n\r\n  private groupRenderer() {\r\n    if (!this.renderers || !this.renderers.group) {\r\n      return null;\r\n    }\r\n    if (this.renderers.groupTemplate)  {\r\n      return <HTMLElement>this.renderers.groupTemplate.cloneNode(true);\r\n    }\r\n    const elem = asElement(this.ctx.document, this.renderers.group.template);\r\n    elem.dataset.renderer = this.renderers.groupId;\r\n    elem.dataset.group = 'g';\r\n\r\n    this.renderers.groupTemplate = <HTMLElement>elem.cloneNode(true);\r\n    return elem;\r\n  }\r\n\r\n  private summaryRenderer() {\r\n    if (!this.renderers || !this.renderers.summary) {\r\n      return null;\r\n    }\r\n    if (this.renderers.summaryTemplate)  {\r\n      return <HTMLElement>this.renderers.summaryTemplate.cloneNode(true);\r\n    }\r\n    const elem = asElement(this.ctx.document, this.renderers.summary.template);\r\n    elem.dataset.renderer = this.renderers.summaryId;\r\n    elem.classList.add('lu-summary');\r\n    this.renderers.summaryTemplate = <HTMLElement>elem.cloneNode(true);\r\n    return elem;\r\n  }\r\n\r\n  createHeader() {\r\n    const node = createHeader(this.c, this.ctx, {\r\n      dragAble: this.flags.advancedUIFeatures,\r\n      mergeDropAble: this.flags.advancedModelFeatures,\r\n      rearrangeAble: this.flags.advancedUIFeatures,\r\n      resizeable: this.flags.advancedUIFeatures\r\n    });\r\n    node.className = `lu-header`;\r\n    node.classList.toggle('frozen', this.frozen);\r\n\r\n    if (this.renderers && this.renderers.summary) {\r\n      const summary = this.summaryRenderer()!;\r\n      node.appendChild(summary);\r\n    }\r\n    this.updateHeader(node);\r\n    return node;\r\n  }\r\n\r\n  updateHeader(node: HTMLElement) {\r\n    updateHeader(node, this.c);\r\n    if (!this.renderers || !this.renderers.summary) {\r\n      return;\r\n    }\r\n    let summary = <HTMLElement>node.querySelector('.lu-summary')!;\r\n    const oldRenderer = summary.dataset.renderer;\r\n    const currentRenderer = this.renderers.summaryId;\r\n    if (oldRenderer !== currentRenderer) {\r\n      summary.remove();\r\n      summary = this.summaryRenderer()!;\r\n      node.appendChild(summary);\r\n    }\r\n    this.renderers.summary.update(summary, this.ctx.statsOf(<any>this.c));\r\n  }\r\n\r\n  createCell(index: number) {\r\n    const isGroup = this.ctx.isGroup(index);\r\n    const node = isGroup ? this.groupRenderer()! : this.singleRenderer()!;\r\n    this.updateCell(node, index);\r\n    return node;\r\n  }\r\n\r\n  updateCell(node: HTMLElement, index: number): HTMLElement | void {\r\n    node.classList.toggle('frozen', this.frozen);\r\n    const isGroup = this.ctx.isGroup(index);\r\n    // assert that we have the template of the right mode\r\n    const oldRenderer = node.dataset.renderer;\r\n    const currentRenderer = isGroup ? this.renderers!.groupId : this.renderers!.singleId;\r\n    const oldGroup = node.dataset.group;\r\n    const currentGroup = (isGroup ? 'g' : 'd');\r\n    if (oldRenderer !== currentRenderer || oldGroup !== currentGroup) {\r\n      node = isGroup ? this.groupRenderer()! : this.singleRenderer()!;\r\n    }\r\n    if (isGroup) {\r\n      const g = this.ctx.getGroup(index);\r\n      this.renderers!.group.update(node, g, g.rows);\r\n    } else {\r\n      const r = this.ctx.getRow(index);\r\n      this.renderers!.single.update(node, r, r.relativeIndex, r.group);\r\n    }\r\n    return node;\r\n  }\r\n\r\n  renderCell(ctx: CanvasRenderingContext2D, index: number) {\r\n    const r = this.ctx.getRow(index);\r\n    this.renderers!.single.render(ctx, r, r.relativeIndex, r.group);\r\n  }\r\n}\r\n\r\nfunction asElement(doc: Document, html: string): HTMLElement {\r\n  const helper = doc.createElement('div');\r\n  helper.innerHTML = html;\r\n  const s = <HTMLElement>helper.firstElementChild!;\r\n  helper.innerHTML = '';\r\n  return s;\r\n}\r\n","import {StyleManager} from 'lineupengine';\r\nimport {round} from '../internal';\r\nimport Column from '../model/Column';\r\nimport {IMultiLevelColumn} from '../model';\r\nimport {ISummaryRenderer} from '../renderer/interfaces';\r\nimport {gridClass} from '../renderer/MultiLevelCellRenderer';\r\nimport {COLUMN_PADDING} from '../styles';\r\nimport {createHeader, updateHeader} from './header';\r\nimport {IRankingContext} from './interfaces';\r\nimport RenderColumn from './RenderColumn';\r\nimport {ILineUpFlags} from '../interfaces';\r\n\r\n/** @internal */\r\nexport default class MultiLevelRenderColumn extends RenderColumn {\r\n  private readonly summaries: ISummaryRenderer[] = [];\r\n\r\n  constructor(c: IMultiLevelColumn & Column, index: number, ctx: IRankingContext, flags: ILineUpFlags) {\r\n    super(c, index, ctx, flags);\r\n  }\r\n\r\n  private get mc() {\r\n    return <IMultiLevelColumn & Column>this.c;\r\n  }\r\n\r\n  get width() {\r\n    return this.c.getWidth() + COLUMN_PADDING * this.mc.length;\r\n  }\r\n\r\n  createHeader() {\r\n    const node = super.createHeader();\r\n    const wrapper = this.ctx.document.createElement('div');\r\n    wrapper.classList.add('lu-nested');\r\n    wrapper.classList.add(gridClass(this.c));\r\n    node.appendChild(wrapper);\r\n\r\n    this.summaries.splice(0, this.summaries.length);\r\n    this.mc.children.forEach((cc, i) => {\r\n      const n = createHeader(cc, this.ctx, {\r\n        mergeDropAble: false,\r\n        dragAble: this.flags.advancedModelFeatures,\r\n        rearrangeAble: this.flags.advancedModelFeatures,\r\n        resizeable: this.flags.advancedModelFeatures\r\n      });\r\n      n.classList.add('lu-header');\r\n      (<any>n.style).gridColumnStart = (i + 1).toString();\r\n      wrapper.appendChild(n);\r\n\r\n      if (!this.renderers || !this.renderers.summary) {\r\n        return;\r\n      }\r\n      const summary = this.ctx.summaryRenderer(cc, false);\r\n      n.insertAdjacentHTML('beforeend', summary.template);\r\n      const summaryNode = <HTMLElement>n.lastElementChild!;\r\n      summaryNode.classList.add('lu-summary');\r\n      summaryNode.dataset.renderer = cc.getSummaryRenderer();\r\n      this.summaries.push(summary);\r\n      summary.update(summaryNode, this.ctx.statsOf(<any>cc));\r\n    });\r\n\r\n    this.updateNested(wrapper);\r\n\r\n    return node;\r\n  }\r\n\r\n  updateHeader(node: HTMLElement) {\r\n    super.updateHeader(node);\r\n\r\n    const wrapper = <HTMLElement>node.querySelector('.lu-nested');\r\n    if (!wrapper) {\r\n      return node; // too early\r\n    }\r\n    node.appendChild(wrapper); // ensure the last one\r\n    this.updateNested(wrapper);\r\n    return node;\r\n  }\r\n\r\n  updateWidthRule(style: StyleManager) {\r\n    const mc = this.mc;\r\n    // need this for chrome to work properly\r\n    const widths = mc.children.map((c) => `minmax(0, ${round(c.getWidth())}fr)`);\r\n    const clazz = gridClass(this.c);\r\n    style.updateRule(`stacked-${this.c.id}`, `.lineup-engine .${clazz} {\r\n      display: grid;\r\n      grid-template-columns: ${widths.join(' ')};\r\n    }`);\r\n    return clazz;\r\n  }\r\n\r\n  private updateNested(wrapper: HTMLElement) {\r\n    const sub = this.mc.children;\r\n    const children = <HTMLElement[]>Array.from(wrapper.children);\r\n    sub.forEach((c, i) => {\r\n      const node = children[i];\r\n      updateHeader(node, c);\r\n\r\n      if (!this.renderers || !this.renderers.summary) {\r\n        return;\r\n      }\r\n      let summary = <HTMLElement>node.querySelector('.lu-summary')!;\r\n      const oldRenderer = summary.dataset.renderer;\r\n      const currentRenderer = c.getSummaryRenderer();\r\n      if (oldRenderer !== currentRenderer) {\r\n        const renderer = this.ctx.summaryRenderer(c, false);\r\n        summary.remove();\r\n        summary.innerHTML = renderer.template;\r\n        summary = <HTMLElement>summary.firstElementChild!;\r\n        summary.classList.add('lu-summary');\r\n        summary.dataset.renderer = currentRenderer;\r\n        this.summaries[i] = renderer;\r\n        node.appendChild(summary);\r\n      }\r\n      this.summaries[i].update(summary, this.ctx.statsOf(<any>c));\r\n    });\r\n  }\r\n}\r\n","import AEventDispatcher from '../internal/AEventDispatcher';\r\nimport OrderedSet from '../internal/OrderedSet';\r\nimport {IGroupData, IGroupItem, isGroup} from '../model';\r\nimport {IDataProvider} from '../provider/ADataProvider';\r\nimport {rangeSelection} from '../renderer/SelectionRenderer';\r\nimport {IEventListener} from '../internal/AEventDispatcher';\r\n\r\ninterface IPoint {\r\n  x: number;\r\n  y: number;\r\n}\r\n\r\ninterface IShift {\r\n  xShift: number;\r\n  yShift: number;\r\n  node: HTMLElement;\r\n}\r\n\r\n/**\r\n * @asMemberOf SelectionManager\r\n * @event\r\n */\r\nexport declare function selectRange(from: number, to: number, additional: boolean): void;\r\n\r\n/** @internal */\r\nexport default class SelectionManager extends AEventDispatcher {\r\n  static readonly EVENT_SELECT_RANGE = 'selectRange';\r\n  private static readonly MIN_DISTANCE = 10;\r\n\r\n  private readonly hr: HTMLHRElement;\r\n\r\n  private start: (IPoint & IShift) | null = null;\r\n\r\n  constructor(private readonly ctx: { provider: IDataProvider }, private readonly body: HTMLElement) {\r\n    super();\r\n    const root = body.parentElement!.parentElement!;\r\n    let hr = <HTMLHRElement>root.querySelector('hr');\r\n    if (!hr) {\r\n      console.assert(root.ownerDocument != null);\r\n      hr = root.ownerDocument!.createElement('hr');\r\n      root.appendChild(hr);\r\n    }\r\n    this.hr = hr;\r\n\r\n    const mouseMove = (evt: MouseEvent) => {\r\n      this.showHint(evt);\r\n    };\r\n    const mouseUp = (evt: MouseEvent) => {\r\n      this.body.removeEventListener('mousemove', mouseMove);\r\n      this.body.removeEventListener('mouseup', mouseUp);\r\n      this.body.removeEventListener('mouseleave', mouseUp);\r\n\r\n      if (!this.start) {\r\n        return;\r\n      }\r\n      const startNode = this.start.node.classList.contains('lu-row') ? this.start.node : <HTMLElement>this.start.node.closest('.lu-row');\r\n      // somehow on firefox the mouseUp will be triggered on the original node\r\n      // thus search the node explicitly\r\n      console.assert(this.body.ownerDocument != null);\r\n      const end = <HTMLElement>this.body.ownerDocument!.elementFromPoint(evt.clientX, evt.clientY);\r\n      const endNode = end.classList.contains('lu-row') ? end : <HTMLElement>(end.closest('.lu-row'));\r\n      this.start = null;\r\n      this.body.classList.remove('lu-selection-active');\r\n      this.hr.classList.remove('lu-selection-active');\r\n\r\n      this.select(evt.ctrlKey, startNode, endNode);\r\n    };\r\n\r\n    body.addEventListener('mousedown', (evt) => {\r\n      const r = root.getBoundingClientRect();\r\n      this.start = {x: evt.clientX, y: evt.clientY, xShift: r.left, yShift: r.top, node: <HTMLElement>evt.target};\r\n      this.body.classList.add('lu-selection-active');\r\n      body.addEventListener('mousemove', mouseMove, {\r\n        passive: true\r\n      });\r\n      body.addEventListener('mouseup', mouseUp, {\r\n        passive: true\r\n      });\r\n      body.addEventListener('mouseleave', mouseUp, {\r\n        passive: true\r\n      });\r\n    }, {\r\n      passive: true\r\n    });\r\n  }\r\n\r\n  protected createEventList() {\r\n    return super.createEventList().concat([SelectionManager.EVENT_SELECT_RANGE]);\r\n  }\r\n\r\n  on(type: typeof SelectionManager.EVENT_SELECT_RANGE, listener: typeof selectRange | null): this;\r\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\r\n  on(type: string | string[], listener: IEventListener | null): this {\r\n    return super.on(type, listener);\r\n  }\r\n\r\n  private select(additional: boolean, startNode?: HTMLElement, endNode?: HTMLElement) {\r\n    if (!startNode || !endNode || startNode === endNode) {\r\n      return; // no single\r\n    }\r\n\r\n    const startIndex = parseInt(startNode.dataset.index!, 10);\r\n    const endIndex = parseInt(endNode.dataset.index!, 10);\r\n\r\n    const from = Math.min(startIndex, endIndex);\r\n    const end = Math.max(startIndex, endIndex);\r\n    if (from === end) {\r\n      return; // no single\r\n    }\r\n    // bounce event end\r\n    requestAnimationFrame(() => this.fire(SelectionManager.EVENT_SELECT_RANGE, from, end, additional));\r\n  }\r\n\r\n  private showHint(end: MouseEvent) {\r\n    const start = this.start!;\r\n    const sy = start.y;\r\n    const ey = end.clientY;\r\n\r\n    const visible = Math.abs(sy - ey) > SelectionManager.MIN_DISTANCE;\r\n    this.hr.classList.toggle('lu-selection-active', visible);\r\n    this.hr.style.transform = `translate(${start.x - start.xShift}px,${sy - start.yShift}px)scale(1,${Math.abs(ey - sy)})rotate(${ey > sy ? 90 : -90}deg)`;\r\n  }\r\n\r\n  remove(node: HTMLElement) {\r\n    node.onclick = <any>undefined;\r\n  }\r\n\r\n  add(node: HTMLElement) {\r\n    node.onclick = (evt) => {\r\n      const dataIndex = parseInt(node.dataset.i!, 10);\r\n      if (evt.shiftKey) {\r\n        const relIndex = parseInt(node.dataset.index!, 10);\r\n        const ranking = node.parentElement!.dataset.ranking!;\r\n        if (rangeSelection(this.ctx.provider, ranking, dataIndex, relIndex, evt.ctrlKey)) {\r\n          return;\r\n        }\r\n      }\r\n      this.ctx.provider.toggleSelection(dataIndex, evt.ctrlKey);\r\n    };\r\n  }\r\n\r\n  /**\r\n   *\r\n   */\r\n\r\n\r\n  selectRange(rows: { forEach: (c: (item: (IGroupItem | IGroupData)) => void) => void }, additional: boolean = false) {\r\n    const current = new OrderedSet<number>(additional ? this.ctx.provider.getSelection() : []);\r\n    const toggle = (dataIndex: number) => {\r\n      if (current.has(dataIndex)) {\r\n        current.delete(dataIndex);\r\n      } else {\r\n        current.add(dataIndex);\r\n      }\r\n    };\r\n    rows.forEach((d) => {\r\n      if (isGroup(d)) {\r\n        d.rows.forEach((r) => toggle(r.i));\r\n      } else {\r\n        toggle(d.i);\r\n      }\r\n    });\r\n    this.ctx.provider.setSelection(Array.from(current));\r\n  }\r\n\r\n  updateState(node: HTMLElement, dataIndex: number) {\r\n    if (this.ctx.provider.isSelected(dataIndex)) {\r\n      node.classList.add('lu-selected');\r\n    } else {\r\n      node.classList.remove('lu-selected');\r\n    }\r\n  }\r\n\r\n  update(node: HTMLElement, selectedDataIndices: { has(dataIndex: number): boolean }) {\r\n    const dataIndex = parseInt(node.dataset.i!, 10);\r\n    if (selectedDataIndices.has(dataIndex)) {\r\n      node.classList.add('lu-selected');\r\n    } else {\r\n      node.classList.remove('lu-selected');\r\n    }\r\n  }\r\n}\r\n","import {IExceptionContext, nonUniformContext, uniformContext, PrefetchMixin, GridStyleManager, setColumn, ACellTableSection, ITableSection, ICellRenderContext} from 'lineupengine';\r\nimport {HOVER_DELAY_SHOW_DETAIL} from '../config';\r\nimport AEventDispatcher, {IEventContext, IEventHandler, IEventListener} from '../internal/AEventDispatcher';\r\nimport debounce from '../internal/debounce';\r\nimport {IDataRow, IGroupData, IGroupItem, isGroup, isMultiLevelColumn, ValueColumn} from '../model';\r\nimport Column from '../model/Column';\r\nimport Ranking from '../model/Ranking';\r\nimport StackColumn from '../model/StackColumn';\r\nimport {IImposer, IRenderContext} from '../renderer';\r\nimport {CANVAS_HEIGHT, COLUMN_PADDING} from '../styles';\r\nimport {lineupAnimation} from './animation';\r\nimport {IRankingBodyContext, IRankingHeaderContextContainer} from './interfaces';\r\nimport MultiLevelRenderColumn from './MultiLevelRenderColumn';\r\nimport RenderColumn, {IRenderers} from './RenderColumn';\r\nimport SelectionManager from './SelectionManager';\r\nimport {ILineUpFlags} from '../interfaces';\r\n\r\nexport interface IEngineRankingContext extends IRankingHeaderContextContainer, IRenderContext {\r\n  createRenderer(c: Column, imposer?: IImposer): IRenderers;\r\n}\r\n\r\n\r\nexport interface IEngineRankingOptions {\r\n  animation: boolean;\r\n  levelOfDetail: (rowIndex: number) => 'high' | 'low';\r\n  customRowUpdate: (row: HTMLElement, rowIndex: number) => void;\r\n  flags: ILineUpFlags;\r\n}\r\n\r\n/**\r\n * emitted when the width of the ranking changed\r\n * @asMemberOf EngineRanking\r\n * @event\r\n */\r\nexport declare function widthChanged(): void;\r\n/**\r\n * emitted when the data of the ranking needs to be updated\r\n * @asMemberOf EngineRanking\r\n * @event\r\n */\r\nexport declare function updateData(): void;\r\n/**\r\n * emitted when the histogram of a column needs to be updated\r\n * @asMemberOf EngineRanking\r\n * @param col the column to update the histogram of\r\n * @event\r\n */\r\nexport declare function updateHist(col: Column): void;\r\n/**\r\n * emitted when the highlight changes\r\n * @asMemberOf EngineRanking\r\n * @param dataIndex the highlghted data index or -1 for none\r\n * @event\r\n */\r\nexport declare function highlightChanged(dataIndex: number): void;\r\n\r\n\r\n/** @internal */\r\nclass RankingEvents extends AEventDispatcher {\r\n  static readonly EVENT_WIDTH_CHANGED = 'widthChanged';\r\n  static readonly EVENT_UPDATE_DATA = 'updateData';\r\n  static readonly EVENT_UPDATE_HIST = 'updateHist';\r\n  static readonly EVENT_HIGHLIGHT_CHANGED = 'highlightChanged';\r\n\r\n  fire(type: string | string[], ...args: any[]) {\r\n    super.fire(type, ...args);\r\n  }\r\n\r\n  protected createEventList() {\r\n    return super.createEventList().concat([RankingEvents.EVENT_WIDTH_CHANGED, RankingEvents.EVENT_UPDATE_DATA, RankingEvents.EVENT_UPDATE_HIST, RankingEvents.EVENT_HIGHLIGHT_CHANGED]);\r\n  }\r\n}\r\n\r\nexport default class EngineRanking extends ACellTableSection<RenderColumn> implements ITableSection, IEventHandler {\r\n  static readonly EVENT_WIDTH_CHANGED = RankingEvents.EVENT_WIDTH_CHANGED;\r\n  static readonly EVENT_UPDATE_DATA = RankingEvents.EVENT_UPDATE_DATA;\r\n  static readonly EVENT_UPDATE_HIST = RankingEvents.EVENT_UPDATE_HIST;\r\n  static readonly EVENT_HIGHLIGHT_CHANGED = RankingEvents.EVENT_HIGHLIGHT_CHANGED;\r\n\r\n  private _context: ICellRenderContext<RenderColumn>;\r\n\r\n  private readonly renderCtx: IRankingBodyContext;\r\n  private data: (IGroupItem | IGroupData)[] = [];\r\n  private readonly selection: SelectionManager;\r\n  private highlight: number = -1;\r\n  private readonly canvasPool: HTMLCanvasElement[] = [];\r\n  private oldLeft: number = 0;\r\n\r\n  private readonly events = new RankingEvents();\r\n\r\n  private roptions: Readonly<IEngineRankingOptions> = {\r\n    animation: true,\r\n    levelOfDetail: () => 'high',\r\n    customRowUpdate: () => undefined,\r\n    flags: {\r\n      disableFrozenColumns: false,\r\n      advancedModelFeatures: true,\r\n      advancedRankingFeatures: true,\r\n      advancedUIFeatures: true\r\n    }\r\n  };\r\n\r\n  private readonly delayedUpdate: (this: { type: string }) => void;\r\n  private readonly delayedUpdateAll: () => void;\r\n  private readonly delayedUpdateColumnWidths: () => void;\r\n  private readonly columns: RenderColumn[];\r\n\r\n  private readonly canvasMouseHandler = {\r\n    timer: -1,\r\n    enter: (evt: MouseEvent) => {\r\n      const c = this.canvasMouseHandler;\r\n      if (c.timer > 0) {\r\n        self.clearTimeout(c.timer);\r\n      }\r\n      const row = <HTMLElement>evt.currentTarget;\r\n      row.addEventListener('mouseleave', c.leave, {\r\n        passive: true\r\n      });\r\n      c.timer = self.setTimeout(() => this.updateHoveredRow(row, true), HOVER_DELAY_SHOW_DETAIL);\r\n    },\r\n    leave: (evt: MouseEvent) => {\r\n      const c = this.canvasMouseHandler;\r\n      if (c.timer > 0) {\r\n        self.clearTimeout(c.timer);\r\n        c.timer = -1;\r\n      }\r\n      const row = <HTMLElement>evt.currentTarget;\r\n      if (!EngineRanking.isCanvasRenderedRow(row)) {\r\n        self.setTimeout(() => this.updateHoveredRow(row, false));\r\n      }\r\n      // remove self\r\n      row.removeEventListener('mouseleave', c.leave);\r\n    }\r\n  };\r\n\r\n  private readonly highlightHandler = {\r\n    enabled: false,\r\n    enter: (evt: MouseEvent) => {\r\n      if (this.highlight >= 0) {\r\n        const old = this.body.querySelector('.le-highlighted');\r\n        if (old) {\r\n          old.classList.remove('le-highlighted');\r\n        }\r\n        this.highlight = -1;\r\n      }\r\n      const row = <HTMLElement>evt.currentTarget;\r\n      const dataIndex = parseInt(row.dataset.i || '-1', 10);\r\n      this.events.fire(EngineRanking.EVENT_HIGHLIGHT_CHANGED, dataIndex);\r\n    },\r\n    leave: () => {\r\n      if (this.highlight >= 0) {\r\n        const old = this.body.querySelector('.le-highlighted');\r\n        if (old) {\r\n          old.classList.remove('le-highlighted');\r\n        }\r\n        this.highlight = -1;\r\n      }\r\n      this.events.fire(EngineRanking.EVENT_HIGHLIGHT_CHANGED, -1);\r\n    }\r\n  };\r\n\r\n  constructor(public readonly ranking: Ranking, header: HTMLElement, body: HTMLElement, tableId: string, style: GridStyleManager, private readonly ctx: IEngineRankingContext, roptions: Partial<IEngineRankingOptions> = {}) {\r\n    super(header, body, tableId, style, {mixins: [PrefetchMixin], batchSize: 10});\r\n    Object.assign(this.roptions, roptions);\r\n    body.classList.add('lu-row-body');\r\n    body.dataset.ranking = ranking.id;\r\n\r\n    const that = this;\r\n    this.delayedUpdate = debounce((function (this: { type: string, primaryType: string }) {\r\n      if (this.type !== Ranking.EVENT_DIRTY_VALUES) {\r\n        that.events.fire(EngineRanking.EVENT_UPDATE_DATA);\r\n        return;\r\n      }\r\n      if (this.primaryType !== Column.EVENT_RENDERER_TYPE_CHANGED && this.primaryType !== Column.EVENT_GROUP_RENDERER_TYPE_CHANGED && this.primaryType !== Column.EVENT_LABEL_CHANGED) { // just the single column will be updated\r\n        that.updateBody();\r\n      }\r\n    }), 50, (current, next) => {\r\n      const currentEvent = current.self.type;\r\n      // order changed is more important\r\n      return currentEvent === Ranking.EVENT_ORDER_CHANGED ? current : next;\r\n    });\r\n\r\n    this.delayedUpdateAll = debounce(() => this.updateAll(), 50);\r\n    this.delayedUpdateColumnWidths = debounce(() => this.updateColumnWidths(), 50);\r\n    ranking.on(`${Ranking.EVENT_ADD_COLUMN}.hist`, (col: Column, index: number) => {\r\n      this.columns.splice(index, 0, this.createCol(col, index));\r\n      this.reindex();\r\n      this.updateHist(col);\r\n      this.delayedUpdateAll();\r\n    });\r\n    ranking.on(`${Ranking.EVENT_REMOVE_COLUMN}.body`, (col: Column, index: number) => {\r\n      EngineRanking.disableListener(col);\r\n      this.columns.splice(index, 1);\r\n      this.reindex();\r\n      this.delayedUpdateAll();\r\n    });\r\n    ranking.on(`${Ranking.EVENT_MOVE_COLUMN}.body`, (col: Column, index: number, old: number) => {\r\n      //delete first\r\n      const c = this.columns.splice(old, 1)[0];\r\n      console.assert(c.c === col);\r\n      // adapt target index based on previous index, i.e shift by one\r\n      this.columns.splice(old < index ? index - 1 : index, 0, c);\r\n      this.reindex();\r\n      this.delayedUpdateAll();\r\n    });\r\n    ranking.on(`${Ranking.EVENT_COLUMN_VISIBILITY_CHANGED}.body`, (col: Column, _oldValue: boolean, newValue: boolean) => {\r\n      if (newValue) {\r\n        // become visible\r\n        const index = ranking.children.indexOf(col);\r\n        this.columns.splice(index, 0, this.createCol(col, index));\r\n        this.updateHist(col);\r\n      } else {\r\n        // hide\r\n        const index = this.columns.findIndex((d) => d.c === col);\r\n        EngineRanking.disableListener(col);\r\n        this.columns.splice(index, 1);\r\n      }\r\n      this.reindex();\r\n      this.delayedUpdateAll();\r\n    });\r\n    ranking.on(`${Ranking.EVENT_ORDER_CHANGED}.body`, this.delayedUpdate);\r\n\r\n    this.selection = new SelectionManager(this.ctx, body);\r\n    this.selection.on(SelectionManager.EVENT_SELECT_RANGE, (from: number, to: number, additional: boolean) => {\r\n      this.selection.selectRange(this.data.slice(from, to + 1), additional);\r\n    });\r\n\r\n    this.renderCtx = Object.assign({\r\n      isGroup: (index: number) => isGroup(this.data[index]),\r\n      getRow: (index: number) => <IGroupItem>this.data[index],\r\n      getGroup: (index: number) => <IGroupData>this.data[index]\r\n    }, ctx);\r\n\r\n    // default context\r\n    this.columns = ranking.children.filter((c) => c.isVisible()).map((c, i) => this.createCol(c, i));\r\n    this._context = Object.assign({\r\n      columns: this.columns,\r\n      column: nonUniformContext(this.columns.map((w) => w.width), 100, COLUMN_PADDING)\r\n    }, uniformContext(0, 20));\r\n\r\n    this.columns.forEach((column) => {\r\n      if (column instanceof MultiLevelRenderColumn) {\r\n        column.updateWidthRule(this.style);\r\n      }\r\n      column.renderers = this.ctx.createRenderer(column.c);\r\n    });\r\n  }\r\n\r\n  on(type: typeof EngineRanking.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\r\n  on(type: typeof EngineRanking.EVENT_UPDATE_DATA, listener: typeof updateData | null): this;\r\n  on(type: typeof EngineRanking.EVENT_UPDATE_HIST, listener: typeof updateHist | null): this;\r\n  on(type: typeof EngineRanking.EVENT_HIGHLIGHT_CHANGED, listener: typeof highlightChanged | null): this;\r\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\r\n  on(type: string | string[], listener: IEventListener | null): this {\r\n    this.events.on(type, listener);\r\n    return this;\r\n  }\r\n\r\n  get id() {\r\n    return this.ranking.id;\r\n  }\r\n\r\n  protected onVisibilityChanged(visible: boolean) {\r\n    super.onVisibilityChanged(visible);\r\n    if (visible) {\r\n      this.delayedUpdate.call({type: Ranking.EVENT_ORDER_CHANGED});\r\n    }\r\n  }\r\n\r\n  updateHeaders() {\r\n    return super.updateHeaders();\r\n  }\r\n\r\n  get currentData() {\r\n    return this.data;\r\n  }\r\n\r\n  get context(): ICellRenderContext<RenderColumn> {\r\n    return this._context;\r\n  }\r\n\r\n  protected createHeader(_document: Document, column: RenderColumn) {\r\n    return column.createHeader();\r\n  }\r\n\r\n  protected updateHeader(node: HTMLElement, column: RenderColumn) {\r\n    if (column instanceof MultiLevelRenderColumn) {\r\n      column.updateWidthRule(this.style);\r\n    }\r\n    return column.updateHeader(node);\r\n  }\r\n\r\n  protected createCell(_document: Document, index: number, column: RenderColumn) {\r\n    return column.createCell(index);\r\n  }\r\n\r\n  protected updateCell(node: HTMLElement, index: number, column: RenderColumn) {\r\n    return column.updateCell(node, index);\r\n  }\r\n\r\n  private selectCanvas() {\r\n    if (this.canvasPool.length > 0) {\r\n      return this.canvasPool.pop()!;\r\n    }\r\n    console.assert(this.body.ownerDocument != null);\r\n    const c = this.body.ownerDocument!.createElement('canvas');\r\n    c.classList.add('lu-detail-canvas');\r\n    return c;\r\n  }\r\n\r\n  private rowFlags(row: HTMLElement) {\r\n    const rowany: any = row;\r\n    const v = rowany.__lu__;\r\n    if (v == null) {\r\n      return rowany.__lu__ = {};\r\n    }\r\n    return v;\r\n  }\r\n\r\n  private visibleRenderedWidth() {\r\n    let width = 0;\r\n    for (const col of this.visibleColumns.frozen) {\r\n      width += this.columns[col].width + COLUMN_PADDING;\r\n    }\r\n    for(let col = this.visibleColumns.first; col <= this.visibleColumns.last; ++col) {\r\n      width += this.columns[col].width + COLUMN_PADDING;\r\n    }\r\n    if (width > 0) {\r\n      width -= COLUMN_PADDING; // for the last one\r\n    }\r\n    return width;\r\n  }\r\n\r\n  private renderRow(canvas: HTMLCanvasElement, index: number, width = this.visibleRenderedWidth()) {\r\n    canvas.width = width;\r\n    canvas.style.width = `${width}px`;\r\n    canvas.height = CANVAS_HEIGHT;\r\n    const ctx = canvas.getContext('2d')!;\r\n    ctx.imageSmoothingEnabled = false;\r\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n    ctx.save();\r\n    for (const col of this.visibleColumns.frozen) {\r\n      const c = this.columns[col];\r\n      c.renderCell(ctx, index);\r\n      const shift = c.width + COLUMN_PADDING;\r\n      ctx.translate(shift, 0);\r\n    }\r\n    for(let col = this.visibleColumns.first; col <= this.visibleColumns.last; ++col) {\r\n      const c = this.columns[col];\r\n      c.renderCell(ctx, index);\r\n      const shift = c.width + COLUMN_PADDING;\r\n      ctx.translate(shift, 0);\r\n    }\r\n    ctx.restore();\r\n  }\r\n\r\n  protected updateCanvasCell(canvas: HTMLCanvasElement, index: number, column: RenderColumn, x: number) {\r\n    const ctx = canvas.getContext('2d')!;\r\n    ctx.clearRect(x - 1, 0, column.width + 2, canvas.height);\r\n    ctx.save();\r\n    ctx.translate(x, 0);\r\n    column.renderCell(ctx, index);\r\n    ctx.restore();\r\n  }\r\n\r\n  private reindex() {\r\n    this.columns.forEach((c, i) => {\r\n      c.index = i;\r\n    });\r\n  }\r\n\r\n  updateAll() {\r\n    this.columns.forEach((c, i) => {\r\n      c.index = i;\r\n      c.renderers = this.ctx.createRenderer(c.c);\r\n    });\r\n\r\n    this._context = Object.assign({}, this._context, {\r\n      column: nonUniformContext(this.columns.map((w) => w.width), 100, COLUMN_PADDING)\r\n    });\r\n\r\n    super.recreate();\r\n    this.events.fire(EngineRanking.EVENT_WIDTH_CHANGED);\r\n  }\r\n\r\n  updateBody() {\r\n    if (this.hidden) {\r\n      return;\r\n    }\r\n    this.events.fire(EngineRanking.EVENT_WIDTH_CHANGED);\r\n    super.forEachRow((row, rowIndex) => this.updateRow(row, rowIndex));\r\n  }\r\n\r\n  updateHeaderOf(col: Column) {\r\n    const i = this._context.columns.findIndex((d) => d.c === col);\r\n    if (i < 0) {\r\n      return false;\r\n    }\r\n    const node = <HTMLElement>this.header.children[i]!;\r\n    const column = this._context.columns[i];\r\n    if (node && column) {\r\n      this.updateHeader(node, column);\r\n    }\r\n    return node && column;\r\n  }\r\n\r\n  protected createRow(node: HTMLElement, rowIndex: number): void {\r\n    node.classList.add('lu-row');\r\n    this.roptions.customRowUpdate(node, rowIndex);\r\n    if (this.highlightHandler.enabled) {\r\n      node.addEventListener('mouseenter', this.highlightHandler.enter, {\r\n        passive: true\r\n      });\r\n      this.rowFlags(node).highlight = true;\r\n    }\r\n\r\n    const isGroup = this.renderCtx.isGroup(rowIndex);\r\n\r\n    if (isGroup) {\r\n      node.dataset.agg = 'group';\r\n      super.createRow(node, rowIndex);\r\n      return;\r\n    }\r\n\r\n    const {i, meta} = this.renderCtx.getRow(rowIndex);\r\n    node.classList.toggle('le-highlighted', this.highlight === i);\r\n    node.dataset.i = i.toString();\r\n    node.dataset.agg = 'detail'; //or 'group'\r\n    if (!meta) {\r\n      delete node.dataset.meta;\r\n    } else {\r\n      node.dataset.meta = meta;\r\n    }\r\n\r\n    this.selection.updateState(node, i);\r\n    this.selection.add(node);\r\n\r\n    const lod = this.roptions.levelOfDetail(rowIndex);\r\n\r\n    if (lod === 'high') {\r\n      delete node.dataset.lod;\r\n    } else {\r\n      node.dataset.lod = lod;\r\n    }\r\n\r\n    if (lod === 'high' || meta || this.ctx.provider.isSelected(i)) {\r\n      super.createRow(node, rowIndex);\r\n      return;\r\n    }\r\n\r\n    const canvas = this.selectCanvas();\r\n    node.appendChild(canvas);\r\n    this.renderRow(canvas, rowIndex);\r\n    node.addEventListener('mouseenter', this.canvasMouseHandler.enter, {\r\n      passive: true\r\n    });\r\n  }\r\n\r\n  protected updateRow(node: HTMLElement, rowIndex: number, forcedLod?: 'high' | 'low'): void {\r\n    this.roptions.customRowUpdate(node, rowIndex);\r\n\r\n    const computedLod = this.roptions.levelOfDetail(rowIndex);\r\n    const lod = forcedLod ? forcedLod : computedLod;\r\n    const wasLod = node.dataset.lod || 'high';\r\n    const isGroup = this.renderCtx.isGroup(rowIndex);\r\n    const wasGroup = node.dataset.agg === 'group';\r\n\r\n    if (computedLod === 'high') {\r\n      delete node.dataset.lod;\r\n    } else {\r\n      node.dataset.lod = computedLod;\r\n    }\r\n\r\n    if (this.highlightHandler.enabled && !this.rowFlags(node).highlight) {\r\n      node.addEventListener('mouseenter', this.highlightHandler.enter, {\r\n        passive: true\r\n      });\r\n      this.rowFlags(node).highlight = true;\r\n    }\r\n\r\n    node.removeEventListener('mouseenter', this.canvasMouseHandler.enter);\r\n\r\n    if (isGroup !== wasGroup) {\r\n      // change of mode clear the children to reinitialize them\r\n      node.innerHTML = '';\r\n\r\n      // adapt body\r\n      node.dataset.agg = isGroup ? 'group' : 'detail';\r\n      if (isGroup) {\r\n        node.dataset.i = '';\r\n        this.selection.remove(node);\r\n      } else {\r\n        this.selection.add(node);\r\n      }\r\n    }\r\n\r\n    if (isGroup) {\r\n      node.classList.remove('le-highlighted');\r\n      super.updateRow(node, rowIndex);\r\n      return;\r\n    }\r\n\r\n    const {i, meta} = this.renderCtx.getRow(rowIndex);\r\n    node.classList.toggle('le-highlighted', this.highlight === i);\r\n    node.dataset.i = i.toString();\r\n    if (!meta) {\r\n      delete node.dataset.meta;\r\n    } else {\r\n      node.dataset.meta = meta;\r\n    }\r\n    this.selection.updateState(node, i);\r\n\r\n    const canvas = <HTMLCanvasElement>Array.from(node.children).find((d) => d.classList.contains('lu-detail-canvas'));\r\n    if (lod === 'high' || meta || this.ctx.provider.isSelected(i)) {\r\n      if (canvas) {\r\n        this.canvasPool.push(canvas);\r\n        canvas.remove();\r\n      }\r\n      super.updateRow(node, rowIndex);\r\n      return;\r\n    }\r\n\r\n    node.addEventListener('mouseenter', this.canvasMouseHandler.enter, {\r\n      passive: true\r\n    });\r\n    // use canvas\r\n    if (wasLod !== 'high' && canvas) {\r\n      this.renderRow(canvas, rowIndex);\r\n      return;\r\n    }\r\n    // clear old\r\n    node.innerHTML = '';\r\n    node.dataset.agg = 'detail';\r\n    const canvas2 = this.selectCanvas();\r\n    node.appendChild(canvas2);\r\n    this.renderRow(canvas2, rowIndex);\r\n  }\r\n\r\n  private updateCanvasBody() {\r\n    const width = this.visibleRenderedWidth();\r\n    super.forEachRow((row, index) => {\r\n      if (EngineRanking.isCanvasRenderedRow(row)) {\r\n        this.renderRow(row.querySelector('canvas')!, index, width);\r\n      }\r\n    });\r\n  }\r\n\r\n  protected updateShifts(top: number, left: number) {\r\n    super.updateShifts(top, left);\r\n\r\n    if (left === this.oldLeft) {\r\n      return;\r\n    }\r\n    this.oldLeft = left;\r\n    this.updateCanvasBody();\r\n  }\r\n\r\n  enableHighlightListening(enable: boolean) {\r\n    if (this.highlightHandler.enabled === enable) {\r\n      return;\r\n    }\r\n\r\n    this.highlightHandler.enabled = enable;\r\n\r\n    if (enable) {\r\n      this.body.addEventListener('mouseleave', this.highlightHandler.leave, {\r\n        passive: true\r\n      });\r\n      super.forEachRow((row) => {\r\n        row.addEventListener('mouseenter', this.highlightHandler.enter, {\r\n          passive: true\r\n        });\r\n        this.rowFlags(row).highlight = true;\r\n      });\r\n      return;\r\n    }\r\n\r\n    this.body.removeEventListener('mouseleave', this.highlightHandler.leave);\r\n\r\n    super.forEachRow((row) => {\r\n      row.removeEventListener('mouseenter', this.highlightHandler.enter);\r\n      this.rowFlags(row).highlight = false;\r\n    });\r\n  }\r\n\r\n  private updateHoveredRow(row: HTMLElement, hover: boolean) {\r\n    const isCanvas = EngineRanking.isCanvasRenderedRow(row);\r\n    if (isCanvas !== hover) {\r\n      return; // good nothing to do\r\n    }\r\n    const index = parseInt(row.dataset.index!, 10);\r\n    this.updateRow(row, index, hover ? 'high' : 'low');\r\n  }\r\n\r\n  protected forEachRow(callback: (row: HTMLElement, rowIndex: number) => void, inplace: boolean = false) {\r\n    const adapter = (row: HTMLElement, rowIndex: number) => {\r\n      if (EngineRanking.isCanvasRenderedRow(row)) {\r\n        // skip canvas\r\n        return;\r\n      }\r\n      callback(row, rowIndex);\r\n    };\r\n    return super.forEachRow(adapter, inplace);\r\n  }\r\n\r\n  updateSelection(selectedDataIndices: { has(i: number): boolean }) {\r\n    super.forEachRow((node: HTMLElement, rowIndex: number) => {\r\n      if (this.renderCtx.isGroup(rowIndex)) {\r\n        this.updateRow(node, rowIndex);\r\n      } else {\r\n        // fast pass for item\r\n        this.selection.update(node, selectedDataIndices);\r\n      }\r\n    }, true);\r\n  }\r\n\r\n  updateColumnWidths() {\r\n    // update the column context in place\r\n    (<any>this._context).column = nonUniformContext(this._context.columns.map((w) => w.width), 100, COLUMN_PADDING);\r\n    super.updateColumnWidths();\r\n    const {columns} = this.context;\r\n    //no data update needed since just width changed\r\n    columns.forEach((column) => {\r\n      if (column instanceof MultiLevelRenderColumn) {\r\n        column.updateWidthRule(this.style);\r\n      }\r\n      column.renderers = this.ctx.createRenderer(column.c);\r\n    });\r\n    this.events.fire(EngineRanking.EVENT_WIDTH_CHANGED);\r\n  }\r\n\r\n  private updateHist(col: Column) {\r\n    this.events.fire(EngineRanking.EVENT_UPDATE_HIST, col);\r\n  }\r\n\r\n  private updateColumn(index: number) {\r\n    const columns = this.context.columns;\r\n    const column = columns[index];\r\n    if (!column) {\r\n      return false;\r\n    }\r\n    let x = 0;\r\n    for (let i = this.visibleColumns.first; i < index; ++i) {\r\n      x += columns[i].width + COLUMN_PADDING;\r\n    }\r\n    super.forEachRow((row, rowIndex) => {\r\n      if (EngineRanking.isCanvasRenderedRow(row)) {\r\n        this.updateCanvasCell(row.querySelector('canvas')!, rowIndex, column, x);\r\n        return;\r\n      }\r\n      const before = <HTMLElement>row.children[index];\r\n      if (!before) {\r\n        return; // race condition\r\n      }\r\n      const after = this.updateCell(before, rowIndex, column);\r\n      if (before !== after && after) {\r\n        setColumn(after, column);\r\n        row.replaceChild(after, before);\r\n      }\r\n    });\r\n    return true;\r\n  }\r\n\r\n  destroy() {\r\n    super.destroy();\r\n    this.ranking.flatColumns.forEach((c) => EngineRanking.disableListener(c));\r\n  }\r\n\r\n  groupData(data: IDataRow[]): (IGroupItem | IGroupData)[] {\r\n    const groups = this.ranking.getGroups();\r\n    const provider = this.ctx.provider;\r\n    const toMeta = (relativeIndex: number, length: number): 'first' | 'last' | 'first last' | undefined => {\r\n      if (length === 1) {\r\n        return 'first last';\r\n      }\r\n      if (relativeIndex === 0) {\r\n        return 'first';\r\n      }\r\n      if (relativeIndex === length - 1) {\r\n        return 'last';\r\n      }\r\n      return undefined;\r\n    };\r\n    if (groups.length === 1) {\r\n      // simple case\r\n      if (provider.isAggregated(this.ranking, groups[0])) {\r\n        // just a single row\r\n        return [Object.assign({rows: data}, groups[0])];\r\n      }\r\n      // simple ungrouped case\r\n      return data.map((r, i) => Object.assign({group: groups[0], relativeIndex: i, meta: toMeta(i, data.length)}, r));\r\n    }\r\n\r\n    //multiple groups\r\n    let offset = 0;\r\n    const r = <(IGroupItem | IGroupData)[]>[];\r\n    groups.forEach((group) => {\r\n      const length = group.order.length;\r\n      const groupData = data.slice(offset, offset + length);\r\n      offset += length;\r\n\r\n      if (provider.isAggregated(this.ranking, group)) {\r\n        r.push(Object.assign({rows: groupData}, group));\r\n        return;\r\n      }\r\n      r.push(...groupData.map((r, i) => Object.assign({\r\n        group,\r\n        relativeIndex: i,\r\n        meta: toMeta(i, groupData.length)\r\n      }, r)));\r\n    });\r\n    return r;\r\n  }\r\n\r\n  render(data: (IGroupItem | IGroupData)[], rowContext: IExceptionContext) {\r\n    const previous = this._context;\r\n    const previousData = this.data;\r\n    this.data = data;\r\n    (<any>this.renderCtx).totalNumberOfRows = data.length;\r\n\r\n    this.columns.forEach((c, i) => {\r\n      c.index = i;\r\n      c.renderers = this.ctx.createRenderer(c.c);\r\n    });\r\n    this._context = Object.assign({\r\n      columns: this.columns,\r\n      column: nonUniformContext(this.columns.map((w) => w.width), 100, COLUMN_PADDING)\r\n    }, rowContext);\r\n\r\n    if (!this.bodyScroller) { // somehow not part of dom\r\n      return;\r\n    }\r\n    return super.recreate(this.roptions.animation ? lineupAnimation(previous, previousData, this.data) : undefined);\r\n  }\r\n\r\n  setHighlight(dataIndex: number) {\r\n    this.highlight = dataIndex;\r\n    const old = this.body.querySelector(`[data-i].le-highlighted`);\r\n    if (old) {\r\n      old.classList.remove('le-highlighted');\r\n    }\r\n    if (dataIndex < 0) {\r\n      return;\r\n    }\r\n    const item = this.body.querySelector(`[data-i=\"${dataIndex}\"]`);\r\n    if (item) {\r\n      item.classList.add('le-highlighted');\r\n    }\r\n    return item != null;\r\n  }\r\n\r\n  findNearest(dataIndices: number[]) {\r\n    // find the nearest visible data index\r\n    // first check if already visible\r\n    const index = dataIndices.find((d) => Boolean(this.body.querySelectorAll(`[data-i=\"${d}\"]`)));\r\n    if (index != null) {\r\n      return index; // visible one\r\n    }\r\n    const visible = this.visible;\r\n    const lookFor = new Set(dataIndices);\r\n    let firstBeforePos = -1;\r\n    let firstAfterPos = -1;\r\n    for (let i = visible.first; i >= 0; --i) {\r\n      const d = this.data[i];\r\n      if (!isGroup(d) && lookFor.has(d.i)) {\r\n        firstBeforePos = i;\r\n        break;\r\n      }\r\n    }\r\n    for (let i = visible.last; i < this.data.length; ++i) {\r\n      const d = this.data[i];\r\n      if (!isGroup(d) && lookFor.has(d.i)) {\r\n        firstAfterPos = i;\r\n        break;\r\n      }\r\n    }\r\n\r\n    if (firstBeforePos < 0 && firstBeforePos < 0) {\r\n      return -1; // not found at all\r\n    }\r\n    const nearestPos = (firstBeforePos >= 0 && (visible.first - firstBeforePos) < (firstAfterPos - visible.last)) ? firstBeforePos : firstAfterPos;\r\n    return (<IGroupItem>this.data[nearestPos]).i;\r\n  }\r\n\r\n  scrollIntoView(dataIndex: number) {\r\n    const item = this.body.querySelector(`[data-i=\"${dataIndex}\"]`);\r\n    if (item) {\r\n      item.scrollIntoView(true);\r\n      return true;\r\n    }\r\n    const index = this.data.findIndex((d) => !isGroup(d) && d.i === dataIndex);\r\n    if (index < 0) {\r\n      return false; // part of a group?\r\n    }\r\n\r\n    const posOf = () => {\r\n      const c = this._context;\r\n      if (c.exceptions.length === 0 || index < c.exceptions[0].index) {\r\n        // fast pass\r\n        return index * c.defaultRowHeight;\r\n      }\r\n      const before = c.exceptions.reverse().find((d) => d.index <= index);\r\n      if (!before) {\r\n        return -1;\r\n      }\r\n      if (before.index === index) {\r\n        return before.y;\r\n      }\r\n      const regular = index - before.index - 1;\r\n      return before.y2 + regular * c.defaultRowHeight;\r\n    };\r\n    const pos = posOf();\r\n    if (pos < 0) {\r\n      return false;\r\n    }\r\n    const scroller = this.bodyScroller;\r\n    if (!scroller) {\r\n      return false;\r\n    }\r\n    const top = scroller.scrollTop;\r\n    scroller.scrollTop = Math.min(pos, scroller.scrollHeight - scroller.clientHeight);\r\n    this.onScrolledVertically(scroller.scrollTop, scroller.clientHeight, top < scroller.scrollTop);\r\n\r\n    const found = this.body.querySelector(`[data-i=\"${dataIndex}\"]`);\r\n    if (found) {\r\n      found.scrollIntoView(true);\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  getHighlight() {\r\n    const item = <HTMLElement>this.body.querySelector(`[data-i]:hover, [data-i].le-highlighted`);\r\n    if (item) {\r\n      return parseInt(item.dataset.i!, 10);\r\n    }\r\n    return this.highlight;\r\n  }\r\n\r\n  private createCol(c: Column, index: number) {\r\n    const col = (isMultiLevelColumn(c) && !c.getCollapsed()) ? new MultiLevelRenderColumn(c, index, this.renderCtx, this.roptions.flags) : new RenderColumn(c, index, this.renderCtx, this.roptions.flags);\r\n\r\n    c.on(`${Column.EVENT_WIDTH_CHANGED}.body`, () => {\r\n      this.delayedUpdateColumnWidths();\r\n    });\r\n    c.on(`${ValueColumn.EVENT_DATA_LOADED}.hist`, () => this.updateHist(c));\r\n    const debounceUpdate = debounce(() => {\r\n      const valid = this.updateColumn(col.index);\r\n      if (!valid) {\r\n        EngineRanking.disableListener(c); // destroy myself\r\n      }\r\n    }, 25);\r\n    c.on([`${Column.EVENT_RENDERER_TYPE_CHANGED}.body`, `${Column.EVENT_GROUP_RENDERER_TYPE_CHANGED}.body`], () => {\r\n      // replace myself upon renderer type change\r\n      col.renderers = this.ctx.createRenderer(c);\r\n      debounceUpdate();\r\n    });\r\n    const that = this;\r\n    c.on(`${Column.EVENT_DIRTY_HEADER}.body`, function (this: IEventContext) {\r\n      const valid = that.updateHeaderOf(col.c);\r\n      if (!valid) {\r\n        EngineRanking.disableListener(c); // destroy myself\r\n      }\r\n      if (this.primaryType === Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED || this.primaryType === Column.EVENT_LABEL_CHANGED || this.primaryType === Column.EVENT_METADATA_CHANGED) {\r\n        return;\r\n      }\r\n      self.setTimeout(() => that.updateHist(col.c), 50);\r\n    });\r\n    c.on(`${Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED}.body`, () => {\r\n      // replace myself upon renderer type change\r\n      col.renderers = this.ctx.createRenderer(c);\r\n      const valid = this.updateHeaderOf(col.c);\r\n      if (!valid) {\r\n        EngineRanking.disableListener(c); // destroy myself\r\n      }\r\n    });\r\n    c.on(`${Column.EVENT_DIRTY_VALUES}.body`, debounceUpdate);\r\n\r\n    if (isMultiLevelColumn(c) && !c.getCollapsed()) {\r\n      (<MultiLevelRenderColumn>col).updateWidthRule(this.style);\r\n      c.on(`${StackColumn.EVENT_MULTI_LEVEL_CHANGED}.body`, () => {\r\n        (<MultiLevelRenderColumn>col).updateWidthRule(this.style);\r\n      });\r\n      c.on(`${StackColumn.EVENT_MULTI_LEVEL_CHANGED}.bodyUpdate`, debounceUpdate);\r\n    }\r\n\r\n    return col;\r\n  }\r\n\r\n  private static isCanvasRenderedRow(row: HTMLElement) {\r\n    return row.dataset.lod === 'low' && row.childElementCount === 1 && row.firstElementChild!.classList.contains('lu-detail-canvas');\r\n  }\r\n\r\n  private static disableListener(c: Column) {\r\n    c.on(`${Column.EVENT_WIDTH_CHANGED}.body`, null);\r\n    c.on(`${ValueColumn.EVENT_DATA_LOADED}.hist`, null);\r\n    c.on([`${Column.EVENT_RENDERER_TYPE_CHANGED}.body`, `${Column.EVENT_GROUP_RENDERER_TYPE_CHANGED}.body`, `${Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED}.body`, `${Column.EVENT_LABEL_CHANGED}.body`], null);\r\n    c.on(`${Ranking.EVENT_DIRTY_HEADER}.body`, null);\r\n    c.on(`${Ranking.EVENT_DIRTY_VALUES}.body`, null);\r\n\r\n    if (!(isMultiLevelColumn(c))) {\r\n      return;\r\n    }\r\n    c.on(`${StackColumn.EVENT_MULTI_LEVEL_CHANGED}.body`, null);\r\n    c.on(`${StackColumn.EVENT_MULTI_LEVEL_CHANGED}.bodyUpdate`, null);\r\n  }\r\n}\r\n","interface IDebounceContext {\r\n  self: any;\r\n  args: any[];\r\n}\r\n\r\n/**\r\n * create a delayed call, can be called multiple times but only the last one at most delayed by timeToDelay will be executed\r\n * @param {(...args: any[]) => void} callback the callback to call\r\n * @param {number} timeToDelay delay the call in milliseconds\r\n * @return {(...args: any[]) => any} a function that can be called with the same interface as the callback but delayed\r\n * @internal\r\n */\r\nexport default function debounce(callback: (...args: any[]) => void, timeToDelay = 100, choose?: (current: IDebounceContext, next: IDebounceContext) => IDebounceContext) {\r\n  let tm = -1;\r\n  let ctx: IDebounceContext | null = null;\r\n  return function (this: any, ...args: any[]) {\r\n    if (tm >= 0) {\r\n      clearTimeout(tm);\r\n      tm = -1;\r\n    }\r\n    const next = {self: this, args};\r\n    ctx = ctx && choose ? choose(ctx, next) : next;\r\n    tm = self.setTimeout(() => {\r\n      console.assert(ctx != null);\r\n      callback.call(ctx!.self, ...ctx!.args);\r\n      ctx = null;\r\n    }, timeToDelay);\r\n  };\r\n}\r\n","import {IDataRow, IGroup} from '../model';\r\nimport {default as ActionColumn} from '../model/ActionColumn';\r\nimport Column from '../model/Column';\r\nimport {ERenderMode, ICellRendererFactory, ICellRenderer, IGroupCellRenderer, ISummaryRenderer} from './interfaces';\r\nimport {forEachChild, noop, noRenderer} from './utils';\r\n\r\nexport default class ActionRenderer implements ICellRendererFactory {\r\n  readonly title: string = 'Default';\r\n\r\n  canRender(col: Column, mode: ERenderMode): boolean {\r\n    return col instanceof ActionColumn && mode !== ERenderMode.SUMMARY;\r\n  }\r\n\r\n  create(col: ActionColumn): ICellRenderer {\r\n    const actions = col.actions;\r\n    return {\r\n      template: `<div class='actions lu-hover-only'>${actions.map((a) => `<span title='${a.name}' class='${a.className || ''}'>${a.icon || ''}</span>`).join('')}</div>`,\r\n      update: (n: HTMLElement, d: IDataRow) => {\r\n        forEachChild(n, (ni: HTMLSpanElement, i: number) => {\r\n          ni.onclick = function (event) {\r\n            event.preventDefault();\r\n            event.stopPropagation();\r\n            actions[i].action(d);\r\n          };\r\n        });\r\n      },\r\n      render: noop\r\n    };\r\n  }\r\n\r\n  createGroup(col: ActionColumn): IGroupCellRenderer {\r\n    const actions = col.groupActions;\r\n    return {\r\n      template: `<div class='actions lu-hover-only'>${actions.map((a) => `<span title='${a.name}' class='${a.className || ''}'>${a.icon || ''}</span>`).join('')}</div>`,\r\n      update: (n: HTMLElement, group: IGroup, rows: IDataRow[]) => {\r\n        forEachChild(n, (ni: HTMLSpanElement, i: number) => {\r\n          ni.onclick = function (event) {\r\n            event.preventDefault();\r\n            event.stopPropagation();\r\n            actions[i].action(group, rows);\r\n          };\r\n        });\r\n      }\r\n    };\r\n  }\r\n\r\n  createSummary(): ISummaryRenderer {\r\n    return noRenderer;\r\n  }\r\n}\r\n","import {IDataRow, IGroup} from '../model';\r\nimport AggregateGroupColumn from '../model/AggregateGroupColumn';\r\nimport Column from '../model/Column';\r\nimport {AGGREGATE, CANVAS_HEIGHT} from '../styles';\r\nimport {default as IRenderContext, ICellRendererFactory, ICellRenderer, IGroupCellRenderer, ISummaryRenderer} from './interfaces';\r\n\r\nexport default class AggregateGroupRenderer implements ICellRendererFactory {\r\n  readonly title: string = 'Default';\r\n\r\n  canRender(col: Column): boolean {\r\n    return col instanceof AggregateGroupColumn;\r\n  }\r\n\r\n  create(col: AggregateGroupColumn, context: IRenderContext): ICellRenderer {\r\n    const width = context.colWidth(col);\r\n    return {\r\n      template: `<div title=\"Collapse Group\"></div>`,\r\n      update(node: HTMLElement, _row: IDataRow, _i: number, group: IGroup) {\r\n        node.onclick = function (event) {\r\n          event.preventDefault();\r\n          event.stopPropagation();\r\n          col.setAggregated(group, true);\r\n        };\r\n      },\r\n      render: (ctx: CanvasRenderingContext2D) => {\r\n        ctx.fillStyle = AGGREGATE.color;\r\n        // weird shift of 1\r\n        ctx.fillRect(width - AGGREGATE.width - 1, 0, AGGREGATE.strokeWidth, CANVAS_HEIGHT);\r\n      }\r\n    };\r\n  }\r\n\r\n  createGroup(col: AggregateGroupColumn): IGroupCellRenderer {\r\n    return {\r\n      template: `<div title=\"Expand Group\"></div>`,\r\n      update(node: HTMLElement, group: IGroup) {\r\n        node.onclick = function (event) {\r\n          event.preventDefault();\r\n          event.stopPropagation();\r\n          col.setAggregated(group, false);\r\n        };\r\n      }\r\n    };\r\n  }\r\n\r\n  createSummary(col: AggregateGroupColumn, context: IRenderContext): ISummaryRenderer {\r\n    return {\r\n      template: `<div title=\"(Un)Aggregate All\" data-icon=\"caret-down\"></div>`,\r\n      update: (node: HTMLElement) => {\r\n        const ranking = col.findMyRanker();\r\n        const right = Boolean(ranking && ranking.getGroups().every((g) => col.isAggregated(g)));\r\n\r\n        node.dataset.icon = right ? 'caret-right' : 'caret-down';\r\n\r\n        node.onclick = (evt) => {\r\n          evt.stopPropagation();\r\n          const ranking = col.findMyRanker();\r\n          if (!ranking || !context) {\r\n            return;\r\n          }\r\n          const aggregate = node.dataset.icon === 'caret-down';\r\n          node.dataset.icon = aggregate ? 'caret-right' : 'caret-down';\r\n          context.provider.aggregateAllOf(ranking, aggregate);\r\n        };\r\n      }\r\n    };\r\n  }\r\n}\r\n","import {IDataRow, IGroup} from '../model';\r\nimport Column from '../model/Column';\r\nimport StringColumn from '../model/StringColumn';\r\nimport {filterMissingMarkup, findFilterMissing} from '../ui/missing';\r\nimport {default as IRenderContext, ICellRendererFactory, ICellRenderer, IGroupCellRenderer, ISummaryRenderer} from './interfaces';\r\nimport {renderMissingDOM} from './missing';\r\nimport {noop, setText, uniqueId, exampleText} from './utils';\r\n\r\n\r\n/**\r\n * renders a string with additional alignment behavior\r\n * one instance factory shared among strings\r\n */\r\nexport default class StringCellRenderer implements ICellRendererFactory {\r\n  readonly title: string = 'Default';\r\n\r\n  canRender(col: Column): boolean {\r\n    return col instanceof StringColumn;\r\n  }\r\n\r\n  create(col: StringColumn): ICellRenderer {\r\n    const align = col.alignment || 'left';\r\n    return {\r\n      template: `<div${align !== 'left' ? ` class=\"lu-${align}\"` : ''}> </div>`,\r\n      update: (n: HTMLDivElement, d: IDataRow) => {\r\n        renderMissingDOM(n, col, d);\r\n        if (col.escape) {\r\n          setText(n, col.getLabel(d));\r\n        } else {\r\n          n.innerHTML = col.getLabel(d);\r\n        }\r\n        n.title = n.textContent!;\r\n      },\r\n      render: noop\r\n    };\r\n  }\r\n\r\n\r\n  createGroup(col: StringColumn): IGroupCellRenderer {\r\n    return {\r\n      template: `<div> </div>`,\r\n      update: (n: HTMLDivElement, _group: IGroup, rows: IDataRow[]) => {\r\n        const v = exampleText(col, rows);\r\n        if (col.escape) {\r\n          setText(n, v);\r\n        } else {\r\n          n.innerHTML = v;\r\n          n.title = v;\r\n        }\r\n      }\r\n    };\r\n  }\r\n\r\n  private static interactiveSummary(col: StringColumn, node: HTMLElement) {\r\n    const form = <HTMLFormElement>node;\r\n    const filterMissing = findFilterMissing(node);\r\n    const input = <HTMLInputElement>node.querySelector('input[type=\"text\"]');\r\n    const isRegex = <HTMLInputElement>node.querySelector('input[type=\"checkbox\"]');\r\n\r\n    const update = () => {\r\n      input.disabled = filterMissing.checked;\r\n      isRegex.disabled = filterMissing.checked;\r\n\r\n      if (filterMissing.checked) {\r\n        col.setFilter(StringColumn.FILTER_MISSING);\r\n        return;\r\n      }\r\n      const valid = input.value.trim();\r\n      filterMissing.disabled = valid.length > 0;\r\n      if (valid.length <= 0) {\r\n        col.setFilter(null);\r\n        return;\r\n      }\r\n      col.setFilter(isRegex.checked ? new RegExp(input.value) : input.value);\r\n    };\r\n\r\n    filterMissing.onchange = update;\r\n    input.onchange = update;\r\n    isRegex.onchange = update;\r\n    form.onsubmit = (evt) => {\r\n      evt.preventDefault();\r\n      evt.stopPropagation();\r\n      update();\r\n      return false;\r\n    };\r\n\r\n    return (actCol: StringColumn) => {\r\n      col = actCol;\r\n      let bak = col.getFilter() || '';\r\n      const bakMissing = bak === StringColumn.FILTER_MISSING;\r\n      if (bakMissing) {\r\n        bak = '';\r\n      }\r\n      filterMissing.checked = bakMissing;\r\n      input.value = bak instanceof RegExp ? bak.source : bak;\r\n      isRegex.checked = bak instanceof RegExp;\r\n      filterMissing.disabled = input.value.trim().length > 0;\r\n      input.disabled = filterMissing.checked;\r\n      isRegex.disabled = filterMissing.checked;\r\n    };\r\n  }\r\n\r\n  createSummary(col: StringColumn, context: IRenderContext, interactive: boolean): ISummaryRenderer {\r\n    if (!interactive) {\r\n      return {\r\n        template: `<div></div>`,\r\n        update: (node: HTMLElement) => {\r\n          const filter = col.getFilter() || '';\r\n          node.textContent = toString(filter);\r\n        }\r\n      };\r\n    }\r\n    let bak = col.getFilter() || '';\r\n    const bakMissing = bak === StringColumn.FILTER_MISSING;\r\n    if (bakMissing) {\r\n      bak = '';\r\n    }\r\n    let update: (col: StringColumn) => void;\r\n    const id = uniqueId(context.idPrefix);\r\n    return {\r\n      template: `<form><input type=\"text\" placeholder=\"Filter ${col.desc.label}...\" autofocus value=\"${(bak instanceof RegExp) ? bak.source : bak}\">\r\n          <div class=\"lu-checkbox\"><input id=\"${id}\" type=\"checkbox\" ${(bak instanceof RegExp) ? 'checked=\"checked\"' : ''}><label for=\"${id}\">Use regular expressions</label></div>\r\n          ${filterMissingMarkup(bakMissing, context.idPrefix)}</form>`,\r\n      update: (node: HTMLElement) => {\r\n        if (!update) {\r\n          update = StringCellRenderer.interactiveSummary(col, node);\r\n        }\r\n        update(col);\r\n      }\r\n    };\r\n  }\r\n}\r\n\r\nfunction toString(filter: null | string | RegExp) {\r\n  if (filter == null || filter === '' || filter === StringColumn.FILTER_MISSING) {\r\n    return '';\r\n  }\r\n  if (filter instanceof RegExp) {\r\n    return filter.source;\r\n  }\r\n  return String(filter);\r\n}\r\n","import {IDataRow} from '../model';\r\nimport AnnotateColumn from '../model/AnnotateColumn';\r\nimport Column from '../model/Column';\r\nimport StringCellRenderer from './StringCellRenderer';\r\nimport {noop} from './utils';\r\nimport {ICellRenderer} from './interfaces';\r\n\r\nexport default class AnnotationRenderer extends StringCellRenderer {\r\n  readonly title: string = 'Default';\r\n\r\n  canRender(col: Column): boolean {\r\n    return super.canRender(col) && col instanceof AnnotateColumn;\r\n  }\r\n\r\n  create(col: AnnotateColumn): ICellRenderer {\r\n    return {\r\n      template: `<div class='annotations text'>\r\n        <input class='lu-hover-only'>\r\n        <span class='text lu-not-hover'></span>\r\n       </div>`,\r\n      update: (n: HTMLElement, d: IDataRow) => {\r\n        const input: HTMLInputElement = <HTMLInputElement>n.firstElementChild!;\r\n        input.onchange = () => {\r\n          col.setValue(d, input.value);\r\n        };\r\n        input.onclick = (event) => {\r\n          event.stopPropagation();\r\n        };\r\n        n.lastElementChild!.textContent = input.value = col.getLabel(d);\r\n      },\r\n      render: noop\r\n    };\r\n  }\r\n}\r\n","import {IDataRow} from '../model';\r\nimport Column from '../model/Column';\r\nimport {IImposer} from './interfaces';\r\nimport {isMapAbleColumn} from '../model/MappingFunction';\r\n\r\nexport function colorOf(col: Column, row: IDataRow | null, imposer?: IImposer, valueHint?: number) {\r\n  if (imposer && imposer.color) {\r\n    return imposer.color(row, valueHint);\r\n  }\r\n  if (!row) {\r\n    if (isMapAbleColumn(col)) {\r\n      return col.getColorMapping().apply(valueHint != null ? valueHint : 0);\r\n    }\r\n    return Column.DEFAULT_COLOR;\r\n  }\r\n  return col.getColor(row);\r\n}\r\n","import {ICategoricalStatistics, IStatistics} from '../internal';\r\nimport {IDataRow, INumberColumn, isNumberColumn} from '../model';\r\nimport Column from '../model/Column';\r\nimport {setText, adaptDynamicColorToBgColor, noRenderer} from './utils';\r\nimport {isNumbersColumn} from '../model';\r\nimport {CANVAS_HEIGHT} from '../styles';\r\nimport {colorOf} from './impose';\r\nimport {default as IRenderContext, ERenderMode, ICellRendererFactory, IImposer, IGroupCellRenderer, ISummaryRenderer, ICellRenderer} from './interfaces';\r\nimport {renderMissingCanvas, renderMissingDOM} from './missing';\r\n\r\n\r\nexport default class BarCellRenderer implements ICellRendererFactory {\r\n  readonly title: string = 'Bar';\r\n\r\n  /**\r\n   * flag to always render the value\r\n   * @type {boolean}\r\n   */\r\n\r\n  constructor(private readonly renderValue: boolean = false) {\r\n  }\r\n\r\n  canRender(col: Column, mode: ERenderMode): boolean {\r\n    return mode === ERenderMode.CELL && isNumberColumn(col) && !isNumbersColumn(col);\r\n  }\r\n\r\n  create(col: INumberColumn, context: IRenderContext, _hist: IStatistics | ICategoricalStatistics | null, imposer?: IImposer): ICellRenderer {\r\n    const width = context.colWidth(col);\r\n    return {\r\n      template: `<div title=\"\">\r\n          <div style='background-color: ${Column.DEFAULT_COLOR}'>\r\n            <span ${this.renderValue ? '' : 'class=\"lu-hover-only\"'}></span>\r\n          </div>\r\n        </div>`,\r\n      update: (n: HTMLDivElement, d: IDataRow) => {\r\n        const value = col.getNumber(d);\r\n        const missing = renderMissingDOM(n, col, d);\r\n        const w = isNaN(value) ? 0 : Math.round(value * 100 * 100) / 100;\r\n        const title = col.getLabel(d);\r\n        n.title = title;\r\n\r\n        const bar = <HTMLElement>n.firstElementChild!;\r\n        bar.style.width = missing ? '100%' : `${w}%`;\r\n        const color = colorOf(col, d, imposer, value);\r\n        bar.style.backgroundColor = missing ? null : color;\r\n        setText(bar.firstElementChild!, title);\r\n        const item = <HTMLElement>bar.firstElementChild!;\r\n        setText(item, title);\r\n        adaptDynamicColorToBgColor(item, color || Column.DEFAULT_COLOR, title, w / 100);\r\n      },\r\n      render: (ctx: CanvasRenderingContext2D, d: IDataRow) => {\r\n        if (renderMissingCanvas(ctx, col, d, width)) {\r\n          return;\r\n        }\r\n        const value = col.getNumber(d);\r\n        ctx.fillStyle = colorOf(col, d, imposer, value) || Column.DEFAULT_COLOR;\r\n        const w = width * value;\r\n        ctx.fillRect(0, 0, isNaN(w) ? 0 : w, CANVAS_HEIGHT);\r\n      }\r\n    };\r\n  }\r\n\r\n  createGroup(): IGroupCellRenderer {\r\n    return noRenderer;\r\n  }\r\n\r\n  createSummary(): ISummaryRenderer {\r\n    return noRenderer;\r\n  }\r\n}\r\n","import {IDataRow} from '../model';\r\nimport Column from '../model/Column';\r\nimport {ERenderMode, ICellRendererFactory, IGroupCellRenderer, ISummaryRenderer, ICellRenderer} from './interfaces';\r\nimport {renderMissingDOM} from './missing';\r\nimport {noop, noRenderer, setText} from './utils';\r\n\r\n/**\r\n * default renderer instance rendering the value as a text\r\n */\r\nexport class DefaultCellRenderer implements ICellRendererFactory {\r\n  title: string = 'String';\r\n  groupTitle: string = 'None';\r\n  summaryTitle: string = 'None';\r\n\r\n  canRender(_col: Column, _mode: ERenderMode): boolean {\r\n    return true;\r\n  }\r\n\r\n  create(col: Column): ICellRenderer {\r\n    return {\r\n      template: `<div> </div>`,\r\n      update: (n: HTMLDivElement, d: IDataRow) => {\r\n        renderMissingDOM(n, col, d);\r\n        setText(n, col.getLabel(d));\r\n      },\r\n      render: noop\r\n    };\r\n  }\r\n\r\n  createGroup(_col: Column): IGroupCellRenderer {\r\n    return noRenderer;\r\n  }\r\n\r\n  createSummary(): ISummaryRenderer {\r\n    return noRenderer;\r\n  }\r\n}\r\n","import BooleanColumn from '../model/BooleanColumn';\r\nimport Column from '../model/Column';\r\nimport {DefaultCellRenderer} from './DefaultCellRenderer';\r\nimport {ERenderMode, ICellRenderer} from './interfaces';\r\n\r\nexport default class BooleanCellRenderer extends DefaultCellRenderer {\r\n  readonly title: string = 'Default';\r\n\r\n  canRender(col: Column, mode: ERenderMode): boolean {\r\n    return col instanceof BooleanColumn && mode === ERenderMode.CELL;\r\n  }\r\n\r\n  create(col: Column): ICellRenderer {\r\n    const r = super.create(col);\r\n    (<any>r).template = `<div class=\"lu-center\"> </div>`;\r\n    return r;\r\n  }\r\n}\r\n","import {IBoxPlotData, ICategoricalStatistics, IStatistics, LazyBoxPlotData, IAdvancedBoxPlotData, round} from '../internal';\r\nimport {IDataRow, IGroup, isNumberColumn} from '../model';\r\nimport {default as BoxPlotColumn} from '../model/BoxPlotColumn';\r\nimport Column from '../model/Column';\r\nimport {IBoxPlotColumn, INumberColumn, INumbersColumn, isBoxPlotColumn, isNumbersColumn} from '../model/INumberColumn';\r\nimport NumberColumn from '../model/NumberColumn';\r\nimport {BOX_PLOT, CANVAS_HEIGHT, DOT} from '../styles';\r\nimport {colorOf} from './impose';\r\nimport {default as IRenderContext, ERenderMode, ICellRendererFactory, IImposer} from './interfaces';\r\nimport {renderMissingCanvas, renderMissingDOM} from './missing';\r\nimport {isMapAbleColumn} from '../model/MappingFunction';\r\n\r\nexport function computeLabel(v: IBoxPlotData | IAdvancedBoxPlotData) {\r\n  if (v == null) {\r\n    return '';\r\n  }\r\n  const f = BoxPlotColumn.DEFAULT_FORMATTER;\r\n  const mean = (<IAdvancedBoxPlotData>v).mean != null ? `mean = ${f((<IAdvancedBoxPlotData>v).mean)}\\n` : '';\r\n  return `min = ${f(v.min)}\\nq1 = ${f(v.q1)}\\nmedian = ${f(v.median)}\\n${mean}q3 = ${f(v.q3)}\\nmax = ${f(v.max)}`;\r\n}\r\n\r\nexport default class BoxplotCellRenderer implements ICellRendererFactory {\r\n  readonly title: string = 'Box Plot';\r\n\r\n  canRender(col: Column, mode: ERenderMode) {\r\n    return (isBoxPlotColumn(col) && mode === ERenderMode.CELL || (isNumberColumn(col) && mode !== ERenderMode.CELL));\r\n  }\r\n\r\n  create(col: IBoxPlotColumn, context: IRenderContext, _hist: IStatistics | ICategoricalStatistics | null, imposer?: IImposer) {\r\n    const sortMethod = <keyof IBoxPlotData>col.getSortMethod();\r\n    const sortedByMe = col.isSortedByMe().asc !== undefined;\r\n    const width = context.colWidth(col);\r\n    return {\r\n      template: `<div title=\"\">\r\n                    <div><div></div><div></div></div>\r\n                 </div>`,\r\n      update: (n: HTMLElement, d: IDataRow) => {\r\n        const data = col.getBoxPlotData(d);\r\n        if (!data || col.isMissing(d)) {\r\n          n.classList.add('lu-missing');\r\n          return;\r\n        }\r\n        n.classList.remove('lu-missing');\r\n        const label = col.getRawBoxPlotData(d)!;\r\n        renderDOMBoxPlot(n, data!, label, sortedByMe ? sortMethod : '', colorOf(col, d, imposer));\r\n      },\r\n      render: (ctx: CanvasRenderingContext2D, d: IDataRow) => {\r\n        if (renderMissingCanvas(ctx, col, d, width)) {\r\n          return;\r\n        }\r\n\r\n        // Rectangle\r\n        const data = col.getBoxPlotData(d);\r\n        if (!data) {\r\n          return;\r\n        }\r\n\r\n        const scaled = {\r\n          min: data.min * width,\r\n          median: data.median * width,\r\n          q1: data.q1 * width,\r\n          q3: data.q3 * width,\r\n          max: data.max * width,\r\n          outlier: data.outlier ? data.outlier.map((d) => d * width) : undefined,\r\n          whiskerLow: data.whiskerLow != null ? data.whiskerLow * width : undefined,\r\n          whiskerHigh: data.whiskerHigh != null ? data.whiskerHigh * width : undefined\r\n        };\r\n        renderBoxPlot(ctx, scaled, sortedByMe ? sortMethod : '', colorOf(col, d, imposer), CANVAS_HEIGHT, 0);\r\n      }\r\n    };\r\n  }\r\n\r\n  private static createAggregatedBoxPlot(col: INumbersColumn, rows: IDataRow[], raw = false): IBoxPlotData {\r\n    // concat all values\r\n    const vs = (<number[]>[]).concat(...rows.map((r) => (raw ? col.getRawNumbers(r) : col.getNumber(r))));\r\n    return new LazyBoxPlotData(vs);\r\n  }\r\n\r\n  createGroup(col: INumberColumn, _context: IRenderContext, _hist: IStatistics | ICategoricalStatistics | null, imposer?: IImposer) {\r\n    const sort = (col instanceof NumberColumn && col.isGroupSortedByMe().asc !== undefined) ? col.getSortMethod() : '';\r\n    return {\r\n      template: `<div title=\"\">\r\n                    <div><div></div><div></div></div>\r\n                 </div>`,\r\n      update: (n: HTMLElement, _group: IGroup, rows: IDataRow[]) => {\r\n        if (rows.every((row) => col.isMissing(row))) {\r\n          renderMissingDOM(n, col, rows[0]); // doesn't matter since all\r\n          return;\r\n        }\r\n        n.classList.remove('lu-missing');\r\n\r\n        let box: IBoxPlotData, label: IBoxPlotData;\r\n\r\n        if (isNumbersColumn(col)) {\r\n          box = BoxplotCellRenderer.createAggregatedBoxPlot(col, rows);\r\n          label = BoxplotCellRenderer.createAggregatedBoxPlot(col, rows, true);\r\n        } else {\r\n          box = new LazyBoxPlotData(rows.map((row) => col.getNumber(row)));\r\n          label = new LazyBoxPlotData(rows.map((row) => col.getRawNumber(row)));\r\n        }\r\n        renderDOMBoxPlot(n, box, label, sort, colorOf(col, null, imposer));\r\n      }\r\n    };\r\n  }\r\n\r\n  createSummary(col: INumberColumn, _comtext: IRenderContext, _interactive: boolean, imposer?: IImposer) {\r\n    let template = `<div title=\"\">\r\n    <div><div></div><div></div></div>`;\r\n    if (isMapAbleColumn(col)) {\r\n      const range = col.getRange();\r\n      template += `<span>${range[0]}</span><span>${range[1]}</span>`;\r\n    }\r\n    template += '</div>';\r\n\r\n    return {\r\n      template,\r\n      update: (n: HTMLElement, hist: IStatistics | null) => {\r\n        if (hist == null || hist.count === 0) {\r\n          n.classList.add('lu-missing');\r\n          return;\r\n        }\r\n        n.classList.remove('lu-missing');\r\n        const sort = (col instanceof NumberColumn && col.isGroupSortedByMe().asc !== undefined) ? col.getSortMethod() : '';\r\n\r\n        if (isMapAbleColumn(col)) {\r\n          const range = col.getRange();\r\n          Array.from(n.querySelectorAll('span')).forEach((d: HTMLElement, i) => d.textContent = range[i]);\r\n        }\r\n\r\n        renderDOMBoxPlot(n, hist, hist, sort, colorOf(col, null, imposer), isMapAbleColumn(col));\r\n      }\r\n    };\r\n  }\r\n}\r\n\r\nfunction renderDOMBoxPlot(n: HTMLElement, data: IBoxPlotData, label: IBoxPlotData, sort: string, color: string | null, hasRange: boolean = false) {\r\n  n.title = computeLabel(label);\r\n\r\n  const whiskers = <HTMLElement>n.firstElementChild;\r\n  const box = <HTMLElement>whiskers.firstElementChild;\r\n  const median = <HTMLElement>whiskers.lastElementChild;\r\n\r\n  const leftWhisker = data.whiskerLow != null ? data.whiskerLow : Math.max(data.q1 - 1.5 * (data.q3 - data.q1), data.min);\r\n  const rightWhisker = data.whiskerHigh != null ? data.whiskerHigh : Math.min(data.q3 + 1.5 * (data.q3 - data.q1), data.max);\r\n  whiskers.style.left = `${round(leftWhisker * 100, 2)}%`;\r\n  const range = rightWhisker - leftWhisker;\r\n  whiskers.style.width = `${round(range * 100, 2)}%`;\r\n\r\n  //relative within the whiskers\r\n  box.style.left = `${round((data.q1 - leftWhisker) / range * 100, 2)}%`;\r\n  box.style.width = `${round((data.q3 - data.q1) / range * 100, 2)}%`;\r\n  box.style.backgroundColor = color;\r\n\r\n  //relative within the whiskers\r\n  median.style.left = `${round((data.median - leftWhisker) / range * 100, 2)}%`;\r\n\r\n  // match lengths\r\n  const outliers = <HTMLElement[]>Array.from(n.children).slice(1, hasRange ? -2 : undefined);\r\n  const numOutliers = data.outlier ? data.outlier.length : 0;\r\n  outliers.splice(numOutliers, outliers.length - numOutliers).forEach((v) => v.remove());\r\n\r\n  whiskers.dataset.sort = sort;\r\n\r\n  if (!data.outlier || numOutliers === 0) {\r\n    return;\r\n  }\r\n\r\n  for (let i = outliers.length; i < numOutliers; ++i) {\r\n    console.assert(n.ownerDocument != null);\r\n    const p = n.ownerDocument!.createElement('div');\r\n    outliers.unshift(p);\r\n    whiskers.insertAdjacentElement('afterend', p);\r\n  }\r\n\r\n  data.outlier.forEach((v, i) => {\r\n    delete outliers[i].dataset.sort;\r\n    outliers[i].style.left = `${round(v * 100, 2)}%`;\r\n  });\r\n\r\n  if (sort === 'min' && data.outlier[0] <= leftWhisker) {\r\n    // first outliers is the min\r\n    whiskers.dataset.sort = '';\r\n    outliers[0].dataset.sort = 'min';\r\n    if (outliers.length > 1) {\r\n      // append at the end of the DOM to be on top\r\n      outliers[outliers.length - 1].insertAdjacentElement('afterend', outliers[0]);\r\n    }\r\n  } else if (sort === 'max' && data.outlier[outliers.length - 1] >= rightWhisker) {\r\n    // last outlier is the max\r\n    whiskers.dataset.sort = '';\r\n    outliers[outliers.length - 1].dataset.sort = 'max';\r\n  }\r\n}\r\n\r\nfunction renderBoxPlot(ctx: CanvasRenderingContext2D, box: IBoxPlotData, sort: string, color: string | null, height: number, topPadding: number) {\r\n  const left = box.whiskerLow != null ? box.whiskerLow : Math.max((box.q1 - 1.5 * (box.q3 - box.q1)), box.min);\r\n  const right = box.whiskerHigh != null ? box.whiskerHigh : Math.min((box.q3 + 1.5 * (box.q3 - box.q1)), box.max);\r\n\r\n  ctx.fillStyle = color || BOX_PLOT.box;\r\n  ctx.strokeStyle = BOX_PLOT.stroke;\r\n  ctx.beginPath();\r\n  ctx.rect(box.q1, 0, box.q3 - box.q1, height);\r\n  ctx.fill();\r\n  ctx.stroke();\r\n\r\n  //Line\r\n  const bottomPos = height - topPadding;\r\n  const middlePos = height / 2;\r\n\r\n  ctx.beginPath();\r\n  ctx.moveTo(left, middlePos);\r\n  ctx.lineTo(box.q1, middlePos);\r\n  ctx.moveTo(left, topPadding);\r\n  ctx.lineTo(left, bottomPos);\r\n  ctx.moveTo(box.median, 0);\r\n  ctx.lineTo(box.median, height);\r\n  ctx.moveTo(box.q3, middlePos);\r\n  ctx.lineTo(right, middlePos);\r\n  ctx.moveTo(right, topPadding);\r\n  ctx.lineTo(right, bottomPos);\r\n  ctx.stroke();\r\n  ctx.fill();\r\n\r\n  if (sort !== '') {\r\n    ctx.strokeStyle = BOX_PLOT.sort;\r\n    ctx.beginPath();\r\n    ctx.moveTo(<number>box[<keyof IBoxPlotData>sort], topPadding);\r\n    ctx.lineTo(<number>box[<keyof IBoxPlotData>sort], height - topPadding);\r\n    ctx.stroke();\r\n    ctx.fill();\r\n  }\r\n\r\n  if (!box.outlier) {\r\n    return;\r\n  }\r\n  ctx.fillStyle = BOX_PLOT.outlier;\r\n  box.outlier.forEach((v) => {\r\n    // currently dots with 3px\r\n    ctx.fillRect(Math.max(v - DOT.size / 2, 0), middlePos - DOT.size / 2, DOT.size, DOT.size);\r\n  });\r\n}\r\n","import {hsl} from 'd3-color';\r\nimport {ICategoricalStatistics, IStatistics} from '../internal/math';\r\nimport {IDataRow, INumberColumn, isNumberColumn, isMapAbleColumn} from '../model';\r\nimport Column from '../model/Column';\r\nimport {isNumbersColumn} from '../model/INumberColumn';\r\nimport {CANVAS_HEIGHT} from '../styles';\r\nimport {colorOf} from './impose';\r\nimport {default as IRenderContext, ERenderMode, ICellRendererFactory, IImposer, ICellRenderer, IGroupCellRenderer, ISummaryRenderer} from './interfaces';\r\nimport {renderMissingCanvas, renderMissingDOM} from './missing';\r\nimport {noRenderer, setText} from './utils';\r\n\r\nexport function toHeatMapColor(v: number | null, row: IDataRow, col: INumberColumn, imposer?: IImposer) {\r\n  if (v == null || isNaN(v)) {\r\n    v = 1; // max = brightest\r\n  }\r\n  if (imposer || !isMapAbleColumn(col)) {\r\n    //hsl space encoding, encode in lightness\r\n    const color = hsl(colorOf(col, row, imposer, v) || Column.DEFAULT_COLOR);\r\n    color.l = 1 - v; // largest value = darkest color\r\n    return color.toString();\r\n  }\r\n  const map = col.getColorMapping();\r\n  const valueColor = map.apply(v);\r\n  if (map.type === 'solid') {\r\n    //hsl space encoding, encode in lightness\r\n    const color = hsl(valueColor);\r\n    color.l = 1 - v; // largest value = darkest color\r\n    return color.toString();\r\n  }\r\n  // some custom logic that maps to another value\r\n  return valueColor;\r\n}\r\n\r\nexport default class BrightnessCellRenderer implements ICellRendererFactory {\r\n  readonly title: string = 'Brightness';\r\n\r\n  canRender(col: Column, mode: ERenderMode): boolean {\r\n    return isNumberColumn(col) && mode === ERenderMode.CELL && !isNumbersColumn(col);\r\n  }\r\n\r\n  create(col: INumberColumn, context: IRenderContext, _hist: IStatistics | ICategoricalStatistics | null, imposer?: IImposer): ICellRenderer {\r\n    const width = context.colWidth(col);\r\n    return {\r\n      template: `<div title=\"\">\r\n        <div style=\"background-color: ${Column.DEFAULT_COLOR}\"></div><div> </div>\r\n      </div>`,\r\n      update: (n: HTMLElement, d: IDataRow) => {\r\n        const missing = renderMissingDOM(n, col, d);\r\n        n.title = col.getLabel(d);\r\n        (<HTMLDivElement>n.firstElementChild!).style.backgroundColor = missing ? null : toHeatMapColor(col.getNumber(d), d, col, imposer);\r\n        setText(<HTMLSpanElement>n.lastElementChild!, n.title);\r\n      },\r\n      render: (ctx: CanvasRenderingContext2D, d: IDataRow) => {\r\n        if (renderMissingCanvas(ctx, col, d, width)) {\r\n          return;\r\n        }\r\n        ctx.fillStyle = toHeatMapColor(col.getNumber(d), d, col, imposer);\r\n        ctx.fillRect(0, 0, width, CANVAS_HEIGHT);\r\n      }\r\n    };\r\n  }\r\n\r\n  createGroup(): IGroupCellRenderer {\r\n    return noRenderer;\r\n  }\r\n\r\n  createSummary(): ISummaryRenderer {\r\n    return noRenderer;\r\n  }\r\n}\r\n","import {DENSE_HISTOGRAM} from '../config';\r\nimport {computeHist, ICategoricalBin, ICategoricalStatistics} from '../internal/math';\r\nimport {ICategoricalColumn, IDataRow, IGroup, isCategoricalColumn} from '../model';\r\nimport CategoricalColumn from '../model/CategoricalColumn';\r\nimport Column from '../model/Column';\r\nimport {isCategoryIncluded} from '../model/ICategoricalColumn';\r\nimport OrdinalColumn from '../model/OrdinalColumn';\r\nimport {CANVAS_HEIGHT} from '../styles';\r\nimport {filterMissingNumberMarkup, updateFilterMissingNumberMarkup} from '../ui/missing';\r\nimport {default as IRenderContext, ICellRendererFactory, ICellRenderer, IGroupCellRenderer, ISummaryRenderer} from './interfaces';\r\nimport {renderMissingCanvas, renderMissingDOM} from './missing';\r\nimport {setText, wideEnough, forEach} from './utils';\r\n\r\nexport default class CategoricalCellRenderer implements ICellRendererFactory {\r\n  readonly title: string = 'Color';\r\n  readonly groupTitle: string = 'Histogram';\r\n\r\n  canRender(col: Column): boolean {\r\n    return isCategoricalColumn(col);\r\n  }\r\n\r\n  create(col: ICategoricalColumn, context: IRenderContext): ICellRenderer {\r\n    const width = context.colWidth(col);\r\n    return {\r\n      template: `<div>\r\n        <div></div><div></div>\r\n      </div>`,\r\n      update: (n: HTMLElement, d: IDataRow) => {\r\n        renderMissingDOM(n, col, d);\r\n        const v = col.getCategory(d);\r\n        (<HTMLDivElement>n.firstElementChild!).style.backgroundColor = v ? v.color : null;\r\n        setText(<HTMLSpanElement>n.lastElementChild!, col.getLabel(d));\r\n      },\r\n      render: (ctx: CanvasRenderingContext2D, d: IDataRow) => {\r\n        if (renderMissingCanvas(ctx, col, d, width)) {\r\n          return;\r\n        }\r\n        const v = col.getCategory(d);\r\n        ctx.fillStyle = v ? v.color : '';\r\n        ctx.fillRect(0, 0, width, CANVAS_HEIGHT);\r\n      }\r\n    };\r\n  }\r\n\r\n  createGroup(col: ICategoricalColumn, _context: IRenderContext, globalHist: ICategoricalStatistics | null): IGroupCellRenderer {\r\n    const {template, update} = hist(col, false);\r\n    return {\r\n      template: `${template}</div>`,\r\n      update: (n: HTMLElement, _group: IGroup, rows: IDataRow[]) => {\r\n        const {maxBin, hist} = computeHist(rows, (r: IDataRow) => col.getCategory(r), col.categories);\r\n\r\n        const max = Math.max(maxBin, globalHist ? globalHist.maxBin : 0);\r\n        update(n, max, hist);\r\n      }\r\n    };\r\n  }\r\n\r\n  createSummary(col: ICategoricalColumn, ctx: IRenderContext, interactive: boolean): ISummaryRenderer {\r\n    return (col instanceof CategoricalColumn || col instanceof OrdinalColumn) ? interactiveSummary(col, interactive, ctx.idPrefix) : staticSummary(col, interactive);\r\n  }\r\n}\r\n\r\nfunction staticSummary(col: ICategoricalColumn, interactive: boolean) {\r\n  const {template, update} = hist(col, interactive);\r\n  return {\r\n    template: `${template}</div>`,\r\n    update: (n: HTMLElement, hist: ICategoricalStatistics | null) => {\r\n      n.classList.toggle('lu-missing', !hist);\r\n      if (!hist) {\r\n        return;\r\n      }\r\n      update(n, hist.maxBin, hist.hist);\r\n    }\r\n  };\r\n}\r\n\r\nfunction interactiveSummary(col: CategoricalColumn | OrdinalColumn, interactive: boolean, idPrefix: string) {\r\n  const {template, update} = hist(col, interactive || wideEnough(col));\r\n  let filterUpdate: (missing: number, col: CategoricalColumn | OrdinalColumn) => void;\r\n  return {\r\n    template: `${template}${interactive ? filterMissingNumberMarkup(false, 0, idPrefix) : ''}</div>`,\r\n    update: (n: HTMLElement, hist: ICategoricalStatistics | null) => {\r\n      if (!filterUpdate) {\r\n        filterUpdate = interactiveHist(col, n);\r\n      }\r\n      filterUpdate(hist ? hist.missing : 0, col);\r\n\r\n      n.classList.toggle('lu-missing', !hist);\r\n      if (!hist) {\r\n        return;\r\n      }\r\n      update(n, hist.maxBin, hist.hist);\r\n    }\r\n  };\r\n}\r\n\r\nfunction hist(col: ICategoricalColumn, showLabels: boolean) {\r\n  const bins = col.categories.map((c) => `<div title=\"${c.label}: 0\" data-cat=\"${c.name}\" ${showLabels ? `data-title=\"${c.label}\"` : ''}><div style=\"height: 0; background-color: ${c.color}\"></div></div>`).join('');\r\n\r\n  return {\r\n    template: `<div${col.dataLength! > DENSE_HISTOGRAM ? 'class=\"lu-dense\"' : ''}>${bins}`, // no closing div to be able to append things\r\n    update: (n: HTMLElement, maxBin: number, hist: ICategoricalBin[]) => {\r\n      forEach(n, '[data-cat]', (d: HTMLElement, i) => {\r\n        const {y} = hist[i];\r\n        d.title = `${col.categories[i].label}: ${y}`;\r\n        const inner = <HTMLElement>d.firstElementChild!;\r\n        inner.style.height = `${Math.round(y * 100 / maxBin)}%`;\r\n      });\r\n    }\r\n  };\r\n}\r\n\r\nexport function interactiveHist(col: CategoricalColumn | OrdinalColumn, node: HTMLElement) {\r\n  const bins = <HTMLElement[]>Array.from(node.querySelectorAll('[data-cat]'));\r\n\r\n  bins.forEach((bin, i) => {\r\n    const cat = col.categories[i];\r\n\r\n    bin.onclick = (evt) => {\r\n      evt.preventDefault();\r\n      evt.stopPropagation();\r\n\r\n      // toggle filter\r\n      const old = col.getFilter();\r\n      if (old == null || !Array.isArray(old.filter)) {\r\n        // deselect\r\n        const without = col.categories.slice();\r\n        bin.dataset.filtered = 'filtered';\r\n        without.splice(i, 1);\r\n        col.setFilter({\r\n          filterMissing: old ? old.filterMissing : false,\r\n          filter: without.map((d) => d.name)\r\n        });\r\n        return;\r\n      }\r\n      const filter = old.filter.slice();\r\n      const contained = filter.indexOf(cat.name);\r\n      if (contained >= 0) {\r\n        // remove\r\n        bin.dataset.filtered = 'filtered';\r\n        filter.splice(contained, 1);\r\n      } else {\r\n        // readd\r\n        delete bin.dataset.filtered;\r\n        filter.push(cat.name);\r\n      }\r\n      col.setFilter({\r\n        filterMissing: old.filterMissing,\r\n        filter\r\n      });\r\n    };\r\n  });\r\n\r\n\r\n  const filterMissing = <HTMLInputElement>node.querySelector('input')!;\r\n\r\n  if (filterMissing) {\r\n    filterMissing.onchange = () => {\r\n      // toggle filter\r\n      const v = filterMissing.checked;\r\n      const old = col.getFilter();\r\n      if (old == null) {\r\n        col.setFilter(v ? {filterMissing: v, filter: col.categories.map((d) => d.name)} : null);\r\n      } else {\r\n        col.setFilter({filterMissing: v, filter: old.filter});\r\n      }\r\n    };\r\n  }\r\n\r\n\r\n  return (missing: number, actCol: CategoricalColumn | OrdinalColumn) => {\r\n    col = actCol;\r\n    const cats = col.categories;\r\n    const f = col.getFilter();\r\n    bins.forEach((bin, i) => {\r\n      if (!isCategoryIncluded(f, cats[i])) {\r\n        bin.dataset.filtered = 'filtered';\r\n      } else {\r\n        delete bin.dataset.filtered;\r\n      }\r\n    });\r\n    if (filterMissing) {\r\n      filterMissing.checked = f != null && f.filterMissing;\r\n      updateFilterMissingNumberMarkup(<HTMLElement>filterMissing.parentElement, missing);\r\n    }\r\n  };\r\n}\r\n","import {ICategory, IDataRow, IGroup} from '../model';\r\nimport Column from '../model/Column';\r\nimport {ISetColumn, isSetColumn} from '../model/ICategoricalColumn';\r\nimport {CANVAS_HEIGHT, UPSET} from '../styles';\r\nimport {default as IRenderContext, ERenderMode, ICellRendererFactory, ICellRenderer, IGroupCellRenderer, ISummaryRenderer} from './interfaces';\r\nimport {renderMissingCanvas, renderMissingDOM} from './missing';\r\nimport {noRenderer} from './utils';\r\n\r\nexport default class UpSetCellRenderer implements ICellRendererFactory {\r\n  readonly title: string = 'Matrix';\r\n\r\n  canRender(col: Column, mode: ERenderMode): boolean {\r\n    return isSetColumn(col) && mode !== ERenderMode.SUMMARY;\r\n  }\r\n\r\n  private static calculateSetPath(setData: boolean[], cellDimension: number) {\r\n    const catindexes: number[] = [];\r\n    setData.forEach((d: boolean, i: number) => (d) ? catindexes.push(i) : -1);\r\n\r\n    const left = (catindexes[0] * cellDimension) + (cellDimension / 2);\r\n    const right = (catindexes[catindexes.length - 1] * cellDimension) + (cellDimension / 2);\r\n\r\n    return {left, right};\r\n  }\r\n\r\n  private static createDOMContext(col: ISetColumn) {\r\n    const categories = col.categories;\r\n    let templateRows = '';\r\n    for (const cat of categories) {\r\n      templateRows += `<div title=\"${cat.label}\"></div>`;\r\n    }\r\n    return {\r\n      templateRow: templateRows,\r\n      render: (n: HTMLElement, value: boolean[]) => {\r\n        Array.from(n.children).slice(1).forEach((d, i) => {\r\n          const v = value[i];\r\n          d.classList.toggle('enabled', v);\r\n        });\r\n\r\n        const line = <HTMLElement>n.firstElementChild;\r\n        const left = value.findIndex((d) => d);\r\n        const right = (value.length - 1) - value.reverse().findIndex((d) => d);\r\n\r\n        if (left < 0 || left === right) {\r\n          line.style.display = 'none';\r\n          return;\r\n        }\r\n        line.style.display = null;\r\n        line.style.left = `${Math.round(100 * (left + 0.5) / value.length)}%`;\r\n        line.style.width = `${Math.round(100 * (right - left) / value.length)}%`;\r\n      }\r\n    };\r\n  }\r\n\r\n  create(col: ISetColumn, context: IRenderContext): ICellRenderer {\r\n    const {templateRow, render} = UpSetCellRenderer.createDOMContext(col);\r\n    const width = context.colWidth(col);\r\n    const cellDimension = width / col.dataLength!;\r\n\r\n    return {\r\n      template: `<div><div></div>${templateRow}</div>`,\r\n      update: (n: HTMLElement, d: IDataRow) => {\r\n        if (renderMissingDOM(n, col, d)) {\r\n          return;\r\n        }\r\n        render(n, col.getValues(d));\r\n      },\r\n      render: (ctx: CanvasRenderingContext2D, d: IDataRow) => {\r\n        if (renderMissingCanvas(ctx, col, d, width)) {\r\n          return;\r\n        }\r\n        // Circle\r\n        const data = col.getValues(d);\r\n\r\n        const hasTrueValues = data.some((d) => d); //some values are true?\r\n\r\n        ctx.save();\r\n        ctx.fillStyle = UPSET.circle;\r\n        ctx.strokeStyle = UPSET.stroke;\r\n        if (hasTrueValues) {\r\n          const {left, right} = UpSetCellRenderer.calculateSetPath(data, cellDimension);\r\n          ctx.beginPath();\r\n          ctx.moveTo(left, CANVAS_HEIGHT / 2);\r\n          ctx.lineTo(right, CANVAS_HEIGHT / 2);\r\n          ctx.stroke();\r\n        }\r\n\r\n        data.forEach((d, j) => {\r\n          const posx = (j * cellDimension);\r\n          ctx.beginPath();\r\n          ctx.globalAlpha = d ? 1 : UPSET.inactive;\r\n          ctx.fillRect(posx, 0, cellDimension, CANVAS_HEIGHT);\r\n          ctx.fill();\r\n        });\r\n\r\n        ctx.restore();\r\n      }\r\n    };\r\n  }\r\n\r\n  createGroup(col: ISetColumn): IGroupCellRenderer {\r\n    const {templateRow, render} = UpSetCellRenderer.createDOMContext(col);\r\n    return {\r\n      template: `<div><div></div>${templateRow}</div>`,\r\n      update: (n: HTMLElement, _group: IGroup, rows: IDataRow[]) => {\r\n        const value = union(col, rows);\r\n        render(n, value);\r\n      }\r\n    };\r\n  }\r\n\r\n  createSummary(): ISummaryRenderer {\r\n    return noRenderer;\r\n  }\r\n}\r\n\r\n\r\nexport function union(col: ISetColumn, rows: IDataRow[]) {\r\n  const values = new Set<ICategory>();\r\n  rows.forEach((d) => {\r\n    col.getSet(d).forEach((c) => values.add(c));\r\n  });\r\n  return col.categories.map((cat) => values.has(cat));\r\n}\r\n","import {IDataRow, IGroup} from '../model';\r\nimport Column from '../model/Column';\r\nimport {ISetColumn, isSetColumn} from '../model/ICategoricalColumn';\r\nimport {CANVAS_HEIGHT} from '../styles';\r\nimport {default as IRenderContext, ICellRendererFactory, ICellRenderer, IGroupCellRenderer, ISummaryRenderer} from './interfaces';\r\nimport {renderMissingCanvas, renderMissingDOM} from './missing';\r\nimport {union} from './UpSetCellRenderer';\r\nimport {noop, wideEnough, forEachChild} from './utils';\r\n\r\nexport default class CategoricalHeatmapCellRenderer implements ICellRendererFactory {\r\n  title: string = 'Heatmap';\r\n\r\n  canRender(col: Column): boolean {\r\n    return isSetColumn(col);\r\n  }\r\n\r\n  private static createDOMContext(col: ISetColumn) {\r\n    const categories = col.categories;\r\n    let templateRows = '';\r\n    for (const cat of categories) {\r\n      templateRows += `<div title=\"${cat.label}\" style=\"background-color: ${cat.color}\"></div>`;\r\n    }\r\n    return {\r\n      templateRow: templateRows,\r\n      render: (n: HTMLElement, value: boolean[]) => {\r\n        forEachChild(n, (d: HTMLElement, i) => {\r\n          const v = value[i];\r\n          d.style.visibility = v ? null : 'hidden';\r\n        });\r\n      }\r\n    };\r\n  }\r\n\r\n  create(col: ISetColumn, context: IRenderContext): ICellRenderer {\r\n    const {templateRow, render} = CategoricalHeatmapCellRenderer.createDOMContext(col);\r\n    const width = context.colWidth(col);\r\n    const cellDimension = width / col.dataLength!;\r\n    const cats = col.categories;\r\n\r\n    return {\r\n      template: `<div>${templateRow}</div>`,\r\n      update: (n: HTMLElement, d: IDataRow) => {\r\n        if (renderMissingDOM(n, col, d)) {\r\n          return;\r\n        }\r\n        render(n, col.getValues(d));\r\n      },\r\n      render: (ctx: CanvasRenderingContext2D, d: IDataRow) => {\r\n        if (renderMissingCanvas(ctx, col, d, width)) {\r\n          return;\r\n        }\r\n        // Circle\r\n        const data = col.getValues(d);\r\n\r\n        ctx.save();\r\n        cats.forEach((d, j) => {\r\n          if (!data[j]) {\r\n            return;\r\n          }\r\n          const posx = (j * cellDimension);\r\n          ctx.fillStyle = d.color;\r\n          ctx.fillRect(posx, 0, cellDimension, CANVAS_HEIGHT);\r\n        });\r\n\r\n        ctx.restore();\r\n      }\r\n    };\r\n  }\r\n\r\n  createGroup(col: ISetColumn): IGroupCellRenderer {\r\n    const {templateRow, render} = CategoricalHeatmapCellRenderer.createDOMContext(col);\r\n    return {\r\n      template: `<div>${templateRow}</div>`,\r\n      update: (n: HTMLElement, _group: IGroup, rows: IDataRow[]) => {\r\n        const value = union(col, rows);\r\n        render(n, value);\r\n      }\r\n    };\r\n  }\r\n\r\n  createSummary(col: ISetColumn): ISummaryRenderer {\r\n    const categories = col.categories;\r\n    let templateRows = '<div>';\r\n    const labels = wideEnough(col);\r\n    for (const cat of categories) {\r\n      templateRows += `<div title=\"${cat.label}\"${labels ? ` data-title=\"${cat.label}\"` : ''} style=\"background-color: ${cat.color}\"></div>`;\r\n    }\r\n    templateRows += '</div>';\r\n    return {\r\n      template: templateRows,\r\n      update: noop\r\n    };\r\n  }\r\n}\r\n","import {computeHist, ICategoricalBin, ICategoricalStatistics} from '../internal/math';\r\nimport {ICategoricalColumn, IDataRow, IGroup, isCategoricalColumn} from '../model';\r\nimport CategoricalColumn from '../model/CategoricalColumn';\r\nimport Column from '../model/Column';\r\nimport OrdinalColumn from '../model/OrdinalColumn';\r\nimport {filterMissingNumberMarkup} from '../ui/missing';\r\nimport {interactiveHist} from './CategoricalCellRenderer';\r\nimport {default as IRenderContext, ERenderMode, ICellRendererFactory, ICellRenderer, IGroupCellRenderer, ISummaryRenderer} from './interfaces';\r\nimport {forEachChild, noRenderer, adaptTextColorToBgColor} from './utils';\r\n\r\nexport default class CategoricalStackedDistributionlCellRenderer implements ICellRendererFactory {\r\n  readonly title: string = 'Distribution Bar';\r\n\r\n  canRender(col: Column, mode: ERenderMode): boolean {\r\n    return isCategoricalColumn(col) && mode !== ERenderMode.CELL;\r\n  }\r\n\r\n  create(): ICellRenderer {\r\n    return noRenderer;\r\n  }\r\n\r\n\r\n  createGroup(col: ICategoricalColumn): IGroupCellRenderer {\r\n    const { template, update } = stackedBar(col);\r\n    return {\r\n      template: `${template}</div>`,\r\n      update: (n: HTMLElement, _group: IGroup, rows: IDataRow[]) => {\r\n        const { hist, missing } = computeHist(rows, (r: IDataRow) => col.getCategory(r), col.categories);\r\n        update(n, hist, missing);\r\n      }\r\n    };\r\n  }\r\n\r\n  createSummary(col: ICategoricalColumn, ctx: IRenderContext, interactive: boolean): ISummaryRenderer {\r\n    return (col instanceof CategoricalColumn || col instanceof OrdinalColumn) ? interactiveSummary(col, interactive, ctx.idPrefix) : staticSummary(col);\r\n  }\r\n}\r\n\r\nfunction staticSummary(col: ICategoricalColumn) {\r\n  const { template, update } = stackedBar(col);\r\n  return {\r\n    template: `${template}</div>`,\r\n    update: (n: HTMLElement, hist: ICategoricalStatistics | null) => {\r\n      n.classList.toggle('lu-missing', !hist);\r\n      if (!hist) {\r\n        return;\r\n      }\r\n      update(n, hist.hist, hist.missing);\r\n    }\r\n  };\r\n}\r\n\r\nfunction interactiveSummary(col: CategoricalColumn | OrdinalColumn, interactive: boolean, idPrefix: string) {\r\n  const { template, update } = stackedBar(col);\r\n  let filterUpdate: (missing: number, col: CategoricalColumn | OrdinalColumn) => void;\r\n  return {\r\n    template: `${template}${interactive ? filterMissingNumberMarkup(false, 0, idPrefix) : ''}</div>`,\r\n    update: (n: HTMLElement, hist: ICategoricalStatistics | null) => {\r\n      if (!filterUpdate) {\r\n        filterUpdate = interactiveHist(col, n);\r\n      }\r\n      filterUpdate(hist ? hist.missing : 0, col);\r\n\r\n      n.classList.toggle('lu-missing', !hist);\r\n      if (!hist) {\r\n        return;\r\n      }\r\n      update(n, hist.hist, hist.missing);\r\n    }\r\n  };\r\n}\r\n\r\nfunction stackedBar(col: ICategoricalColumn) {\r\n  const cats = col.categories;\r\n  const bins = cats.map((c) => `<div style=\"background-color: ${c.color}; color: ${adaptTextColorToBgColor(c.color)}\" title=\"${c.label}: 0\" data-cat=\"${c.name}\"><span>${c.label}</span></div>`).join('');\r\n\r\n  return {\r\n    template: `<div>${bins}<div title=\"Missing Values\"></div>`, // no closing div to be able to append things\r\n    update: (n: HTMLElement, hist: ICategoricalBin[], missing: number) => {\r\n      const total = hist.reduce((acc, { y }) => acc + y, missing);\r\n      forEachChild(n, (d: HTMLElement, i) => {\r\n        let y: number;\r\n        let label: string;\r\n        if (i >= hist.length) {\r\n          y = missing;\r\n          label = 'Missing Values';\r\n        } else {\r\n          y = hist[i].y;\r\n          label = cats[i].label;\r\n        }\r\n        d.style.flexGrow = `${Math.round(total === 0 ? 0 : y)}`;\r\n        d.title = `${label}: ${y}`;\r\n      });\r\n    }\r\n  };\r\n}\r\n","import {ICategoricalStatistics, IStatistics} from '../internal/math';\r\nimport {IDataRow, INumberColumn, isNumberColumn} from '../model';\r\nimport Column from '../model/Column';\r\nimport {isNumbersColumn} from '../model/INumberColumn';\r\nimport {colorOf} from './impose';\r\nimport {default as IRenderContext, ERenderMode, ICellRendererFactory, IImposer, ICellRenderer, IGroupCellRenderer, ISummaryRenderer} from './interfaces';\r\nimport {renderMissingDOM} from './missing';\r\nimport {attr, noop, noRenderer, setText} from './utils';\r\n\r\nexport default class CircleCellRenderer implements ICellRendererFactory {\r\n  readonly title: string = 'Proportional Symbol';\r\n\r\n  canRender(col: Column, mode: ERenderMode): boolean {\r\n    return isNumberColumn(col) && mode === ERenderMode.CELL && !isNumbersColumn(col);\r\n  }\r\n\r\n  create(col: INumberColumn, _context: IRenderContext, _hist: IStatistics | ICategoricalStatistics | null, imposer?: IImposer): ICellRenderer {\r\n    return {\r\n      template: `<div style=\"background: radial-gradient(circle closest-side, red 100%, transparent 100%)\" title=\"\">\r\n              <div class=\"lu-hover-only\"></div>\r\n          </div>`,\r\n      update: (n: HTMLElement, d: IDataRow) => {\r\n        const v = col.getNumber(d);\r\n        const p = Math.round(v * 100);\r\n        const missing = renderMissingDOM(n, col, d);\r\n        attr(<HTMLElement>n, {}, {\r\n          background: missing ? null : `radial-gradient(circle closest-side, ${colorOf(col, d, imposer)} ${p}%, transparent ${p}%)`\r\n        },);\r\n        setText(n.firstElementChild!, col.getLabel(d));\r\n      },\r\n      render: noop\r\n    };\r\n  }\r\n\r\n  createGroup(): IGroupCellRenderer {\r\n    return noRenderer;\r\n  }\r\n\r\n  createSummary(): ISummaryRenderer {\r\n    return noRenderer;\r\n  }\r\n}\r\n","import {ICategoricalStatistics, IStatistics} from '../internal';\r\nimport {INumberColumn, IDataRow, IGroup, isMissingValue, isNumberColumn} from '../model';\r\n/**\r\n * a renderer rendering a bar for numerical columns\r\n */\r\nimport Column from '../model/Column';\r\nimport {DEFAULT_FORMATTER, isNumbersColumn} from '../model/INumberColumn';\r\nimport {CANVAS_HEIGHT, DOT} from '../styles';\r\nimport {colorOf} from './impose';\r\nimport {default as IRenderContext, ERenderMode, ICellRendererFactory, IImposer, ICellRenderer, IGroupCellRenderer, ISummaryRenderer} from './interfaces';\r\nimport {renderMissingCanvas, renderMissingDOM} from './missing';\r\nimport {attr, forEachChild, noRenderer} from './utils';\r\n\r\nexport default class DotCellRenderer implements ICellRendererFactory {\r\n  readonly title: string = 'Dot';\r\n  readonly groupTitle: string = 'Dots';\r\n\r\n  canRender(col: Column, mode: ERenderMode): boolean {\r\n    return isNumberColumn(col) && mode !== ERenderMode.SUMMARY;\r\n  }\r\n\r\n  private static getDOMRenderer(col: INumberColumn) {\r\n    const dots = isNumbersColumn(col) ? col.dataLength! : 1;\r\n    let tmp = '';\r\n    for (let i = 0; i < dots; ++i) {\r\n      tmp += `<div style='background-color: ${Column.DEFAULT_COLOR}' title=''></div>`;\r\n    }\r\n\r\n    const update = (n: HTMLElement, vs: number[], labels: string[], colors: (string | null)[]) => {\r\n      //adapt the number of children\r\n      if (n.children.length !== vs.length) {\r\n        let tmp = '';\r\n        for (let i = 0; i < vs.length; ++i) {\r\n          tmp += `<div style='background-color: ${colors[i]}' title='${labels[i]}'></div>`;\r\n        }\r\n        n.innerHTML = tmp;\r\n      }\r\n      forEachChild(n, (d: HTMLElement, i) => {\r\n        const v = vs[i];\r\n        attr(<HTMLElement>d, {\r\n          title: labels[i]\r\n        }, {\r\n          display: isMissingValue(v) ? 'none' : null,\r\n          left: `${Math.round(v * 100)}%`,\r\n          // jitter\r\n          top: vs.length > 1 ? `${Math.round(Math.random() * 80 + 10)}%` : null,\r\n          'background-color': colors[i]\r\n        });\r\n      });\r\n    };\r\n\r\n    const render = (ctx: CanvasRenderingContext2D, vs: number[], colors: (string | null)[], width: number) => {\r\n      ctx.save();\r\n      ctx.globalAlpha = DOT.opacity;\r\n      vs.forEach((v, i) => {\r\n        ctx.fillStyle = colors[i] || DOT.color;\r\n        ctx.fillRect(Math.max(0, v * width - DOT.size / 2), 0, DOT.size, CANVAS_HEIGHT);\r\n      });\r\n      ctx.restore();\r\n    };\r\n\r\n    return {template: `<div>${tmp}</div>`, update, render};\r\n  }\r\n\r\n  create(col: INumberColumn, context: IRenderContext, _hist: IStatistics | ICategoricalStatistics | null, imposer?: IImposer): ICellRenderer {\r\n    const {template, render, update} = DotCellRenderer.getDOMRenderer(col);\r\n    const width = context.colWidth(col);\r\n    return {\r\n      template,\r\n      update: (n: HTMLElement, d: IDataRow) => {\r\n        if (renderMissingDOM(n, col, d)) {\r\n          return;\r\n        }\r\n        const color = colorOf(col, d, imposer);\r\n        const v = col.getValue(d);\r\n        if (!isNumbersColumn(col)) {\r\n          return update(n, [v], [col.getLabel(d)], [color]);\r\n        }\r\n        const vs: number[] = v.filter((vi: number) => !isMissingValue(vi));\r\n        return update(n, vs, vs.map(DEFAULT_FORMATTER), vs.map((_: any) => color));\r\n      },\r\n      render: (ctx: CanvasRenderingContext2D, d: IDataRow) => {\r\n        if (renderMissingCanvas(ctx, col, d, width)) {\r\n          return;\r\n        }\r\n        const color = colorOf(col, d, imposer);\r\n        const v = col.getValue(d);\r\n        if (!isNumbersColumn(col)) {\r\n          return render(ctx, [v], [color], width);\r\n        }\r\n        const vs: number[] = v.filter((vi: number) => !isMissingValue(vi));\r\n        return render(ctx, vs, vs.map((_: any) => color), width);\r\n      }\r\n    };\r\n  }\r\n\r\n  createGroup(col: INumberColumn, _context: IRenderContext, _hist: IStatistics | ICategoricalStatistics | null, imposer?: IImposer): IGroupCellRenderer {\r\n    const {template, update} = DotCellRenderer.getDOMRenderer(col);\r\n    return {\r\n      template,\r\n      update: (n: HTMLElement, _group: IGroup, rows: IDataRow[]) => {\r\n        const vs = rows.map((r) => col.getValue(r));\r\n        const colors = rows.map((r) => colorOf(col, r, imposer));\r\n\r\n        if (!isNumbersColumn(col)) {\r\n          return update(n, vs, rows.map((r) => col.getLabel(r)), colors);\r\n        }\r\n        // concatenate all columns\r\n        const all = (<number[]>[]).concat(...vs.filter((vi: number) => !isMissingValue(vi)));\r\n        return update(n, all, all.map(DEFAULT_FORMATTER), vs.map((_v: number[], i) => colors[i]));\r\n      }\r\n    };\r\n  }\r\n\r\n  createSummary(): ISummaryRenderer {\r\n    return noRenderer;\r\n  }\r\n}\r\n","import {IDataRow, IGroup} from '../model';\r\nimport Column from '../model/Column';\r\nimport GroupColumn from '../model/GroupColumn';\r\nimport {ICellRendererFactory, ICellRenderer, IGroupCellRenderer, ISummaryRenderer} from './interfaces';\r\nimport {noop, noRenderer} from './utils';\r\n\r\nexport default class GroupCellRenderer implements ICellRendererFactory {\r\n  readonly title: string = 'Default';\r\n\r\n  canRender(col: Column): boolean {\r\n    return col instanceof GroupColumn;\r\n  }\r\n\r\n  create(): ICellRenderer {\r\n    return {\r\n      template: `<div><div></div></div>`,\r\n      update(node: HTMLElement, _row: IDataRow, i: number, group: IGroup) {\r\n        const p = (<HTMLElement>node.firstElementChild!);\r\n        if (i !== 0) {\r\n          p.innerText = '';\r\n        } else if (Array.isArray((<any>group).order)) {\r\n          p.innerText = `${group.name} (${(<any>group).order.length})`;\r\n        } else {\r\n          p.innerText = group.name;\r\n        }\r\n      },\r\n      render: noop\r\n    };\r\n  }\r\n\r\n  createGroup(): IGroupCellRenderer {\r\n    return {\r\n      template: `<div><div></div></div>`,\r\n      update(node: HTMLElement, group: IGroup, rows: IDataRow[]) {\r\n        (<HTMLElement>node.firstElementChild!).innerText = `${group.name} (${rows.length})`;\r\n      }\r\n    };\r\n  }\r\n\r\n  createSummary(): ISummaryRenderer {\r\n    return noRenderer;\r\n  }\r\n}\r\n","import {LazyBoxPlotData} from '../internal';\r\nimport {IDataRow, IGroup, isMissingValue} from '../model';\r\nimport {INumbersColumn} from '../model/INumberColumn';\r\nimport {default as IRenderContext, IImposer, ICellRenderer, IGroupCellRenderer} from './interfaces';\r\nimport {renderMissingCanvas, renderMissingDOM} from './missing';\r\n\r\nexport abstract class ANumbersCellRenderer {\r\n  abstract readonly title: string;\r\n\r\n  protected abstract createContext(col: INumbersColumn, context: IRenderContext, imposer?: IImposer): {\r\n    templateRow: string,\r\n    update: (row: HTMLElement, data: number[], raw: number[], d: IDataRow) => void,\r\n    render: (ctx: CanvasRenderingContext2D, data: number[], d: IDataRow) => void,\r\n  };\r\n\r\n  static choose(col: INumbersColumn, rows: IDataRow[]) {\r\n    const data = rows.map((r) => ({n: col.getNumbers(r), raw: col.getRawNumbers(r)}));\r\n    const cols = col.dataLength!;\r\n    const normalized = <number[]>[];\r\n    const raw = <number[]>[];\r\n    // mean column)\r\n    for (let i = 0; i < cols; ++i) {\r\n      const vs = data.map((d) => ({n: d.n[i], raw: d.raw[i]})).filter((d) => !isMissingValue(d.n));\r\n      if (vs.length === 0) {\r\n        normalized.push(NaN);\r\n        raw.push(NaN);\r\n      } else {\r\n        const box = <any>new LazyBoxPlotData(vs.map((d) => d.n));\r\n        const boxRaw = <any>new LazyBoxPlotData(vs.map((d) => d.raw));\r\n        normalized.push(box[col.getSortMethod()]);\r\n        raw.push(boxRaw[col.getSortMethod()]);\r\n      }\r\n    }\r\n    return {normalized, raw};\r\n  }\r\n\r\n  create(col: INumbersColumn, context: IRenderContext, _hist: any, imposer?: IImposer): ICellRenderer {\r\n    const width = context.colWidth(col);\r\n    const {templateRow, render, update} = this.createContext(col, context, imposer);\r\n    return {\r\n      template: `<div>${templateRow}</div>`,\r\n      update: (n: HTMLElement, d: IDataRow) => {\r\n        if (renderMissingDOM(n, col, d)) {\r\n          return;\r\n        }\r\n        update(n, col.getNumbers(d), col.getRawNumbers(d), d);\r\n      },\r\n      render: (ctx: CanvasRenderingContext2D, d: IDataRow) => {\r\n        if (renderMissingCanvas(ctx, col, d, width)) {\r\n          return;\r\n        }\r\n        render(ctx, col.getNumbers(d), d);\r\n      },\r\n    };\r\n  }\r\n\r\n  createGroup(col: INumbersColumn, context: IRenderContext, _hist: any, imposer?: IImposer): IGroupCellRenderer {\r\n    const {templateRow, update} = this.createContext(col, context, imposer);\r\n    return {\r\n      template: `<div>${templateRow}</div>`,\r\n      update: (n: HTMLDivElement, _group: IGroup, rows: IDataRow[]) => {\r\n        // render a heatmap\r\n        const {normalized, raw} = ANumbersCellRenderer.choose(col, rows);\r\n        update(n, normalized, raw, rows[0]);\r\n      }\r\n    };\r\n  }\r\n}\r\n\r\n\r\nexport function matchRows(n: HTMLElement | SVGElement, rows: IDataRow[], template: string) {\r\n  // first match the number of rows\r\n  const children = <(HTMLElement | SVGElement)[]>Array.from(n.children);\r\n  if (children.length > rows.length) {\r\n    children.slice(rows.length).forEach((c) => c.remove());\r\n  } else if (rows.length > children.length) {\r\n    n.insertAdjacentHTML('beforeend', template.repeat(rows.length - children.length));\r\n  }\r\n}\r\n","import {IDataRow, isMissingValue} from '../model';\r\nimport Column from '../model/Column';\r\nimport {DEFAULT_FORMATTER, INumbersColumn, isNumbersColumn} from '../model/INumberColumn';\r\nimport {CANVAS_HEIGHT} from '../styles';\r\nimport {ANumbersCellRenderer} from './ANumbersCellRenderer';\r\nimport {toHeatMapColor} from './BrightnessCellRenderer';\r\nimport IRenderContext, {ICellRendererFactory, IImposer} from './interfaces';\r\nimport {renderMissingValue, renderMissingDOM} from './missing';\r\nimport {noop, wideEnough} from './utils';\r\nimport {IGroup} from '../model/interfaces';\r\nimport {ICellRenderer, IGroupCellRenderer, ISummaryRenderer} from './interfaces';\r\n\r\nconst GUESSED_HEIGHT = 20;\r\n\r\nexport default class HeatmapCellRenderer implements ICellRendererFactory {\r\n  readonly title: string = 'Heatmap';\r\n\r\n  canRender(col: Column): boolean {\r\n    return isNumbersColumn(col) && Boolean(col.dataLength);\r\n  }\r\n\r\n  private createContext(col: INumbersColumn, context: IRenderContext, _hist: any, imposer?: IImposer) {\r\n    const width = context.colWidth(col);\r\n    const cellDimension = width / col.dataLength!;\r\n    const labels = col.labels;\r\n    const render = (ctx: CanvasRenderingContext2D, data: number[], item: IDataRow, height: number) => {\r\n      data.forEach((d: number, j: number) => {\r\n        const x = j * cellDimension;\r\n        if (isMissingValue(d)) {\r\n          renderMissingValue(ctx, cellDimension, height, x, 0);\r\n          return;\r\n        }\r\n        ctx.fillStyle = toHeatMapColor(d, item, col, imposer);\r\n        ctx.fillRect(x, 0, cellDimension, height);\r\n      });\r\n    };\r\n    return {\r\n      template: `<canvas height=\"${GUESSED_HEIGHT}\" title=\"\"></canvas>`,\r\n      render,\r\n      width,\r\n      mover: (n: HTMLElement, values: string[]) => (evt: MouseEvent) => {\r\n        const percent = evt.offsetX / width;\r\n        const index = Math.max(0, Math.min(col.dataLength! - 1, Math.floor(percent * (col.dataLength! - 1) + 0.5)));\r\n        n.title = `${labels[index]}: ${values[index]}`;\r\n      }\r\n    };\r\n  }\r\n\r\n  create(col: INumbersColumn, context: IRenderContext, _hist: any, imposer?: IImposer): ICellRenderer {\r\n    const {template, render, mover, width} = this.createContext(col, context, _hist, imposer);\r\n    return {\r\n      template,\r\n      update: (n: HTMLElement, d: IDataRow) => {\r\n        const ctx = (<HTMLCanvasElement>n).getContext('2d')!;\r\n        ctx.canvas.width = width;\r\n        ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\r\n\r\n        if (renderMissingDOM(n, col, d)) {\r\n          return;\r\n        }\r\n        n.onmousemove = mover(n, col.getRawNumbers(d).map(DEFAULT_FORMATTER));\r\n        n.onmouseleave = () => n.title = '';\r\n        render(ctx, col.getNumbers(d), d, GUESSED_HEIGHT);\r\n      },\r\n      render: (ctx: CanvasRenderingContext2D, d: IDataRow) => {\r\n        render(ctx, col.getNumbers(d), d, CANVAS_HEIGHT);\r\n      }\r\n    };\r\n  }\r\n\r\n  createGroup(col: INumbersColumn, context: IRenderContext, _hist: any, imposer?: IImposer): IGroupCellRenderer {\r\n    const {template, render, mover, width} = this.createContext(col, context, _hist, imposer);\r\n    return {\r\n      template,\r\n      update: (n: HTMLElement, _group: IGroup, rows: IDataRow[]) => {\r\n        // render a heatmap\r\n        const {normalized, raw} = ANumbersCellRenderer.choose(col, rows);\r\n        const ctx = (<HTMLCanvasElement>n).getContext('2d')!;\r\n        ctx.canvas.width = width;\r\n        ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\r\n        n.onmousemove = mover(n, raw.map(DEFAULT_FORMATTER));\r\n        n.onmouseleave = () => n.title = '';\r\n        render(ctx, normalized, rows[0], GUESSED_HEIGHT);\r\n      }\r\n    };\r\n  }\r\n\r\n  createSummary(col: INumbersColumn): ISummaryRenderer {\r\n    let labels = col.labels.slice();\r\n    while (labels.length > 0 && !wideEnough(col, labels.length)) {\r\n      labels = labels.filter((_, i) => i % 2 === 0); // even\r\n    }\r\n    let templateRows = '<div>';\r\n    for (const label of labels) {\r\n      templateRows += `<div title=\"${label}\" data-title=\"${label}\"></div>`;\r\n    }\r\n    templateRows += '</div>';\r\n    return {\r\n      template: templateRows,\r\n      update: noop\r\n    };\r\n  }\r\n}\r\n","import ADialog, {IDialogContext} from './ADialog';\r\n\r\n/** @internal */\r\nexport interface IInputNumberOptions {\r\n  min: number;\r\n  max: number;\r\n  step: number | 'any';\r\n  value: number;\r\n  label: string | null;\r\n}\r\n\r\n/** @internal */\r\nexport default class InputNumberDialog extends ADialog {\r\n\r\n  private readonly ioptions: Readonly<IInputNumberOptions> = {\r\n    min: NaN,\r\n    max: NaN,\r\n    step: 'any',\r\n    value: NaN,\r\n    label: null\r\n  };\r\n\r\n  constructor(dialog: IDialogContext, private readonly callback: (value: number) => void, options: Partial<IInputNumberOptions> = {}) {\r\n    super(dialog);\r\n    Object.assign(this.ioptions, options);\r\n  }\r\n\r\n  protected build(node: HTMLElement) {\r\n    const o = this.ioptions;\r\n    node.insertAdjacentHTML('beforeend', `\r\n     <input type=\"number\" value=\"${isNaN(o.value) ? '' : String(o.value)}\" required autofocus placeholder=\"${o.label ? o.label : 'enter number'}\" ${isNaN(o.min) ? '' : ` min=\"${o.min}\"`} ${isNaN(o.max) ? '' : ` max=\"${o.max}\"`} step=\"${o.step}\">\r\n    `);\r\n  }\r\n\r\n  submit() {\r\n    this.callback(parseFloat(this.findInput('input[type=number]').value));\r\n    return true;\r\n  }\r\n}\r\n","import {DENSE_HISTOGRAM} from '../config';\r\nimport {computeStats, getNumberOfBins, INumberBin, IStatistics} from '../internal/math';\r\nimport {IDataRow, IGroup, isMissingValue} from '../model';\r\nimport Column from '../model/Column';\r\nimport {\r\n  DEFAULT_FORMATTER, INumberColumn, INumbersColumn, isNumberColumn,\r\n  isNumbersColumn\r\n} from '../model/INumberColumn';\r\nimport {IMapAbleColumn, isMapAbleColumn} from '../model/MappingFunction';\r\nimport InputNumberDialog from '../ui/dialogs/InputNumberDialog';\r\nimport {filterMissingNumberMarkup, updateFilterMissingNumberMarkup} from '../ui/missing';\r\nimport {colorOf} from './impose';\r\nimport {default as IRenderContext, ERenderMode, ICellRendererFactory, IImposer, ICellRenderer, IGroupCellRenderer, ISummaryRenderer} from './interfaces';\r\nimport {renderMissingDOM} from './missing';\r\nimport {noop} from './utils';\r\nimport {dragHandle, IDragHandleOptions} from '../internal/drag';\r\n\r\nexport default class HistogramCellRenderer implements ICellRendererFactory {\r\n  readonly title: string = 'Histogram';\r\n\r\n  canRender(col: Column, mode: ERenderMode): boolean {\r\n    return (isNumberColumn(col) && mode !== ERenderMode.CELL) || (isNumbersColumn(col) && mode === ERenderMode.CELL);\r\n  }\r\n\r\n  create(col: INumbersColumn, context: IRenderContext, hist: IStatistics | null, imposer?: IImposer): ICellRenderer {\r\n    const {template, render, guessedBins} = getHistDOMRenderer(context.totalNumberOfRows, col, imposer);\r\n    return {\r\n      template: `${template}</div>`,\r\n      update: (n: HTMLElement, row: IDataRow) => {\r\n        if (renderMissingDOM(n, col, row)) {\r\n          return;\r\n        }\r\n        render(n, createHist(hist, guessedBins, [row], col));\r\n      },\r\n      render: noop\r\n    };\r\n  }\r\n\r\n  createGroup(col: INumberColumn, context: IRenderContext, hist: IStatistics | null, imposer?: IImposer): IGroupCellRenderer {\r\n    const {template, render, guessedBins} = getHistDOMRenderer(context.totalNumberOfRows, col, imposer);\r\n    return {\r\n      template: `${template}</div>`,\r\n      update: (n: HTMLElement, _group: IGroup, rows: IDataRow[]) => {\r\n        render(n, createHist(hist, guessedBins, rows, col));\r\n      }\r\n    };\r\n  }\r\n\r\n  createSummary(col: INumberColumn, context: IRenderContext, interactive: boolean, imposer?: IImposer): ISummaryRenderer {\r\n    const r = getHistDOMRenderer(context.totalNumberOfRows, col, imposer);\r\n\r\n    const staticHist = !interactive || !isMapAbleColumn(col);\r\n    return staticHist ? staticSummary(col, r.template, r.render) : interactiveSummary(<INumberColumn & IMapAbleColumn>col, context, r.template, r.render);\r\n  }\r\n}\r\n\r\n\r\nfunction staticSummary(col: INumberColumn, template: string, render: (n: HTMLElement, stats: {bins: number, max: number, hist: INumberBin[]}) => void) {\r\n  if (isMapAbleColumn(col)) {\r\n    const range = col.getRange();\r\n    template += `<span>${range[0]}</span><span>${range[1]}</span>`;\r\n  }\r\n  return {\r\n    template: `${template}</div>`,\r\n    update: (node: HTMLElement, hist: IStatistics | null) => {\r\n      if (isMapAbleColumn(col)) {\r\n        const range = col.getRange();\r\n        Array.from(node.querySelectorAll('span')).forEach((d: HTMLElement, i) => d.textContent = range[i]);\r\n      }\r\n\r\n      node.classList.toggle('lu-missing', !hist);\r\n      if (!hist) {\r\n        return;\r\n      }\r\n      render(node, {bins: hist.hist.length, max: hist.maxBin, hist: hist.hist});\r\n    }\r\n  };\r\n}\r\n\r\nfunction interactiveSummary(col: INumberColumn & IMapAbleColumn, context: IRenderContext, template: string, render: (n: HTMLElement, stats: {bins: number, max: number, hist: INumberBin[]}) => void) {\r\n  const f = filter(col);\r\n  const formatter = col.getNumberFormat ? col.getNumberFormat() : DEFAULT_FORMATTER;\r\n  template += `\r\n      <div data-handle=\"min-hint\" style=\"width: ${f.percent(f.filterMin)}%\"></div>\r\n      <div data-handle=\"max-hint\" style=\"width: ${100 - f.percent(f.filterMax)}%\"></div>\r\n      <div data-handle=\"min\" data-value=\"${formatter(f.filterMin)}\" style=\"left: ${f.percent(f.filterMin)}%\" title=\"min filter, drag or shift click to change\"></div>\r\n      <div data-handle='max' data-value=\"${formatter(f.filterMax)}\" style=\"right: ${100 - f.percent(f.filterMax)}%\" title=\"max filter, drag or shift click to change\"></div>\r\n      ${filterMissingNumberMarkup(f.filterMissing, 0, context.idPrefix)}\r\n    `;\r\n\r\n  let updateFilter: (missing: number, col: IMapAbleColumn) => void;\r\n\r\n  return {\r\n    template: `${template}</div>`,\r\n    update: (node: HTMLElement, hist: IStatistics | null) => {\r\n      if (!updateFilter) {\r\n        updateFilter = initFilter(node, col, context);\r\n      }\r\n      updateFilter(hist ? hist.missing : 0, col);\r\n\r\n      node.classList.toggle('lu-missing', !hist);\r\n      if (!hist) {\r\n        return;\r\n      }\r\n      render(node, {bins: hist.hist.length, max: hist.maxBin, hist: hist.hist});\r\n    }\r\n  };\r\n}\r\n\r\nfunction initFilter(node: HTMLElement, col: IMapAbleColumn, context: IRenderContext) {\r\n  const min = <HTMLElement>node.querySelector('[data-handle=min]');\r\n  const max = <HTMLElement>node.querySelector('[data-handle=max]');\r\n  const minHint = <HTMLElement>node.querySelector('[data-handle=min-hint]');\r\n  const maxHint = <HTMLElement>node.querySelector('[data-handle=max-hint]');\r\n  const filterMissing = <HTMLInputElement>node.querySelector('input');\r\n  const formatter = col.getNumberFormat ? col.getNumberFormat() : DEFAULT_FORMATTER;\r\n\r\n  const setFilter = () => {\r\n    const f = filter(col);\r\n    const minValue = f.unpercent(parseFloat(min.style.left!));\r\n    const maxValue = f.unpercent(100 - parseFloat(max.style.right!));\r\n    col.setFilter({\r\n      filterMissing: filterMissing.checked,\r\n      min: minValue === f.domain[0] ? NaN : minValue,\r\n      max: maxValue === f.domain[1] ? NaN : maxValue\r\n    });\r\n  };\r\n\r\n  min.onclick = (evt) => {\r\n    if (!evt.shiftKey) {\r\n      return;\r\n    }\r\n    evt.preventDefault();\r\n    evt.stopPropagation();\r\n\r\n    const f = filter(col);\r\n    const value = f.unpercent(parseFloat(min.style.left!));\r\n\r\n    const dialogCtx = {\r\n      attachment: min,\r\n      manager: context.dialogManager,\r\n      level: 1,\r\n      idPrefix: context.idPrefix\r\n    };\r\n\r\n    const dialog = new InputNumberDialog(dialogCtx, (newValue) => {\r\n      minHint.style.width = `${f.percent(newValue)}%`;\r\n      min.dataset.value = formatter(newValue);\r\n      min.style.left = `${f.percent(newValue)}%`;\r\n      min.classList.toggle('lu-swap-hint', f.percent(newValue) > 15);\r\n      setFilter();\r\n    }, {\r\n        value, min: f.domain[0], max: f.domain[1]\r\n      });\r\n    dialog.open();\r\n  };\r\n\r\n  max.onclick = (evt) => {\r\n    if (!evt.shiftKey) {\r\n      return;\r\n    }\r\n    evt.preventDefault();\r\n    evt.stopPropagation();\r\n\r\n    const f = filter(col);\r\n    const value = f.unpercent(100 - parseFloat(max.style.right!));\r\n\r\n    const dialogCtx = {\r\n      attachment: max,\r\n      manager: context.dialogManager,\r\n      level: 1,\r\n      idPrefix: context.idPrefix\r\n    };\r\n\r\n    const dialog = new InputNumberDialog(dialogCtx, (newValue) => {\r\n      maxHint.style.width = `${100 - f.percent(newValue)}%`;\r\n      max.dataset.value = formatter(newValue);\r\n      max.style.right = `${100 - f.percent(newValue)}%`;\r\n      min.classList.toggle('lu-swap-hint', f.percent(newValue) < 85);\r\n      setFilter();\r\n    }, {\r\n        value, min: f.domain[0], max: f.domain[1]\r\n      });\r\n    dialog.open();\r\n  };\r\n\r\n  filterMissing.onchange = () => setFilter();\r\n\r\n  const options: Partial<IDragHandleOptions> = {\r\n    minDelta: 0,\r\n    filter: (evt) => evt.button === 0 && !evt.shiftKey,\r\n    onStart: (handle) => handle.classList.add('lu-dragging'),\r\n    onDrag: (handle, x) => {\r\n      const total = node.clientWidth;\r\n      const px = Math.max(0, Math.min(x, total));\r\n      const percent = Math.round(100 * px / total);\r\n      const domain = col.getMapping().domain;\r\n      (<HTMLElement>handle).dataset.value = formatter(((percent / 100) * (domain[1] - domain[0]) + domain[0]));\r\n\r\n      if ((<HTMLElement>handle).dataset.handle === 'min') {\r\n        handle.style.left = `${percent}%`;\r\n        handle.classList.toggle('lu-swap-hint', percent > 15);\r\n        minHint.style.width = `${percent}%`;\r\n        return;\r\n      }\r\n      handle.style.right = `${100 - percent}%`;\r\n      handle.classList.toggle('lu-swap-hint', percent < 85);\r\n      maxHint.style.width = `${100 - percent}%`;\r\n    },\r\n    onEnd: (handle) => {\r\n      handle.classList.remove('lu-dragging');\r\n      setFilter();\r\n    }\r\n  };\r\n  dragHandle(min, options);\r\n  dragHandle(max, options);\r\n\r\n  return (missing: number, actCol: IMapAbleColumn) => {\r\n    col = actCol;\r\n    const f = filter(col);\r\n    minHint.style.width = `${f.percent(f.filterMin)}%`;\r\n    maxHint.style.width = `${100 - f.percent(f.filterMax)}%`;\r\n    min.dataset.value = formatter(f.filterMin);\r\n    max.dataset.value = formatter(f.filterMax);\r\n    min.style.left = `${f.percent(f.filterMin)}%`;\r\n    max.style.right = `${100 - f.percent(f.filterMax)}%`;\r\n    filterMissing.checked = f.filterMissing;\r\n    updateFilterMissingNumberMarkup(<HTMLElement>filterMissing.parentElement, missing);\r\n  };\r\n}\r\n\r\nfunction createHist(globalHist: IStatistics | null, guessedBins: number, rows: IDataRow[], col: INumberColumn) {\r\n  const bins = globalHist ? globalHist.hist.length : guessedBins;\r\n  let stats: IStatistics;\r\n  if (isNumbersColumn(col)) {\r\n    //multiple values\r\n    const values = (<number[]>[]).concat(...rows.map((r) => col.getNumbers(r)));\r\n    stats = computeStats(values, (v: number) => v, isMissingValue, [0, 1], bins);\r\n  } else {\r\n    stats = computeStats(rows, (r: IDataRow) => col.getNumber(r), (r: IDataRow) => col.isMissing(r), [0, 1], bins);\r\n  }\r\n\r\n  const max = Math.max(stats.maxBin, globalHist ? globalHist.maxBin : 0);\r\n  return {bins, max, hist: stats.hist};\r\n}\r\n\r\nexport function getHistDOMRenderer(totalNumberOfRows: number, col: INumberColumn, imposer?: IImposer) {\r\n  const guessedBins = getNumberOfBins(totalNumberOfRows);\r\n  const formatter = col.getNumberFormat ? col.getNumberFormat() : DEFAULT_FORMATTER;\r\n  let bins = '';\r\n  for (let i = 0; i < guessedBins; ++i) {\r\n    bins += `<div title=\"Bin ${i}: 0\" data-x=\"\"><div style=\"height: 0\" ></div></div>`;\r\n  }\r\n\r\n  const render = (n: HTMLElement, stats: {bins: number, max: number, hist: INumberBin[]}) => {\r\n    const {bins, max, hist} = stats;\r\n    //adapt the number of children\r\n    let nodes = <HTMLElement[]>Array.from(n.querySelectorAll('[data-x]'));\r\n    if (nodes.length > bins) {\r\n      nodes.splice(bins, nodes.length - bins).forEach((d) => d.remove());\r\n    } else if (nodes.length < bins) {\r\n      for (let i = nodes.length; i < bins; ++i) {\r\n        n.insertAdjacentHTML('afterbegin', `<div title=\"Bin ${i}: 0\" data-x=\"\"><div style=\"height: 0\" ></div></div>`);\r\n      }\r\n      nodes = Array.from(n.querySelectorAll('[data-x]'));\r\n    }\r\n    n.classList.toggle('lu-dense', bins > DENSE_HISTOGRAM);\r\n    nodes.forEach((d: HTMLElement, i) => {\r\n      const {x0, x1, length} = hist[i];\r\n      const inner = <HTMLElement>d.firstElementChild!;\r\n      d.title = `${formatter(x0)} - ${formatter(x1)} (${length})`;\r\n      d.dataset.x = formatter(x0);\r\n      inner.style.height = `${Math.round(length * 100 / max)}%`;\r\n      inner.style.backgroundColor = colorOf(col, null, imposer, (x1 + x0) / 2);\r\n    });\r\n  };\r\n  return {\r\n    template: `<div${guessedBins > DENSE_HISTOGRAM ? ' class=\"lu-dense' : ''}>${bins}`, // no closing div to be able to append things\r\n    render,\r\n    guessedBins\r\n  };\r\n}\r\n\r\n\r\nfunction filter(col: IMapAbleColumn) {\r\n  const filter = col.getFilter();\r\n  const domain = col.getMapping().domain;\r\n  const percent = (v: number) => Math.round(100 * (v - domain[0]) / (domain[1] - domain[0]));\r\n  const unpercent = (v: number) => ((v / 100) * (domain[1] - domain[0]) + domain[0]);\r\n  const filterMin = isFinite(filter.min) ? filter.min : domain[0];\r\n  const filterMax = isFinite(filter.max) ? filter.max : domain[1];\r\n  return {\r\n    filterMissing: filter.filterMissing,\r\n    domain,\r\n    percent,\r\n    unpercent,\r\n    filterMin,\r\n    filterMax\r\n  };\r\n}\r\n","import {IDataRow} from '../model';\r\nimport Column from '../model/Column';\r\nimport {ERenderMode, ICellRendererFactory, ICellRenderer, IGroupCellRenderer, ISummaryRenderer} from './interfaces';\r\nimport {renderMissingDOM} from './missing';\r\nimport {noop, noRenderer} from './utils';\r\nimport LinkColumn from '../model/LinkColumn';\r\n\r\nexport default class ImageCellRenderer implements ICellRendererFactory {\r\n  readonly title: string = 'Image';\r\n\r\n  canRender(col: Column, mode: ERenderMode): boolean {\r\n    return col instanceof LinkColumn && mode === ERenderMode.CELL;\r\n  }\r\n\r\n  create(col: LinkColumn): ICellRenderer {\r\n    return {\r\n      template: `<div></div>`,\r\n      update: (n: HTMLElement, d: IDataRow) => {\r\n        const missing = renderMissingDOM(n, col, d);\r\n        const v = col.getLink(d);\r\n        n.title = v ? v.alt : '';\r\n        n.style.backgroundImage = missing || !v ? null : `url('${v.href}')`;\r\n      },\r\n      render: noop\r\n    };\r\n  }\r\n\r\n  createGroup(): IGroupCellRenderer {\r\n    return noRenderer;\r\n  }\r\n\r\n  createSummary(): ISummaryRenderer {\r\n    return noRenderer;\r\n  }\r\n}\r\n","import {INumberBin, IStatistics} from '../internal';\r\nimport {IDataRow, IGroup} from '../model';\r\nimport Column from '../model/Column';\r\nimport CompositeNumberColumn from '../model/CompositeNumberColumn';\r\nimport {CANVAS_HEIGHT} from '../styles';\r\nimport {getHistDOMRenderer} from './HistogramCellRenderer';\r\nimport {default as IRenderContext, ERenderMode, ICellRendererFactory, ICellRenderer, IGroupCellRenderer, ISummaryRenderer} from './interfaces';\r\nimport {renderMissingCanvas, renderMissingDOM} from './missing';\r\nimport {createFlatColumnData} from './MultiLevelCellRenderer';\r\nimport {matchColumns, forEachChild} from './utils';\r\nimport {colorOf} from '../ui/dialogs/utils';\r\n\r\n\r\nexport default class InterleavingCellRenderer implements ICellRendererFactory {\r\n  readonly title: string = 'Interleaved';\r\n\r\n  canRender(col: Column): boolean {\r\n    return col instanceof CompositeNumberColumn;\r\n  }\r\n\r\n  create(col: CompositeNumberColumn, context: IRenderContext): ICellRenderer {\r\n    const {cols} = createFlatColumnData(col, context, false, ERenderMode.CELL);\r\n    const width = context.colWidth(col);\r\n    return {\r\n      template: `<div>${cols.map((r) => r.template).join('')}</div>`,\r\n      update: (n: HTMLDivElement, d: IDataRow, i: number, group: IGroup) => {\r\n        const missing = renderMissingDOM(n, col, d);\r\n        if (missing) {\r\n          return;\r\n        }\r\n        matchColumns(n, cols);\r\n        forEachChild(n, (ni: HTMLElement, j) => {\r\n          cols[j].renderer!.update(ni, d, i, group);\r\n        });\r\n      },\r\n      render: (ctx: CanvasRenderingContext2D, d: IDataRow, _i: number, group: IGroup) => {\r\n        if (renderMissingCanvas(ctx, col, d, width)) {\r\n          return;\r\n        }\r\n\r\n        ctx.save();\r\n        ctx.scale(1, 1 / cols.length); // scale since internal use the height, too\r\n        cols.forEach((r, i) => {\r\n          r.renderer!.render(ctx, d, i, group);\r\n          ctx.translate(0, CANVAS_HEIGHT);\r\n        });\r\n        ctx.restore();\r\n      }\r\n    };\r\n  }\r\n\r\n  createGroup(col: CompositeNumberColumn, context: IRenderContext): IGroupCellRenderer {\r\n    const {cols} = createFlatColumnData(col, context, false, ERenderMode.GROUP);\r\n    return {\r\n      template: `<div>${cols.map((r) => r.template).join('')}</div>`,\r\n      update: (n: HTMLElement, group: IGroup, rows: IDataRow[]) => {\r\n        matchColumns(n, cols);\r\n        forEachChild(n, (ni: HTMLElement, j) => {\r\n          cols[j].groupRenderer!.update(ni, group, rows);\r\n        });\r\n      }\r\n    };\r\n  }\r\n\r\n  createSummary(col: CompositeNumberColumn, context: IRenderContext): ISummaryRenderer {\r\n    const cols = col.children;\r\n    let acc = 0;\r\n    const {template, render} = getHistDOMRenderer(context.totalNumberOfRows, col, {\r\n      color: () => colorOf(cols[(acc++) % cols.length])\r\n    });\r\n    return {\r\n      template,\r\n      update: (n: HTMLElement) => {\r\n        const stats = cols.map((c) => <IStatistics | null>context.statsOf(<any>c));\r\n        if (!stats.some(Boolean)) {\r\n          n.classList.add('lu-missing');\r\n          return;\r\n        }\r\n        n.classList.remove('lu-missing');\r\n        const grouped = groupedHist(stats);\r\n        render(n, grouped);\r\n      }\r\n    };\r\n  }\r\n}\r\n\r\nconst dummyBin: INumberBin = {\r\n  length: 0,\r\n  x0: 0,\r\n  x1: 0\r\n};\r\n\r\nfunction groupedHist(stats: (IStatistics | null)[]) {\r\n  const sample = stats.find(Boolean)!;\r\n  const bins = sample.hist.length;\r\n  // assert all have the same bin size\r\n  const hist = <INumberBin[]>[];\r\n  let maxBin = 0;\r\n  for (let i = 0; i < bins; ++i) {\r\n    stats.forEach((s) => {\r\n      const bin = s ? s.hist[i] : null;\r\n      if (!bin) {\r\n        hist.push(dummyBin);\r\n        return;\r\n      }\r\n      if (bin.length > maxBin) {\r\n        maxBin = bin.length;\r\n      }\r\n      hist.push(bin);\r\n    });\r\n  }\r\n  return {bins, max: maxBin, hist};\r\n}\r\n","import {IDataRow, IGroup} from '../model';\r\nimport Column from '../model/Column';\r\nimport {ERenderMode, ICellRendererFactory, ICellRenderer, IGroupCellRenderer, ISummaryRenderer} from './interfaces';\r\nimport {renderMissingDOM} from './missing';\r\nimport {noop, noRenderer, setText} from './utils';\r\nimport LinkColumn from '../model/LinkColumn';\r\n\r\nexport default class LinkCellRenderer implements ICellRendererFactory {\r\n  readonly title: string = 'Link';\r\n\r\n  canRender(col: Column, mode: ERenderMode): boolean {\r\n    return col instanceof LinkColumn && mode !== ERenderMode.SUMMARY;\r\n  }\r\n\r\n  create(col: LinkColumn): ICellRenderer {\r\n    const align = col.alignment || 'left';\r\n    return {\r\n      template: `<a${align !== 'left' ? ` class=\"lu-${align}\"` : ''} target=\"_blank\" href=\"\"></a>`,\r\n      update: (n: HTMLAnchorElement, d: IDataRow) => {\r\n        if (renderMissingDOM(n, col, d)) {\r\n          return;\r\n        }\r\n        const v = col.getLink(d);\r\n        n.href = v ? v.href : '';\r\n        if (col.escape) {\r\n          setText(n, v ? v.alt : '');\r\n        } else {\r\n          n.innerHTML = v ? v.alt : '';\r\n        }\r\n      },\r\n      render: noop\r\n    };\r\n  }\r\n\r\n  private static exampleText(col: LinkColumn, rows: IDataRow[]) {\r\n    const numExampleRows = 5;\r\n    const examples = <string[]>[];\r\n    for (const row of rows) {\r\n      if (col.isMissing(row)) {\r\n        continue;\r\n      }\r\n      const v = col.getLink(row);\r\n      examples.push(`<a target=\"_blank\" href=\"${v ? v.href : ''}\">${v ? v.alt : ''}</a>`);\r\n      if (examples.length >= numExampleRows) {\r\n        break;\r\n      }\r\n    }\r\n    return `${examples.join(', ')}${examples.length < rows.length ? ', &hellip;' : ''}`;\r\n  }\r\n\r\n  createGroup(col: LinkColumn): IGroupCellRenderer {\r\n    return {\r\n      template: `<div> </div>`,\r\n      update: (n: HTMLDivElement, _group: IGroup, rows: IDataRow[]) => {\r\n        n.innerHTML = LinkCellRenderer.exampleText(col, rows);\r\n      }\r\n    };\r\n  }\r\n\r\n  createSummary(): ISummaryRenderer {\r\n    return noRenderer;\r\n  }\r\n}\r\n","import {IDataRow, IGroup, isMissingValue} from '../model';\r\nimport Column from '../model/Column';\r\nimport {IArrayColumn, IKeyValue, IMapColumn, isArrayColumn, isMapColumn} from '../model/IArrayColumn';\r\nimport {ICellRendererFactory, ICellRenderer, IGroupCellRenderer, ISummaryRenderer} from './interfaces';\r\nimport {renderMissingDOM} from './missing';\r\nimport {forEach, noop} from './utils';\r\n\r\nexport default class TableCellRenderer implements ICellRendererFactory {\r\n  readonly title: string = 'Table';\r\n\r\n  canRender(col: Column): boolean {\r\n    return isMapColumn(col);\r\n  }\r\n\r\n  create(col: IMapColumn<any>): ICellRenderer {\r\n    if (isArrayColumn(col) && col.dataLength) {\r\n      // fixed length optimized rendering\r\n      return this.createFixed(col);\r\n    }\r\n    return {\r\n      template: `<div></div>`,\r\n      update: (node: HTMLElement, d: IDataRow) => {\r\n        if (renderMissingDOM(node, col, d)) {\r\n          return;\r\n        }\r\n        node.innerHTML = col.getMapLabel(d).map(({key, value}) => `<div>${key}</div><div>${value}</div>`).join('');\r\n      },\r\n      render: noop\r\n    };\r\n  }\r\n\r\n  private static template(col: IArrayColumn<any>) {\r\n    const labels = col.labels;\r\n    return `<div>${labels.map((l) => `<div>${l}</div><div data-v></div>`).join('\\n')}</div>`;\r\n  }\r\n\r\n  private createFixed(col: IArrayColumn<any>) {\r\n    return {\r\n      template: TableCellRenderer.template(col),\r\n      update: (node: HTMLElement, d: IDataRow) => {\r\n        if (renderMissingDOM(node, col, d)) {\r\n          return;\r\n        }\r\n        const value = col.getLabels(d);\r\n        forEach(node, '[data-v]', (n: HTMLElement, i) => {\r\n          n.innerHTML = value[i];\r\n        });\r\n      },\r\n      render: noop\r\n    };\r\n  }\r\n\r\n  private static example(arr: IKeyValue<string>[]) {\r\n    const numExampleRows = 5;\r\n    return `${arr.slice(0, numExampleRows).map((d) => d.value).join(', ')}${numExampleRows < arr.length ? ', &hellip;' : ''}`;\r\n  }\r\n\r\n  createGroup(col: IMapColumn<any>): IGroupCellRenderer {\r\n    if (isArrayColumn(col) && col.dataLength) {\r\n      // fixed length optimized rendering\r\n      return this.createFixedGroup(col);\r\n    }\r\n    return {\r\n      template: `<div></div>`,\r\n      update: (node: HTMLElement, _group: IGroup, rows: IDataRow[]) => {\r\n        const vs = rows.filter((d) => !col.isMissing(d)).map((d) => col.getMapLabel(d));\r\n\r\n        const entries = groupByKey(vs);\r\n\r\n        node.innerHTML = entries.map(({key, values}) => `<div>${key}</div><div>${TableCellRenderer.example(values)}</div>`).join('');\r\n      }\r\n    };\r\n  }\r\n\r\n  private createFixedGroup(col: IArrayColumn<any>) {\r\n    return {\r\n      template: TableCellRenderer.template(col),\r\n      update: (node: HTMLElement, _group: IGroup, rows: IDataRow[]) => {\r\n        const numExampleRows = 5;\r\n        const vs = rows.filter((d) => !col.isMissing(d)).map((d) => col.getLabels(d));\r\n        forEach(node, '[data-v]', (n: HTMLElement, i) => {\r\n          const values = <string[]>[];\r\n          for (const v of vs) {\r\n            const vi = v[i];\r\n            if (isMissingValue(vi)) {\r\n              continue;\r\n            }\r\n            values.push(vi);\r\n            if (values.length >= numExampleRows) {\r\n              break;\r\n            }\r\n          }\r\n          n.innerHTML = `${values.join(', ')}${numExampleRows < vs.length ? ', &hellip;' : ''}`;\r\n        });\r\n      }\r\n    };\r\n  }\r\n\r\n  createSummary(): ISummaryRenderer {\r\n    return {\r\n      template: `<div><div>Key</div><div>Value</div></div>`,\r\n      update: noop\r\n    };\r\n  }\r\n\r\n}\r\n\r\nexport function groupByKey<T extends { key: string }>(arr: T[][]) {\r\n  const m = new Map<string, T[]>();\r\n  arr.forEach((a) => a.forEach((d) => {\r\n    if (!m.has(d.key)) {\r\n      m.set(d.key, [d]);\r\n    } else {\r\n      m.get(d.key)!.push(d);\r\n    }\r\n  }));\r\n  return Array.from(m).sort((a, b) => a[0].localeCompare(b[0])).map(([key, values]) => ({key, values}));\r\n}\r\n","import {IDataRow, IGroup} from '../model';\r\nimport Column from '../model/Column';\r\nimport {ERenderMode, ICellRendererFactory, ICellRenderer, IGroupCellRenderer, ISummaryRenderer} from './interfaces';\r\nimport {renderMissingDOM} from './missing';\r\nimport {groupByKey} from './TableCellRenderer';\r\nimport {noop, noRenderer} from './utils';\r\nimport LinkMapColumn from '../model/LinkMapColumn';\r\nimport {ILink} from '../model/LinkColumn';\r\nimport {IKeyValue} from '../model/IArrayColumn';\r\n\r\nexport default class LinkMapCellRenderer implements ICellRendererFactory {\r\n  readonly title: string = 'Table with Links';\r\n\r\n  canRender(col: Column, mode: ERenderMode): boolean {\r\n    return col instanceof LinkMapColumn && mode !== ERenderMode.SUMMARY;\r\n  }\r\n\r\n  create(col: LinkMapColumn): ICellRenderer {\r\n    const align = col.alignment || 'left';\r\n    return {\r\n      template: `<div></div>`,\r\n      update: (node: HTMLElement, d: IDataRow) => {\r\n        if (renderMissingDOM(node, col, d)) {\r\n          return;\r\n        }\r\n        node.innerHTML = col.getLinkMap(d).map(({key, value}) => `<div>${key}</div><div${align !== 'left' ? ` class=\"lu-${align}\"` : ''}><a href=\"${value.href}\" target=\"_blank\">${value.alt}</a></div>`).join('');\r\n      },\r\n      render: noop\r\n    };\r\n  }\r\n\r\n  private static example(arr: IKeyValue<ILink>[]) {\r\n    const numExampleRows = 5;\r\n    const examples = <string[]>[];\r\n    for (const row of arr) {\r\n      examples.push(`<a target=\"_blank\" href=\"${row.value.href}\">${row.value.alt}</a>`);\r\n      if (examples.length >= numExampleRows) {\r\n        break;\r\n      }\r\n    }\r\n    return `${examples.join(', ')}${examples.length < arr.length} ? ', &hellip;': ''}`;\r\n  }\r\n\r\n  createGroup(col: LinkMapColumn): IGroupCellRenderer {\r\n    const align = col.alignment || 'left';\r\n    return {\r\n      template: `<div></div>`,\r\n      update: (node: HTMLElement, _group: IGroup, rows: IDataRow[]) => {\r\n        const vs = rows.filter((d) => !col.isMissing(d)).map((d) => col.getLinkMap(d));\r\n\r\n        const entries = groupByKey(vs);\r\n\r\n        node.innerHTML = entries.map(({key, values}) => `<div>${key}</div><div${align !== 'left' ? ` class=\"lu-${align}\"` : ''}>${LinkMapCellRenderer.example(values)}</div>`).join('');\r\n      }\r\n    };\r\n  }\r\n\r\n  createSummary(): ISummaryRenderer {\r\n    return noRenderer;\r\n  }\r\n}\r\n","import {ICellRendererFactory, IGroupCellRenderer, ISummaryRenderer} from './interfaces';\r\nimport {noop} from './utils';\r\n\r\nexport default class LoadingCellRenderer implements ICellRendererFactory {\r\n  readonly title: string = 'Loading';\r\n\r\n  canRender(): boolean {\r\n    return false; // just direct selection\r\n  }\r\n\r\n  create() { // no typing because ICellRenderer would not be assignable to IGroupCellRenderer and ISummaryRenderer\r\n    return {\r\n      template: `<div>Loading</div>`,\r\n      update: noop,\r\n      render: noop\r\n    };\r\n  }\r\n\r\n  createGroup(): IGroupCellRenderer {\r\n    return this.create();\r\n  }\r\n\r\n  createSummary(): ISummaryRenderer {\r\n    return this.create();\r\n  }\r\n}\r\n","import {ICategoricalStatistics, IStatistics} from '../internal/math';\r\nimport {IDataRow, isMissingValue, isNumberColumn} from '../model';\r\nimport Column from '../model/Column';\r\nimport {IMapColumn, isMapColumn} from '../model/IArrayColumn';\r\nimport {DEFAULT_FORMATTER} from '../model/INumberColumn';\r\nimport {IMapAbleColumn, isMapAbleColumn} from '../model/MappingFunction';\r\nimport {colorOf} from './impose';\r\nimport {ICellRendererFactory, IImposer, default as IRenderContext, ERenderMode, ICellRenderer, IGroupCellRenderer, ISummaryRenderer} from './interfaces';\r\nimport {renderMissingDOM} from './missing';\r\nimport {noop, noRenderer} from './utils';\r\n\r\nexport default class MapBarCellRenderer implements ICellRendererFactory {\r\n  readonly title: string = 'Bar Table';\r\n\r\n  canRender(col: Column, mode: ERenderMode): boolean {\r\n    return isMapColumn(col) && isNumberColumn(col) && (mode === ERenderMode.CELL || (mode === ERenderMode.SUMMARY && isMapAbleColumn(col)));\r\n  }\r\n\r\n  create(col: IMapColumn<number>, _context: IRenderContext, _hist: IStatistics | ICategoricalStatistics | null, imposer?: IImposer): ICellRenderer {\r\n    return {\r\n      template: `<div></div>`,\r\n      update: (node: HTMLElement, d: IDataRow) => {\r\n        if (renderMissingDOM(node, col, d)) {\r\n          return;\r\n        }\r\n        node.innerHTML = col.getMap(d).map(({key, value}) => {\r\n          if (isMissingValue(value)) {\r\n            return `<div>${key}</div><div class=\"lu-missing\"></div>`;\r\n          }\r\n          const w = isNaN(value) ? 0 : Math.round(value * 100 * 100) / 100;\r\n          return `<div>${key}</div><div title=\"${DEFAULT_FORMATTER(value)}\"><div style=\"width: ${w}%; background-color: ${colorOf(col, d, imposer)}\"><span class=\"lu-hover-only\">${value}</span></div></div>`;\r\n        }).join('');\r\n      },\r\n      render: noop\r\n    };\r\n  }\r\n\r\n  createGroup(): IGroupCellRenderer {\r\n    return noRenderer;\r\n  }\r\n\r\n  createSummary(col: IMapColumn<number> & IMapAbleColumn): ISummaryRenderer {\r\n    return {\r\n      template: `<div><div>Key</div><div><span></span><span></span>Value</div></div>`,\r\n      update: (node: HTMLElement) => {\r\n        const range = col.getRange();\r\n        const value = <HTMLElement>node.lastElementChild!;\r\n        value.firstElementChild!.textContent = range[0];\r\n        value.children[1]!.textContent = range[1];\r\n      }\r\n    };\r\n  }\r\n}\r\n","import {IDataRow, IGroup} from '../model';\r\nimport Column from '../model/Column';\r\nimport RankColumn from '../model/RankColumn';\r\nimport {ICellRendererFactory, ICellRenderer, IGroupCellRenderer, ISummaryRenderer} from './interfaces';\r\nimport {renderMissingDOM} from './missing';\r\nimport {noop, noRenderer, setText} from './utils';\r\n\r\nexport default class RankCellRenderer implements ICellRendererFactory {\r\n  readonly title: string = 'Default';\r\n\r\n  canRender(col: Column): boolean {\r\n    return col instanceof RankColumn;\r\n  }\r\n\r\n  create(col: Column): ICellRenderer {\r\n    return {\r\n      template: `<div class=\"lu-right\"> </div>`,\r\n      update: (n: HTMLDivElement, d: IDataRow) => {\r\n        renderMissingDOM(n, col, d);\r\n        setText(n, col.getLabel(d));\r\n      },\r\n      render: noop\r\n    };\r\n  }\r\n\r\n  createGroup(col: Column): IGroupCellRenderer {\r\n    return {\r\n      template: `<div><div></div><div></div></div>`,\r\n      update: (n: HTMLElement, _group: IGroup, rows: IDataRow[]) => {\r\n        const fromTSpan = <HTMLElement>n.firstElementChild!;\r\n        const toTSpan = <HTMLElement>n.lastElementChild!;\r\n        if (rows.length === 0) {\r\n          fromTSpan.textContent = '';\r\n          toTSpan.textContent = '';\r\n          return;\r\n        }\r\n        fromTSpan.textContent = col.getLabel(rows[0]);\r\n        toTSpan.textContent = col.getLabel(rows[rows.length - 1],);\r\n      }\r\n    };\r\n  }\r\n\r\n  createSummary(): ISummaryRenderer {\r\n    return noRenderer;\r\n  }\r\n}\r\n","import {IDataRow, IGroup, isMissingValue} from '../model';\r\nimport Column from '../model/Column';\r\nimport {INumbersColumn, isNumbersColumn} from '../model/INumberColumn';\r\nimport NumbersColumn from '../model/NumbersColumn';\r\nimport {matchRows} from './ANumbersCellRenderer';\r\nimport {ERenderMode, ICellRendererFactory, ICellRenderer, IGroupCellRenderer, ISummaryRenderer} from './interfaces';\r\nimport {renderMissingDOM} from './missing';\r\nimport {forEachChild, noop, noRenderer} from './utils';\r\n\r\nexport function line(data: number[]) {\r\n  if (data.length === 0) {\r\n    return '';\r\n  }\r\n  let p = '';\r\n  let moveNext = true;\r\n\r\n  data.forEach((d, i) => {\r\n    if (isMissingValue(d)) {\r\n      moveNext = true;\r\n    } else if (moveNext) {\r\n      p += `M${i},${1 - d} `;\r\n      moveNext = false;\r\n    } else {\r\n      p += `L${i},${1 - d} `;\r\n    }\r\n  });\r\n  return p;\r\n}\r\n\r\nexport default class SparklineCellRenderer implements ICellRendererFactory {\r\n  readonly title: string = 'Sparkline';\r\n\r\n  canRender(col: Column, mode: ERenderMode): boolean {\r\n    return isNumbersColumn(col) && mode !== ERenderMode.SUMMARY;\r\n  }\r\n\r\n  create(col: INumbersColumn): ICellRenderer {\r\n    const dataLength = col.dataLength!;\r\n    const yPos = 1 - col.getMapping().apply(NumbersColumn.CENTER);\r\n    return {\r\n      template: `<svg viewBox=\"0 0 ${dataLength - 1} 1\" preserveAspectRatio=\"none meet\"><line x1=\"0\" x2=\"${dataLength - 1}\" y1=\"${yPos}\" y2=\"${yPos}\"></line><path></path></svg>`,\r\n      update: (n: HTMLElement, d: IDataRow) => {\r\n        if (renderMissingDOM(n, col, d)) {\r\n          return;\r\n        }\r\n        const data = col.getNumbers(d);\r\n        n.querySelector('path')!.setAttribute('d', line(data));\r\n      },\r\n      render: noop\r\n    };\r\n  }\r\n\r\n  createGroup(col: INumbersColumn): IGroupCellRenderer {\r\n    const dataLength = col.dataLength!;\r\n    const yPos = 1 - col.getMapping().apply(NumbersColumn.CENTER);\r\n    return {\r\n      template: `<svg viewBox=\"0 0 ${dataLength} 1\" preserveAspectRatio=\"none meet\"><line x1=\"0\" x2=\"${dataLength - 1}\" y1=\"${yPos}\" y2=\"${yPos}\"></line><path></path></svg>`,\r\n      update: (n: HTMLElement, _group: IGroup, rows: IDataRow[]) => {\r\n        //overlapping ones\r\n        matchRows(n, rows, `<path></path>`);\r\n        forEachChild(n, ((row, i) => {\r\n          const d = rows[i];\r\n          row.setAttribute('d', line(col.getNumbers(d)));\r\n        }));\r\n      }\r\n    };\r\n  }\r\n\r\n  createSummary(): ISummaryRenderer {\r\n    return noRenderer;\r\n  }\r\n\r\n}\r\n","import {IDataRow} from '../model';\r\nimport Column from '../model/Column';\r\nimport {DEFAULT_FORMATTER, INumbersColumn, isNumbersColumn} from '../model/INumberColumn';\r\nimport NumbersColumn from '../model/NumbersColumn';\r\nimport {CANVAS_HEIGHT} from '../styles';\r\nimport {ANumbersCellRenderer} from './ANumbersCellRenderer';\r\nimport {toHeatMapColor} from './BrightnessCellRenderer';\r\nimport IRenderContext, {ERenderMode, ICellRendererFactory, IImposer} from './interfaces';\r\nimport {attr, forEachChild, noRenderer} from './utils';\r\nimport {ISummaryRenderer} from './interfaces';\r\n\r\nexport default class VerticalBarCellRenderer extends ANumbersCellRenderer implements ICellRendererFactory {\r\n  readonly title: string = 'Bar Chart';\r\n\r\n  canRender(col: Column, mode: ERenderMode): boolean {\r\n    return isNumbersColumn(col) && Boolean(col.dataLength) && mode === ERenderMode.CELL;\r\n  }\r\n\r\n  private static compute(v: number, threshold: number, domain: number[]) {\r\n    if (v < threshold) {\r\n      //threshold to down\r\n      return {height: (threshold - v), bottom: (v - domain[0])};\r\n    }\r\n    //from top to down\r\n    return {height: (v - threshold), bottom: (threshold - domain[0])};\r\n  }\r\n\r\n  protected createContext(col: INumbersColumn, context: IRenderContext, imposer?: IImposer) {\r\n    const cellDimension = context.colWidth(col) / col.dataLength!;\r\n    const threshold = col.getMapping().apply(NumbersColumn.CENTER);\r\n    const range = 1;\r\n    let templateRows = '';\r\n    for (let i = 0; i < col.dataLength!; ++i) {\r\n      templateRows += `<div style=\"background-color: white\" title=\"\"></div>`;\r\n    }\r\n    return {\r\n      templateRow: templateRows,\r\n      update: (row: HTMLElement, data: number[], raw: number[], item: IDataRow) => {\r\n        const zero = toHeatMapColor(0, item, col, imposer);\r\n        const one = toHeatMapColor(1, item, col, imposer);\r\n\r\n        forEachChild(row, (d, i) => {\r\n          const v = data[i];\r\n          const {bottom, height} = VerticalBarCellRenderer.compute(v, threshold, [0, 1]);\r\n          attr(<HTMLElement>d, {\r\n            title: DEFAULT_FORMATTER(raw[i])\r\n          }, {\r\n            'background-color': v < threshold ? zero : one,\r\n            bottom: `${Math.round((100 * bottom) / range)}%`,\r\n            height: `${Math.round((100 * height) / range)}%`\r\n          });\r\n        });\r\n      },\r\n      render: (ctx: CanvasRenderingContext2D, data: number[], item: IDataRow) => {\r\n        const zero = toHeatMapColor(0, item, col, imposer);\r\n        const one = toHeatMapColor(1, item, col, imposer);\r\n        const scale = CANVAS_HEIGHT / range;\r\n        data.forEach((v, j) => {\r\n          ctx.fillStyle = v < threshold ? zero : one;\r\n          const xpos = (j * cellDimension);\r\n          const {bottom, height} = VerticalBarCellRenderer.compute(v, threshold, [0, 1]);\r\n          ctx.fillRect(xpos, (range - height - bottom) * scale, cellDimension, height * scale);\r\n        });\r\n      }\r\n    };\r\n  }\r\n\r\n  createSummary(): ISummaryRenderer {\r\n    return noRenderer;\r\n  }\r\n}\r\n","import {IDataRow, IGroup} from '../model';\r\nimport Column from '../model/Column';\r\nimport {ICellRendererFactory, IGroupCellRenderer, ISummaryRenderer, ICellRenderer} from './interfaces';\r\nimport {renderMissingDOM} from './missing';\r\nimport {noop, noRenderer, setText, exampleText} from './utils';\r\nimport DateColumn, {choose} from '../model/DateColumn';\r\n\r\nexport default class DateCellRenderer implements ICellRendererFactory {\r\n  title: string = 'Date';\r\n  groupTitle: string = 'Date';\r\n  summaryTitle: string = 'Date';\r\n\r\n  canRender(col: Column): boolean {\r\n    return col instanceof DateColumn;\r\n  }\r\n\r\n  create(col: DateColumn): ICellRenderer {\r\n    return {\r\n      template: `<div> </div>`,\r\n      update: (n: HTMLDivElement, d: IDataRow) => {\r\n        renderMissingDOM(n, col, d);\r\n        setText(n, col.getLabel(d));\r\n      },\r\n      render: noop\r\n    };\r\n  }\r\n\r\n  createGroup(col: DateColumn): IGroupCellRenderer {\r\n    const isGrouped = col.isGroupedBy() >= 0;\r\n    const grouper = col.getDateGrouper();\r\n    return {\r\n      template: `<div> </div>`,\r\n      update: (n: HTMLDivElement, _group: IGroup, rows: IDataRow[]) => {\r\n        if (isGrouped) {\r\n          const chosen = choose(rows, grouper, col);\r\n          setText(n, chosen.name);\r\n          return;\r\n        }\r\n        setText(n, exampleText(col, rows));\r\n      }\r\n    };\r\n  }\r\n\r\n  createSummary(): ISummaryRenderer {\r\n    return noRenderer;\r\n  }\r\n}\r\n","import Column from '../model/Column';\r\nimport ActionRenderer from './ActionRenderer';\r\nimport AggregateGroupRenderer from './AggregateGroupRenderer';\r\nimport AnnotationRenderer from './AnnotationRenderer';\r\nimport BarCellRenderer from './BarCellRenderer';\r\nimport BooleanCellRenderer from './BooleanCellRenderer';\r\nimport BoxplotCellRenderer from './BoxplotCellRenderer';\r\nimport BrightnessCellRenderer from './BrightnessCellRenderer';\r\nimport CategoricalCellRenderer from './CategoricalCellRenderer';\r\nimport CategoricalHeatmapCellRenderer from './CategoricalHeatmapCellRenderer';\r\nimport CategoricalStackedDistributionlCellRenderer from './CategoricalStackedDistributionlCellRenderer';\r\nimport CircleCellRenderer from './CircleCellRenderer';\r\nimport {DefaultCellRenderer} from './DefaultCellRenderer';\r\nimport DotCellRenderer from './DotCellRenderer';\r\nimport GroupCellRenderer from './GroupCellRenderer';\r\nimport HeatmapCellRenderer from './HeatmapCellRenderer';\r\nimport HistogramCellRenderer from './HistogramCellRenderer';\r\nimport ImageCellRenderer from './ImageCellRenderer';\r\nimport {ERenderMode, ICellRendererFactory} from './interfaces';\r\nimport InterleavingCellRenderer from './InterleavingCellRenderer';\r\nimport LinkCellRenderer from './LinkCellRenderer';\r\nimport LinkMapCellRenderer from './LinkMapCellRenderer';\r\nimport LoadingCellRenderer from './LoadingCellRenderer';\r\nimport MapBarCellRenderer from './MapBarCellRenderer';\r\nimport MultiLevelCellRenderer from './MultiLevelCellRenderer';\r\nimport RankCellRenderer from './RankCellRenderer';\r\nimport SelectionRenderer from './SelectionRenderer';\r\nimport SparklineCellRenderer from './SparklineCellRenderer';\r\nimport StringCellRenderer from './StringCellRenderer';\r\nimport TableCellRenderer from './TableCellRenderer';\r\nimport UpSetCellRenderer from './UpSetCellRenderer';\r\nimport VerticalBarCellRenderer from './VerticalBarCellRenderer';\r\nimport DateCellRenderer from './DateCellRenderer';\r\n\r\n// re-export all the renderers\r\nexport {\r\n  ActionRenderer,\r\n  AggregateGroupRenderer,\r\n  AnnotationRenderer,\r\n  BarCellRenderer,\r\n  BooleanCellRenderer,\r\n  BoxplotCellRenderer,\r\n  BrightnessCellRenderer,\r\n  CategoricalCellRenderer,\r\n  CategoricalHeatmapCellRenderer,\r\n  CategoricalStackedDistributionlCellRenderer,\r\n  CircleCellRenderer,\r\n  DefaultCellRenderer,\r\n  DotCellRenderer,\r\n  GroupCellRenderer,\r\n  HeatmapCellRenderer,\r\n  HistogramCellRenderer,\r\n  ImageCellRenderer,\r\n  InterleavingCellRenderer,\r\n  LinkCellRenderer,\r\n  LinkMapCellRenderer,\r\n  LoadingCellRenderer,\r\n  MapBarCellRenderer,\r\n  MultiLevelCellRenderer,\r\n  RankCellRenderer,\r\n  SelectionRenderer,\r\n  SparklineCellRenderer,\r\n  StringCellRenderer,\r\n  TableCellRenderer,\r\n  UpSetCellRenderer,\r\n  VerticalBarCellRenderer,\r\n  DateCellRenderer\r\n};\r\n\r\nexport {\r\n  default as IRenderContext,\r\n  IImposer,\r\n  ERenderMode,\r\n  ISummaryRenderer,\r\n  IGroupCellRenderer,\r\n  ICellRenderer,\r\n  ICellRendererFactory\r\n} from './interfaces';\r\n\r\nexport {colorOf} from './impose';\r\nexport {renderMissingDOM, renderMissingCanvas} from './missing';\r\n\r\n\r\nconst defaultCellRenderer = new DefaultCellRenderer();\r\n/**\r\n * default render factories\r\n */\r\nexport const renderers: { [key: string]: ICellRendererFactory } = {\r\n  actions: new ActionRenderer(),\r\n  aggregate: new AggregateGroupRenderer(),\r\n  annotate: new AnnotationRenderer(),\r\n  boolean: new BooleanCellRenderer(),\r\n  boxplot: new BoxplotCellRenderer(),\r\n  brightness: new BrightnessCellRenderer(),\r\n  catdistributionbar: new CategoricalStackedDistributionlCellRenderer(),\r\n  categorical: new CategoricalCellRenderer(),\r\n  circle: new CircleCellRenderer(),\r\n  date: new DateCellRenderer(),\r\n  default: defaultCellRenderer,\r\n  dot: new DotCellRenderer(),\r\n  group: new GroupCellRenderer(),\r\n  heatmap: new HeatmapCellRenderer(),\r\n  catheatmap: new CategoricalHeatmapCellRenderer(),\r\n  histogram: new HistogramCellRenderer(),\r\n  image: new ImageCellRenderer(),\r\n  interleaving: new InterleavingCellRenderer(),\r\n  link: new LinkCellRenderer(),\r\n  linkMap: new LinkMapCellRenderer(),\r\n  loading: new LoadingCellRenderer(),\r\n  nested: new MultiLevelCellRenderer(false),\r\n  number: new BarCellRenderer(),\r\n  mapbars: new MapBarCellRenderer(),\r\n  rank: new RankCellRenderer(),\r\n  selection: new SelectionRenderer(),\r\n  sparkline: new SparklineCellRenderer(),\r\n  stack: new MultiLevelCellRenderer(),\r\n  string: new StringCellRenderer(),\r\n  table: new TableCellRenderer(),\r\n  upset: new UpSetCellRenderer(),\r\n  verticalbar: new VerticalBarCellRenderer()\r\n};\r\n\r\n\r\nexport function chooseRenderer(col: Column, renderers: { [key: string]: ICellRendererFactory }): ICellRendererFactory {\r\n  const r = renderers[col.getRenderer()];\r\n  return r || defaultCellRenderer;\r\n}\r\n\r\nexport function chooseGroupRenderer(col: Column, renderers: { [key: string]: ICellRendererFactory }): ICellRendererFactory {\r\n  const r = renderers[col.getGroupRenderer()];\r\n  return r || defaultCellRenderer;\r\n}\r\n\r\nexport function chooseSummaryRenderer(col: Column, renderers: { [key: string]: ICellRendererFactory }): ICellRendererFactory {\r\n  const r = renderers[col.getSummaryRenderer()];\r\n  return r || defaultCellRenderer;\r\n}\r\n\r\nexport function possibleRenderer(col: Column, renderers: { [key: string]: ICellRendererFactory }, mode: ERenderMode = ERenderMode.CELL): { type: string, label: string }[] {\r\n  const valid = Object.keys(renderers).filter((type) => {\r\n    const factory = renderers[type];\r\n    return factory.canRender(col, mode);\r\n  });\r\n  // TODO some magic to remove and order\r\n\r\n\r\n  return valid.map((type) => {\r\n    const r = renderers[type];\r\n    return {\r\n      type,\r\n      label: mode === ERenderMode.CELL ? r.title : (mode === ERenderMode.GROUP ? r.groupTitle || r.title : r.summaryTitle || r.groupTitle || r.title)\r\n    };\r\n  });\r\n}\r\n\r\nexport function possibleGroupRenderer(col: Column, renderers: { [key: string]: ICellRendererFactory }) {\r\n  return possibleRenderer(col, renderers, ERenderMode.GROUP);\r\n}\r\n\r\nexport function possibleSummaryRenderer(col: Column, renderers: { [key: string]: ICellRendererFactory }) {\r\n  return possibleRenderer(col, renderers, ERenderMode.SUMMARY);\r\n}\r\n","import {Category, SupportType, toolbar} from './annotations';\r\nimport {IDataRow, IGroup} from './interfaces';\r\nimport Column, {widthChanged, labelChanged, metaDataChanged, dirty, dirtyHeader, dirtyValues, rendererTypeChanged, groupRendererChanged, summaryRendererChanged, visibilityChanged} from './Column';\r\nimport ValueColumn, {IValueColumnDesc, dataLoaded} from './ValueColumn';\r\nimport {IEventListener} from '../internal/AEventDispatcher';\r\n\r\n/**\r\n * factory for creating a description creating a rank column\r\n * @param label\r\n * @returns {{type: string, label: string}}\r\n */\r\nexport function createSelectionDesc(label: string = 'Selection Checkboxes') {\r\n  return {type: 'selection', label, fixed: true};\r\n}\r\n\r\nexport interface ISelectionColumnDesc extends IValueColumnDesc<boolean> {\r\n  /**\r\n   * setter for selecting/deselecting the given row\r\n   */\r\n  setter(row: IDataRow, value: boolean): void;\r\n\r\n  /**\r\n   * setter for selecting/deselecting the given row\r\n   */\r\n  setterAll(rows: IDataRow[], value: boolean): void;\r\n}\r\n\r\n\r\n/**\r\n * emitted when rows are selected\r\n * @asMemberOf SelectionColumn\r\n * @param row the (de)seleced row\r\n * @param value true if selected else false\r\n * @param rows in case of multiple rows are selected\r\n * @event\r\n */\r\nexport declare function select(row: IDataRow, value: boolean, rows?: IDataRow[]): void;\r\n\r\n/**\r\n * a checkbox column for selections\r\n */\r\n@SupportType()\r\n@toolbar('sort', 'sortBy', 'group', 'groupBy', 'invertSelection')\r\n@Category('support')\r\nexport default class SelectionColumn extends ValueColumn<boolean> {\r\n  private static SELECTED_GROUP: IGroup = {\r\n    name: 'Selected',\r\n    color: 'orange'\r\n  };\r\n  private static NOT_SELECTED_GROUP: IGroup = {\r\n    name: 'Unselected',\r\n    color: 'gray'\r\n  };\r\n  static readonly EVENT_SELECT = 'select';\r\n\r\n  constructor(id: string, desc: Readonly<ISelectionColumnDesc>) {\r\n    super(id, desc);\r\n    this.setDefaultWidth(20);\r\n  }\r\n\r\n  get frozen() {\r\n    return this.desc.frozen !== false;\r\n  }\r\n\r\n  protected createEventList() {\r\n    return super.createEventList().concat([SelectionColumn.EVENT_SELECT]);\r\n  }\r\n\r\n  on(type: typeof SelectionColumn.EVENT_SELECT, listener: typeof select | null): this;\r\n  on(type: typeof ValueColumn.EVENT_DATA_LOADED, listener: typeof dataLoaded | null): this;\r\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\r\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\r\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\r\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\r\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\r\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\r\n  on(type: string | string[], listener: IEventListener | null): this {\r\n    return super.on(<any>type, listener);\r\n  }\r\n\r\n  setValue(row: IDataRow, value: boolean) {\r\n    const old = this.getValue(row);\r\n    if (old === value) {\r\n      return true;\r\n    }\r\n    return this.setImpl(row, value);\r\n  }\r\n\r\n  setValues(rows: IDataRow[], value: boolean) {\r\n    if (rows.length === 0) {\r\n      return;\r\n    }\r\n    if ((<ISelectionColumnDesc>this.desc).setterAll) {\r\n      (<ISelectionColumnDesc>this.desc).setterAll(rows, value);\r\n    }\r\n    this.fire(SelectionColumn.EVENT_SELECT, rows[0], value, rows);\r\n    return true;\r\n  }\r\n\r\n  private setImpl(row: IDataRow, value: boolean) {\r\n    if ((<ISelectionColumnDesc>this.desc).setter) {\r\n      (<ISelectionColumnDesc>this.desc).setter(row, value);\r\n    }\r\n    this.fire(SelectionColumn.EVENT_SELECT, row, value);\r\n    return true;\r\n  }\r\n\r\n  toggleValue(row: IDataRow) {\r\n    const old = this.getValue(row);\r\n    this.setImpl(row, !old);\r\n    return !old;\r\n  }\r\n\r\n  compare(a: IDataRow, b: IDataRow) {\r\n    const va = this.getValue(a) === true;\r\n    const vb = this.getValue(b) === true;\r\n    return va === vb ? 0 : (va < vb ? -1 : +1);\r\n  }\r\n\r\n  group(row: IDataRow) {\r\n    const isSelected = this.getValue(row);\r\n    return isSelected ? SelectionColumn.SELECTED_GROUP : SelectionColumn.NOT_SELECTED_GROUP;\r\n  }\r\n}\r\n","import Column from './Column';\r\nimport {IDataRow} from './interfaces';\r\n\r\n\r\nexport interface IKeyValue<T> {\r\n  key: string;\r\n  value: T;\r\n}\r\n\r\nexport interface IMapColumn<T> extends Column {\r\n  getMap(row: IDataRow): IKeyValue<T>[];\r\n\r\n  getMapLabel(row: IDataRow): IKeyValue<string>[];\r\n}\r\n\r\nexport function isMapColumn(col: Column): col is IMapColumn<any> {\r\n  return typeof (<IMapColumn<any>>col).getMap === 'function' && typeof (<IMapColumn<any>>col).getMapLabel === 'function';\r\n}\r\n\r\nexport interface IArrayColumn<T> extends IMapColumn<T> {\r\n  readonly labels: string[];\r\n  readonly dataLength: number | null;\r\n\r\n  getLabels(row: IDataRow): string[];\r\n\r\n  getValues(row: IDataRow): T[];\r\n}\r\n\r\nexport function isArrayColumn(col: Column): col is IArrayColumn<any> {\r\n  return typeof (<IArrayColumn<any>>col).getLabels === 'function' && typeof (<IArrayColumn<any>>col).getValues === 'function' && isMapColumn(col);\r\n}\r\n","export interface IStyleColumn {\r\n  /**\r\n   * column description\r\n   */\r\n  description: string;\r\n\r\n  /**\r\n   * color of this column\r\n   * @deprecated not used anymore\r\n   */\r\n  color: string;\r\n\r\n  /**\r\n   * frozen column\r\n   * @default isSupportType\r\n   */\r\n  frozen: boolean;\r\n\r\n  /**\r\n   * whether the column can be removed or not\r\n   * @default false\r\n   */\r\n  fixed: boolean;\r\n\r\n  /**\r\n   * default renderer to use\r\n   */\r\n  renderer: string;\r\n\r\n  /**\r\n   * default group renderer to use\r\n   */\r\n  groupRenderer: string;\r\n\r\n  /**\r\n   * default summary renderer to use\r\n   */\r\n  summaryRenderer: string;\r\n\r\n  /**\r\n   * initial width of the column\r\n   * @default 100 or 200 for strings\r\n   */\r\n  width: number;\r\n\r\n  /**\r\n   * is this column visible by default\r\n   * @default true\r\n   */\r\n  visible: boolean;\r\n}\r\n\r\n\r\nexport interface IColumnDesc extends Partial<IStyleColumn> {\r\n  /**\r\n   * label of the column\r\n   */\r\n  label: string;\r\n  /**\r\n   * the column type\r\n   */\r\n  type: string;\r\n}\r\n\r\n\r\n/**\r\n * a data row for rendering\r\n */\r\nexport interface IDataRow {\r\n  /**\r\n   * the value\r\n   */\r\n  readonly v: any;\r\n  /**\r\n   * the underlying data index\r\n   */\r\n  readonly i: number;\r\n}\r\n\r\n\r\nexport interface IGroup {\r\n  name: string;\r\n  color: string;\r\n  parent?: Readonly<IGroupParent> | null;\r\n}\r\n\r\nexport interface IGroupParent extends IGroup {\r\n  subGroups: (Readonly<IGroupParent> | Readonly<IGroup>)[];\r\n}\r\n\r\nexport interface IGroupItem extends IDataRow {\r\n  readonly group: IGroup;\r\n  readonly relativeIndex: number;\r\n  readonly meta?: 'first' | 'last' | 'first last';\r\n}\r\n\r\nexport interface IGroupData extends Readonly<IGroup> {\r\n  readonly rows: IDataRow[];\r\n}\r\n\r\nexport function isGroup(item: IGroupData | IGroupItem): item is IGroupData {\r\n  return item && (<IGroupData>item).name !== undefined; // use .name as separator\r\n}\r\n","import formatDecimal from \"./formatDecimal.js\";\n\nexport default function(x) {\n  return x = formatDecimal(Math.abs(x)), x ? x[1] : NaN;\n}\n","import {ICategoricalStatistics, IStatistics} from '../internal';\r\nimport {IDataRow, IGroup} from '../model';\r\nimport Column from '../model/Column';\r\nimport {\r\n  default as IRenderContext, ERenderMode, ICellRenderer, ICellRendererFactory, IGroupCellRenderer,\r\n  IImposer\r\n} from './interfaces';\r\nimport {noRenderer} from './utils';\r\nimport {ISummaryRenderer} from './interfaces';\r\n\r\n/**\r\n * helper class that renders a group renderer as a selected (e.g. median) single item\r\n */\r\nexport abstract class AAggregatedGroupRenderer<T extends Column> implements ICellRendererFactory {\r\n  abstract readonly title: string;\r\n\r\n  abstract canRender(col: Column, mode: ERenderMode): boolean;\r\n\r\n  abstract create(col: T, context: IRenderContext, hist: IStatistics | ICategoricalStatistics | null, imposer?: IImposer): ICellRenderer;\r\n\r\n  protected abstract aggregatedIndex(rows: IDataRow[], col: T): number;\r\n\r\n  createGroup(col: T, context: IRenderContext, hist: IStatistics | ICategoricalStatistics | null, imposer?: IImposer): IGroupCellRenderer {\r\n    const single = this.create(col, context, hist, imposer);\r\n    return {\r\n      template: `<div>${single.template}</div>`,\r\n      update: (node: HTMLElement, group: IGroup, rows: IDataRow[]) => {\r\n        const aggregate = this.aggregatedIndex(rows, col);\r\n        single.update(<HTMLElement>node.firstElementChild!, rows[aggregate], aggregate, group);\r\n      }\r\n    };\r\n  }\r\n\r\n  createSummary(): ISummaryRenderer {\r\n    return noRenderer;\r\n  }\r\n}\r\n\r\nexport default AAggregatedGroupRenderer;\r\n","import {ICategoricalStatistics, IStatistics, round} from '../internal';\r\nimport {IDataRow, IGroup, IMultiLevelColumn, isMultiLevelColumn} from '../model';\r\nimport Column from '../model/Column';\r\nimport {medianIndex} from '../model/internal';\r\nimport {default as INumberColumn, isNumberColumn} from '../model/INumberColumn';\r\nimport {COLUMN_PADDING} from '../styles';\r\nimport {AAggregatedGroupRenderer} from './AAggregatedGroupRenderer';\r\nimport {default as IRenderContext, ERenderMode, ICellRendererFactory, IImposer, ICellRenderer, IGroupCellRenderer, ISummaryRenderer} from './interfaces';\r\nimport {renderMissingCanvas, renderMissingDOM} from './missing';\r\nimport {matchColumns} from './utils';\r\n\r\n// @internal\r\nexport function gridClass(column: Column) {\r\n  return `lu-stacked-${column.id}`;\r\n}\r\n\r\nexport interface ICols {\r\n  column: Column;\r\n  shift: number;\r\n  width: number;\r\n  template: string;\r\n  rendererId: string;\r\n  renderer: ICellRenderer | null;\r\n  groupRenderer: IGroupCellRenderer | null;\r\n  summaryRenderer: ISummaryRenderer | null;\r\n}\r\n\r\nexport function createFlatColumnData(col: { children: Column[] } & Column, context: IRenderContext, stacked: boolean, mode: ERenderMode, imposer?: IImposer): {cols: ICols[], stacked: boolean, padding: number} {\r\n  const padding = COLUMN_PADDING;\r\n  let offset = 0;\r\n  const cols = col.children.map((d) => {\r\n    const shift = offset;\r\n    const width = d.getWidth();\r\n    offset += width;\r\n    offset += (!stacked ? padding : 0);\r\n\r\n    const renderer = mode === ERenderMode.CELL ? context.renderer(d, imposer) : null;\r\n    const groupRenderer = mode === ERenderMode.GROUP ? context.groupRenderer(d, imposer) : null;\r\n    const summaryRenderer = mode === ERenderMode.GROUP ? context.summaryRenderer(d, false, imposer) : null;\r\n    let template: string = '';\r\n    let rendererId: string = '';\r\n    switch (mode) {\r\n      case ERenderMode.CELL:\r\n        template = renderer!.template;\r\n        rendererId = col.getRenderer();\r\n        break;\r\n      case ERenderMode.GROUP:\r\n        template = groupRenderer!.template;\r\n        rendererId = col.getGroupRenderer();\r\n        break;\r\n      case ERenderMode.SUMMARY:\r\n        template = summaryRenderer!.template;\r\n        rendererId = col.getSummaryRenderer();\r\n        break;\r\n    }\r\n    // inject data attributes\r\n    template = template.replace(/^<([^ >]+)([ >])/, `<$1 data-column-id=\"${d.id}\" data-renderer=\"${rendererId}\"$2`);\r\n    return {\r\n      column: d,\r\n      shift,\r\n      width,\r\n      template,\r\n      rendererId,\r\n      renderer,\r\n      groupRenderer,\r\n      summaryRenderer\r\n    };\r\n  });\r\n  return {cols, stacked, padding};\r\n}\r\n\r\nexport default class MultiLevelCellRenderer extends AAggregatedGroupRenderer<IMultiLevelColumn & Column> implements ICellRendererFactory {\r\n  readonly title: string;\r\n\r\n  constructor(private readonly stacked: boolean = true) {\r\n    super();\r\n    this.title = this.stacked ? 'Stacked Bar' : 'Nested';\r\n  }\r\n\r\n  canRender(col: Column, mode: ERenderMode): boolean {\r\n    return isMultiLevelColumn(col) && mode !== ERenderMode.SUMMARY;\r\n  }\r\n\r\n  create(col: IMultiLevelColumn & Column, context: IRenderContext, _hist: IStatistics | ICategoricalStatistics | null, imposer?: IImposer): ICellRenderer {\r\n    const {cols, stacked, padding} = createFlatColumnData(col, context, this.stacked, ERenderMode.CELL, imposer);\r\n    const useGrid = context.option('useGridLayout', false);\r\n    const width = context.colWidth(col);\r\n    return {\r\n      template: `<div class='${useGrid ? gridClass(col) : ''}${useGrid && !stacked ? ' lu-grid-space' : ''}'>${cols.map((d) => d.template).join('')}</div>`,\r\n      update: (n: HTMLDivElement, d: IDataRow, i: number, group: IGroup) => {\r\n        if (renderMissingDOM(n, col, d)) {\r\n          return;\r\n        }\r\n        matchColumns(n, cols);\r\n\r\n        const children = <HTMLElement[]>Array.from(n.children);\r\n        const total = col.getWidth();\r\n        let missingWeight = 0;\r\n        cols.forEach((col, ci) => {\r\n          const weight = col.column.getWidth() / total;\r\n          const cnode = children[ci];\r\n          cnode.style.transform = stacked ? `translate(-${round((missingWeight / weight) * 100, 4)}%,0)` : '';\r\n          if (!useGrid) {\r\n            cnode.style.width = `${round(weight * 100, 2)}%`;\r\n            cnode.style.marginRight = stacked ? null : `${padding}px`;\r\n          } else {\r\n            (<any>cnode.style).gridColumnStart = (ci + 1).toString();\r\n          }\r\n          col.renderer!.update(cnode, d, i, group);\r\n          if (stacked) {\r\n            missingWeight += (1 - col.column.getValue(d)) * weight;\r\n          }\r\n        });\r\n      },\r\n      render: (ctx: CanvasRenderingContext2D, d: IDataRow, i: number, group: IGroup) => {\r\n        if (renderMissingCanvas(ctx, col, d, width)) {\r\n          return;\r\n        }\r\n        let stackShift = 0;\r\n        cols.forEach((col) => {\r\n          const shift = col.shift - stackShift;\r\n          ctx.translate(shift, 0);\r\n          col.renderer!.render(ctx, d, i, group);\r\n          ctx.translate(-shift, 0);\r\n          if (stacked) {\r\n            stackShift += col.width * (1 - col.column.getValue(d));\r\n          }\r\n        });\r\n      }\r\n    };\r\n  }\r\n\r\n\r\n  createGroup(col: IMultiLevelColumn & Column, context: IRenderContext, hist: IStatistics | ICategoricalStatistics | null, imposer?: IImposer): IGroupCellRenderer {\r\n    if (this.stacked && isNumberColumn(col)) {\r\n      return super.createGroup(col, context, hist, imposer);\r\n    }\r\n\r\n    const {cols, padding} = createFlatColumnData(col, context, false, ERenderMode.GROUP, imposer);\r\n    const useGrid = context.option('useGridLayout', false);\r\n    return {\r\n      template: `<div class='${useGrid ? gridClass(col) : ''}${useGrid ? ' lu-grid-space' : ''}'>${cols.map((d) => d.template).join('')}</div>`,\r\n      update: (n: HTMLElement, group: IGroup, rows: IDataRow[]) => {\r\n        matchColumns(n, cols);\r\n\r\n        const children = <HTMLElement[]>Array.from(n.children);\r\n        const total = col.getWidth();\r\n        cols.forEach((col, ci) => {\r\n          const weight = col.column.getWidth() / total;\r\n          const cnode = children[ci];\r\n          if (!useGrid) {\r\n            cnode.style.width = `${round(weight * 100, 2)}%`;\r\n            cnode.style.marginRight = `${padding}px`;\r\n          } else {\r\n            (<any>cnode.style).gridColumnStart = (ci + 1).toString();\r\n          }\r\n          col.groupRenderer!.update(cnode, group, rows);\r\n        });\r\n      }\r\n    };\r\n  }\r\n\r\n  protected aggregatedIndex(rows: IDataRow[], col: IMultiLevelColumn & Column) {\r\n    console.assert(isNumberColumn(col));\r\n    return medianIndex(rows, (<INumberColumn><any>col));\r\n  }\r\n}\r\n","import define, {extend} from \"./define.js\";\n\nexport function Color() {}\n\nexport var darker = 0.7;\nexport var brighter = 1 / darker;\n\nvar reI = \"\\\\s*([+-]?\\\\d+)\\\\s*\",\n    reN = \"\\\\s*([+-]?\\\\d*\\\\.?\\\\d+(?:[eE][+-]?\\\\d+)?)\\\\s*\",\n    reP = \"\\\\s*([+-]?\\\\d*\\\\.?\\\\d+(?:[eE][+-]?\\\\d+)?)%\\\\s*\",\n    reHex = /^#([0-9a-f]{3,8})$/,\n    reRgbInteger = new RegExp(\"^rgb\\\\(\" + [reI, reI, reI] + \"\\\\)$\"),\n    reRgbPercent = new RegExp(\"^rgb\\\\(\" + [reP, reP, reP] + \"\\\\)$\"),\n    reRgbaInteger = new RegExp(\"^rgba\\\\(\" + [reI, reI, reI, reN] + \"\\\\)$\"),\n    reRgbaPercent = new RegExp(\"^rgba\\\\(\" + [reP, reP, reP, reN] + \"\\\\)$\"),\n    reHslPercent = new RegExp(\"^hsl\\\\(\" + [reN, reP, reP] + \"\\\\)$\"),\n    reHslaPercent = new RegExp(\"^hsla\\\\(\" + [reN, reP, reP, reN] + \"\\\\)$\");\n\nvar named = {\n  aliceblue: 0xf0f8ff,\n  antiquewhite: 0xfaebd7,\n  aqua: 0x00ffff,\n  aquamarine: 0x7fffd4,\n  azure: 0xf0ffff,\n  beige: 0xf5f5dc,\n  bisque: 0xffe4c4,\n  black: 0x000000,\n  blanchedalmond: 0xffebcd,\n  blue: 0x0000ff,\n  blueviolet: 0x8a2be2,\n  brown: 0xa52a2a,\n  burlywood: 0xdeb887,\n  cadetblue: 0x5f9ea0,\n  chartreuse: 0x7fff00,\n  chocolate: 0xd2691e,\n  coral: 0xff7f50,\n  cornflowerblue: 0x6495ed,\n  cornsilk: 0xfff8dc,\n  crimson: 0xdc143c,\n  cyan: 0x00ffff,\n  darkblue: 0x00008b,\n  darkcyan: 0x008b8b,\n  darkgoldenrod: 0xb8860b,\n  darkgray: 0xa9a9a9,\n  darkgreen: 0x006400,\n  darkgrey: 0xa9a9a9,\n  darkkhaki: 0xbdb76b,\n  darkmagenta: 0x8b008b,\n  darkolivegreen: 0x556b2f,\n  darkorange: 0xff8c00,\n  darkorchid: 0x9932cc,\n  darkred: 0x8b0000,\n  darksalmon: 0xe9967a,\n  darkseagreen: 0x8fbc8f,\n  darkslateblue: 0x483d8b,\n  darkslategray: 0x2f4f4f,\n  darkslategrey: 0x2f4f4f,\n  darkturquoise: 0x00ced1,\n  darkviolet: 0x9400d3,\n  deeppink: 0xff1493,\n  deepskyblue: 0x00bfff,\n  dimgray: 0x696969,\n  dimgrey: 0x696969,\n  dodgerblue: 0x1e90ff,\n  firebrick: 0xb22222,\n  floralwhite: 0xfffaf0,\n  forestgreen: 0x228b22,\n  fuchsia: 0xff00ff,\n  gainsboro: 0xdcdcdc,\n  ghostwhite: 0xf8f8ff,\n  gold: 0xffd700,\n  goldenrod: 0xdaa520,\n  gray: 0x808080,\n  green: 0x008000,\n  greenyellow: 0xadff2f,\n  grey: 0x808080,\n  honeydew: 0xf0fff0,\n  hotpink: 0xff69b4,\n  indianred: 0xcd5c5c,\n  indigo: 0x4b0082,\n  ivory: 0xfffff0,\n  khaki: 0xf0e68c,\n  lavender: 0xe6e6fa,\n  lavenderblush: 0xfff0f5,\n  lawngreen: 0x7cfc00,\n  lemonchiffon: 0xfffacd,\n  lightblue: 0xadd8e6,\n  lightcoral: 0xf08080,\n  lightcyan: 0xe0ffff,\n  lightgoldenrodyellow: 0xfafad2,\n  lightgray: 0xd3d3d3,\n  lightgreen: 0x90ee90,\n  lightgrey: 0xd3d3d3,\n  lightpink: 0xffb6c1,\n  lightsalmon: 0xffa07a,\n  lightseagreen: 0x20b2aa,\n  lightskyblue: 0x87cefa,\n  lightslategray: 0x778899,\n  lightslategrey: 0x778899,\n  lightsteelblue: 0xb0c4de,\n  lightyellow: 0xffffe0,\n  lime: 0x00ff00,\n  limegreen: 0x32cd32,\n  linen: 0xfaf0e6,\n  magenta: 0xff00ff,\n  maroon: 0x800000,\n  mediumaquamarine: 0x66cdaa,\n  mediumblue: 0x0000cd,\n  mediumorchid: 0xba55d3,\n  mediumpurple: 0x9370db,\n  mediumseagreen: 0x3cb371,\n  mediumslateblue: 0x7b68ee,\n  mediumspringgreen: 0x00fa9a,\n  mediumturquoise: 0x48d1cc,\n  mediumvioletred: 0xc71585,\n  midnightblue: 0x191970,\n  mintcream: 0xf5fffa,\n  mistyrose: 0xffe4e1,\n  moccasin: 0xffe4b5,\n  navajowhite: 0xffdead,\n  navy: 0x000080,\n  oldlace: 0xfdf5e6,\n  olive: 0x808000,\n  olivedrab: 0x6b8e23,\n  orange: 0xffa500,\n  orangered: 0xff4500,\n  orchid: 0xda70d6,\n  palegoldenrod: 0xeee8aa,\n  palegreen: 0x98fb98,\n  paleturquoise: 0xafeeee,\n  palevioletred: 0xdb7093,\n  papayawhip: 0xffefd5,\n  peachpuff: 0xffdab9,\n  peru: 0xcd853f,\n  pink: 0xffc0cb,\n  plum: 0xdda0dd,\n  powderblue: 0xb0e0e6,\n  purple: 0x800080,\n  rebeccapurple: 0x663399,\n  red: 0xff0000,\n  rosybrown: 0xbc8f8f,\n  royalblue: 0x4169e1,\n  saddlebrown: 0x8b4513,\n  salmon: 0xfa8072,\n  sandybrown: 0xf4a460,\n  seagreen: 0x2e8b57,\n  seashell: 0xfff5ee,\n  sienna: 0xa0522d,\n  silver: 0xc0c0c0,\n  skyblue: 0x87ceeb,\n  slateblue: 0x6a5acd,\n  slategray: 0x708090,\n  slategrey: 0x708090,\n  snow: 0xfffafa,\n  springgreen: 0x00ff7f,\n  steelblue: 0x4682b4,\n  tan: 0xd2b48c,\n  teal: 0x008080,\n  thistle: 0xd8bfd8,\n  tomato: 0xff6347,\n  turquoise: 0x40e0d0,\n  violet: 0xee82ee,\n  wheat: 0xf5deb3,\n  white: 0xffffff,\n  whitesmoke: 0xf5f5f5,\n  yellow: 0xffff00,\n  yellowgreen: 0x9acd32\n};\n\ndefine(Color, color, {\n  copy: function(channels) {\n    return Object.assign(new this.constructor, this, channels);\n  },\n  displayable: function() {\n    return this.rgb().displayable();\n  },\n  hex: color_formatHex, // Deprecated! Use color.formatHex.\n  formatHex: color_formatHex,\n  formatHsl: color_formatHsl,\n  formatRgb: color_formatRgb,\n  toString: color_formatRgb\n});\n\nfunction color_formatHex() {\n  return this.rgb().formatHex();\n}\n\nfunction color_formatHsl() {\n  return hslConvert(this).formatHsl();\n}\n\nfunction color_formatRgb() {\n  return this.rgb().formatRgb();\n}\n\nexport default function color(format) {\n  var m, l;\n  format = (format + \"\").trim().toLowerCase();\n  return (m = reHex.exec(format)) ? (l = m[1].length, m = parseInt(m[1], 16), l === 6 ? rgbn(m) // #ff0000\n      : l === 3 ? new Rgb((m >> 8 & 0xf) | (m >> 4 & 0xf0), (m >> 4 & 0xf) | (m & 0xf0), ((m & 0xf) << 4) | (m & 0xf), 1) // #f00\n      : l === 8 ? new Rgb(m >> 24 & 0xff, m >> 16 & 0xff, m >> 8 & 0xff, (m & 0xff) / 0xff) // #ff000000\n      : l === 4 ? new Rgb((m >> 12 & 0xf) | (m >> 8 & 0xf0), (m >> 8 & 0xf) | (m >> 4 & 0xf0), (m >> 4 & 0xf) | (m & 0xf0), (((m & 0xf) << 4) | (m & 0xf)) / 0xff) // #f000\n      : null) // invalid hex\n      : (m = reRgbInteger.exec(format)) ? new Rgb(m[1], m[2], m[3], 1) // rgb(255, 0, 0)\n      : (m = reRgbPercent.exec(format)) ? new Rgb(m[1] * 255 / 100, m[2] * 255 / 100, m[3] * 255 / 100, 1) // rgb(100%, 0%, 0%)\n      : (m = reRgbaInteger.exec(format)) ? rgba(m[1], m[2], m[3], m[4]) // rgba(255, 0, 0, 1)\n      : (m = reRgbaPercent.exec(format)) ? rgba(m[1] * 255 / 100, m[2] * 255 / 100, m[3] * 255 / 100, m[4]) // rgb(100%, 0%, 0%, 1)\n      : (m = reHslPercent.exec(format)) ? hsla(m[1], m[2] / 100, m[3] / 100, 1) // hsl(120, 50%, 50%)\n      : (m = reHslaPercent.exec(format)) ? hsla(m[1], m[2] / 100, m[3] / 100, m[4]) // hsla(120, 50%, 50%, 1)\n      : named.hasOwnProperty(format) ? rgbn(named[format]) // eslint-disable-line no-prototype-builtins\n      : format === \"transparent\" ? new Rgb(NaN, NaN, NaN, 0)\n      : null;\n}\n\nfunction rgbn(n) {\n  return new Rgb(n >> 16 & 0xff, n >> 8 & 0xff, n & 0xff, 1);\n}\n\nfunction rgba(r, g, b, a) {\n  if (a <= 0) r = g = b = NaN;\n  return new Rgb(r, g, b, a);\n}\n\nexport function rgbConvert(o) {\n  if (!(o instanceof Color)) o = color(o);\n  if (!o) return new Rgb;\n  o = o.rgb();\n  return new Rgb(o.r, o.g, o.b, o.opacity);\n}\n\nexport function rgb(r, g, b, opacity) {\n  return arguments.length === 1 ? rgbConvert(r) : new Rgb(r, g, b, opacity == null ? 1 : opacity);\n}\n\nexport function Rgb(r, g, b, opacity) {\n  this.r = +r;\n  this.g = +g;\n  this.b = +b;\n  this.opacity = +opacity;\n}\n\ndefine(Rgb, rgb, extend(Color, {\n  brighter: function(k) {\n    k = k == null ? brighter : Math.pow(brighter, k);\n    return new Rgb(this.r * k, this.g * k, this.b * k, this.opacity);\n  },\n  darker: function(k) {\n    k = k == null ? darker : Math.pow(darker, k);\n    return new Rgb(this.r * k, this.g * k, this.b * k, this.opacity);\n  },\n  rgb: function() {\n    return this;\n  },\n  displayable: function() {\n    return (-0.5 <= this.r && this.r < 255.5)\n        && (-0.5 <= this.g && this.g < 255.5)\n        && (-0.5 <= this.b && this.b < 255.5)\n        && (0 <= this.opacity && this.opacity <= 1);\n  },\n  hex: rgb_formatHex, // Deprecated! Use color.formatHex.\n  formatHex: rgb_formatHex,\n  formatRgb: rgb_formatRgb,\n  toString: rgb_formatRgb\n}));\n\nfunction rgb_formatHex() {\n  return \"#\" + hex(this.r) + hex(this.g) + hex(this.b);\n}\n\nfunction rgb_formatRgb() {\n  var a = this.opacity; a = isNaN(a) ? 1 : Math.max(0, Math.min(1, a));\n  return (a === 1 ? \"rgb(\" : \"rgba(\")\n      + Math.max(0, Math.min(255, Math.round(this.r) || 0)) + \", \"\n      + Math.max(0, Math.min(255, Math.round(this.g) || 0)) + \", \"\n      + Math.max(0, Math.min(255, Math.round(this.b) || 0))\n      + (a === 1 ? \")\" : \", \" + a + \")\");\n}\n\nfunction hex(value) {\n  value = Math.max(0, Math.min(255, Math.round(value) || 0));\n  return (value < 16 ? \"0\" : \"\") + value.toString(16);\n}\n\nfunction hsla(h, s, l, a) {\n  if (a <= 0) h = s = l = NaN;\n  else if (l <= 0 || l >= 1) h = s = NaN;\n  else if (s <= 0) h = NaN;\n  return new Hsl(h, s, l, a);\n}\n\nexport function hslConvert(o) {\n  if (o instanceof Hsl) return new Hsl(o.h, o.s, o.l, o.opacity);\n  if (!(o instanceof Color)) o = color(o);\n  if (!o) return new Hsl;\n  if (o instanceof Hsl) return o;\n  o = o.rgb();\n  var r = o.r / 255,\n      g = o.g / 255,\n      b = o.b / 255,\n      min = Math.min(r, g, b),\n      max = Math.max(r, g, b),\n      h = NaN,\n      s = max - min,\n      l = (max + min) / 2;\n  if (s) {\n    if (r === max) h = (g - b) / s + (g < b) * 6;\n    else if (g === max) h = (b - r) / s + 2;\n    else h = (r - g) / s + 4;\n    s /= l < 0.5 ? max + min : 2 - max - min;\n    h *= 60;\n  } else {\n    s = l > 0 && l < 1 ? 0 : h;\n  }\n  return new Hsl(h, s, l, o.opacity);\n}\n\nexport function hsl(h, s, l, opacity) {\n  return arguments.length === 1 ? hslConvert(h) : new Hsl(h, s, l, opacity == null ? 1 : opacity);\n}\n\nfunction Hsl(h, s, l, opacity) {\n  this.h = +h;\n  this.s = +s;\n  this.l = +l;\n  this.opacity = +opacity;\n}\n\ndefine(Hsl, hsl, extend(Color, {\n  brighter: function(k) {\n    k = k == null ? brighter : Math.pow(brighter, k);\n    return new Hsl(this.h, this.s, this.l * k, this.opacity);\n  },\n  darker: function(k) {\n    k = k == null ? darker : Math.pow(darker, k);\n    return new Hsl(this.h, this.s, this.l * k, this.opacity);\n  },\n  rgb: function() {\n    var h = this.h % 360 + (this.h < 0) * 360,\n        s = isNaN(h) || isNaN(this.s) ? 0 : this.s,\n        l = this.l,\n        m2 = l + (l < 0.5 ? l : 1 - l) * s,\n        m1 = 2 * l - m2;\n    return new Rgb(\n      hsl2rgb(h >= 240 ? h - 240 : h + 120, m1, m2),\n      hsl2rgb(h, m1, m2),\n      hsl2rgb(h < 120 ? h + 240 : h - 120, m1, m2),\n      this.opacity\n    );\n  },\n  displayable: function() {\n    return (0 <= this.s && this.s <= 1 || isNaN(this.s))\n        && (0 <= this.l && this.l <= 1)\n        && (0 <= this.opacity && this.opacity <= 1);\n  },\n  formatHsl: function() {\n    var a = this.opacity; a = isNaN(a) ? 1 : Math.max(0, Math.min(1, a));\n    return (a === 1 ? \"hsl(\" : \"hsla(\")\n        + (this.h || 0) + \", \"\n        + (this.s || 0) * 100 + \"%, \"\n        + (this.l || 0) * 100 + \"%\"\n        + (a === 1 ? \")\" : \", \" + a + \")\");\n  }\n}));\n\n/* From FvD 13.37, CSS Color Module Level 3 */\nfunction hsl2rgb(h, m1, m2) {\n  return (h < 60 ? m1 + (m2 - m1) * h / 60\n      : h < 180 ? m2\n      : h < 240 ? m1 + (m2 - m1) * (240 - h) / 60\n      : m1) * 255;\n}\n","import {Category, SupportType} from './annotations';\r\nimport Column, {IColumnDesc} from './Column';\r\nimport {IDataRow, IGroup} from './interfaces';\r\n\r\nexport interface IAction {\r\n  name: string;\r\n  icon?: string;\r\n  className?: string;\r\n\r\n  action(row: IDataRow): void;\r\n}\r\n\r\nexport interface IGroupAction {\r\n  name: string;\r\n  icon?: string;\r\n  className?: string;\r\n\r\n  action(group: IGroup, rows: IDataRow[]): void;\r\n}\r\n\r\n/**\r\n * utility for creating an action description with optional label\r\n * @param label\r\n * @param actions\r\n * @param groupActions\r\n * @returns {{type: string, label: string}}\r\n */\r\nexport function createActionDesc(label = 'actions', actions: Readonly<IAction>[] = [], groupActions: Readonly<IGroupAction>[] = []) {\r\n  return {type: 'actions', label, actions, groupActions, fixed: true};\r\n}\r\n\r\nexport interface IActionDesc {\r\n  actions?: Readonly<IAction>[];\r\n  groupActions?: Readonly<IGroupAction>[];\r\n}\r\n\r\nexport declare type IActionColumnDesc = IColumnDesc & IActionDesc;\r\n\r\n/**\r\n * a default column with no values\r\n */\r\n@SupportType()\r\n@Category('support')\r\nexport default class ActionColumn extends Column {\r\n\r\n  readonly actions: IAction[];\r\n  readonly groupActions: IGroupAction[];\r\n\r\n  constructor(id: string, desc: Readonly<IActionColumnDesc>) {\r\n    super(id, desc);\r\n\r\n    this.actions = desc.actions || [];\r\n    this.groupActions = desc.groupActions || [];\r\n  }\r\n\r\n  getLabel() {\r\n    return '';\r\n  }\r\n\r\n  getValue() {\r\n    return '';\r\n  }\r\n\r\n  compare() {\r\n    return 0; //can't compare\r\n  }\r\n}\r\n","import {Category, SupportType, toolbar, dialogAddons} from './annotations';\r\nimport Column, {widthChanged, labelChanged, metaDataChanged, dirty, dirtyHeader, dirtyValues, rendererTypeChanged, groupRendererChanged, summaryRendererChanged, visibilityChanged} from './Column';\r\nimport {IGroupData} from './interfaces';\r\nimport {FIRST_IS_NAN, missingGroup} from './missing';\r\nimport {IEventListener} from '../internal/AEventDispatcher';\r\n\r\nexport function createGroupDesc(label = 'Group Name') {\r\n  return {type: 'group', label};\r\n}\r\n\r\nexport enum EGroupSortMethod {\r\n  name = 'name',\r\n  count ='count'\r\n}\r\n\r\n/**\r\n * emitted when the sort method property changes\r\n * @asMemberOf GroupColumn\r\n * @event\r\n */\r\nexport declare function sortMethodChanged(previous: EGroupSortMethod, current: EGroupSortMethod): void;\r\n\r\n\r\n@SupportType()\r\n@toolbar('sortGroupBy')\r\n@dialogAddons('sortGroup', 'sortGroups')\r\n@Category('support')\r\nexport default class GroupColumn extends Column {\r\n  static readonly EVENT_SORTMETHOD_CHANGED = 'sortMethodChanged';\r\n\r\n  private groupSortMethod: EGroupSortMethod = EGroupSortMethod.name;\r\n\r\n  get frozen() {\r\n    return this.desc.frozen !== false;\r\n  }\r\n\r\n  protected createEventList() {\r\n    return super.createEventList().concat([GroupColumn.EVENT_SORTMETHOD_CHANGED]);\r\n  }\r\n\r\n  on(type: typeof GroupColumn.EVENT_SORTMETHOD_CHANGED, listener: typeof sortMethodChanged | null): this;\r\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\r\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\r\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\r\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\r\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\r\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\r\n  on(type: string | string[], listener: IEventListener | null): this {\r\n    return super.on(<any>type, listener);\r\n  }\r\n\r\n  getLabel() {\r\n    return '';\r\n  }\r\n\r\n  getValue() {\r\n    return '';\r\n  }\r\n\r\n  compare() {\r\n    return 0; //can't compare\r\n  }\r\n\r\n  getSortMethod() {\r\n    return this.groupSortMethod;\r\n  }\r\n\r\n  setSortMethod(sortMethod: EGroupSortMethod) {\r\n    if (this.groupSortMethod === sortMethod) {\r\n      return;\r\n    }\r\n    this.fire([GroupColumn.EVENT_SORTMETHOD_CHANGED], this.groupSortMethod, this.groupSortMethod = sortMethod);\r\n    // sort by me if not already sorted by me\r\n    if (!this.isGroupSortedByMe().asc) {\r\n      this.toggleMyGroupSorting();\r\n    }\r\n  }\r\n\r\n  groupCompare(a: IGroupData, b: IGroupData) {\r\n    switch (this.groupSortMethod) {\r\n      case 'count':\r\n        return a.rows.length - b.rows.length;\r\n      default:\r\n        if (a.name === missingGroup.name) {\r\n          return b.name === missingGroup.name ? 0 : FIRST_IS_NAN;\r\n        }\r\n        if (b.name === missingGroup.name) {\r\n          return -FIRST_IS_NAN;\r\n        }\r\n        return a.name.toLowerCase().localeCompare(b.name.toLowerCase());\r\n    }\r\n  }\r\n}\r\n","import {extent} from 'd3-array';\r\nimport {equalArrays} from '../internal';\r\nimport {Category, toolbar} from './annotations';\r\nimport CategoricalColumn from './CategoricalColumn';\r\nimport Column, {widthChanged, labelChanged, metaDataChanged, dirty, dirtyHeader, dirtyValues, rendererTypeChanged, groupRendererChanged, summaryRendererChanged, visibilityChanged} from './Column';\r\nimport {\r\n  ICategoricalColumn, ICategoricalDesc, ICategoricalFilter, ICategory, toCategories,\r\n  toCategory\r\n} from './ICategoricalColumn';\r\nimport {IDataRow} from './interfaces';\r\nimport NumberColumn, {INumberColumn} from './NumberColumn';\r\nimport ValueColumn, {IValueColumnDesc, dataLoaded} from './ValueColumn';\r\nimport {IEventListener} from '../internal/AEventDispatcher';\r\n\r\nexport declare type ICategoricalNumberColumnDesc = ICategoricalDesc & IValueColumnDesc<number>;\r\n\r\n/**\r\n * emitted when the mapping property changes\r\n * @asMemberOf OrdinalColumn\r\n * @event\r\n */\r\nexport declare function mappingChanged(previous: number[], current: number[]): void;\r\n\r\n/**\r\n * emitted when the filter property changes\r\n * @asMemberOf OrdinalColumn\r\n * @event\r\n */\r\nexport declare function filterChanged(previous: ICategoricalFilter | null, current: ICategoricalFilter | null): void;\r\n\r\n/**\r\n * similar to a categorical column but the categories are mapped to numbers\r\n */\r\n@toolbar('group', 'filterOrdinal')\r\n@Category('categorical')\r\nexport default class OrdinalColumn extends ValueColumn<number> implements INumberColumn, ICategoricalColumn {\r\n  static readonly EVENT_MAPPING_CHANGED = NumberColumn.EVENT_MAPPING_CHANGED;\r\n  static readonly EVENT_FILTER_CHANGED = CategoricalColumn.EVENT_FILTER_CHANGED;\r\n\r\n  readonly categories: ICategory[];\r\n\r\n  private missingCategory: ICategory | null;\r\n\r\n  private readonly lookup = new Map<string, Readonly<ICategory>>();\r\n\r\n  private currentFilter: ICategoricalFilter | null = null;\r\n\r\n\r\n  constructor(id: string, desc: Readonly<ICategoricalNumberColumnDesc>) {\r\n    super(id, desc);\r\n    this.categories = toCategories(desc);\r\n    this.missingCategory = desc.missingCategory ? toCategory(desc.missingCategory, NaN) : null;\r\n    this.categories.forEach((d) => this.lookup.set(d.name, d));\r\n    this.setDefaultRenderer('number');\r\n    this.setDefaultGroupRenderer('boxplot');\r\n  }\r\n\r\n  protected createEventList() {\r\n    return super.createEventList().concat([OrdinalColumn.EVENT_MAPPING_CHANGED, OrdinalColumn.EVENT_FILTER_CHANGED]);\r\n  }\r\n\r\n  on(type: typeof OrdinalColumn.EVENT_MAPPING_CHANGED, listener: typeof mappingChanged | null): this;\r\n  on(type: typeof OrdinalColumn.EVENT_FILTER_CHANGED, listener: typeof filterChanged | null): this;\r\n  on(type: typeof ValueColumn.EVENT_DATA_LOADED, listener: typeof dataLoaded | null): this;\r\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\r\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\r\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\r\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\r\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\r\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\r\n  on(type: string | string[], listener: IEventListener | null): this {\r\n    return super.on(<any>type, listener);\r\n  }\r\n\r\n  get dataLength() {\r\n    return this.categories.length;\r\n  }\r\n\r\n  get labels() {\r\n    return this.categories.map((d) => d.label);\r\n  }\r\n\r\n  getValue(row: IDataRow) {\r\n    const v = this.getCategory(row);\r\n    return v ? v.value : NaN;\r\n  }\r\n\r\n  getCategory(row: IDataRow) {\r\n    const v = super.getValue(row);\r\n    if (!v) {\r\n      return this.missingCategory;\r\n    }\r\n    const vs = String(v);\r\n    return this.lookup.has(vs) ? this.lookup.get(vs)! : this.missingCategory;\r\n  }\r\n\r\n  getColor(row: IDataRow) {\r\n    return CategoricalColumn.prototype.getColor.call(this, row);\r\n  }\r\n\r\n  getLabel(row: IDataRow) {\r\n    return CategoricalColumn.prototype.getLabel.call(this, row);\r\n  }\r\n\r\n  getLabels(row: IDataRow) {\r\n    return CategoricalColumn.prototype.getLabels.call(this, row);\r\n  }\r\n\r\n  getValues(row: IDataRow) {\r\n    return CategoricalColumn.prototype.getValues.call(this, row);\r\n  }\r\n\r\n  getMap(row: IDataRow) {\r\n    return CategoricalColumn.prototype.getMap.call(this, row);\r\n  }\r\n\r\n  getMapLabel(row: IDataRow) {\r\n    return CategoricalColumn.prototype.getMapLabel.call(this, row);\r\n  }\r\n\r\n  getSet(row: IDataRow) {\r\n    return CategoricalColumn.prototype.getSet.call(this, row);\r\n  }\r\n\r\n  getNumber(row: IDataRow) {\r\n    return this.getValue(row);\r\n  }\r\n\r\n  isMissing(row: IDataRow) {\r\n    return CategoricalColumn.prototype.isMissing.call(this, row);\r\n  }\r\n\r\n  getRawNumber(row: IDataRow) {\r\n    return this.getNumber(row);\r\n  }\r\n\r\n  getExportValue(row: IDataRow, format: 'text' | 'json'): any {\r\n    if (format === 'json') {\r\n      if (this.isMissing(row)) {\r\n        return null;\r\n      }\r\n      return {\r\n        name: this.getLabel(row),\r\n        value: this.getValue(row)\r\n      };\r\n    }\r\n    return super.getExportValue(row, format);\r\n  }\r\n\r\n  dump(toDescRef: (desc: any) => any): any {\r\n    const r = CategoricalColumn.prototype.dump.call(this, toDescRef);\r\n    r.mapping = this.getMapping();\r\n    return r;\r\n  }\r\n\r\n  restore(dump: any, factory: (dump: any) => Column | null) {\r\n    CategoricalColumn.prototype.restore.call(this, dump, factory);\r\n    if (dump.mapping) {\r\n      this.setMapping(dump.mapping);\r\n    }\r\n  }\r\n\r\n  getMapping() {\r\n    return this.categories.map((d) => d.value);\r\n  }\r\n\r\n  setMapping(mapping: number[]) {\r\n    const r = extent(mapping);\r\n    mapping = mapping.map((d) => (d - r[0]!) / (r[1]! - r[0]!));\r\n    const bak = this.getMapping();\r\n    if (equalArrays(bak, mapping)) {\r\n      return;\r\n    }\r\n    this.categories.forEach((d, i) => d.value = mapping[i] || 0);\r\n    this.fire([OrdinalColumn.EVENT_MAPPING_CHANGED, Column.EVENT_DIRTY_HEADER, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY], bak, this.getMapping());\r\n  }\r\n\r\n  isFiltered() {\r\n    return this.currentFilter != null;\r\n  }\r\n\r\n  filter(row: IDataRow): boolean {\r\n    return CategoricalColumn.prototype.filter.call(this, row);\r\n  }\r\n\r\n  group(row: IDataRow) {\r\n    return CategoricalColumn.prototype.group.call(this, row);\r\n  }\r\n\r\n  getFilter() {\r\n    return this.currentFilter;\r\n  }\r\n\r\n  setFilter(filter: ICategoricalFilter | null) {\r\n    return CategoricalColumn.prototype.setFilter.call(this, filter);\r\n  }\r\n\r\n  compare(a: IDataRow, b: IDataRow) {\r\n    return CategoricalColumn.prototype.compare.call(this, a, b);\r\n  }\r\n\r\n  getRenderer(): string {\r\n    return NumberColumn.prototype.getRenderer.call(this);\r\n  }\r\n}\r\n","export default function(constructor, factory, prototype) {\n  constructor.prototype = factory.prototype = prototype;\n  prototype.constructor = constructor;\n}\n\nexport function extend(parent, definition) {\n  var prototype = Object.create(parent.prototype);\n  for (var key in definition) prototype[key] = definition[key];\n  return prototype;\n}\n","import constant from \"./constant.js\";\n\nfunction linear(a, d) {\n  return function(t) {\n    return a + t * d;\n  };\n}\n\nfunction exponential(a, b, y) {\n  return a = Math.pow(a, y), b = Math.pow(b, y) - a, y = 1 / y, function(t) {\n    return Math.pow(a + t * b, y);\n  };\n}\n\nexport function hue(a, b) {\n  var d = b - a;\n  return d ? linear(a, d > 180 || d < -180 ? d - 360 * Math.round(d / 360) : d) : constant(isNaN(a) ? b : a);\n}\n\nexport function gamma(y) {\n  return (y = +y) === 1 ? nogamma : function(a, b) {\n    return b - a ? exponential(a, b, y) : constant(isNaN(a) ? b : a);\n  };\n}\n\nexport default function nogamma(a, b) {\n  var d = b - a;\n  return d ? linear(a, d) : constant(isNaN(a) ? b : a);\n}\n","export function initRange(domain, range) {\n  switch (arguments.length) {\n    case 0: break;\n    case 1: this.range(domain); break;\n    default: this.range(range).domain(domain); break;\n  }\n  return this;\n}\n\nexport function initInterpolator(domain, interpolator) {\n  switch (arguments.length) {\n    case 0: break;\n    case 1: this.interpolator(domain); break;\n    default: this.interpolator(interpolator).domain(domain); break;\n  }\n  return this;\n}\n","export var prefix = \"$\";\n\nfunction Map() {}\n\nMap.prototype = map.prototype = {\n  constructor: Map,\n  has: function(key) {\n    return (prefix + key) in this;\n  },\n  get: function(key) {\n    return this[prefix + key];\n  },\n  set: function(key, value) {\n    this[prefix + key] = value;\n    return this;\n  },\n  remove: function(key) {\n    var property = prefix + key;\n    return property in this && delete this[property];\n  },\n  clear: function() {\n    for (var property in this) if (property[0] === prefix) delete this[property];\n  },\n  keys: function() {\n    var keys = [];\n    for (var property in this) if (property[0] === prefix) keys.push(property.slice(1));\n    return keys;\n  },\n  values: function() {\n    var values = [];\n    for (var property in this) if (property[0] === prefix) values.push(this[property]);\n    return values;\n  },\n  entries: function() {\n    var entries = [];\n    for (var property in this) if (property[0] === prefix) entries.push({key: property.slice(1), value: this[property]});\n    return entries;\n  },\n  size: function() {\n    var size = 0;\n    for (var property in this) if (property[0] === prefix) ++size;\n    return size;\n  },\n  empty: function() {\n    for (var property in this) if (property[0] === prefix) return false;\n    return true;\n  },\n  each: function(f) {\n    for (var property in this) if (property[0] === prefix) f(this[property], property.slice(1), this);\n  }\n};\n\nfunction map(object, f) {\n  var map = new Map;\n\n  // Copy constructor.\n  if (object instanceof Map) object.each(function(value, key) { map.set(key, value); });\n\n  // Index array by numeric index or specified key function.\n  else if (Array.isArray(object)) {\n    var i = -1,\n        n = object.length,\n        o;\n\n    if (f == null) while (++i < n) map.set(i, object[i]);\n    else while (++i < n) map.set(f(o = object[i], i, object), o);\n  }\n\n  // Convert object to map.\n  else if (object) for (var key in object) map.set(key, object[key]);\n\n  return map;\n}\n\nexport default map;\n","import {default as map, prefix} from \"./map\";\n\nfunction Set() {}\n\nvar proto = map.prototype;\n\nSet.prototype = set.prototype = {\n  constructor: Set,\n  has: proto.has,\n  add: function(value) {\n    value += \"\";\n    this[prefix + value] = value;\n    return this;\n  },\n  remove: proto.remove,\n  clear: proto.clear,\n  values: proto.keys,\n  size: proto.size,\n  empty: proto.empty,\n  each: proto.each\n};\n\nfunction set(object, f) {\n  var set = new Set;\n\n  // Copy constructor.\n  if (object instanceof Set) object.each(function(value) { set.add(value); });\n\n  // Otherwise, assume its an array.\n  else if (object) {\n    var i = -1, n = object.length;\n    if (f == null) while (++i < n) set.add(object[i]);\n    else while (++i < n) set.add(f(object[i], i, object));\n  }\n\n  return set;\n}\n\nexport default set;\n","var array = Array.prototype;\n\nexport var map = array.map;\nexport var slice = array.slice;\n","export default function(a, b) {\n  if (!b) b = [];\n  var n = a ? Math.min(b.length, a.length) : 0,\n      c = b.slice(),\n      i;\n  return function(t) {\n    for (i = 0; i < n; ++i) c[i] = a[i] * (1 - t) + b[i] * t;\n    return c;\n  };\n}\n\nexport function isNumberArray(x) {\n  return ArrayBuffer.isView(x) && !(x instanceof DataView);\n}\n","import value from \"./value.js\";\nimport numberArray, {isNumberArray} from \"./numberArray.js\";\n\nexport default function(a, b) {\n  return (isNumberArray(b) ? numberArray : genericArray)(a, b);\n}\n\nexport function genericArray(a, b) {\n  var nb = b ? b.length : 0,\n      na = a ? Math.min(nb, a.length) : 0,\n      x = new Array(na),\n      c = new Array(nb),\n      i;\n\n  for (i = 0; i < na; ++i) x[i] = value(a[i], b[i]);\n  for (; i < nb; ++i) c[i] = b[i];\n\n  return function(t) {\n    for (i = 0; i < na; ++i) c[i] = x[i](t);\n    return c;\n  };\n}\n","export default function(a, b) {\n  var d = new Date;\n  return a = +a, b = +b, function(t) {\n    return d.setTime(a * (1 - t) + b * t), d;\n  };\n}\n","export default function(a, b) {\n  return a = +a, b = +b, function(t) {\n    return a * (1 - t) + b * t;\n  };\n}\n","import value from \"./value.js\";\n\nexport default function(a, b) {\n  var i = {},\n      c = {},\n      k;\n\n  if (a === null || typeof a !== \"object\") a = {};\n  if (b === null || typeof b !== \"object\") b = {};\n\n  for (k in b) {\n    if (k in a) {\n      i[k] = value(a[k], b[k]);\n    } else {\n      c[k] = b[k];\n    }\n  }\n\n  return function(t) {\n    for (k in i) c[k] = i[k](t);\n    return c;\n  };\n}\n","import number from \"./number.js\";\n\nvar reA = /[-+]?(?:\\d+\\.?\\d*|\\.?\\d+)(?:[eE][-+]?\\d+)?/g,\n    reB = new RegExp(reA.source, \"g\");\n\nfunction zero(b) {\n  return function() {\n    return b;\n  };\n}\n\nfunction one(b) {\n  return function(t) {\n    return b(t) + \"\";\n  };\n}\n\nexport default function(a, b) {\n  var bi = reA.lastIndex = reB.lastIndex = 0, // scan index for next number in b\n      am, // current match in a\n      bm, // current match in b\n      bs, // string preceding current number in b, if any\n      i = -1, // index in s\n      s = [], // string constants and placeholders\n      q = []; // number interpolators\n\n  // Coerce inputs to strings.\n  a = a + \"\", b = b + \"\";\n\n  // Interpolate pairs of numbers in a & b.\n  while ((am = reA.exec(a))\n      && (bm = reB.exec(b))) {\n    if ((bs = bm.index) > bi) { // a string precedes the next number in b\n      bs = b.slice(bi, bs);\n      if (s[i]) s[i] += bs; // coalesce with previous string\n      else s[++i] = bs;\n    }\n    if ((am = am[0]) === (bm = bm[0])) { // numbers in a & b match\n      if (s[i]) s[i] += bm; // coalesce with previous string\n      else s[++i] = bm;\n    } else { // interpolate non-matching numbers\n      s[++i] = null;\n      q.push({i: i, x: number(am, bm)});\n    }\n    bi = reB.lastIndex;\n  }\n\n  // Add remains of b.\n  if (bi < b.length) {\n    bs = b.slice(bi);\n    if (s[i]) s[i] += bs; // coalesce with previous string\n    else s[++i] = bs;\n  }\n\n  // Special optimization for only a single match.\n  // Otherwise, interpolate each of the numbers and rejoin the string.\n  return s.length < 2 ? (q[0]\n      ? one(q[0].x)\n      : zero(b))\n      : (b = q.length, function(t) {\n          for (var i = 0, o; i < b; ++i) s[(o = q[i]).i] = o.x(t);\n          return s.join(\"\");\n        });\n}\n","import {color} from \"d3-color\";\nimport rgb from \"./rgb.js\";\nimport {genericArray} from \"./array.js\";\nimport date from \"./date.js\";\nimport number from \"./number.js\";\nimport object from \"./object.js\";\nimport string from \"./string.js\";\nimport constant from \"./constant.js\";\nimport numberArray, {isNumberArray} from \"./numberArray.js\";\n\nexport default function(a, b) {\n  var t = typeof b, c;\n  return b == null || t === \"boolean\" ? constant(b)\n      : (t === \"number\" ? number\n      : t === \"string\" ? ((c = color(b)) ? (b = c, rgb) : string)\n      : b instanceof color ? rgb\n      : b instanceof Date ? date\n      : isNumberArray(b) ? numberArray\n      : Array.isArray(b) ? genericArray\n      : typeof b.valueOf !== \"function\" && typeof b.toString !== \"function\" || isNaN(b) ? object\n      : number)(a, b);\n}\n","export default function(a, b) {\n  return a = +a, b = +b, function(t) {\n    return Math.round(a * (1 - t) + b * t);\n  };\n}\n","export default function(x) {\n  return +x;\n}\n","import {bisect} from \"d3-array\";\nimport {interpolate as interpolateValue, interpolateNumber, interpolateRound} from \"d3-interpolate\";\nimport {map, slice} from \"./array\";\nimport constant from \"./constant\";\nimport number from \"./number\";\n\nvar unit = [0, 1];\n\nexport function identity(x) {\n  return x;\n}\n\nfunction normalize(a, b) {\n  return (b -= (a = +a))\n      ? function(x) { return (x - a) / b; }\n      : constant(isNaN(b) ? NaN : 0.5);\n}\n\nfunction clamper(domain) {\n  var a = domain[0], b = domain[domain.length - 1], t;\n  if (a > b) t = a, a = b, b = t;\n  return function(x) { return Math.max(a, Math.min(b, x)); };\n}\n\n// normalize(a, b)(x) takes a domain value x in [a,b] and returns the corresponding parameter t in [0,1].\n// interpolate(a, b)(t) takes a parameter t in [0,1] and returns the corresponding range value x in [a,b].\nfunction bimap(domain, range, interpolate) {\n  var d0 = domain[0], d1 = domain[1], r0 = range[0], r1 = range[1];\n  if (d1 < d0) d0 = normalize(d1, d0), r0 = interpolate(r1, r0);\n  else d0 = normalize(d0, d1), r0 = interpolate(r0, r1);\n  return function(x) { return r0(d0(x)); };\n}\n\nfunction polymap(domain, range, interpolate) {\n  var j = Math.min(domain.length, range.length) - 1,\n      d = new Array(j),\n      r = new Array(j),\n      i = -1;\n\n  // Reverse descending domains.\n  if (domain[j] < domain[0]) {\n    domain = domain.slice().reverse();\n    range = range.slice().reverse();\n  }\n\n  while (++i < j) {\n    d[i] = normalize(domain[i], domain[i + 1]);\n    r[i] = interpolate(range[i], range[i + 1]);\n  }\n\n  return function(x) {\n    var i = bisect(domain, x, 1, j) - 1;\n    return r[i](d[i](x));\n  };\n}\n\nexport function copy(source, target) {\n  return target\n      .domain(source.domain())\n      .range(source.range())\n      .interpolate(source.interpolate())\n      .clamp(source.clamp())\n      .unknown(source.unknown());\n}\n\nexport function transformer() {\n  var domain = unit,\n      range = unit,\n      interpolate = interpolateValue,\n      transform,\n      untransform,\n      unknown,\n      clamp = identity,\n      piecewise,\n      output,\n      input;\n\n  function rescale() {\n    piecewise = Math.min(domain.length, range.length) > 2 ? polymap : bimap;\n    output = input = null;\n    return scale;\n  }\n\n  function scale(x) {\n    return isNaN(x = +x) ? unknown : (output || (output = piecewise(domain.map(transform), range, interpolate)))(transform(clamp(x)));\n  }\n\n  scale.invert = function(y) {\n    return clamp(untransform((input || (input = piecewise(range, domain.map(transform), interpolateNumber)))(y)));\n  };\n\n  scale.domain = function(_) {\n    return arguments.length ? (domain = map.call(_, number), clamp === identity || (clamp = clamper(domain)), rescale()) : domain.slice();\n  };\n\n  scale.range = function(_) {\n    return arguments.length ? (range = slice.call(_), rescale()) : range.slice();\n  };\n\n  scale.rangeRound = function(_) {\n    return range = slice.call(_), interpolate = interpolateRound, rescale();\n  };\n\n  scale.clamp = function(_) {\n    return arguments.length ? (clamp = _ ? clamper(domain) : identity, scale) : clamp !== identity;\n  };\n\n  scale.interpolate = function(_) {\n    return arguments.length ? (interpolate = _, rescale()) : interpolate;\n  };\n\n  scale.unknown = function(_) {\n    return arguments.length ? (unknown = _, scale) : unknown;\n  };\n\n  return function(t, u) {\n    transform = t, untransform = u;\n    return rescale();\n  };\n}\n\nexport default function continuous(transform, untransform) {\n  return transformer()(transform, untransform);\n}\n","export default function(x) {\n  return function() {\n    return x;\n  };\n}\n","import {tickStep} from \"d3-array\";\nimport {format, formatPrefix, formatSpecifier, precisionFixed, precisionPrefix, precisionRound} from \"d3-format\";\n\nexport default function(start, stop, count, specifier) {\n  var step = tickStep(start, stop, count),\n      precision;\n  specifier = formatSpecifier(specifier == null ? \",f\" : specifier);\n  switch (specifier.type) {\n    case \"s\": {\n      var value = Math.max(Math.abs(start), Math.abs(stop));\n      if (specifier.precision == null && !isNaN(precision = precisionPrefix(step, value))) specifier.precision = precision;\n      return formatPrefix(specifier, value);\n    }\n    case \"\":\n    case \"e\":\n    case \"g\":\n    case \"p\":\n    case \"r\": {\n      if (specifier.precision == null && !isNaN(precision = precisionRound(step, Math.max(Math.abs(start), Math.abs(stop))))) specifier.precision = precision - (specifier.type === \"e\");\n      break;\n    }\n    case \"f\":\n    case \"%\": {\n      if (specifier.precision == null && !isNaN(precision = precisionFixed(step))) specifier.precision = precision - (specifier.type === \"%\") * 2;\n      break;\n    }\n  }\n  return format(specifier);\n}\n","import exponent from \"./exponent.js\";\n\nexport default function(step, value) {\n  return Math.max(0, Math.max(-8, Math.min(8, Math.floor(exponent(value) / 3))) * 3 - exponent(Math.abs(step)));\n}\n","import exponent from \"./exponent.js\";\n\nexport default function(step, max) {\n  step = Math.abs(step), max = Math.abs(max) - step;\n  return Math.max(0, exponent(max) - exponent(step)) + 1;\n}\n","import exponent from \"./exponent.js\";\n\nexport default function(step) {\n  return Math.max(0, -exponent(Math.abs(step)));\n}\n","import {ticks, tickIncrement} from \"d3-array\";\nimport continuous, {copy, identity} from \"./continuous\";\nimport {initRange} from \"./init\";\nimport tickFormat from \"./tickFormat\";\n\nexport function linearish(scale) {\n  var domain = scale.domain;\n\n  scale.ticks = function(count) {\n    var d = domain();\n    return ticks(d[0], d[d.length - 1], count == null ? 10 : count);\n  };\n\n  scale.tickFormat = function(count, specifier) {\n    var d = domain();\n    return tickFormat(d[0], d[d.length - 1], count == null ? 10 : count, specifier);\n  };\n\n  scale.nice = function(count) {\n    if (count == null) count = 10;\n\n    var d = domain(),\n        i0 = 0,\n        i1 = d.length - 1,\n        start = d[i0],\n        stop = d[i1],\n        step;\n\n    if (stop < start) {\n      step = start, start = stop, stop = step;\n      step = i0, i0 = i1, i1 = step;\n    }\n\n    step = tickIncrement(start, stop, count);\n\n    if (step > 0) {\n      start = Math.floor(start / step) * step;\n      stop = Math.ceil(stop / step) * step;\n      step = tickIncrement(start, stop, count);\n    } else if (step < 0) {\n      start = Math.ceil(start * step) / step;\n      stop = Math.floor(stop * step) / step;\n      step = tickIncrement(start, stop, count);\n    }\n\n    if (step > 0) {\n      d[i0] = Math.floor(start / step) * step;\n      d[i1] = Math.ceil(stop / step) * step;\n      domain(d);\n    } else if (step < 0) {\n      d[i0] = Math.ceil(start * step) / step;\n      d[i1] = Math.floor(stop * step) / step;\n      domain(d);\n    }\n\n    return scale;\n  };\n\n  return scale;\n}\n\nexport default function linear() {\n  var scale = continuous(identity, identity);\n\n  scale.copy = function() {\n    return copy(scale, linear());\n  };\n\n  initRange.apply(scale, arguments);\n\n  return linearish(scale);\n}\n","export default function(domain, interval) {\n  domain = domain.slice();\n\n  var i0 = 0,\n      i1 = domain.length - 1,\n      x0 = domain[i0],\n      x1 = domain[i1],\n      t;\n\n  if (x1 < x0) {\n    t = i0, i0 = i1, i1 = t;\n    t = x0, x0 = x1, x1 = t;\n  }\n\n  domain[i0] = interval.floor(x0);\n  domain[i1] = interval.ceil(x1);\n  return domain;\n}\n","import {ticks} from \"d3-array\";\nimport {format} from \"d3-format\";\nimport nice from \"./nice\";\nimport {copy, transformer} from \"./continuous\";\nimport {initRange} from \"./init\";\n\nfunction transformLog(x) {\n  return Math.log(x);\n}\n\nfunction transformExp(x) {\n  return Math.exp(x);\n}\n\nfunction transformLogn(x) {\n  return -Math.log(-x);\n}\n\nfunction transformExpn(x) {\n  return -Math.exp(-x);\n}\n\nfunction pow10(x) {\n  return isFinite(x) ? +(\"1e\" + x) : x < 0 ? 0 : x;\n}\n\nfunction powp(base) {\n  return base === 10 ? pow10\n      : base === Math.E ? Math.exp\n      : function(x) { return Math.pow(base, x); };\n}\n\nfunction logp(base) {\n  return base === Math.E ? Math.log\n      : base === 10 && Math.log10\n      || base === 2 && Math.log2\n      || (base = Math.log(base), function(x) { return Math.log(x) / base; });\n}\n\nfunction reflect(f) {\n  return function(x) {\n    return -f(-x);\n  };\n}\n\nexport function loggish(transform) {\n  var scale = transform(transformLog, transformExp),\n      domain = scale.domain,\n      base = 10,\n      logs,\n      pows;\n\n  function rescale() {\n    logs = logp(base), pows = powp(base);\n    if (domain()[0] < 0) {\n      logs = reflect(logs), pows = reflect(pows);\n      transform(transformLogn, transformExpn);\n    } else {\n      transform(transformLog, transformExp);\n    }\n    return scale;\n  }\n\n  scale.base = function(_) {\n    return arguments.length ? (base = +_, rescale()) : base;\n  };\n\n  scale.domain = function(_) {\n    return arguments.length ? (domain(_), rescale()) : domain();\n  };\n\n  scale.ticks = function(count) {\n    var d = domain(),\n        u = d[0],\n        v = d[d.length - 1],\n        r;\n\n    if (r = v < u) i = u, u = v, v = i;\n\n    var i = logs(u),\n        j = logs(v),\n        p,\n        k,\n        t,\n        n = count == null ? 10 : +count,\n        z = [];\n\n    if (!(base % 1) && j - i < n) {\n      i = Math.round(i) - 1, j = Math.round(j) + 1;\n      if (u > 0) for (; i < j; ++i) {\n        for (k = 1, p = pows(i); k < base; ++k) {\n          t = p * k;\n          if (t < u) continue;\n          if (t > v) break;\n          z.push(t);\n        }\n      } else for (; i < j; ++i) {\n        for (k = base - 1, p = pows(i); k >= 1; --k) {\n          t = p * k;\n          if (t < u) continue;\n          if (t > v) break;\n          z.push(t);\n        }\n      }\n    } else {\n      z = ticks(i, j, Math.min(j - i, n)).map(pows);\n    }\n\n    return r ? z.reverse() : z;\n  };\n\n  scale.tickFormat = function(count, specifier) {\n    if (specifier == null) specifier = base === 10 ? \".0e\" : \",\";\n    if (typeof specifier !== \"function\") specifier = format(specifier);\n    if (count === Infinity) return specifier;\n    if (count == null) count = 10;\n    var k = Math.max(1, base * count / scale.ticks().length); // TODO fast estimate?\n    return function(d) {\n      var i = d / pows(Math.round(logs(d)));\n      if (i * base < base - 0.5) i *= base;\n      return i <= k ? specifier(d) : \"\";\n    };\n  };\n\n  scale.nice = function() {\n    return domain(nice(domain(), {\n      floor: function(x) { return pows(Math.floor(logs(x))); },\n      ceil: function(x) { return pows(Math.ceil(logs(x))); }\n    }));\n  };\n\n  return scale;\n}\n\nexport default function log() {\n  var scale = loggish(transformer()).domain([1, 10]);\n\n  scale.copy = function() {\n    return copy(scale, log()).base(scale.base());\n  };\n\n  initRange.apply(scale, arguments);\n\n  return scale;\n}\n","import {linearish} from \"./linear\";\nimport {copy, identity, transformer} from \"./continuous\";\nimport {initRange} from \"./init\";\n\nfunction transformPow(exponent) {\n  return function(x) {\n    return x < 0 ? -Math.pow(-x, exponent) : Math.pow(x, exponent);\n  };\n}\n\nfunction transformSqrt(x) {\n  return x < 0 ? -Math.sqrt(-x) : Math.sqrt(x);\n}\n\nfunction transformSquare(x) {\n  return x < 0 ? -x * x : x * x;\n}\n\nexport function powish(transform) {\n  var scale = transform(identity, identity),\n      exponent = 1;\n\n  function rescale() {\n    return exponent === 1 ? transform(identity, identity)\n        : exponent === 0.5 ? transform(transformSqrt, transformSquare)\n        : transform(transformPow(exponent), transformPow(1 / exponent));\n  }\n\n  scale.exponent = function(_) {\n    return arguments.length ? (exponent = +_, rescale()) : exponent;\n  };\n\n  return linearish(scale);\n}\n\nexport default function pow() {\n  var scale = powish(transformer());\n\n  scale.copy = function() {\n    return copy(scale, pow()).exponent(scale.exponent());\n  };\n\n  initRange.apply(scale, arguments);\n\n  return scale;\n}\n\nexport function sqrt() {\n  return pow.apply(null, arguments).exponent(0.5);\n}\n","import interval from \"./interval.js\";\n\nvar millisecond = interval(function() {\n  // noop\n}, function(date, step) {\n  date.setTime(+date + step);\n}, function(start, end) {\n  return end - start;\n});\n\n// An optimized implementation for this simple case.\nmillisecond.every = function(k) {\n  k = Math.floor(k);\n  if (!isFinite(k) || !(k > 0)) return null;\n  if (!(k > 1)) return millisecond;\n  return interval(function(date) {\n    date.setTime(Math.floor(date / k) * k);\n  }, function(date, step) {\n    date.setTime(+date + step * k);\n  }, function(start, end) {\n    return (end - start) / k;\n  });\n};\n\nexport default millisecond;\nexport var milliseconds = millisecond.range;\n","import {bisector, tickStep} from \"d3-array\";\nimport {timeYear, timeMonth, timeWeek, timeDay, timeHour, timeMinute, timeSecond, timeMillisecond} from \"d3-time\";\nimport {timeFormat} from \"d3-time-format\";\nimport {map} from \"./array\";\nimport continuous, {copy, identity} from \"./continuous\";\nimport {initRange} from \"./init\";\nimport nice from \"./nice\";\n\nvar durationSecond = 1000,\n    durationMinute = durationSecond * 60,\n    durationHour = durationMinute * 60,\n    durationDay = durationHour * 24,\n    durationWeek = durationDay * 7,\n    durationMonth = durationDay * 30,\n    durationYear = durationDay * 365;\n\nfunction date(t) {\n  return new Date(t);\n}\n\nfunction number(t) {\n  return t instanceof Date ? +t : +new Date(+t);\n}\n\nexport function calendar(year, month, week, day, hour, minute, second, millisecond, format) {\n  var scale = continuous(identity, identity),\n      invert = scale.invert,\n      domain = scale.domain;\n\n  var formatMillisecond = format(\".%L\"),\n      formatSecond = format(\":%S\"),\n      formatMinute = format(\"%I:%M\"),\n      formatHour = format(\"%I %p\"),\n      formatDay = format(\"%a %d\"),\n      formatWeek = format(\"%b %d\"),\n      formatMonth = format(\"%B\"),\n      formatYear = format(\"%Y\");\n\n  var tickIntervals = [\n    [second,  1,      durationSecond],\n    [second,  5,  5 * durationSecond],\n    [second, 15, 15 * durationSecond],\n    [second, 30, 30 * durationSecond],\n    [minute,  1,      durationMinute],\n    [minute,  5,  5 * durationMinute],\n    [minute, 15, 15 * durationMinute],\n    [minute, 30, 30 * durationMinute],\n    [  hour,  1,      durationHour  ],\n    [  hour,  3,  3 * durationHour  ],\n    [  hour,  6,  6 * durationHour  ],\n    [  hour, 12, 12 * durationHour  ],\n    [   day,  1,      durationDay   ],\n    [   day,  2,  2 * durationDay   ],\n    [  week,  1,      durationWeek  ],\n    [ month,  1,      durationMonth ],\n    [ month,  3,  3 * durationMonth ],\n    [  year,  1,      durationYear  ]\n  ];\n\n  function tickFormat(date) {\n    return (second(date) < date ? formatMillisecond\n        : minute(date) < date ? formatSecond\n        : hour(date) < date ? formatMinute\n        : day(date) < date ? formatHour\n        : month(date) < date ? (week(date) < date ? formatDay : formatWeek)\n        : year(date) < date ? formatMonth\n        : formatYear)(date);\n  }\n\n  function tickInterval(interval, start, stop, step) {\n    if (interval == null) interval = 10;\n\n    // If a desired tick count is specified, pick a reasonable tick interval\n    // based on the extent of the domain and a rough estimate of tick size.\n    // Otherwise, assume interval is already a time interval and use it.\n    if (typeof interval === \"number\") {\n      var target = Math.abs(stop - start) / interval,\n          i = bisector(function(i) { return i[2]; }).right(tickIntervals, target);\n      if (i === tickIntervals.length) {\n        step = tickStep(start / durationYear, stop / durationYear, interval);\n        interval = year;\n      } else if (i) {\n        i = tickIntervals[target / tickIntervals[i - 1][2] < tickIntervals[i][2] / target ? i - 1 : i];\n        step = i[1];\n        interval = i[0];\n      } else {\n        step = Math.max(tickStep(start, stop, interval), 1);\n        interval = millisecond;\n      }\n    }\n\n    return step == null ? interval : interval.every(step);\n  }\n\n  scale.invert = function(y) {\n    return new Date(invert(y));\n  };\n\n  scale.domain = function(_) {\n    return arguments.length ? domain(map.call(_, number)) : domain().map(date);\n  };\n\n  scale.ticks = function(interval, step) {\n    var d = domain(),\n        t0 = d[0],\n        t1 = d[d.length - 1],\n        r = t1 < t0,\n        t;\n    if (r) t = t0, t0 = t1, t1 = t;\n    t = tickInterval(interval, t0, t1, step);\n    t = t ? t.range(t0, t1 + 1) : []; // inclusive stop\n    return r ? t.reverse() : t;\n  };\n\n  scale.tickFormat = function(count, specifier) {\n    return specifier == null ? tickFormat : format(specifier);\n  };\n\n  scale.nice = function(interval, step) {\n    var d = domain();\n    return (interval = tickInterval(interval, d[0], d[d.length - 1], step))\n        ? domain(nice(d, interval))\n        : scale;\n  };\n\n  scale.copy = function() {\n    return copy(scale, calendar(year, month, week, day, hour, minute, second, millisecond, format));\n  };\n\n  return scale;\n}\n\nexport default function() {\n  return initRange.apply(calendar(timeYear, timeMonth, timeWeek, timeDay, timeHour, timeMinute, timeSecond, timeMillisecond, timeFormat).domain([new Date(2000, 0, 1), new Date(2000, 0, 2)]), arguments);\n}\n","import interval from \"./interval.js\";\n\nvar utcMonth = interval(function(date) {\n  date.setUTCDate(1);\n  date.setUTCHours(0, 0, 0, 0);\n}, function(date, step) {\n  date.setUTCMonth(date.getUTCMonth() + step);\n}, function(start, end) {\n  return end.getUTCMonth() - start.getUTCMonth() + (end.getUTCFullYear() - start.getUTCFullYear()) * 12;\n}, function(date) {\n  return date.getUTCMonth();\n});\n\nexport default utcMonth;\nexport var utcMonths = utcMonth.range;\n","import interval from \"./interval.js\";\nimport {durationHour} from \"./duration.js\";\n\nvar utcHour = interval(function(date) {\n  date.setUTCMinutes(0, 0, 0);\n}, function(date, step) {\n  date.setTime(+date + step * durationHour);\n}, function(start, end) {\n  return (end - start) / durationHour;\n}, function(date) {\n  return date.getUTCHours();\n});\n\nexport default utcHour;\nexport var utcHours = utcHour.range;\n","import interval from \"./interval.js\";\nimport {durationMinute} from \"./duration.js\";\n\nvar utcMinute = interval(function(date) {\n  date.setUTCSeconds(0, 0);\n}, function(date, step) {\n  date.setTime(+date + step * durationMinute);\n}, function(start, end) {\n  return (end - start) / durationMinute;\n}, function(date) {\n  return date.getUTCMinutes();\n});\n\nexport default utcMinute;\nexport var utcMinutes = utcMinute.range;\n","export {\n  default as scaleBand,\n  point as scalePoint\n} from \"./band\";\n\nexport {\n  default as scaleIdentity\n} from \"./identity\";\n\nexport {\n  default as scaleLinear\n} from \"./linear\";\n\nexport {\n  default as scaleLog\n} from \"./log\";\n\nexport {\n  default as scaleSymlog\n} from \"./symlog\";\n\nexport {\n  default as scaleOrdinal,\n  implicit as scaleImplicit\n} from \"./ordinal\";\n\nexport {\n  default as scalePow,\n  sqrt as scaleSqrt\n} from \"./pow\";\n\nexport {\n  default as scaleQuantile\n} from \"./quantile\";\n\nexport {\n  default as scaleQuantize\n} from \"./quantize\";\n\nexport {\n  default as scaleThreshold\n} from \"./threshold\";\n\nexport {\n  default as scaleTime\n} from \"./time\";\n\nexport {\n  default as scaleUtc\n} from \"./utcTime\";\n\nexport {\n  default as scaleSequential,\n  sequentialLog as scaleSequentialLog,\n  sequentialPow as scaleSequentialPow,\n  sequentialSqrt as scaleSequentialSqrt,\n  sequentialSymlog as scaleSequentialSymlog\n} from \"./sequential\";\n\nexport {\n  default as scaleSequentialQuantile\n} from \"./sequentialQuantile\";\n\nexport {\n  default as scaleDiverging,\n  divergingLog as scaleDivergingLog,\n  divergingPow as scaleDivergingPow,\n  divergingSqrt as scaleDivergingSqrt,\n  divergingSymlog as scaleDivergingSymlog\n} from \"./diverging\";\n\nexport {\n  default as tickFormat\n} from \"./tickFormat\";\n","import {Category, toolbar} from './annotations';\r\nimport CategoricalColumn from './CategoricalColumn';\r\nimport Column, {widthChanged, labelChanged, metaDataChanged, dirty, dirtyHeader, dirtyValues, rendererTypeChanged, groupRendererChanged, summaryRendererChanged, visibilityChanged} from './Column';\r\nimport ValueColumn, {IValueColumnDesc, dataLoaded} from './ValueColumn';\r\nimport {ICategoricalColumn, ICategory} from './ICategoricalColumn';\r\nimport {IDataRow} from './interfaces';\r\nimport {IEventListener} from '../internal/AEventDispatcher';\r\n\r\nexport interface IBooleanDesc {\r\n  /**\r\n   * string to show for true\r\n   * @default \r\n   */\r\n  trueMarker?: string;\r\n  /**\r\n   * strint to show for false\r\n   * @default (empty)\r\n   */\r\n  falseMarker?: string;\r\n}\r\n\r\nexport declare type IBooleanColumnDesc = IValueColumnDesc<boolean> & IBooleanDesc;\r\n\r\n\r\n/**\r\n * emitted when the filter property changes\r\n * @asMemberOf BooleanColumn\r\n * @event\r\n */\r\nexport declare function filterChanged(previous: boolean | null, current: boolean | null): void;\r\n\r\n/**\r\n * a string column with optional alignment\r\n */\r\n@toolbar('group', 'groupBy', 'filterBoolean')\r\n@Category('categorical')\r\nexport default class BooleanColumn extends ValueColumn<boolean> implements ICategoricalColumn {\r\n  static readonly EVENT_FILTER_CHANGED = 'filterChanged';\r\n\r\n  static readonly GROUP_TRUE = {name: 'True', color: 'black'};\r\n  static readonly GROUP_FALSE = {name: 'False', color: 'white'};\r\n\r\n  private currentFilter: boolean | null = null;\r\n  readonly categories: ICategory[];\r\n\r\n  constructor(id: string, desc: Readonly<IBooleanColumnDesc>) {\r\n    super(id, desc);\r\n    this.setWidthImpl(30);\r\n    this.categories = [\r\n      {\r\n        name: desc.trueMarker || '',\r\n        color: BooleanColumn.GROUP_TRUE.color,\r\n        label: BooleanColumn.GROUP_TRUE.name,\r\n        value: 0\r\n      },\r\n      {\r\n        name: desc.trueMarker || '',\r\n        color: BooleanColumn.GROUP_FALSE.color,\r\n        label: BooleanColumn.GROUP_FALSE.name,\r\n        value: 1\r\n      }\r\n    ];\r\n  }\r\n\r\n  protected createEventList() {\r\n    return super.createEventList().concat([BooleanColumn.EVENT_FILTER_CHANGED]);\r\n  }\r\n\r\n  on(type: typeof BooleanColumn.EVENT_FILTER_CHANGED, listener: typeof filterChanged | null): this;\r\n  on(type: typeof ValueColumn.EVENT_DATA_LOADED, listener: typeof dataLoaded | null): this;\r\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\r\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\r\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\r\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\r\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\r\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\r\n  on(type: string | string[], listener: IEventListener | null): this {\r\n    return super.on(<any>type, listener);\r\n  }\r\n\r\n\r\n  get dataLength() {\r\n    return this.categories.length;\r\n  }\r\n\r\n  get labels() {\r\n    return this.categories.map((d) => d.label);\r\n  }\r\n\r\n  getValue(row: IDataRow) {\r\n    const v: any = super.getValue(row);\r\n    if (typeof(v) === 'undefined' || v == null) {\r\n      return false;\r\n    }\r\n    return v === true || v === 'true' || v === 'yes' || v === 'x';\r\n  }\r\n\r\n  isMissing() {\r\n    return false;\r\n  }\r\n\r\n  getCategory(row: IDataRow) {\r\n    const v = this.getValue(row);\r\n    return this.categories[v ? 0 : 1];\r\n  }\r\n\r\n  getColor(row: IDataRow) {\r\n    return CategoricalColumn.prototype.getColor.call(this, row);\r\n  }\r\n\r\n  getLabel(row: IDataRow) {\r\n    return CategoricalColumn.prototype.getLabel.call(this, row);\r\n  }\r\n\r\n  getLabels(row: IDataRow) {\r\n    return CategoricalColumn.prototype.getLabels.call(this, row);\r\n  }\r\n\r\n  getValues(row: IDataRow) {\r\n    return CategoricalColumn.prototype.getValues.call(this, row);\r\n  }\r\n\r\n  getMap(row: IDataRow) {\r\n    return CategoricalColumn.prototype.getMap.call(this, row);\r\n  }\r\n\r\n  getMapLabel(row: IDataRow) {\r\n    return CategoricalColumn.prototype.getMapLabel.call(this, row);\r\n  }\r\n\r\n  getSet(row: IDataRow) {\r\n    const v = this.getValue(row);\r\n    const r = new Set<ICategory>();\r\n    r.add(this.categories[v ? 0 : 1]);\r\n    return r;\r\n  }\r\n\r\n  dump(toDescRef: (desc: any) => any): any {\r\n    const r = super.dump(toDescRef);\r\n    if (this.currentFilter != null) {\r\n      r.filter = this.currentFilter;\r\n    }\r\n    return r;\r\n  }\r\n\r\n  restore(dump: any, factory: (dump: any) => Column | null) {\r\n    super.restore(dump, factory);\r\n    if (typeof dump.filter !== 'undefined') {\r\n      this.currentFilter = dump.filter;\r\n    }\r\n  }\r\n\r\n  isFiltered() {\r\n    return this.currentFilter != null;\r\n  }\r\n\r\n  filter(row: IDataRow) {\r\n    if (!this.isFiltered()) {\r\n      return true;\r\n    }\r\n    const r = this.getValue(row);\r\n    return r === this.currentFilter;\r\n  }\r\n\r\n  getFilter() {\r\n    return this.currentFilter;\r\n  }\r\n\r\n  setFilter(filter: boolean | null) {\r\n    if (this.currentFilter === filter) {\r\n      return;\r\n    }\r\n    this.fire([BooleanColumn.EVENT_FILTER_CHANGED, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY], this.currentFilter, this.currentFilter = filter);\r\n  }\r\n\r\n  compare(a: IDataRow, b: IDataRow) {\r\n    const av = this.getValue(a);\r\n    const bv = this.getValue(b);\r\n    return av === bv ? 0 : (av < bv ? -1 : +1);\r\n  }\r\n\r\n  group(row: IDataRow) {\r\n    const enabled = this.getValue(row);\r\n    return enabled ? BooleanColumn.GROUP_TRUE : BooleanColumn.GROUP_FALSE;\r\n  }\r\n}\r\n","import {IBoxPlotData} from '../internal';\r\nimport {suffix, IEventListener} from '../internal/AEventDispatcher';\r\nimport {toolbar, SortByDefault, dialogAddons} from './annotations';\r\nimport BoxPlotColumn, {mappingChanged} from './BoxPlotColumn';\r\nimport Column, {IColumnDesc, widthChanged, labelChanged, metaDataChanged, dirty, dirtyHeader, dirtyValues, rendererTypeChanged, groupRendererChanged, summaryRendererChanged, visibilityChanged} from './Column';\r\nimport CompositeColumn, {addColumn, filterChanged, moveColumn, removeColumn} from './CompositeColumn';\r\nimport {IDataRow, IGroupData} from './interfaces';\r\nimport {ESortMethod, IBoxPlotColumn, INumberFilter, isBoxPlotColumn, noNumberFilter} from './INumberColumn';\r\nimport {IMappingFunction, ScaleMappingFunction, isMapAbleColumn} from './MappingFunction';\r\nimport NumbersColumn from './NumbersColumn';\r\nimport {colorMappingChanged} from './NumberColumn';\r\nimport {DEFAULT_COLOR_FUNCTION, IColorMappingFunction} from './ColorMappingFunction';\r\n\r\n\r\n/**\r\n *  factory for creating a description creating a max column\r\n * @param label\r\n * @returns {{type: string, label: string}}\r\n */\r\nexport function createImpositionBoxPlotDesc(label: string = 'Imposition') {\r\n  return {type: 'impositions', label};\r\n}\r\n\r\n/**\r\n * implementation of a combine column, standard operations how to select\r\n */\r\n@toolbar('filterNumber', 'colorMapped', 'editMapping')\r\n@dialogAddons('sort', 'sortBoxPlot')\r\n@SortByDefault('descending')\r\nexport default class ImpositionBoxPlotColumn extends CompositeColumn implements IBoxPlotColumn {\r\n  static readonly EVENT_MAPPING_CHANGED = NumbersColumn.EVENT_MAPPING_CHANGED;\r\n  static readonly EVENT_COLOR_MAPPING_CHANGED = NumbersColumn.EVENT_COLOR_MAPPING_CHANGED;\r\n\r\n  constructor(id: string, desc: Readonly<IColumnDesc>) {\r\n    super(id, desc);\r\n\r\n    this.setDefaultRenderer('boxplot');\r\n    this.setDefaultGroupRenderer('boxplot');\r\n  }\r\n\r\n  get label() {\r\n    const l = super.getMetaData().label;\r\n    const c = this._children;\r\n    if (l !== 'Imposition' || c.length === 0) {\r\n      return l;\r\n    }\r\n    if (c.length === 1) {\r\n      return c[0].label;\r\n    }\r\n    return `${c[0].label} (${c.slice(1).map((c) => c.label).join(', ')})`;\r\n  }\r\n\r\n  private get wrapper(): IBoxPlotColumn | null {\r\n    const c = this._children;\r\n    return c.length === 0 ? null : <IBoxPlotColumn>c[0];\r\n  }\r\n\r\n  getLabel(row: IDataRow) {\r\n    const c = this._children;\r\n    if (c.length === 0) {\r\n      return '';\r\n    }\r\n    if (c.length === 1) {\r\n      return c[0].getLabel(row);\r\n    }\r\n    return `${c[0].getLabel(row)} (${c.slice(1).map((c) => `${c.label} = ${c.getLabel(row)}`)})`;\r\n  }\r\n\r\n  getColor(row: IDataRow) {\r\n    const c = this._children;\r\n    switch(c.length) {\r\n      case 0:\r\n        return Column.DEFAULT_COLOR;\r\n      case 1:\r\n        return c[0].getColor(row);\r\n      default:\r\n        return c[1].getColor(row);\r\n    }\r\n  }\r\n\r\n  protected createEventList() {\r\n    return super.createEventList().concat([ImpositionBoxPlotColumn.EVENT_MAPPING_CHANGED, ImpositionBoxPlotColumn.EVENT_COLOR_MAPPING_CHANGED]);\r\n  }\r\n\r\n  on(type: typeof ImpositionBoxPlotColumn.EVENT_COLOR_MAPPING_CHANGED, listener: typeof colorMappingChanged | null): this;\r\n  on(type: typeof ImpositionBoxPlotColumn.EVENT_MAPPING_CHANGED, listener: typeof mappingChanged | null): this;\r\n  on(type: typeof CompositeColumn.EVENT_FILTER_CHANGED, listener: typeof filterChanged | null): this;\r\n  on(type: typeof CompositeColumn.EVENT_ADD_COLUMN, listener: typeof addColumn | null): this;\r\n  on(type: typeof CompositeColumn.EVENT_MOVE_COLUMN, listener: typeof moveColumn | null): this;\r\n  on(type: typeof CompositeColumn.EVENT_REMOVE_COLUMN, listener: typeof removeColumn | null): this;\r\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\r\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\r\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\r\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\r\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\r\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\r\n  on(type: string | string[], listener: IEventListener | null): this {\r\n    return super.on(type, listener);\r\n  }\r\n\r\n  getValue(row: IDataRow) {\r\n    const w = this.wrapper;\r\n    return w ? w.getValue(row) : null;\r\n  }\r\n\r\n  getNumber(row: IDataRow) {\r\n    const w = this.wrapper;\r\n    return w ? w.getNumber(row) : NaN;\r\n  }\r\n\r\n  getRawNumber(row: IDataRow) {\r\n    const w = this.wrapper;\r\n    return w ? w.getRawNumber(row) : NaN;\r\n  }\r\n\r\n  getExportValue(row: IDataRow, format: 'text' | 'json'): any {\r\n    if (format === 'json') {\r\n      if (this.isMissing(row)) {\r\n        return null;\r\n      }\r\n      return {\r\n        label: this.getLabel(row),\r\n        color: this.getColor(row),\r\n        value: this.getRawNumber(row)\r\n      };\r\n    }\r\n    return super.getExportValue(row, format);\r\n  }\r\n\r\n  getBoxPlotData(row: IDataRow): IBoxPlotData | null {\r\n    const w = this.wrapper;\r\n    return w ? w.getBoxPlotData(row) : null;\r\n  }\r\n\r\n  getRawBoxPlotData(row: IDataRow): IBoxPlotData | null {\r\n    const w = this.wrapper;\r\n    return w ? w.getRawBoxPlotData(row) : null;\r\n  }\r\n\r\n  getMapping() {\r\n    const w = this.wrapper;\r\n    return w ? w.getMapping() : new ScaleMappingFunction();\r\n  }\r\n\r\n  getOriginalMapping() {\r\n    const w = this.wrapper;\r\n    return w ? w.getOriginalMapping() : new ScaleMappingFunction();\r\n  }\r\n\r\n  getSortMethod() {\r\n    const w = this.wrapper;\r\n    return w ? w.getSortMethod() : ESortMethod.min;\r\n  }\r\n\r\n  setSortMethod(value: ESortMethod) {\r\n    const w = this.wrapper;\r\n    return w ? w.setSortMethod(value) : undefined;\r\n  }\r\n\r\n  isMissing(row: IDataRow) {\r\n    const w = this.wrapper;\r\n    return w ? w.isMissing(row) : true;\r\n  }\r\n\r\n  setMapping(mapping: IMappingFunction): void {\r\n    const w = this.wrapper;\r\n    return w ? w.setMapping(mapping) : undefined;\r\n  }\r\n\r\n  getColorMapping() {\r\n    const w = this.wrapper;\r\n    return w ? w.getColorMapping() : DEFAULT_COLOR_FUNCTION;\r\n  }\r\n\r\n  setColorMapping(mapping: IColorMappingFunction) {\r\n    const w = this.wrapper;\r\n    return w ? w.setColorMapping(mapping) : undefined;\r\n  }\r\n\r\n  getFilter() {\r\n    const w = this.wrapper;\r\n    return w ? w.getFilter() : noNumberFilter();\r\n  }\r\n\r\n  setFilter(value?: INumberFilter): void {\r\n    const w = this.wrapper;\r\n    return w ? w.setFilter(value) : undefined;\r\n  }\r\n\r\n  getRange(): [string, string] {\r\n    const w = this.wrapper;\r\n    return w ? w.getRange() : ['0', '1'];\r\n  }\r\n\r\n  compare(a: IDataRow, b: IDataRow) {\r\n    return BoxPlotColumn.prototype.compare.call(this, a, b);\r\n  }\r\n\r\n  group(row: IDataRow) {\r\n    return BoxPlotColumn.prototype.group.call(this, row);\r\n  }\r\n\r\n  groupCompare(a: IGroupData, b: IGroupData) {\r\n    return BoxPlotColumn.prototype.groupCompare.call(this, a, b);\r\n  }\r\n\r\n  insert(col: Column, index: number): Column | null {\r\n    if (this._children.length === 0 && !isBoxPlotColumn(col)) {\r\n      return null;\r\n    }\r\n    if (this._children.length >= 2) {\r\n      // limit to two\r\n      return null;\r\n    }\r\n    return super.insert(col, index);\r\n  }\r\n\r\n  protected insertImpl(col: Column, index: number) {\r\n    if (isBoxPlotColumn(col)) {\r\n      this.forward(col, ...suffix('.impose', BoxPlotColumn.EVENT_MAPPING_CHANGED, BoxPlotColumn.EVENT_COLOR_MAPPING_CHANGED));\r\n    }\r\n    if (isMapAbleColumn(col)) {\r\n      this.forward(col, ...suffix('.impose', BoxPlotColumn.EVENT_COLOR_MAPPING_CHANGED));\r\n    }\r\n    return super.insertImpl(col, index);\r\n  }\r\n\r\n  protected removeImpl(child: Column, index: number) {\r\n    if (isBoxPlotColumn(child)) {\r\n      this.unforward(child, ...suffix('.impose', BoxPlotColumn.EVENT_MAPPING_CHANGED, BoxPlotColumn.EVENT_COLOR_MAPPING_CHANGED));\r\n    }\r\n    if (isMapAbleColumn(child)) {\r\n      this.unforward(child, ...suffix('.impose', BoxPlotColumn.EVENT_COLOR_MAPPING_CHANGED));\r\n    }\r\n    return super.removeImpl(child, index);\r\n  }\r\n}\r\n","import {suffix, IEventListener} from '../internal/AEventDispatcher';\r\nimport {toolbar, SortByDefault} from './annotations';\r\nimport Column, {IColumnDesc, widthChanged, labelChanged, metaDataChanged, dirty, dirtyHeader, dirtyValues, rendererTypeChanged, groupRendererChanged, summaryRendererChanged, visibilityChanged} from './Column';\r\nimport CompositeColumn, {addColumn, filterChanged, moveColumn, removeColumn} from './CompositeColumn';\r\nimport {IDataRow, IGroupData} from './interfaces';\r\nimport {isNumberColumn} from './INumberColumn';\r\nimport NumberColumn, {INumberColumn, mappingChanged, colorMappingChanged} from './NumberColumn';\r\nimport {isMapAbleColumn} from './MappingFunction';\r\n\r\n\r\n/**\r\n *  factory for creating a description creating a max column\r\n * @param label\r\n * @returns {{type: string, label: string}}\r\n */\r\nexport function createImpositionDesc(label: string = 'Imposition') {\r\n  return {type: 'imposition', label};\r\n}\r\n\r\n/**\r\n * implementation of a combine column, standard operations how to select\r\n */\r\n@toolbar('filterNumber', 'colorMapped', 'editMapping')\r\n@SortByDefault('descending')\r\nexport default class ImpositionCompositeColumn extends CompositeColumn implements INumberColumn {\r\n  static readonly EVENT_MAPPING_CHANGED = NumberColumn.EVENT_MAPPING_CHANGED;\r\n  static readonly EVENT_COLOR_MAPPING_CHANGED = NumberColumn.EVENT_COLOR_MAPPING_CHANGED;\r\n\r\n  constructor(id: string, desc: Readonly<IColumnDesc>) {\r\n    super(id, desc);\r\n\r\n    this.setDefaultRenderer('number');\r\n    this.setDefaultGroupRenderer('boxplot');\r\n  }\r\n\r\n  get label() {\r\n    const l = super.getMetaData().label;\r\n    const c = this._children;\r\n    if (l !== 'Imposition' || c.length === 0) {\r\n      return l;\r\n    }\r\n    if (c.length === 1) {\r\n      return c[0].label;\r\n    }\r\n    return `${c[0].label} (${c.slice(1).map((c) => c.label).join(', ')})`;\r\n  }\r\n\r\n  private get wrapper(): INumberColumn | null {\r\n    const c = this._children;\r\n    return c.length === 0 ? null : <INumberColumn>c[0];\r\n  }\r\n\r\n  protected createEventList() {\r\n    return super.createEventList().concat([ImpositionCompositeColumn.EVENT_MAPPING_CHANGED, ImpositionCompositeColumn.EVENT_COLOR_MAPPING_CHANGED]);\r\n  }\r\n\r\n  on(type: typeof ImpositionCompositeColumn.EVENT_COLOR_MAPPING_CHANGED, listener: typeof colorMappingChanged | null): this;\r\n  on(type: typeof ImpositionCompositeColumn.EVENT_MAPPING_CHANGED, listener: typeof mappingChanged | null): this;\r\n  on(type: typeof CompositeColumn.EVENT_FILTER_CHANGED, listener: typeof filterChanged | null): this;\r\n  on(type: typeof CompositeColumn.EVENT_ADD_COLUMN, listener: typeof addColumn | null): this;\r\n  on(type: typeof CompositeColumn.EVENT_MOVE_COLUMN, listener: typeof moveColumn | null): this;\r\n  on(type: typeof CompositeColumn.EVENT_REMOVE_COLUMN, listener: typeof removeColumn | null): this;\r\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\r\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\r\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\r\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\r\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\r\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\r\n  on(type: string | string[], listener: IEventListener | null): this {\r\n    return super.on(type, listener);\r\n  }\r\n\r\n  getLabel(row: IDataRow) {\r\n    const c = this._children;\r\n    if (c.length === 0) {\r\n      return '';\r\n    }\r\n    if (c.length === 1) {\r\n      return c[0].getLabel(row);\r\n    }\r\n    return `${c[0].getLabel(row)} (${c.slice(1).map((c) => `${c.label} = ${c.getLabel(row)}`).join(', ')})`;\r\n  }\r\n\r\n  getColor(row: IDataRow) {\r\n    const c = this._children;\r\n    switch(c.length) {\r\n      case 0:\r\n        return Column.DEFAULT_COLOR;\r\n      case 1:\r\n        return c[0].getColor(row);\r\n      default:\r\n        return c[1].getColor(row);\r\n    }\r\n  }\r\n\r\n  getValue(row: IDataRow) {\r\n    const w = this.wrapper;\r\n    return w ? w.getValue(row) : NaN;\r\n  }\r\n\r\n  getNumber(row: IDataRow) {\r\n    const w = this.wrapper;\r\n    return w ? w.getNumber(row) : NaN;\r\n  }\r\n\r\n  getRawNumber(row: IDataRow) {\r\n    const w = this.wrapper;\r\n    return w ? w.getRawNumber(row) : NaN;\r\n  }\r\n\r\n  getExportValue(row: IDataRow, format: 'text' | 'json'): any {\r\n    if (format === 'json') {\r\n      if (this.isMissing(row)) {\r\n        return null;\r\n      }\r\n      return {\r\n        label: this.getLabel(row),\r\n        color: this.getColor(row),\r\n        value: this.getRawNumber(row)\r\n      };\r\n    }\r\n    return super.getExportValue(row, format);\r\n  }\r\n\r\n  isMissing(row: IDataRow) {\r\n    const w = this.wrapper;\r\n    return w ? w.isMissing(row) : true;\r\n  }\r\n\r\n  compare(a: IDataRow, b: IDataRow) {\r\n    return NumberColumn.prototype.compare.call(this, a, b);\r\n  }\r\n\r\n  group(row: IDataRow) {\r\n    return NumberColumn.prototype.group.call(this, row);\r\n  }\r\n\r\n  groupCompare(a: IGroupData, b: IGroupData) {\r\n    return NumberColumn.prototype.groupCompare.call(this, a, b);\r\n  }\r\n\r\n  insert(col: Column, index: number): Column | null {\r\n    if (this._children.length === 0 && !isNumberColumn(col)) {\r\n      return null;\r\n    }\r\n    if (this._children.length >= 2) {\r\n      // limit to two\r\n      return null;\r\n    }\r\n    return super.insert(col, index);\r\n  }\r\n\r\n  protected insertImpl(col: Column, index: number) {\r\n    if (isNumberColumn(col)) {\r\n      this.forward(col, ...suffix('.impose', NumberColumn.EVENT_MAPPING_CHANGED));\r\n    }\r\n    if (isMapAbleColumn(col)) {\r\n      this.forward(col, ...suffix('.impose', NumberColumn.EVENT_COLOR_MAPPING_CHANGED));\r\n    }\r\n    return super.insertImpl(col, index);\r\n  }\r\n\r\n  protected removeImpl(child: Column, index: number) {\r\n    if (isNumberColumn(child)) {\r\n      this.unforward(child, ...suffix('.impose', NumberColumn.EVENT_MAPPING_CHANGED));\r\n    }\r\n    if (isMapAbleColumn(child)) {\r\n      this.unforward(child, ...suffix('.impose', NumberColumn.EVENT_COLOR_MAPPING_CHANGED));\r\n    }\r\n    return super.removeImpl(child, index);\r\n  }\r\n}\r\n","import {IAdvancedBoxPlotData} from '../internal';\r\nimport {suffix, IEventListener} from '../internal/AEventDispatcher';\r\nimport {toolbar, dialogAddons, SortByDefault} from './annotations';\r\nimport Column, {IColumnDesc, widthChanged, labelChanged, metaDataChanged, dirty, dirtyHeader, dirtyValues, rendererTypeChanged, groupRendererChanged, summaryRendererChanged, visibilityChanged} from './Column';\r\nimport CompositeColumn, {addColumn, filterChanged, moveColumn, removeColumn} from './CompositeColumn';\r\nimport {IKeyValue} from './IArrayColumn';\r\nimport {IDataRow, IGroupData} from './interfaces';\r\nimport {EAdvancedSortMethod, INumberFilter, INumbersColumn, isNumbersColumn, noNumberFilter} from './INumberColumn';\r\nimport {IMappingFunction, ScaleMappingFunction, isMapAbleColumn} from './MappingFunction';\r\nimport NumbersColumn, {mappingChanged} from './NumbersColumn';\r\nimport {colorMappingChanged} from './NumberColumn';\r\nimport {DEFAULT_COLOR_FUNCTION, IColorMappingFunction} from './ColorMappingFunction';\r\n\r\n\r\n/**\r\n *  factory for creating a description creating a max column\r\n * @param label\r\n * @returns {{type: string, label: string}}\r\n */\r\nexport function createImpositionsDesc(label: string = 'Imposition') {\r\n  return {type: 'impositions', label};\r\n}\r\n\r\n/**\r\n * implementation of a combine column, standard operations how to select\r\n */\r\n@toolbar('filterNumber', 'colorMapped', 'editMapping')\r\n@dialogAddons('sort', 'sortNumbers')\r\n@SortByDefault('descending')\r\nexport default class ImpositionCompositesColumn extends CompositeColumn implements INumbersColumn {\r\n  static readonly EVENT_MAPPING_CHANGED = NumbersColumn.EVENT_MAPPING_CHANGED;\r\n  static readonly EVENT_COLOR_MAPPING_CHANGED = NumbersColumn.EVENT_COLOR_MAPPING_CHANGED;\r\n\r\n  constructor(id: string, desc: Readonly<IColumnDesc>) {\r\n    super(id, desc);\r\n\r\n    this.setDefaultRenderer('numbers');\r\n    this.setDefaultGroupRenderer('numbers');\r\n  }\r\n\r\n  get label() {\r\n    const l = super.getMetaData().label;\r\n    const c = this._children;\r\n    if (l !== 'Imposition' || c.length === 0) {\r\n      return l;\r\n    }\r\n    if (c.length === 1) {\r\n      return c[0].label;\r\n    }\r\n    return `${c[0].label} (${c.slice(1).map((c) => c.label).join(', ')})`;\r\n  }\r\n\r\n  private get wrapper(): INumbersColumn | null {\r\n    const c = this._children;\r\n    return c.length === 0 ? null : <INumbersColumn>c[0];\r\n  }\r\n\r\n  getLabel(row: IDataRow) {\r\n    const c = this._children;\r\n    if (c.length === 0) {\r\n      return '';\r\n    }\r\n    if (c.length === 1) {\r\n      return c[0].getLabel(row);\r\n    }\r\n    return `${c[0].getLabel(row)} (${c.slice(1).map((c) => `${c.label} = ${c.getLabel(row)}`)})`;\r\n  }\r\n\r\n  getColor(row: IDataRow) {\r\n    const c = this._children;\r\n    switch(c.length) {\r\n      case 0:\r\n        return Column.DEFAULT_COLOR;\r\n      case 1:\r\n        return c[0].getColor(row);\r\n      default:\r\n        return c[1].getColor(row);\r\n    }\r\n  }\r\n\r\n  protected createEventList() {\r\n    return super.createEventList().concat([ImpositionCompositesColumn.EVENT_MAPPING_CHANGED, ImpositionCompositesColumn.EVENT_COLOR_MAPPING_CHANGED]);\r\n  }\r\n\r\n  on(type: typeof ImpositionCompositesColumn.EVENT_COLOR_MAPPING_CHANGED, listener: typeof colorMappingChanged | null): this;\r\n  on(type: typeof ImpositionCompositesColumn.EVENT_MAPPING_CHANGED, listener: typeof mappingChanged | null): this;\r\n  on(type: typeof CompositeColumn.EVENT_FILTER_CHANGED, listener: typeof filterChanged | null): this;\r\n  on(type: typeof CompositeColumn.EVENT_ADD_COLUMN, listener: typeof addColumn | null): this;\r\n  on(type: typeof CompositeColumn.EVENT_MOVE_COLUMN, listener: typeof moveColumn | null): this;\r\n  on(type: typeof CompositeColumn.EVENT_REMOVE_COLUMN, listener: typeof removeColumn | null): this;\r\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\r\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\r\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\r\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\r\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\r\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\r\n  on(type: string | string[], listener: IEventListener | null): this {\r\n    return super.on(type, listener);\r\n  }\r\n\r\n  get labels() {\r\n    const w = this.wrapper;\r\n    return w ? w.labels : [];\r\n  }\r\n\r\n  get dataLength() {\r\n    const w = this.wrapper;\r\n    return w ? w.dataLength : null;\r\n  }\r\n\r\n  getValue(row: IDataRow) {\r\n    const w = this.wrapper;\r\n    return w ? w.getValue(row) : [];\r\n  }\r\n\r\n  getNumber(row: IDataRow) {\r\n    const w = this.wrapper;\r\n    return w ? w.getNumber(row) : NaN;\r\n  }\r\n\r\n  getRawNumber(row: IDataRow) {\r\n    const w = this.wrapper;\r\n    return w ? w.getRawNumber(row) : NaN;\r\n  }\r\n\r\n  getExportValue(row: IDataRow, format: 'text' | 'json'): any {\r\n    if (format === 'json') {\r\n      if (this.isMissing(row)) {\r\n        return null;\r\n      }\r\n      return {\r\n        label: this.getLabels(row),\r\n        color: this.getColor(row),\r\n        value: this.getRawNumbers(row)\r\n      };\r\n    }\r\n    return super.getExportValue(row, format);\r\n  }\r\n\r\n  getNumbers(row: IDataRow) {\r\n    const w = this.wrapper;\r\n    return w ? w.getNumbers(row) : [];\r\n  }\r\n\r\n  getRawNumbers(row: IDataRow) {\r\n    const w = this.wrapper;\r\n    return w ? w.getRawNumbers(row) : [];\r\n  }\r\n\r\n  getBoxPlotData(row: IDataRow): IAdvancedBoxPlotData | null {\r\n    const w = this.wrapper;\r\n    return w ? w.getBoxPlotData(row) : null;\r\n  }\r\n\r\n  getRawBoxPlotData(row: IDataRow): IAdvancedBoxPlotData | null {\r\n    const w = this.wrapper;\r\n    return w ? w.getRawBoxPlotData(row) : null;\r\n  }\r\n\r\n  getMapping() {\r\n    const w = this.wrapper;\r\n    return w ? w.getMapping() : new ScaleMappingFunction();\r\n  }\r\n\r\n  getOriginalMapping() {\r\n    const w = this.wrapper;\r\n    return w ? w.getOriginalMapping() : new ScaleMappingFunction();\r\n  }\r\n\r\n  getSortMethod() {\r\n    const w = this.wrapper;\r\n    return w ? w.getSortMethod() : EAdvancedSortMethod.min;\r\n  }\r\n\r\n  setSortMethod(value: EAdvancedSortMethod) {\r\n    const w = this.wrapper;\r\n    return w ? w.setSortMethod(value) : undefined;\r\n  }\r\n\r\n  isMissing(row: IDataRow) {\r\n    const w = this.wrapper;\r\n    return w ? w.isMissing(row) : true;\r\n  }\r\n\r\n  setMapping(mapping: IMappingFunction): void {\r\n    const w = this.wrapper;\r\n    return w ? w.setMapping(mapping) : undefined;\r\n  }\r\n\r\n  getColorMapping() {\r\n    const w = this.wrapper;\r\n    return w ? w.getColorMapping() : DEFAULT_COLOR_FUNCTION;\r\n  }\r\n\r\n  setColorMapping(mapping: IColorMappingFunction) {\r\n    const w = this.wrapper;\r\n    return w ? w.setColorMapping(mapping) : undefined;\r\n  }\r\n\r\n  getFilter() {\r\n    const w = this.wrapper;\r\n    return w ? w.getFilter() : noNumberFilter();\r\n  }\r\n\r\n  setFilter(value?: INumberFilter): void {\r\n    const w = this.wrapper;\r\n    return w ? w.setFilter(value) : undefined;\r\n  }\r\n\r\n  getRange(): [string, string] {\r\n    const w = this.wrapper;\r\n    return w ? w.getRange() : ['0', '1'];\r\n  }\r\n\r\n  getMap(row: IDataRow): IKeyValue<number>[] {\r\n    const w = this.wrapper;\r\n    return w ? w.getMap(row) : [];\r\n  }\r\n\r\n  getMapLabel(row: IDataRow) {\r\n    const w = this.wrapper;\r\n    return w ? w.getMapLabel(row) : [];\r\n  }\r\n\r\n  getLabels(row: IDataRow): string[] {\r\n    const w = this.wrapper;\r\n    return w ? w.getLabels(row) : [];\r\n  }\r\n\r\n  getValues(row: IDataRow) {\r\n    const w = this.wrapper;\r\n    return w ? w.getValues(row) : [];\r\n  }\r\n\r\n  compare(a: IDataRow, b: IDataRow) {\r\n    return NumbersColumn.prototype.compare.call(this, a, b);\r\n  }\r\n\r\n  group(row: IDataRow) {\r\n    return NumbersColumn.prototype.group.call(this, row);\r\n  }\r\n\r\n  groupCompare(a: IGroupData, b: IGroupData) {\r\n    return NumbersColumn.prototype.groupCompare.call(this, a, b);\r\n  }\r\n\r\n  insert(col: Column, index: number): Column | null {\r\n    if (this._children.length === 0 && !isNumbersColumn(col)) {\r\n      return null;\r\n    }\r\n    if (this._children.length >= 2) {\r\n      // limit to two\r\n      return null;\r\n    }\r\n    return super.insert(col, index);\r\n  }\r\n\r\n  protected insertImpl(col: Column, index: number) {\r\n    if (isNumbersColumn(col)) {\r\n      this.forward(col, ...suffix('.impose', NumbersColumn.EVENT_MAPPING_CHANGED));\r\n    }\r\n    if (isMapAbleColumn(col)) {\r\n      this.forward(col, ...suffix('.impose', NumbersColumn.EVENT_COLOR_MAPPING_CHANGED));\r\n    }\r\n    return super.insertImpl(col, index);\r\n  }\r\n\r\n  protected removeImpl(child: Column, index: number) {\r\n    if (isNumbersColumn(child)) {\r\n      this.unforward(child, ...suffix('.impose', NumbersColumn.EVENT_MAPPING_CHANGED));\r\n    }\r\n    if (isMapAbleColumn(child)) {\r\n      this.unforward(child, ...suffix('.impose', NumbersColumn.EVENT_COLOR_MAPPING_CHANGED));\r\n    }\r\n    return super.removeImpl(child, index);\r\n  }\r\n}\r\n","import {toolbar} from './annotations';\r\nimport Column, {widthChanged, labelChanged, metaDataChanged, dirty, dirtyHeader, dirtyValues, rendererTypeChanged, groupRendererChanged, summaryRendererChanged, visibilityChanged} from './Column';\r\nimport ValueColumn, {dataLoaded} from './ValueColumn';\r\nimport {IDataRow} from './interfaces';\r\nimport {patternFunction} from './internal';\r\nimport MapColumn, {IMapColumnDesc} from './MapColumn';\r\nimport LinkColumn, {ILinkDesc, patternChanged} from './LinkColumn';\r\nimport {IEventListener} from '../internal/AEventDispatcher';\r\nimport {EAlignment} from './StringColumn';\r\nimport {IKeyValue} from './IArrayColumn';\r\nimport {ILink} from './LinkColumn';\r\n\r\nexport declare type ILinkMapColumnDesc = ILinkDesc & IMapColumnDesc<string>;\r\n\r\n/**\r\n * a string column with optional alignment\r\n */\r\n@toolbar('search', 'editPattern')\r\nexport default class LinkMapColumn extends MapColumn<string> {\r\n  static readonly EVENT_PATTERN_CHANGED = LinkColumn.EVENT_PATTERN_CHANGED;\r\n\r\n  readonly alignment: EAlignment;\r\n  readonly escape: boolean;\r\n  private pattern: string;\r\n  private patternFunction: Function | null = null;\r\n  readonly patternTemplates: string[];\r\n\r\n  constructor(id: string, desc: Readonly<ILinkMapColumnDesc>) {\r\n    super(id, desc);\r\n    this.setDefaultWidth(200); //by default 200\r\n    this.alignment = <any>desc.alignment || EAlignment.left;\r\n    this.escape = desc.escape !== false;\r\n    this.pattern = desc.pattern || '';\r\n    this.patternTemplates = desc.patternTemplates || [];\r\n    this.setDefaultRenderer('map');\r\n  }\r\n\r\n  setPattern(pattern: string) {\r\n    LinkColumn.prototype.setPattern.call(this, pattern);\r\n  }\r\n\r\n  getPattern() {\r\n    return this.pattern;\r\n  }\r\n\r\n  protected createEventList() {\r\n    return super.createEventList().concat([LinkColumn.EVENT_PATTERN_CHANGED]);\r\n  }\r\n\r\n  on(type: typeof LinkColumn.EVENT_PATTERN_CHANGED, listener: typeof patternChanged | null): this;\r\n  on(type: typeof ValueColumn.EVENT_DATA_LOADED, listener: typeof dataLoaded | null): this;\r\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\r\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\r\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\r\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\r\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\r\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\r\n  on(type: string | string[], listener: IEventListener | null): this {\r\n    return super.on(<any>type, listener);\r\n  }\r\n\r\n  getValue(row: IDataRow) {\r\n    return this.getLinkMap(row).map(({key, value}) => ({\r\n      key,\r\n      value: value ? value.href : ''\r\n    }));\r\n  }\r\n\r\n  getLabels(row: IDataRow) {\r\n    return this.getLinkMap(row).map(({key, value}) => ({\r\n      key,\r\n      value: value ? value.alt : ''\r\n    }));\r\n  }\r\n\r\n  getLinkMap(row: IDataRow): IKeyValue<ILink>[] {\r\n    return super.getValue(row).map(({key, value}) => ({\r\n      key,\r\n      value: this.transformValue(value, row, key)\r\n    }));\r\n  }\r\n\r\n  private transformValue(v: any, row: IDataRow, key: string) {\r\n    if (v == null || v === '') {\r\n      return null;\r\n    }\r\n    if (typeof v === 'string') {\r\n      if (!this.pattern) {\r\n        return {\r\n          alt: v,\r\n          href: v\r\n        };\r\n      }\r\n      if (!this.patternFunction) {\r\n        this.patternFunction = patternFunction(this.pattern, 'item', 'key');\r\n      }\r\n      return {\r\n        alt: v,\r\n        href: this.patternFunction.call(this, v, row.v, key)\r\n      };\r\n    }\r\n    return v;\r\n  }\r\n\r\n  dump(toDescRef: (desc: any) => any): any {\r\n    const r = super.dump(toDescRef);\r\n    if (this.pattern !== (<any>this.desc).pattern) {\r\n      r.pattern = this.pattern;\r\n    }\r\n    return r;\r\n  }\r\n\r\n  restore(dump: any, factory: (dump: any) => Column | null) {\r\n    if (dump.pattern) {\r\n      this.pattern = dump.pattern;\r\n    }\r\n    super.restore(dump, factory);\r\n  }\r\n}\r\n","import {extent} from 'd3-array';\r\nimport {isNumberColumn, isSupportType} from '../model';\r\nimport {default as Column, IColumnDesc} from '../model/Column';\r\nimport {colorPool} from '../model/internal';\r\nimport Ranking from '../model/Ranking';\r\nimport {resolveValue} from '../internal/accessor';\r\n\r\n\r\nexport interface IDeriveOptions {\r\n  /**\r\n   * maximal percentage of unique values to be treated as a categorical column\r\n   */\r\n  categoricalThreshold: number;\r\n\r\n  columns: string[];\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nexport function cleanCategories(categories: Set<string>) {\r\n  // remove missing values\r\n  categories.delete(<any>null);\r\n  categories.delete(<any>undefined);\r\n  categories.delete('');\r\n  categories.delete('NA');\r\n  categories.delete('NaN');\r\n  categories.delete('na');\r\n\r\n  return Array.from(categories).map(String).sort();\r\n}\r\n\r\nfunction deriveType(label: string, value: any, column: number | string, data: any[], options: IDeriveOptions): IColumnDesc {\r\n  const base: any = {\r\n    type: 'string',\r\n    label,\r\n    column,\r\n  };\r\n  if (typeof value === 'number') {\r\n    base.type = 'number';\r\n    base.domain = extent(data, (d) => resolveValue(d, column));\r\n    return base;\r\n  }\r\n  if (value && value instanceof Date) {\r\n    base.type = 'date';\r\n    return base;\r\n  }\r\n  if (typeof value === 'boolean') {\r\n    base.type = 'boolean';\r\n    return base;\r\n  }\r\n  if (typeof value === 'string') {\r\n    //maybe a categorical\r\n    const categories = new Set(data.map((d) => resolveValue(d, column)));\r\n    if (categories.size < data.length * options.categoricalThreshold) { // 70% unique guess categorical\r\n      base.type = 'categorical';\r\n      base.categories = cleanCategories(categories);\r\n    }\r\n    return base;\r\n  }\r\n  if (Array.isArray(value)) {\r\n    base.type = 'strings';\r\n    base.dataLength = value.length;\r\n    const vs = value[0];\r\n    if (typeof vs === 'number') {\r\n      base.type = 'numbers';\r\n      base.domain = extent((<number[]>[]).concat(...data.map((d) => resolveValue(d, column))));\r\n      return base;\r\n    }\r\n    if (vs && value instanceof Date) {\r\n      base.type = 'dates';\r\n      return base;\r\n    }\r\n    if (typeof value === 'boolean') {\r\n      base.type = 'booleans';\r\n      return base;\r\n    }\r\n    if (typeof value === 'string') {\r\n      //maybe a categorical\r\n      const categories = new Set((<string[]>[]).concat(...data.map((d) => resolveValue(d, column))));\r\n      if (categories.size < data.length * options.categoricalThreshold) { // 70% unique guess categorical\r\n        base.type = 'categoricals';\r\n        base.categories = cleanCategories(categories);\r\n      }\r\n      return base;\r\n    }\r\n  }\r\n  console.log('cannot infer type of column:', column);\r\n  //unknown type\r\n  return base;\r\n}\r\n\r\nexport function deriveColumnDescriptions(data: any[], options: Partial<IDeriveOptions> = {}) {\r\n  const config = Object.assign({\r\n    categoricalThreshold: 0.7,\r\n    columns: []\r\n  }, options);\r\n  const r: IColumnDesc[] = [];\r\n  if (data.length === 0) {\r\n    // no data to derive something from\r\n    return r;\r\n  }\r\n  const first = data[0];\r\n  if (Array.isArray(first)) {\r\n    //array of arrays\r\n    return first.map((v, i) => deriveType(`Col${i}`, v, i, data, config));\r\n  }\r\n  //objects\r\n  const columns = config.columns.length > 0 ? config.columns : Object.keys(first);\r\n  return columns.map((key) => deriveType(key, resolveValue(first, key), key, data, config));\r\n}\r\n\r\n\r\n/**\r\n * assigns colors to columns if they are numbers and not yet defined\r\n * @param columns\r\n * @returns {IColumnDesc[]}\r\n */\r\nexport function deriveColors(columns: IColumnDesc[]) {\r\n  const colors = colorPool();\r\n  columns.forEach((col: any) => {\r\n    switch (col.type) {\r\n      case 'number':\r\n        col.colorMapping = col.colorMapping || col.color || colors() || Column.DEFAULT_COLOR;\r\n        break;\r\n    }\r\n  });\r\n  return columns;\r\n}\r\n\r\n\r\nexport interface IExportOptions {\r\n  /**\r\n   * export separator, default: '\\t'\r\n   */\r\n  separator: string;\r\n  /**\r\n   * new line character, default: '\\n'\r\n   */\r\n  newline: string;\r\n  /**\r\n   * should a header be generated, default: true\r\n   */\r\n  header: boolean;\r\n  /**\r\n   * quote strings, default: false\r\n   */\r\n  quote: boolean;\r\n  /**\r\n   * quote string to use, default: '\"'\r\n   */\r\n  quoteChar: string;\r\n  /**\r\n   * filter specific column types, default: exclude all support types (selection, action, rank)\r\n   * @param col the column description to filter\r\n   */\r\n  filter: (col: Column) => boolean; //!isSupportType\r\n\r\n  /**\r\n   * whether the description should be part of the column header\r\n   */\r\n  verboseColumnHeaders: boolean;\r\n}\r\n\r\n/**\r\n * utility to export a ranking to a table with the given separator\r\n * @param ranking\r\n * @param data\r\n * @param options\r\n * @returns {Promise<string>}\r\n */\r\nexport function exportRanking(ranking: Ranking, data: any[], options: Partial<IExportOptions> = {}) {\r\n  const opts = <IExportOptions>Object.assign({\r\n    separator: '\\t',\r\n    newline: '\\n',\r\n    header: true,\r\n    quote: false,\r\n    quoteChar: '\"',\r\n    filter: (c: Column) => !isSupportType(c),\r\n    verboseColumnHeaders: false\r\n  }, options);\r\n\r\n  //optionally quote not numbers\r\n  const escape = new RegExp(`[${opts.quoteChar}]`, 'g');\r\n\r\n  function quote(v: any, c?: Column) {\r\n    const l = String(v);\r\n    if ((opts.quote || l.indexOf('\\n') >= 0) && (!c || !isNumberColumn(c))) {\r\n      return `${opts.quoteChar}${l.replace(escape, opts.quoteChar + opts.quoteChar)}${opts.quoteChar}`;\r\n    }\r\n    return l;\r\n  }\r\n\r\n  const columns = ranking.flatColumns.filter((c) => opts.filter(c));\r\n  const order = ranking.getOrder();\r\n\r\n  const r: string[] = [];\r\n  if (opts.header) {\r\n    r.push(columns.map((d) => quote(`${d.label}${opts.verboseColumnHeaders && d.description ? `\\n${d.description}` : ''}`)).join(opts.separator));\r\n  }\r\n  data.forEach((row, i) => {\r\n    r.push(columns.map((c) => quote(c.getExportValue({v: row, i: order[i]}, 'text'), c)).join(opts.separator));\r\n  });\r\n  return r.join(opts.newline);\r\n}\r\n","import {computeHist, computeStats} from '../internal';\r\nimport Column, {\r\n  defaultGroup, ICategoricalColumn, IColumnDesc, IDataRow, IGroup, IGroupData, INumberColumn,\r\n  IOrderedGroup,\r\n  NumberColumn\r\n} from '../model';\r\nimport Ranking from '../model/Ranking';\r\nimport ACommonDataProvider from './ACommonDataProvider';\r\nimport {IDataProviderOptions, IStatsBuilder} from './ADataProvider';\r\n\r\n\r\nexport interface ILocalDataProviderOptions {\r\n  /**\r\n   * whether the filter should be applied to all rankings regardless where they are\r\n   * default: false\r\n   */\r\n  filterGlobally: boolean;\r\n  /**\r\n   * jump to search results such that they are visible\r\n   * default: false\r\n   */\r\n  jumpToSearchResult: boolean;\r\n\r\n  /**\r\n   * the maximum number of nested sorting criteria\r\n   */\r\n  maxNestedSortingCriteria: number;\r\n  maxGroupColumns: number;\r\n}\r\n\r\n/**\r\n * a data provider based on an local array\r\n */\r\nexport default class LocalDataProvider extends ACommonDataProvider {\r\n  private options: ILocalDataProviderOptions = {\r\n    /**\r\n     * whether the filter should be applied to all rankings regardless where they are\r\n     */\r\n    filterGlobally: false,\r\n\r\n    jumpToSearchResult: false,\r\n\r\n    maxNestedSortingCriteria: Infinity,\r\n    maxGroupColumns: Infinity\r\n  };\r\n\r\n  private readonly reorderAll: () => void;\r\n\r\n  private _dataRows: IDataRow[];\r\n  private filter: ((row: IDataRow) => boolean) | null = null;\r\n\r\n  constructor(private _data: any[], columns: IColumnDesc[] = [], options: Partial<ILocalDataProviderOptions & IDataProviderOptions> = {}) {\r\n    super(columns, options);\r\n    Object.assign(this.options, options);\r\n    this._dataRows = toRows(_data);\r\n\r\n\r\n    const that = this;\r\n    this.reorderAll = function (this: {source: Ranking}) {\r\n      //fire for all other rankings a dirty order event, too\r\n      const ranking = this.source;\r\n      that.getRankings().forEach((r) => {\r\n        if (r !== ranking) {\r\n          r.dirtyOrder();\r\n        }\r\n      });\r\n    };\r\n  }\r\n\r\n  /**\r\n   * set a globally applied filter to all data without changing the data source itself\r\n   * @param {((row: IDataRow) => boolean) | null} filter\r\n   */\r\n  setFilter(filter: ((row: IDataRow) => boolean) | null) {\r\n    this.filter = filter;\r\n    this.reorderAll();\r\n  }\r\n\r\n  getFilter() {\r\n    return this.filter;\r\n  }\r\n\r\n  getTotalNumberOfRows() {\r\n    return this.data.length;\r\n  }\r\n\r\n\r\n  protected getMaxGroupColumns() {\r\n    return this.options.maxGroupColumns;\r\n  }\r\n\r\n  protected getMaxNestedSortingCriteria() {\r\n    return this.options.maxNestedSortingCriteria;\r\n  }\r\n\r\n  get data() {\r\n    return this._data;\r\n  }\r\n\r\n  /**\r\n   * replaces the dataset rows with a new one\r\n   * @param data\r\n   */\r\n  setData(data: any[]) {\r\n    this._data = data;\r\n    this._dataRows = toRows(data);\r\n    this.reorderAll();\r\n  }\r\n\r\n  clearData() {\r\n    this.setData([]);\r\n  }\r\n\r\n  /**\r\n   * append rows to the dataset\r\n   * @param data\r\n   */\r\n  appendData(data: any[]) {\r\n    this._data.push(...data);\r\n    this._dataRows.push(...toRows(data));\r\n    this.reorderAll();\r\n  }\r\n\r\n  cloneRanking(existing?: Ranking) {\r\n    const clone = super.cloneRanking(existing);\r\n\r\n    if (this.options.filterGlobally) {\r\n      clone.on(`${NumberColumn.EVENT_FILTER_CHANGED}.reorderAll`, this.reorderAll);\r\n    }\r\n\r\n    return clone;\r\n  }\r\n\r\n  cleanUpRanking(ranking: Ranking) {\r\n    if (this.options.filterGlobally) {\r\n      ranking.on(`${NumberColumn.EVENT_FILTER_CHANGED}.reorderAll`, null);\r\n    }\r\n    super.cleanUpRanking(ranking);\r\n  }\r\n\r\n  sortImpl(ranking: Ranking): IOrderedGroup[] {\r\n    if (this._data.length === 0) {\r\n      return [];\r\n    }\r\n    //wrap in a helper and store the initial index\r\n    let helper = this._data.map((r, i) => ({v: r, i, group: <IGroup | null>null}));\r\n\r\n    //do the optional filtering step\r\n    let filter: ((d: IDataRow) => boolean) | null = null;\r\n    if (this.options.filterGlobally) {\r\n      const filtered = this.getRankings().filter((d) => d.isFiltered());\r\n      if (filtered.length > 0) {\r\n        filter = (d: IDataRow) => filtered.every((f) => f.filter(d));\r\n      }\r\n    } else if (ranking.isFiltered()) {\r\n      filter = (d) => ranking.filter(d);\r\n    }\r\n\r\n    if (filter || this.filter) {\r\n      helper = helper.filter((d) => (!this.filter || this.filter(d)) && (!filter || filter(d)));\r\n    }\r\n\r\n    if (helper.length === 0) {\r\n      return [];\r\n    }\r\n\r\n    //create the groups for each row\r\n    helper.forEach((r) => r.group = ranking.grouper(r) || defaultGroup);\r\n    if ((new Set<string>(helper.map((r) => r.group!.name))).size === 1) {\r\n      const group = helper[0].group;\r\n      //no need to split\r\n      //sort by the ranking column\r\n      helper.sort((a, b) => ranking.comparator(a, b));\r\n\r\n      //store the ranking index and create an argsort version, i.e. rank 0 -> index i\r\n      const order = helper.map((r) => r.i);\r\n      return [Object.assign({order}, group!)];\r\n    }\r\n    //sort by group and within by order\r\n    helper.sort((a, b) => {\r\n      const ga = a.group!;\r\n      const gb = b.group!;\r\n      if (ga.name !== gb.name) {\r\n        return ga.name.toLowerCase().localeCompare(gb.name.toLowerCase());\r\n      }\r\n      return ranking.comparator(a, b);\r\n    });\r\n    //iterate over groups and create within orders\r\n    const groups: (IOrderedGroup & IGroupData)[] = [Object.assign({order: [], rows: []}, helper[0].group!)];\r\n    let group = groups[0];\r\n    helper.forEach((row) => {\r\n      const rowGroup = row.group!;\r\n      if (rowGroup.name === group.name) {\r\n        group.order.push(row.i);\r\n        group.rows.push(row);\r\n      } else { // change in groups\r\n        group = Object.assign({order: [row.i], rows: [row]}, rowGroup);\r\n        groups.push(group);\r\n      }\r\n    });\r\n\r\n    // sort groups\r\n    groups.sort((a, b) => ranking.groupComparator(a, b));\r\n\r\n    return groups;\r\n  }\r\n\r\n\r\n  viewRaw(indices: number[]) {\r\n    //filter invalid indices\r\n    return indices.map((index) => this._data[index]);\r\n  }\r\n\r\n  viewRawRows(indices: number[]) {\r\n    //filter invalid indices\r\n    return indices.map((index) => this._dataRows[index]);\r\n  }\r\n\r\n  view(indices: number[]) {\r\n    return this.viewRaw(indices);\r\n  }\r\n\r\n  fetch(orders: number[][]): IDataRow[][] {\r\n    return orders.map((order) => order.map((index) => this._dataRows[index]));\r\n  }\r\n\r\n  /**\r\n   * helper for computing statistics\r\n   * @param indices\r\n   * @returns {{stats: (function(INumberColumn): *), hist: (function(ICategoricalColumn): *)}}\r\n   */\r\n  stats(indices: number[]): IStatsBuilder {\r\n    let d: IDataRow[] | null = null;\r\n    const getD = () => {\r\n      if (d == null) {\r\n        d = this.viewRawRows(indices);\r\n      }\r\n      return d;\r\n    };\r\n\r\n    return {\r\n      stats: (col: INumberColumn) => computeStats(getD(), (d) => col.getNumber(d), (d) => col.isMissing(d), [0, 1]),\r\n      hist: (col: ICategoricalColumn) => computeHist(getD(), (d) => col.getCategory(d), col.categories)\r\n    };\r\n  }\r\n\r\n\r\n  mappingSample(col: INumberColumn): number[] {\r\n    const MAX_SAMPLE = 120; //at most 500 sample lines\r\n    const l = this._dataRows.length;\r\n    if (l <= MAX_SAMPLE) {\r\n      return <number[]>this._dataRows.map(col.getRawNumber.bind(col));\r\n    }\r\n    //randomly select 500 elements\r\n    const indices: number[] = [];\r\n    for (let i = 0; i < MAX_SAMPLE; ++i) {\r\n      let j = Math.floor(Math.random() * (l - 1));\r\n      while (indices.indexOf(j) >= 0) {\r\n        j = Math.floor(Math.random() * (l - 1));\r\n      }\r\n      indices.push(j);\r\n    }\r\n    return indices.map((i) => col.getRawNumber(this._dataRows[i]));\r\n  }\r\n\r\n  searchAndJump(search: string | RegExp, col: Column) {\r\n    //case insensitive search\r\n    search = typeof search === 'string' ? search.toLowerCase() : search;\r\n    const f = typeof search === 'string' ? (v: string) => v.toLowerCase().indexOf((<string>search)) >= 0 : (<RegExp>search).test.bind(search);\r\n    const indices = <number[]>[];\r\n    for (let i = 0; i < this._dataRows.length; ++i) {\r\n      if (f(col.getLabel(this._dataRows[i]))) {\r\n        indices.push(i);\r\n      }\r\n    }\r\n    this.jumpToNearest(indices);\r\n  }\r\n\r\n}\r\n\r\nfunction toRows(data: any[]) {\r\n  return data.map((v, i) => ({v, i}));\r\n}\r\n","import {defaultOptions} from '../config';\r\nimport {ILineUpOptions} from '../interfaces';\r\nimport merge from '../internal/merge';\r\nimport DataProvider from '../provider/ADataProvider';\r\nimport {ALineUp} from './ALineUp';\r\nimport EngineRenderer from './EngineRenderer';\r\nimport SidePanel from './panel/SidePanel';\r\n\r\nexport {ILineUpOptions} from '../interfaces';\r\n\r\nexport default class LineUp extends ALineUp {\r\n  private readonly renderer: EngineRenderer | null;\r\n  private readonly panel: SidePanel | null;\r\n\r\n  private readonly options = defaultOptions();\r\n\r\n  constructor(node: HTMLElement, data: DataProvider, options: Partial<ILineUpOptions> = {}) {\r\n    super(node, data, options && options.ignoreUnsupportedBrowser === true);\r\n\r\n    merge(this.options, options);\r\n\r\n    if (!this.isBrowserSupported) {\r\n      this.renderer = null;\r\n      this.panel = null;\r\n      return;\r\n    }\r\n\r\n    this.node.classList.add('lu');\r\n\r\n    this.renderer = new EngineRenderer(data, this.node, this.options);\r\n    if (this.options.sidePanel) {\r\n      console.assert(this.node.ownerDocument != null);\r\n      this.panel = new SidePanel(this.renderer.ctx, this.node.ownerDocument!, {\r\n        collapseable: this.options.sidePanelCollapsed ? 'collapsed' : true,\r\n        hierarchy: this.options.hierarchyIndicator && this.options.flags.advancedRankingFeatures\r\n      });\r\n      this.renderer.pushUpdateAble((ctx) => this.panel!.update(ctx));\r\n      this.node.insertBefore(this.panel!.node, this.node.firstChild);\r\n    } else {\r\n      this.panel = null;\r\n    }\r\n    this.forward(this.renderer, `${EngineRenderer.EVENT_HIGHLIGHT_CHANGED}.main`);\r\n  }\r\n\r\n  destroy() {\r\n    this.node.classList.remove('lu');\r\n    if (this.renderer) {\r\n      this.renderer.destroy();\r\n    }\r\n    if (this.panel) {\r\n      this.panel.destroy();\r\n    }\r\n    super.destroy();\r\n  }\r\n\r\n  update() {\r\n    if (this.renderer) {\r\n      this.renderer.update();\r\n    }\r\n  }\r\n\r\n  setDataProvider(data: DataProvider, dump?: any) {\r\n    super.setDataProvider(data, dump);\r\n    if (!this.renderer) {\r\n      return;\r\n    }\r\n    this.renderer.setDataProvider(data);\r\n    this.update();\r\n    if (this.panel) {\r\n      this.panel.update(this.renderer.ctx);\r\n    }\r\n  }\r\n\r\n  setHighlight(dataIndex: number, scrollIntoView: boolean = true) {\r\n    return this.renderer != null && this.renderer.setHighlight(dataIndex, scrollIntoView);\r\n  }\r\n\r\n  getHighlight() {\r\n    return this.renderer ? this.renderer.getHighlight() : -1;\r\n  }\r\n\r\n  protected enableHighlightListening(enable: boolean) {\r\n    if (this.renderer) {\r\n      this.renderer.enableHighlightListening(enable);\r\n    }\r\n  }\r\n}\r\n","import ADialog from './ADialog';\r\nimport Column from '../../model';\r\n\r\n\r\nexport default class DialogManager {\r\n\r\n  private readonly escKeyListener = (evt: KeyboardEvent) => {\r\n    if (evt.which === 27) {\r\n      this.removeLast();\r\n    }\r\n  }\r\n\r\n  private readonly openDialogs: ADialog[] = [];\r\n  readonly node: HTMLElement;\r\n\r\n  constructor(doc = document) {\r\n    this.node = doc.createElement('div');\r\n    this.node.classList.add('lu-backdrop');\r\n    this.node.innerHTML = `<div></div>`;\r\n    this.node.onclick = () => {\r\n      this.removeAll();\r\n    };\r\n  }\r\n\r\n  setHighlight(mask: { left: number, top: number, width: number, height: number }) {\r\n    const area = <HTMLElement>this.node.firstElementChild;\r\n    // @see http://bennettfeely.com/clippy/ -> select `Frame` example\r\n    area.style.clipPath = `polygon(\r\n      0% 0%,\r\n      0% 100%,\r\n      ${mask.left}px 100%,\r\n      ${mask.left}px ${mask.top}px,\r\n      ${mask.left + mask.width}px ${mask.top}px,\r\n      ${mask.left + mask.width}px ${mask.top + mask.height}px,\r\n      ${mask.left}px ${mask.top + mask.height}px,\r\n      ${mask.left}px 100%,\r\n      100% 100%,\r\n      100% 0%\r\n    )`;\r\n  }\r\n\r\n  setHighlightColumn(column: Column) {\r\n    const root = <HTMLElement>this.node.parentElement!;\r\n    if (!root) {\r\n      this.clearHighlight();\r\n      return;\r\n    }\r\n    const header = <HTMLElement>root.querySelector(`.lu-header[data-col-id=\"${column.id}\"]`);\r\n    if (!header) {\r\n      this.clearHighlight();\r\n      return;\r\n    }\r\n    const base = header.getBoundingClientRect();\r\n    const offset = root.getBoundingClientRect();\r\n    this.setHighlight({\r\n      left: base.left - offset.left,\r\n      top: base.top - offset.top,\r\n      width: base.width,\r\n      height: offset.height\r\n    });\r\n  }\r\n\r\n  clearHighlight() {\r\n    const area = <HTMLElement>this.node.firstElementChild;\r\n    area.style.clipPath = '';\r\n  }\r\n\r\n  private removeLast() {\r\n    if (this.openDialogs.length === 0) {\r\n      return;\r\n    }\r\n    this.remove(this.openDialogs[this.openDialogs.length - 1]);\r\n  }\r\n\r\n  removeAll() {\r\n    if (this.openDialogs.length === 0) {\r\n      return;\r\n    }\r\n    const all = this.openDialogs.splice(0, this.openDialogs.length);\r\n    all.forEach((d) => d.destroy());\r\n    this.takeDown();\r\n  }\r\n\r\n  remove(dialog: ADialog) {\r\n    const index = this.openDialogs.indexOf(dialog);\r\n    if (index < 0) {\r\n      return false;\r\n    }\r\n    // destroy self and all levels below that = after that\r\n    const destroyed = this.openDialogs.splice(index, this.openDialogs.length - index);\r\n    destroyed.reverse().forEach((d) => d.destroy());\r\n\r\n    if (this.openDialogs.length === 0) {\r\n      this.takeDown();\r\n    }\r\n    return true;\r\n  }\r\n\r\n  removeAboveLevel(level: number) {\r\n    // hide all dialogs which have a higher or equal level to the newly opened one\r\n    this.openDialogs.filter((d) => d.level >= level).reverse().forEach((d) => this.remove(d));\r\n  }\r\n\r\n  removeLike(dialog: ADialog) {\r\n    const similar = this.openDialogs.find((d) => dialog.equals(d));\r\n    if (!similar) {\r\n      return false;\r\n    }\r\n    this.remove(similar);\r\n    return true;\r\n  }\r\n\r\n  private setUp() {\r\n    console.assert(this.node.ownerDocument != null);\r\n    this.node.ownerDocument!.addEventListener('keyup', this.escKeyListener, {\r\n      passive: true\r\n    });\r\n    this.node.style.display = 'block';\r\n  }\r\n\r\n  private takeDown() {\r\n    this.clearHighlight();\r\n    console.assert(this.node.ownerDocument != null);\r\n    this.node.ownerDocument!.removeEventListener('keyup', this.escKeyListener);\r\n    this.node.style.display = null;\r\n  }\r\n\r\n  push(dialog: ADialog) {\r\n    this.removeAboveLevel(dialog.level);\r\n\r\n    if (this.openDialogs.length === 0) {\r\n      this.setUp();\r\n    }\r\n\r\n    this.openDialogs.push(dialog);\r\n  }\r\n}\r\n","import {nonUniformContext, MultiTableRowRenderer, GridStyleManager} from 'lineupengine';\r\nimport {ILineUpOptions, ILineUpFlags} from '../interfaces';\r\nimport {findOption, ICategoricalStatistics, IStatistics, round} from '../internal';\r\nimport AEventDispatcher, {suffix, IEventListener} from '../internal/AEventDispatcher';\r\nimport {\r\n  Column, ICategoricalColumn, IDataRow, IGroupData, IGroupItem, isCategoricalColumn, isGroup,\r\n  isNumberColumn, INumberColumn\r\n} from '../model';\r\nimport Ranking from '../model/Ranking';\r\nimport ADataProvider from '../provider/ADataProvider';\r\nimport {\r\n  chooseGroupRenderer, chooseRenderer, chooseSummaryRenderer, IImposer, IRenderContext, possibleGroupRenderer,\r\n  possibleRenderer, possibleSummaryRenderer\r\n} from '../renderer';\r\nimport EngineRanking, {IEngineRankingContext} from './EngineRanking';\r\nimport {IRankingHeaderContext, IRankingHeaderContextContainer} from './interfaces';\r\nimport SlopeGraph, {EMode} from './SlopeGraph';\r\nimport DialogManager from './dialogs/DialogManager';\r\n\r\n/**\r\n * emitted when the highlight changes\r\n * @asMemberOf EngineRenderer\r\n * @param dataIndex the highlghted data index or -1 for none\r\n * @event\r\n */\r\nexport declare function highlightChanged(dataIndex: number): void;\r\n\r\nexport default class EngineRenderer extends AEventDispatcher {\r\n  static readonly EVENT_HIGHLIGHT_CHANGED = EngineRanking.EVENT_HIGHLIGHT_CHANGED;\r\n\r\n  protected readonly options: Readonly<ILineUpOptions>;\r\n\r\n  private readonly histCache = new Map<string, IStatistics | ICategoricalStatistics | null | Promise<IStatistics | ICategoricalStatistics>>();\r\n\r\n  readonly node: HTMLElement;\r\n  private readonly table: MultiTableRowRenderer;\r\n  private readonly rankings: EngineRanking[] = [];\r\n  private readonly slopeGraphs: SlopeGraph[] = [];\r\n\r\n  readonly ctx: IRankingHeaderContextContainer & IRenderContext & IEngineRankingContext;\r\n\r\n  private readonly updateAbles: ((ctx: IRankingHeaderContext) => void)[] = [];\r\n  private zoomFactor = 1;\r\n  readonly idPrefix = `lu${Math.random().toString(36).slice(-8).substr(0, 3)}`; //generate a random string with length3;\r\n\r\n  private enabledHighlightListening: boolean = false;\r\n\r\n  constructor(protected data: ADataProvider, parent: HTMLElement, options: Readonly<ILineUpOptions>) {\r\n    super();\r\n    this.options = options;\r\n    console.assert(parent.ownerDocument != null);\r\n    this.node = parent.ownerDocument!.createElement('main');\r\n    this.node.id = this.idPrefix;\r\n    this.node.classList.toggle('lu-whole-hover', options.expandLineOnHover);\r\n    parent.appendChild(this.node);\r\n\r\n    const statsOf = (col: Column) => {\r\n      const r = this.histCache.get(col.id);\r\n      if (r == null || r instanceof Promise) {\r\n        return null;\r\n      }\r\n      return r;\r\n    };\r\n    const dialogManager = new DialogManager(parent.ownerDocument!);\r\n    parent.appendChild(dialogManager.node);\r\n    this.ctx = {\r\n      idPrefix: this.idPrefix,\r\n      document: parent.ownerDocument!,\r\n      provider: data,\r\n      dialogManager,\r\n      toolbar: this.options.toolbar,\r\n      flags: <ILineUpFlags>this.options.flags,\r\n      option: findOption(Object.assign({useGridLayout: true}, this.options)),\r\n      statsOf,\r\n      renderer: (col: Column, imposer?: IImposer) => {\r\n        const r = chooseRenderer(col, this.options.renderers);\r\n        return r.create(col, this.ctx, statsOf(col), imposer);\r\n      },\r\n      groupRenderer: (col: Column, imposer?: IImposer) => {\r\n        const r = chooseGroupRenderer(col, this.options.renderers);\r\n        return r.createGroup(col, this.ctx, statsOf(col), imposer);\r\n      },\r\n      summaryRenderer: (col: Column, interactive: boolean, imposer?: IImposer) => {\r\n        const r = chooseSummaryRenderer(col, this.options.renderers);\r\n        return r.createSummary(col, this.ctx, interactive, imposer);\r\n      },\r\n      totalNumberOfRows: 0,\r\n      createRenderer(col: Column, imposer?: IImposer) {\r\n        const single = this.renderer(col, imposer);\r\n        const group = this.groupRenderer(col, imposer);\r\n        const summary = options.summaryHeader ? this.summaryRenderer(col, false, imposer) : null;\r\n        return {\r\n          single,\r\n          group,\r\n          summary,\r\n          singleId: col.getRenderer(),\r\n          groupId: col.getGroupRenderer(),\r\n          summaryId: col.getSummaryRenderer(),\r\n          singleTemplate: null,\r\n          groupTemplate: null,\r\n          summaryTemplate: null\r\n        };\r\n      },\r\n      getPossibleRenderer: (col: Column) => ({\r\n        item: possibleRenderer(col, this.options.renderers),\r\n        group: possibleGroupRenderer(col, this.options.renderers),\r\n        summary: possibleSummaryRenderer(col, this.options.renderers)\r\n      }),\r\n      colWidth: (col: Column) => !col.isVisible() ? 0 : col.getWidth()\r\n    };\r\n\r\n    this.table = new MultiTableRowRenderer(this.node, `#${this.idPrefix}`);\r\n\r\n    //apply rules\r\n    {\r\n      this.style.addRule('lineup_groupPadding', `\r\n       #${this.idPrefix} .lu-row[data-agg=group],\r\n       #${this.idPrefix} .lu-row[data-meta~=last] {\r\n        margin-bottom: ${options.groupPadding}px;\r\n       }`, false);\r\n\r\n      this.style.addRule('lineup_rowPadding', `\r\n       #${this.idPrefix} .lu-row[data-lod] {\r\n         padding-top: 0;\r\n       }`, false);\r\n\r\n       // padding in general and for hovered low detail rows + their afterwards\r\n       this.style.addRule('lineup_rowPadding2', `\r\n        #${this.idPrefix} .lu-row,\r\n        #${this.idPrefix} .lu-row[data-lod]:hover,\r\n        #${this.idPrefix} .lu-row[data-lod].le-highlighted,\r\n        #${this.idPrefix} .lu-row[data-lod].lu-selected,\r\n        #${this.idPrefix} .lu-row[data-lod]:hover + .lu-row,\r\n        #${this.idPrefix} .lu-row[data-lod].le-highlighted + .lu-row,\r\n        #${this.idPrefix} .lu-row[data-lod].lu-selected + .lu-row {\r\n          padding-top: ${options.rowPadding}px;\r\n        }`, false);\r\n\r\n      this.style.addRule('lineup_rotation', `\r\n       #${this.idPrefix}.lu-rotated-label .lu-label.lu-rotated {\r\n           transform: rotate(${-this.options.labelRotation}deg);\r\n       }`);\r\n\r\n      const toDisable: string[] = [];\r\n      if (!this.options.flags.advancedRankingFeatures) {\r\n        toDisable.push('ranking');\r\n      }\r\n       if (!this.options.flags.advancedModelFeatures) {\r\n        toDisable.push('model');\r\n      }\r\n      if (!this.options.flags.advancedUIFeatures) {\r\n        toDisable.push('ui');\r\n      }\r\n      if (toDisable.length > 0) {\r\n        this.style.addRule('lineup_feature_disable', `\r\n        ${toDisable.map((d) => `.lu-feature-${d}.lu-feature-advanced`).join(', ')} {\r\n            display: none !important;\r\n        }`);\r\n      }\r\n    }\r\n\r\n    this.initProvider(data);\r\n  }\r\n\r\n  get style(): GridStyleManager {\r\n    return this.table.style;\r\n  }\r\n\r\n  zoomOut() {\r\n    this.zoomFactor = Math.max(this.zoomFactor - 0.1, 0.5);\r\n    this.updateZoomFactor();\r\n    this.update();\r\n  }\r\n\r\n  zoomIn() {\r\n    this.zoomFactor = Math.min(this.zoomFactor + 0.1, 2.0);\r\n    this.updateZoomFactor();\r\n    this.update();\r\n  }\r\n\r\n  private updateZoomFactor() {\r\n    const body = <HTMLElement>this.node.querySelector('main')!;\r\n    body.style.fontSize = `${this.zoomFactor * 100}%`;\r\n  }\r\n\r\n  pushUpdateAble(updateAble: (ctx: IRankingHeaderContext) => void) {\r\n    this.updateAbles.push(updateAble);\r\n  }\r\n\r\n  protected createEventList() {\r\n    return super.createEventList().concat([EngineRenderer.EVENT_HIGHLIGHT_CHANGED]);\r\n  }\r\n\r\n  on(type: typeof EngineRenderer.EVENT_HIGHLIGHT_CHANGED, listener: typeof highlightChanged | null): this;\r\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\r\n  on(type: string | string[], listener: IEventListener | null): this {\r\n    return super.on(type, listener);\r\n  }\r\n\r\n\r\n  setDataProvider(data: ADataProvider) {\r\n    this.takeDownProvider();\r\n\r\n    this.data = data;\r\n    (<any>this.ctx).provider = data;\r\n\r\n    this.initProvider(data);\r\n  }\r\n\r\n  private takeDownProvider() {\r\n    this.data.on(`${ADataProvider.EVENT_SELECTION_CHANGED}.body`, null);\r\n    this.data.on(`${ADataProvider.EVENT_ADD_RANKING}.body`, null);\r\n    this.data.on(`${ADataProvider.EVENT_REMOVE_RANKING}.body`, null);\r\n    this.data.on(`${ADataProvider.EVENT_GROUP_AGGREGATION_CHANGED}.body`, null);\r\n    this.data.on(`${ADataProvider.EVENT_JUMP_TO_NEAREST}.body`, null);\r\n\r\n    this.rankings.forEach((r) => this.table.remove(r));\r\n    this.rankings.splice(0, this.rankings.length);\r\n    this.slopeGraphs.forEach((s) => this.table.remove(s));\r\n    this.slopeGraphs.splice(0, this.slopeGraphs.length);\r\n  }\r\n\r\n  private initProvider(data: ADataProvider) {\r\n    data.on(`${ADataProvider.EVENT_SELECTION_CHANGED}.body`, () => this.updateSelection(data.getSelection()));\r\n    data.on(`${ADataProvider.EVENT_ADD_RANKING}.body`, (ranking: Ranking) => {\r\n      this.addRanking(ranking);\r\n    });\r\n    data.on(`${ADataProvider.EVENT_REMOVE_RANKING}.body`, (ranking: Ranking) => {\r\n      this.removeRanking(ranking);\r\n    });\r\n    data.on(`${ADataProvider.EVENT_GROUP_AGGREGATION_CHANGED}.body`, (ranking: Ranking) => {\r\n      this.update(this.rankings.filter((r) => r.ranking === ranking));\r\n    });\r\n    data.on(`${ADataProvider.EVENT_JUMP_TO_NEAREST}.body`, (indices: number[]) => {\r\n      this.setHighlightToNearest(indices, true);\r\n    });\r\n\r\n    this.data.getRankings().forEach((r) => this.addRanking(r));\r\n  }\r\n\r\n  private updateSelection(dataIndices: number[]) {\r\n    const s = new Set(dataIndices);\r\n    this.rankings.forEach((r) => r.updateSelection(s));\r\n\r\n    this.slopeGraphs.forEach((r) => r.updateSelection(s));\r\n  }\r\n\r\n  private updateHist(ranking?: EngineRanking, col?: Column) {\r\n    if (!this.options.summaryHeader) {\r\n      return;\r\n    }\r\n    const rankings = ranking ? [ranking] : this.rankings;\r\n    rankings.forEach((r) => {\r\n      const ranking = r.ranking;\r\n      const order = ranking.getOrder();\r\n      const cols = col ? [col] : ranking.flatColumns;\r\n      const histo = order == null ? null : this.data.stats(order);\r\n      cols.filter((d) => d.isVisible() && isNumberColumn(d)).forEach((col: Column) => {\r\n        this.histCache.set(col.id, histo == null ? null : histo.stats(<INumberColumn>col));\r\n      });\r\n      cols.filter((d) => isCategoricalColumn(d) && d.isVisible()).forEach((col: Column) => {\r\n        this.histCache.set(col.id, histo == null ? null : histo.hist(<ICategoricalColumn>col));\r\n      });\r\n      if (col) {\r\n        // single update\r\n        r.updateHeaderOf(col);\r\n      } else {\r\n        r.updateHeaders();\r\n      }\r\n    });\r\n\r\n    this.updateAbles.forEach((u) => u(this.ctx));\r\n  }\r\n\r\n  private addRanking(ranking: Ranking) {\r\n    if (this.rankings.length > 0) {\r\n      // add slope graph first\r\n      const s = this.table.pushSeparator((header, body) => new SlopeGraph(header, body, `${ranking.id}S`, this.ctx, {\r\n        mode: this.options.defaultSlopeGraphMode === 'band' ? EMode.BAND : EMode.ITEM\r\n      }));\r\n      this.slopeGraphs.push(s);\r\n    }\r\n\r\n    const r = this.table.pushTable((header, body, tableId, style) => new EngineRanking(ranking, header, body, tableId, style, this.ctx, {\r\n      animation: this.options.animated,\r\n      customRowUpdate: this.options.customRowUpdate || (() => undefined),\r\n      levelOfDetail: this.options.levelOfDetail || (() => 'high'),\r\n      flags: <ILineUpFlags>this.options.flags\r\n    }));\r\n    r.on(EngineRanking.EVENT_WIDTH_CHANGED, () => {\r\n      this.updateRotatedHeaderState();\r\n      this.table.widthChanged();\r\n    });\r\n    r.on(EngineRanking.EVENT_UPDATE_DATA, () => this.update([r]));\r\n    r.on(EngineRanking.EVENT_UPDATE_HIST, (col: Column) => this.updateHist(r, col));\r\n    this.forward(r, EngineRanking.EVENT_HIGHLIGHT_CHANGED);\r\n    if (this.enabledHighlightListening) {\r\n      r.enableHighlightListening(true);\r\n    }\r\n\r\n    ranking.on(suffix('.renderer', Ranking.EVENT_ORDER_CHANGED), () => this.updateHist(r));\r\n\r\n    this.rankings.push(r);\r\n    this.update([r]);\r\n  }\r\n\r\n  private updateRotatedHeaderState() {\r\n    if (this.options.labelRotation === 0) {\r\n      return;\r\n    }\r\n    const l = this.node.querySelector('.lu-label.lu-rotated');\r\n    this.node.classList.toggle('lu-rotated-label', Boolean(l));\r\n  }\r\n\r\n  private removeRanking(ranking: Ranking | null) {\r\n    if (!ranking) {\r\n      // remove all\r\n      this.rankings.splice(0, this.rankings.length);\r\n      this.slopeGraphs.splice(0, this.slopeGraphs.length);\r\n      this.table.clear();\r\n      return;\r\n    }\r\n    const index = this.rankings.findIndex((r) => r.ranking === ranking);\r\n    if (index < 0) {\r\n      return; // error\r\n    }\r\n    const section = this.rankings.splice(index, 1)[0]!;\r\n    const slope = this.slopeGraphs.splice(index === 0 ? index : index - 1, 1)[0];\r\n    this.table.remove(section);\r\n    if (slope) {\r\n      this.table.remove(slope);\r\n    }\r\n  }\r\n\r\n  update(rankings: EngineRanking[] = this.rankings) {\r\n    // visible and has parent = part of dom\r\n    rankings = rankings.filter((d) => !d.hidden && d.body.parentElement!);\r\n    if (rankings.length === 0) {\r\n      return;\r\n    }\r\n    const orders = rankings.map((r) => r.ranking.getOrder());\r\n    const data = this.data.fetch(orders);\r\n\r\n    (<any>this.ctx).totalNumberOfRows = Math.max(...data.map((d) => d.length));\r\n\r\n    // TODO support async\r\n    const localData = data.map((d) => d.map((d) => <IDataRow>d));\r\n\r\n    if (this.histCache.size === 0) {\r\n      this.updateHist();\r\n    }\r\n\r\n    const round2 = (v: number) => round(v, 2);\r\n    const rowPadding = round2(this.zoomFactor * this.options.rowPadding!);\r\n    const groupPadding = round2(this.zoomFactor * this.options.groupPadding!);\r\n\r\n    const heightsFor = (ranking: Ranking, data: (IGroupItem | IGroupData)[]) => {\r\n      if (this.options.dynamicHeight) {\r\n        const impl = this.options.dynamicHeight(data, ranking);\r\n        const f = (v: number | any, d: any) => typeof v === 'number' ? v : v(d);\r\n        if (impl) {\r\n          return {\r\n            defaultHeight: round2(this.zoomFactor * impl.defaultHeight),\r\n            height: (d: IGroupItem | IGroupData) => round2(this.zoomFactor * f(impl.height, d)),\r\n            padding: (d: IGroupItem | IGroupData) => round2(this.zoomFactor * f(impl.padding, d)),\r\n          };\r\n        }\r\n      }\r\n      const item = round2(this.zoomFactor * this.options.rowHeight!);\r\n      const group = round2(this.zoomFactor * this.options.groupHeight!);\r\n      return {\r\n        defaultHeight: item,\r\n        height: (d: IGroupItem | IGroupData) => isGroup(d) ? group : item,\r\n        padding: rowPadding\r\n      };\r\n    };\r\n\r\n    rankings.forEach((r, i) => {\r\n      const grouped = r.groupData(localData[i]);\r\n\r\n      const {height, defaultHeight, padding} = heightsFor(r.ranking, grouped);\r\n\r\n      const rowContext = nonUniformContext(grouped.map(height), defaultHeight, (index) => {\r\n        const pad = (typeof padding === 'number' ? padding : padding(grouped[index] || null));\r\n        if (index >= 0 && grouped[index] && (isGroup(grouped[index]) || (<IGroupItem>grouped[index]).meta === 'last' || (<IGroupItem>grouped[index]).meta === 'first last')) {\r\n          return groupPadding + pad;\r\n        }\r\n        return pad;\r\n      });\r\n      r.render(grouped, rowContext);\r\n    });\r\n\r\n    this.updateSlopeGraphs(rankings);\r\n\r\n    this.updateRotatedHeaderState();\r\n    this.table.widthChanged();\r\n  }\r\n\r\n  private updateSlopeGraphs(rankings: EngineRanking[] = this.rankings) {\r\n    const indices = new Set(rankings.map((d) => this.rankings.indexOf(d)));\r\n    this.slopeGraphs.forEach((s, i) => {\r\n      if (s.hidden) {\r\n        return;\r\n      }\r\n      const left = i;\r\n      const right = i + 1;\r\n      if (!indices.has(left) && !indices.has(right)) {\r\n        return;\r\n      }\r\n      const leftRanking = this.rankings[left];\r\n      const rightRanking = this.rankings[right];\r\n      s.rebuild(leftRanking.currentData, leftRanking.context, rightRanking.currentData, rightRanking.context);\r\n    });\r\n  }\r\n\r\n  setHighlight(dataIndex: number, scrollIntoView: boolean) {\r\n    const found = this.rankings.map((r) => r.setHighlight(dataIndex));\r\n    this.fire(EngineRenderer.EVENT_HIGHLIGHT_CHANGED, dataIndex);\r\n    if (this.rankings.length === 0 || dataIndex < 0) {\r\n      return false;\r\n    }\r\n    if (!scrollIntoView) {\r\n      return found[0]!;\r\n    }\r\n    return this.rankings[0].scrollIntoView(dataIndex);\r\n  }\r\n\r\n  setHighlightToNearest(dataIndices: number[], scrollIntoView: boolean) {\r\n    if (this.rankings.length === 0) {\r\n      return false;\r\n    }\r\n    const nearest = this.rankings[0].findNearest(dataIndices);\r\n    if (nearest >= 0) {\r\n      return this.setHighlight(nearest, scrollIntoView);\r\n    }\r\n    return false;\r\n  }\r\n\r\n  getHighlight() {\r\n    for (const ranking of this.rankings) {\r\n      const h = ranking.getHighlight();\r\n      if (h >= 0) {\r\n        return h;\r\n      }\r\n    }\r\n    return -1;\r\n  }\r\n\r\n  enableHighlightListening(enable: boolean) {\r\n    for (const ranking of this.rankings) {\r\n        ranking.enableHighlightListening(enable);\r\n    }\r\n    this.enabledHighlightListening = enable;\r\n  }\r\n\r\n  destroy() {\r\n    this.takeDownProvider();\r\n    this.table.destroy();\r\n    this.node.remove();\r\n  }\r\n}\r\n\r\n","import formatDecimal from \"./formatDecimal.js\";\n\nexport var prefixExponent;\n\nexport default function(x, p) {\n  var d = formatDecimal(x, p);\n  if (!d) return x + \"\";\n  var coefficient = d[0],\n      exponent = d[1],\n      i = exponent - (prefixExponent = Math.max(-8, Math.min(8, Math.floor(exponent / 3))) * 3) + 1,\n      n = coefficient.length;\n  return i === n ? coefficient\n      : i > n ? coefficient + new Array(i - n + 1).join(\"0\")\n      : i > 0 ? coefficient.slice(0, i) + \".\" + coefficient.slice(i)\n      : \"0.\" + new Array(1 - i).join(\"0\") + formatDecimal(x, Math.max(0, p + i - 1))[0]; // less than 1y!\n}\n","import formatLocale from \"./locale.js\";\n\nvar locale;\nexport var format;\nexport var formatPrefix;\n\ndefaultLocale({\n  decimal: \".\",\n  thousands: \",\",\n  grouping: [3],\n  currency: [\"$\", \"\"],\n  minus: \"-\"\n});\n\nexport default function defaultLocale(definition) {\n  locale = formatLocale(definition);\n  format = locale.format;\n  formatPrefix = locale.formatPrefix;\n  return locale;\n}\n","import formatDecimal from \"./formatDecimal.js\";\n\nexport default function(x, p) {\n  var d = formatDecimal(x, p);\n  if (!d) return x + \"\";\n  var coefficient = d[0],\n      exponent = d[1];\n  return exponent < 0 ? \"0.\" + new Array(-exponent).join(\"0\") + coefficient\n      : coefficient.length > exponent + 1 ? coefficient.slice(0, exponent + 1) + \".\" + coefficient.slice(exponent + 1)\n      : coefficient + new Array(exponent - coefficient.length + 2).join(\"0\");\n}\n","import formatPrefixAuto from \"./formatPrefixAuto.js\";\nimport formatRounded from \"./formatRounded.js\";\n\nexport default {\n  \"%\": function(x, p) { return (x * 100).toFixed(p); },\n  \"b\": function(x) { return Math.round(x).toString(2); },\n  \"c\": function(x) { return x + \"\"; },\n  \"d\": function(x) { return Math.round(x).toString(10); },\n  \"e\": function(x, p) { return x.toExponential(p); },\n  \"f\": function(x, p) { return x.toFixed(p); },\n  \"g\": function(x, p) { return x.toPrecision(p); },\n  \"o\": function(x) { return Math.round(x).toString(8); },\n  \"p\": function(x, p) { return formatRounded(x * 100, p); },\n  \"r\": formatRounded,\n  \"s\": formatPrefixAuto,\n  \"X\": function(x) { return Math.round(x).toString(16).toUpperCase(); },\n  \"x\": function(x) { return Math.round(x).toString(16); }\n};\n","export default function(x) {\n  return x;\n}\n","import exponent from \"./exponent.js\";\nimport formatGroup from \"./formatGroup.js\";\nimport formatNumerals from \"./formatNumerals.js\";\nimport formatSpecifier from \"./formatSpecifier.js\";\nimport formatTrim from \"./formatTrim.js\";\nimport formatTypes from \"./formatTypes.js\";\nimport {prefixExponent} from \"./formatPrefixAuto.js\";\nimport identity from \"./identity.js\";\n\nvar map = Array.prototype.map,\n    prefixes = [\"y\",\"z\",\"a\",\"f\",\"p\",\"n\",\"\",\"m\",\"\",\"k\",\"M\",\"G\",\"T\",\"P\",\"E\",\"Z\",\"Y\"];\n\nexport default function(locale) {\n  var group = locale.grouping === undefined || locale.thousands === undefined ? identity : formatGroup(map.call(locale.grouping, Number), locale.thousands + \"\"),\n      currencyPrefix = locale.currency === undefined ? \"\" : locale.currency[0] + \"\",\n      currencySuffix = locale.currency === undefined ? \"\" : locale.currency[1] + \"\",\n      decimal = locale.decimal === undefined ? \".\" : locale.decimal + \"\",\n      numerals = locale.numerals === undefined ? identity : formatNumerals(map.call(locale.numerals, String)),\n      percent = locale.percent === undefined ? \"%\" : locale.percent + \"\",\n      minus = locale.minus === undefined ? \"-\" : locale.minus + \"\",\n      nan = locale.nan === undefined ? \"NaN\" : locale.nan + \"\";\n\n  function newFormat(specifier) {\n    specifier = formatSpecifier(specifier);\n\n    var fill = specifier.fill,\n        align = specifier.align,\n        sign = specifier.sign,\n        symbol = specifier.symbol,\n        zero = specifier.zero,\n        width = specifier.width,\n        comma = specifier.comma,\n        precision = specifier.precision,\n        trim = specifier.trim,\n        type = specifier.type;\n\n    // The \"n\" type is an alias for \",g\".\n    if (type === \"n\") comma = true, type = \"g\";\n\n    // The \"\" type, and any invalid type, is an alias for \".12~g\".\n    else if (!formatTypes[type]) precision === undefined && (precision = 12), trim = true, type = \"g\";\n\n    // If zero fill is specified, padding goes after sign and before digits.\n    if (zero || (fill === \"0\" && align === \"=\")) zero = true, fill = \"0\", align = \"=\";\n\n    // Compute the prefix and suffix.\n    // For SI-prefix, the suffix is lazily computed.\n    var prefix = symbol === \"$\" ? currencyPrefix : symbol === \"#\" && /[boxX]/.test(type) ? \"0\" + type.toLowerCase() : \"\",\n        suffix = symbol === \"$\" ? currencySuffix : /[%p]/.test(type) ? percent : \"\";\n\n    // What format function should we use?\n    // Is this an integer type?\n    // Can this type generate exponential notation?\n    var formatType = formatTypes[type],\n        maybeSuffix = /[defgprs%]/.test(type);\n\n    // Set the default precision if not specified,\n    // or clamp the specified precision to the supported range.\n    // For significant precision, it must be in [1, 21].\n    // For fixed precision, it must be in [0, 20].\n    precision = precision === undefined ? 6\n        : /[gprs]/.test(type) ? Math.max(1, Math.min(21, precision))\n        : Math.max(0, Math.min(20, precision));\n\n    function format(value) {\n      var valuePrefix = prefix,\n          valueSuffix = suffix,\n          i, n, c;\n\n      if (type === \"c\") {\n        valueSuffix = formatType(value) + valueSuffix;\n        value = \"\";\n      } else {\n        value = +value;\n\n        // Perform the initial formatting.\n        var valueNegative = value < 0;\n        value = isNaN(value) ? nan : formatType(Math.abs(value), precision);\n\n        // Trim insignificant zeros.\n        if (trim) value = formatTrim(value);\n\n        // If a negative value rounds to zero during formatting, treat as positive.\n        if (valueNegative && +value === 0) valueNegative = false;\n\n        // Compute the prefix and suffix.\n        valuePrefix = (valueNegative ? (sign === \"(\" ? sign : minus) : sign === \"-\" || sign === \"(\" ? \"\" : sign) + valuePrefix;\n\n        valueSuffix = (type === \"s\" ? prefixes[8 + prefixExponent / 3] : \"\") + valueSuffix + (valueNegative && sign === \"(\" ? \")\" : \"\");\n\n        // Break the formatted value into the integer value part that can be\n        // grouped, and fractional or exponential suffix part that is not.\n        if (maybeSuffix) {\n          i = -1, n = value.length;\n          while (++i < n) {\n            if (c = value.charCodeAt(i), 48 > c || c > 57) {\n              valueSuffix = (c === 46 ? decimal + value.slice(i + 1) : value.slice(i)) + valueSuffix;\n              value = value.slice(0, i);\n              break;\n            }\n          }\n        }\n      }\n\n      // If the fill character is not \"0\", grouping is applied before padding.\n      if (comma && !zero) value = group(value, Infinity);\n\n      // Compute the padding.\n      var length = valuePrefix.length + value.length + valueSuffix.length,\n          padding = length < width ? new Array(width - length + 1).join(fill) : \"\";\n\n      // If the fill character is \"0\", grouping is applied after padding.\n      if (comma && zero) value = group(padding + value, padding.length ? width - valueSuffix.length : Infinity), padding = \"\";\n\n      // Reconstruct the final output based on the desired alignment.\n      switch (align) {\n        case \"<\": value = valuePrefix + value + valueSuffix + padding; break;\n        case \"=\": value = valuePrefix + padding + value + valueSuffix; break;\n        case \"^\": value = padding.slice(0, length = padding.length >> 1) + valuePrefix + value + valueSuffix + padding.slice(length); break;\n        default: value = padding + valuePrefix + value + valueSuffix; break;\n      }\n\n      return numerals(value);\n    }\n\n    format.toString = function() {\n      return specifier + \"\";\n    };\n\n    return format;\n  }\n\n  function formatPrefix(specifier, value) {\n    var f = newFormat((specifier = formatSpecifier(specifier), specifier.type = \"f\", specifier)),\n        e = Math.max(-8, Math.min(8, Math.floor(exponent(value) / 3))) * 3,\n        k = Math.pow(10, -e),\n        prefix = prefixes[8 + e / 3];\n    return function(value) {\n      return f(k * value) + prefix;\n    };\n  }\n\n  return {\n    format: newFormat,\n    formatPrefix: formatPrefix\n  };\n}\n","export default function(grouping, thousands) {\n  return function(value, width) {\n    var i = value.length,\n        t = [],\n        j = 0,\n        g = grouping[0],\n        length = 0;\n\n    while (i > 0 && g > 0) {\n      if (length + g + 1 > width) g = Math.max(1, width - length);\n      t.push(value.substring(i -= g, i + g));\n      if ((length += g + 1) > width) break;\n      g = grouping[j = (j + 1) % grouping.length];\n    }\n\n    return t.reverse().join(thousands);\n  };\n}\n","export default function(numerals) {\n  return function(value) {\n    return value.replace(/[0-9]/g, function(i) {\n      return numerals[+i];\n    });\n  };\n}\n","// Trims insignificant zeros, e.g., replaces 1.2000k with 1.2k.\nexport default function(s) {\n  out: for (var n = s.length, i = 1, i0 = -1, i1; i < n; ++i) {\n    switch (s[i]) {\n      case \".\": i0 = i1 = i; break;\n      case \"0\": if (i0 === 0) i0 = i; i1 = i; break;\n      default: if (!+s[i]) break out; if (i0 > 0) i0 = 0; break;\n    }\n  }\n  return i0 > 0 ? s.slice(0, i0) + s.slice(i1 + 1) : s;\n}\n","import {median, quantile} from 'd3-array';\r\nimport {toolbar} from './annotations';\r\nimport Column, {widthChanged, labelChanged, metaDataChanged, dirty, dirtyHeader, dirtyValues, rendererTypeChanged, groupRendererChanged, summaryRendererChanged, visibilityChanged} from './Column';\r\nimport CompositeColumn, {addColumn, filterChanged, moveColumn, removeColumn} from './CompositeColumn';\r\nimport CompositeNumberColumn, {ICompositeNumberColumnDesc} from './CompositeNumberColumn';\r\nimport {IDataRow} from './interfaces';\r\nimport {EAdvancedSortMethod} from './INumberColumn';\r\nimport {IEventListener} from '../internal/AEventDispatcher';\r\n\r\n/**\r\n *  factory for creating a description creating a max column\r\n * @param label\r\n * @returns {{type: string, label: string}}\r\n */\r\nexport function createReduceDesc(label: string = 'Reduce') {\r\n  return {type: 'reduce', label};\r\n}\r\n\r\nexport interface IReduceDesc {\r\n  readonly reduce?: EAdvancedSortMethod;\r\n}\r\n\r\n\r\nexport declare type IReduceColumnDesc = IReduceDesc & ICompositeNumberColumnDesc;\r\n\r\n/**\r\n * emitted when the mapping property changes\r\n * @asMemberOf ReduceColumn\r\n * @event\r\n */\r\nexport declare function reduceChanged(previous: EAdvancedSortMethod, current: EAdvancedSortMethod): void;\r\n\r\n/**\r\n * combines multiple columns by using the maximal value\r\n */\r\n@toolbar('reduce')\r\nexport default class ReduceColumn extends CompositeNumberColumn {\r\n  static readonly EVENT_REDUCE_CHANGED = 'reduceChanged';\r\n\r\n  private reduce: EAdvancedSortMethod;\r\n\r\n  constructor(id: string, desc: Readonly<IReduceColumnDesc>) {\r\n    super(id, desc);\r\n    this.reduce = desc.reduce || EAdvancedSortMethod.max;\r\n    this.setDefaultRenderer('interleaving');\r\n    this.setDefaultGroupRenderer('interleaving');\r\n    this.setDefaultSummaryRenderer('interleaving');\r\n  }\r\n\r\n  get label() {\r\n    const l = super.getMetaData().label;\r\n    if (l !== 'Reduce') {\r\n      return l;\r\n    }\r\n    return `${this.reduce[0].toUpperCase()}${this.reduce.slice(1)}(${this.children.map((d) => d.label).join(', ')})`;\r\n  }\r\n\r\n  getColor(row: IDataRow) {\r\n    //compute the index of the maximal one\r\n    const c = this._children;\r\n    if (c.length === 0 || this.reduce === EAdvancedSortMethod.q1 || this.reduce === EAdvancedSortMethod.q3 || this.reduce === EAdvancedSortMethod.mean) {\r\n      return Column.DEFAULT_COLOR;\r\n    }\r\n    const v = this.compute(row);\r\n    const selected = c.find((c) => c.getValue(row) === v);\r\n    return selected ? selected.getColor(row) : Column.DEFAULT_COLOR;\r\n  }\r\n\r\n  protected compute(row: IDataRow) {\r\n    const vs = this._children.map((d) => d.getValue(row)).filter((d) => !isNaN(d));\r\n    if (vs.length === 0) {\r\n      return NaN;\r\n    }\r\n    switch (this.reduce) {\r\n      case EAdvancedSortMethod.mean:\r\n        return vs.reduce((a, b) => a + b, 0) / vs.length;\r\n      case EAdvancedSortMethod.max:\r\n        return Math.max(...vs);\r\n      case EAdvancedSortMethod.min:\r\n        return Math.min(...vs);\r\n      case EAdvancedSortMethod.median:\r\n        return median(vs)!;\r\n      case EAdvancedSortMethod.q1:\r\n        return quantile(vs.sort((a, b) => a - b), 0.25)!;\r\n      case EAdvancedSortMethod.q3:\r\n        return quantile(vs.sort((a, b) => a - b), 0.75)!;\r\n    }\r\n  }\r\n\r\n  protected createEventList() {\r\n    return super.createEventList().concat([ReduceColumn.EVENT_REDUCE_CHANGED]);\r\n  }\r\n\r\n  on(type: typeof ReduceColumn.EVENT_REDUCE_CHANGED, listener: typeof reduceChanged | null): this;\r\n  on(type: typeof CompositeColumn.EVENT_FILTER_CHANGED, listener: typeof filterChanged | null): this;\r\n  on(type: typeof CompositeColumn.EVENT_ADD_COLUMN, listener: typeof addColumn | null): this;\r\n  on(type: typeof CompositeColumn.EVENT_MOVE_COLUMN, listener: typeof moveColumn | null): this;\r\n  on(type: typeof CompositeColumn.EVENT_REMOVE_COLUMN, listener: typeof removeColumn | null): this;\r\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\r\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\r\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\r\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\r\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\r\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\r\n  on(type: string | string[], listener: IEventListener | null): this {\r\n    return super.on(type, listener);\r\n  }\r\n\r\n  getReduce() {\r\n    return this.reduce;\r\n  }\r\n\r\n  setReduce(reduce: EAdvancedSortMethod) {\r\n    if (this.reduce === reduce) {\r\n      return;\r\n    }\r\n    this.fire([ReduceColumn.EVENT_REDUCE_CHANGED, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY], this.reduce, this.reduce = reduce);\r\n  }\r\n\r\n  dump(toDescRef: (desc: any) => any) {\r\n    const r = super.dump(toDescRef);\r\n    r.reduce = this.reduce;\r\n    return r;\r\n  }\r\n\r\n  restore(dump: any, factory: (dump: any) => Column | null) {\r\n    this.reduce = dump.reduce || this.reduce;\r\n    super.restore(dump, factory);\r\n  }\r\n\r\n  get canJustAddNumbers() {\r\n    return true;\r\n  }\r\n\r\n  getExportValue(row: IDataRow, format: 'text' | 'json'): any {\r\n    if (format === 'json') {\r\n      return {\r\n        value: this.getRawNumber(row),\r\n        children: this.children.map((d) => d.getExportValue(row, format))\r\n      };\r\n    }\r\n    return super.getExportValue(row, format);\r\n  }\r\n}\r\n","import {toolbar} from './annotations';\r\nimport Column, {widthChanged, labelChanged, metaDataChanged, dirty, dirtyHeader, dirtyValues, rendererTypeChanged, groupRendererChanged, summaryRendererChanged, visibilityChanged} from './Column';\r\nimport CompositeColumn, {addColumn, filterChanged, moveColumn, removeColumn} from './CompositeColumn';\r\nimport CompositeNumberColumn, {ICompositeNumberDesc} from './CompositeNumberColumn';\r\nimport {IDataRow} from './interfaces';\r\nimport {isNumberColumn} from './INumberColumn';\r\nimport {IEventListener} from '../internal/AEventDispatcher';\r\n\r\nconst DEFAULT_SCRIPT = `let s = 0;\r\ncol.forEach((c) => s += c.v);\r\nreturn s / col.length`;\r\n\r\n/**\r\n * factory for creating a description creating a mean column\r\n * @param label\r\n * @returns {{type: string, label: string}}\r\n */\r\nexport function createScriptDesc(label: string = 'script') {\r\n  return {type: 'script', label, script: DEFAULT_SCRIPT};\r\n}\r\n\r\n\r\nfunction wrapWithContext(code: string) {\r\n  let clean = code.trim();\r\n  if (!clean.includes('return')) {\r\n    clean = `return (${clean});`;\r\n  }\r\n  return `\r\n  const max = function(arr) { return Math.max.apply(Math, arr); };\r\n  const min = function(arr) { return Math.min.apply(Math, arr); };\r\n  const extent = function(arr) { return [min(arr), max(arr)]; };\r\n  const clamp = function(v, minValue, maxValue) { return v < minValue ? minValue : (v > maxValue ? maxValue : v); };\r\n  const normalize = function(v, minMax, max) {\r\n    if (Array.isArray(minMax)) {\r\n      minMax = minMax[0];\r\n      max = minMax[1];\r\n    }\r\n    return (v - minMax) / (max - minMax);\r\n  };\r\n  const denormalize = function(v, minMax, max) {\r\n    if (Array.isArray(minMax)) {\r\n      minMax = minMax[0];\r\n      max = minMax[1];\r\n    }\r\n    return v * (max - minMax) + minMax;\r\n  };\r\n  const linear = function(v, source, target) {\r\n    target = target || [0, 1];\r\n    return denormalize(normalize(v, source), target);\r\n  };\r\n  const v = (function custom() {\r\n    ${clean}\r\n  })();\r\n\r\n  return typeof v === 'number' ? v : NaN`;\r\n}\r\n\r\n\r\n/**\r\n * wrapper class for simpler column accessing\r\n */\r\nclass ColumnWrapper {\r\n  constructor(private readonly c: Column, public readonly v: any, public readonly raw: number | null) {\r\n\r\n  }\r\n\r\n  get type() {\r\n    return this.c.desc.type;\r\n  }\r\n\r\n  get name() {\r\n    return this.c.getMetaData().label;\r\n  }\r\n\r\n  get id() {\r\n    return this.c.id;\r\n  }\r\n}\r\n\r\n/**\r\n * helper context for accessing columns within a scripted columns\r\n */\r\nclass ColumnContext {\r\n  private readonly lookup = new Map<string, ColumnWrapper>();\r\n  private _all: ColumnContext | null = null;\r\n\r\n  constructor(private readonly children: ColumnWrapper[], private readonly allFactory?: () => ColumnContext) {\r\n    children.forEach((c) => {\r\n      this.lookup.set(`ID@${c.id}`, c);\r\n      this.lookup.set(`NAME@${c.name}`, c);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * get a column by name\r\n   * @param {string} name\r\n   * @return {ColumnWrapper}\r\n   */\r\n  byName(name: string) {\r\n    return this.lookup.get(`NAME@${name}`);\r\n  }\r\n\r\n  /**\r\n   * get a column by id\r\n   * @param {string} id\r\n   * @return {ColumnWrapper}\r\n   */\r\n  byID(id: string) {\r\n    return this.lookup.get(`ID@${id}`);\r\n  }\r\n\r\n  /**\r\n   * get a column by index\r\n   * @param {number} index\r\n   * @return {ColumnWrapper}\r\n   */\r\n  byIndex(index: number) {\r\n    return this.children[index];\r\n  }\r\n\r\n  forEach(callback: ((c: ColumnWrapper, index: number) => void)) {\r\n    return this.children.forEach(callback);\r\n  }\r\n\r\n  /**\r\n   * number of columns\r\n   * @return {number}\r\n   */\r\n  get length() {\r\n    return this.children.length;\r\n  }\r\n\r\n  /**\r\n   * get the all context, i.e one with all columns of this ranking\r\n   * @return {ColumnContext}\r\n   */\r\n  get all() {\r\n    if (this._all == null) {\r\n      this._all = this.allFactory ? this.allFactory() : null;\r\n    }\r\n    return this._all!;\r\n  }\r\n}\r\n\r\n\r\nexport interface IScriptDesc extends ICompositeNumberDesc {\r\n  /**\r\n   * the function to use, it has two parameters: children (current children) and values (their row values)\r\n   * @default 'return Math.max.apply(Math,values)'\r\n   */\r\n  script?: string;\r\n}\r\n\r\nexport declare type IScriptColumnDesc = IScriptDesc & ICompositeNumberDesc;\r\n\r\n/**\r\n * emitted when the script property changes\r\n * @asMemberOf ScriptColumn\r\n * @event\r\n */\r\nexport declare function scriptChanged(previous: string, current: string): void;\r\n\r\n\r\n@toolbar('script')\r\nexport default class ScriptColumn extends CompositeNumberColumn {\r\n  static readonly EVENT_SCRIPT_CHANGED = 'scriptChanged';\r\n  static readonly DEFAULT_SCRIPT = DEFAULT_SCRIPT;\r\n\r\n  private script = ScriptColumn.DEFAULT_SCRIPT;\r\n  private f: Function | null = null;\r\n\r\n  constructor(id: string, desc: Readonly<IScriptColumnDesc>) {\r\n    super(id, desc);\r\n    this.script = desc.script || this.script;\r\n\r\n    this.setDefaultRenderer('number');\r\n    this.setDefaultGroupRenderer('number');\r\n    this.setDefaultSummaryRenderer('number');\r\n  }\r\n\r\n  protected createEventList() {\r\n    return super.createEventList().concat([ScriptColumn.EVENT_SCRIPT_CHANGED]);\r\n  }\r\n\r\n  on(type: typeof ScriptColumn.EVENT_SCRIPT_CHANGED, listener: typeof scriptChanged | null): this;\r\n  on(type: typeof CompositeColumn.EVENT_FILTER_CHANGED, listener: typeof filterChanged | null): this;\r\n  on(type: typeof CompositeColumn.EVENT_ADD_COLUMN, listener: typeof addColumn | null): this;\r\n  on(type: typeof CompositeColumn.EVENT_MOVE_COLUMN, listener: typeof moveColumn | null): this;\r\n  on(type: typeof CompositeColumn.EVENT_REMOVE_COLUMN, listener: typeof removeColumn | null): this;\r\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\r\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\r\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\r\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\r\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\r\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\r\n  on(type: string | string[], listener: IEventListener | null): this {\r\n    return super.on(type, listener);\r\n  }\r\n\r\n  setScript(script: string) {\r\n    if (this.script === script) {\r\n      return;\r\n    }\r\n    this.f = null;\r\n    this.fire([ScriptColumn.EVENT_SCRIPT_CHANGED, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY], this.script, this.script = script);\r\n  }\r\n\r\n  getScript() {\r\n    return this.script;\r\n  }\r\n\r\n  dump(toDescRef: (desc: any) => any) {\r\n    const r = super.dump(toDescRef);\r\n    r.script = this.script;\r\n    return r;\r\n  }\r\n\r\n  restore(dump: any, factory: (dump: any) => Column | null) {\r\n    this.script = dump.script || this.script;\r\n    super.restore(dump, factory);\r\n  }\r\n\r\n  protected compute(row: IDataRow) {\r\n    if (this.f == null) {\r\n      this.f = new Function('children', 'values', 'raws', 'col', 'row', 'index', wrapWithContext(this.script));\r\n    }\r\n    const children = this._children;\r\n    const values = this._children.map((d) => d.getValue(row));\r\n    const raws = <number[]>this._children.map((d) => isNumberColumn(d) ? d.getRawNumber(row) : null);\r\n    const col = new ColumnContext(children.map((c, i) => new ColumnWrapper(c, values[i], raws[i])), () => {\r\n      const cols = this.findMyRanker()!.flatColumns;\r\n      return new ColumnContext(cols.filter((c) => c !== this).map((c) => new ColumnWrapper(c, c.getValue(row), isNumberColumn(c) ? c.getRawNumber(row) : null)));\r\n    });\r\n    return this.f.call(this, children, values, raws, col, row.v, row.i);\r\n  }\r\n\r\n  getExportValue(row: IDataRow, format: 'text' | 'json'): any {\r\n    if (format === 'json') {\r\n      return {\r\n        value: this.getRawNumber(row),\r\n        children: this.children.map((d) => d.getExportValue(row, format))\r\n      };\r\n    }\r\n    return super.getExportValue(row, format);\r\n  }\r\n}\r\n","import Column from '../../model/Column';\r\nimport ADialog, {IDialogContext} from './ADialog';\r\nimport {IToolbarDialogAddon} from '../toolbar';\r\nimport {IRankingHeaderContext} from '../interfaces';\r\n\r\n/** @internal */\r\nexport default class AddonDialog extends ADialog {\r\n  constructor(private readonly column: Column, private readonly addons: IToolbarDialogAddon[], dialog: IDialogContext, private readonly ctx: IRankingHeaderContext, private readonly onClick?: ()=>void) {\r\n    super(dialog, {\r\n      fullDialog: Boolean(onClick),\r\n      resetPossible: false\r\n    });\r\n  }\r\n\r\n  protected build(node: HTMLElement) {\r\n    for(const addon of this.addons) {\r\n      this.node.insertAdjacentHTML('beforeend', `<strong>${addon.title}</strong>`);\r\n      addon.append(this.column, node, this.dialog, this.ctx);\r\n    }\r\n  }\r\n\r\n  protected submit(): boolean {\r\n    if (this.onClick) {\r\n      this.onClick();\r\n    }\r\n    return true;\r\n  }\r\n}\r\n","import Ranking from '../../model/Ranking';\r\nimport Column from '../../model/Column';\r\nimport {ISortCriteria} from '../../model/Ranking';\r\nimport {updateHeader} from '../header';\r\nimport {IRankingHeaderContext} from '../interfaces';\r\nimport SearchBox, {ISearchBoxOptions} from './SearchBox';\r\nimport {isSupportType, categoryOf, isSortingAscByDefault} from '../../model/annotations';\r\nimport {isSortAble, isGroupAble, getToolbarDialogAddons, IToolbarDialogAddon, dialogContext, isGroupSortAble} from '../toolbar';\r\nimport AddonDialog from '../dialogs/AddonDialog';\r\n\r\ninterface IColumnItem {\r\n  col: Column;\r\n  id: string;\r\n  text: string;\r\n}\r\n/**\r\n * @internal\r\n */\r\nexport default class Hierarchy {\r\n  readonly node: HTMLElement;\r\n  readonly groupAdder: SearchBox<IColumnItem>;\r\n  readonly sortAdder: SearchBox<IColumnItem>;\r\n  readonly groupSortAdder: SearchBox<IColumnItem>;\r\n\r\n  constructor(private readonly ctx: IRankingHeaderContext, document: Document) {\r\n    this.node = document.createElement('aside');\r\n    this.node.classList.add('lu-hierarchy', 'lu-feature-advanced', 'lu-feature-ranking');\r\n    this.node.innerHTML = `\r\n      <section class=\"lu-hierarchy-group\">\r\n      </section>\r\n      <section class=\"lu-hierarchy-sort\">\r\n      </section>\r\n      <section class=\"lu-hierarchy-sortgroup\">\r\n      </section>\r\n    `;\r\n    const options = <Partial<ISearchBoxOptions<IColumnItem>>>{\r\n      doc: document,\r\n      placeholder: 'Add Sort Criteria...',\r\n      formatItem: (item: IColumnItem, node: HTMLElement) => {\r\n        node.dataset.typeCat = categoryOf(item.col).name;\r\n        node.dataset.type = item.col.desc.type;\r\n        return item.text;\r\n      },\r\n\r\n    };\r\n    this.groupAdder = new SearchBox(Object.assign({}, options, {\r\n      placeholder: 'Add Grouping Criteria...'\r\n    }));\r\n    this.groupSortAdder = new SearchBox(Object.assign({}, options, {\r\n      placeholder: 'Add Grouping Sort Criteria...'\r\n    }));\r\n    this.sortAdder = new SearchBox(options);\r\n  }\r\n\r\n  update(ranking: Ranking | null) {\r\n    if (!ranking) {\r\n      this.node.style.display = 'none';\r\n      return;\r\n    }\r\n    this.node.style.display = null;\r\n    this.renderGroups(ranking, <HTMLElement>this.node.firstElementChild!);\r\n    this.renderSorting(ranking, <HTMLElement>this.node.children[1]!);\r\n    this.renderGroupSorting(ranking, <HTMLElement>this.node.lastElementChild!);\r\n  }\r\n\r\n  private render<T>(node: HTMLElement, items: T[], toColumn: (item: T)=>Column, extras: (item: T, node: HTMLElement)=>void, addonKey: string, onChange: (item: T, delta: number)=>void) {\r\n    const cache = new Map((<HTMLElement[]>Array.from(node.children)).map((d) => <[string, HTMLElement]>[d.dataset.id, d]));\r\n    node.innerHTML = '';\r\n\r\n    items.forEach((d) => {\r\n      const col = toColumn(d);\r\n      const item = cache.get(col.id);\r\n      if (item) {\r\n        node.appendChild(item);\r\n        updateHeader(item, col);\r\n        return;\r\n      }\r\n      const addons = getToolbarDialogAddons(col, addonKey, this.ctx);\r\n\r\n      node.insertAdjacentHTML('beforeend', `<div data-id=\"${col.id}\" class=\"lu-toolbar\">\r\n      <div class=\"lu-label\">${col.label}</div>\r\n      ${addons.length > 0 ? `<i title=\"Customize\" class=\"lu-action\"><span aria-hidden=\"true\">Customize</span> </i>` : ''}\r\n      <i title=\"Move Up\" class=\"lu-action\"><span aria-hidden=\"true\">Move Up</span> </i>\r\n      <i title=\"Move Down\" class=\"lu-action\"><span aria-hidden=\"true\">Move Down</span> </i>\r\n      <i title=\"Remove from hierarchy\" class=\"lu-action\"><span aria-hidden=\"true\">Remove from hierarchy</span> </i>\r\n      </div>`);\r\n      const last = <HTMLElement>node.lastElementChild!;\r\n\r\n      function prevent(evt: Event) {\r\n        evt.preventDefault();\r\n        evt.stopPropagation();\r\n      }\r\n\r\n      (<HTMLElement>last.querySelector('i[title=\"Move Down\"]')!).onclick = (evt) => {\r\n        prevent(evt);\r\n        onChange(d, + 1);\r\n      };\r\n      (<HTMLElement>last.querySelector('i[title=\"Move Up\"]')!).onclick = (evt) => {\r\n        prevent(evt);\r\n        onChange(d, -1);\r\n      };\r\n      (<HTMLElement>last.querySelector('i[title^=Remove]')!).onclick = (evt) => {\r\n        prevent(evt);\r\n        onChange(d, 0);\r\n      };\r\n\r\n      if (addons.length > 0) {\r\n        (<HTMLElement>last.querySelector('i[title=Customize]')!).onclick = (evt) => {\r\n          prevent(evt);\r\n          this.customize(col, addons, <any>evt);\r\n        };\r\n      }\r\n\r\n      extras(d, last);\r\n\r\n      updateHeader(last, col);\r\n    });\r\n  }\r\n\r\n  private renderGroups(ranking: Ranking, node: HTMLElement) {\r\n    const groups = ranking.getGroupCriteria();\r\n\r\n    if (groups.length === 0) {\r\n      node.innerHTML = '';\r\n      return;\r\n    }\r\n\r\n    const click = (col: Column, delta: number) => {\r\n      if (delta === 0) {\r\n        col.groupByMe();\r\n        return;\r\n      }\r\n      const current = col.isGroupedBy();\r\n      col.findMyRanker()!.groupBy(col, current + delta);\r\n    };\r\n\r\n    const addButton = (_: Column, last: HTMLElement) => {\r\n      last.insertAdjacentHTML('afterbegin', `<i title=\"Group\" class=\"lu-action\" data-group=\"true\"><span aria-hidden=\"true\">Group</span> </i>`);\r\n    };\r\n\r\n    this.render(node, groups, (d) => d, addButton, 'group', click);\r\n    this.addGroupAdder(ranking, groups, node);\r\n  }\r\n\r\n  private renderSorting(ranking: Ranking, node: HTMLElement) {\r\n    const sortCriterias = ranking.getSortCriteria();\r\n\r\n    if (sortCriterias.length === 0) {\r\n      node.innerHTML = '';\r\n      return;\r\n    }\r\n\r\n    const click = ({col}: ISortCriteria, delta: number) => {\r\n      const current = col.isSortedByMe();\r\n      if (!isFinite(delta)) {\r\n        col.sortByMe(current.asc === 'desc', current.priority);\r\n        return;\r\n      }\r\n      if (delta === 0) {\r\n        col.sortByMe(current.asc === 'asc', -1);\r\n        return;\r\n      }\r\n      col.sortByMe(current.asc === 'asc', current.priority! + delta);\r\n    };\r\n\r\n    const addButton = (s: ISortCriteria, last: HTMLElement) => {\r\n      last.insertAdjacentHTML('afterbegin', `\r\n      <i title=\"Sort\" class=\"lu-action\" data-sort=\"${s.asc ? 'asc' : 'desc'}\"><span aria-hidden=\"true\">Toggle Sorting</span> </i>`);\r\n      (<HTMLElement>last.querySelector('i[title=Sort]')!).onclick = (evt) => {\r\n        evt.preventDefault();\r\n        evt.stopPropagation();\r\n        click(s, Infinity);\r\n      };\r\n    };\r\n\r\n    this.render(node, sortCriterias, (d) => d.col, addButton, 'sort', click);\r\n\r\n    this.addSortAdder(ranking, sortCriterias, node);\r\n  }\r\n\r\n  private renderGroupSorting(ranking: Ranking, node: HTMLElement) {\r\n    const sortCriterias = ranking.getGroupSortCriteria();\r\n\r\n    if (sortCriterias.length === 0) {\r\n      node.innerHTML = '';\r\n      return;\r\n    }\r\n\r\n    const click = ({col}: ISortCriteria, delta: number) => {\r\n      const current = col.isGroupSortedByMe();\r\n      if (!isFinite(delta)) {\r\n        col.groupSortByMe(current.asc === 'desc', current.priority);\r\n        return;\r\n      }\r\n      if (delta === 0) {\r\n        col.groupSortByMe(current.asc === 'asc', -1);\r\n        return;\r\n      }\r\n      col.groupSortByMe(current.asc === 'asc', current.priority! + delta);\r\n    };\r\n\r\n    const addButton = (s: ISortCriteria, last: HTMLElement) => {\r\n      last.insertAdjacentHTML('afterbegin', `\r\n      <i title=\"Sort Group\" class=\"lu-action\" data-sort=\"${s.asc ? 'asc' : 'desc'}\"><span aria-hidden=\"true\">Toggle Sorting</span> </i>`);\r\n      (<HTMLElement>last.querySelector('i[title=\"Sort Group\"]')!).onclick = (evt) => {\r\n        evt.preventDefault();\r\n        evt.stopPropagation();\r\n        click(s, Infinity);\r\n      };\r\n    };\r\n\r\n    this.render(node, sortCriterias, (d) => d.col, addButton, 'sortGroup', click);\r\n\r\n    this.addGroupSortAdder(ranking, sortCriterias, node);\r\n  }\r\n\r\n  private addAdder(adder: SearchBox<IColumnItem>, ranking: Ranking, addonKey: string, current: Column[], node: HTMLElement, check: (col: Column)=>boolean, onSelect: (col: Column)=>void) {\r\n    const used = new Set(current);\r\n\r\n    adder.data = ranking.children.filter((col) => !isSupportType(col) && !used.has(col) && check(col)).map((col) => ({col, id: col.id, text: col.label}));\r\n\r\n    adder.on(SearchBox.EVENT_SELECT, (item: IColumnItem) => {\r\n      const addons = getToolbarDialogAddons(item.col, addonKey, this.ctx);\r\n      if (addons.length > 0) {\r\n        this.customize(item.col, addons, { currentTarget: adder.node}, () => onSelect(item.col));\r\n      } else {\r\n        onSelect(item.col);\r\n      }\r\n    });\r\n\r\n    if (adder.data.length <= 0) {\r\n      return;\r\n    }\r\n\r\n    console.assert(node.ownerDocument != null);\r\n    const wrapper = node.ownerDocument!.createElement('footer');\r\n    wrapper.appendChild(adder.node);\r\n    node.appendChild(wrapper);\r\n  }\r\n\r\n  private addSortAdder(ranking: Ranking, sortCriterias: ISortCriteria[], node: HTMLElement) {\r\n    this.addAdder(this.sortAdder, ranking, 'sort', sortCriterias.map((d) => d.col), node, (d) => isSortAble(d, this.ctx), (col) => {\r\n      ranking.sortBy(col, isSortingAscByDefault(col), sortCriterias.length);\r\n    });\r\n  }\r\n\r\n  private addGroupAdder(ranking: Ranking, groups: Column[], node: HTMLElement) {\r\n    this.addAdder(this.groupAdder, ranking, 'group', groups, node, (d) => isGroupAble(d, this.ctx), (col) => {\r\n      ranking.groupBy(col, groups.length);\r\n    });\r\n  }\r\n\r\n  private addGroupSortAdder(ranking: Ranking, sortCriterias: ISortCriteria[], node: HTMLElement) {\r\n    this.addAdder(this.groupSortAdder, ranking, 'sortGroup', sortCriterias.map((d) => d.col), node, (d) => isGroupSortAble(d, this.ctx), (col) => {\r\n      ranking.groupSortBy(col, isSortingAscByDefault(col), sortCriterias.length);\r\n    });\r\n  }\r\n\r\n  private customize(col: Column, addons: IToolbarDialogAddon[], evt: { currentTarget: Element }, onClick?: ()=>void) {\r\n    const dialog = new AddonDialog(col, addons, dialogContext(this.ctx, 0, evt), this.ctx, onClick);\r\n    dialog.open();\r\n  }\r\n}\r\n\r\n","import Column from '../../model/Column';\r\nimport {ISummaryRenderer} from '../../renderer/interfaces';\r\nimport {dragAbleColumn, updateHeader, createShortcutMenuItems} from '../header';\r\nimport {IRankingHeaderContext} from '../interfaces';\r\nimport {NumberColumn} from '../../model';\r\n\r\n/** @internal */\r\nexport default class SidePanelEntryVis {\r\n  readonly node: HTMLElement;\r\n  private readonly summary: ISummaryRenderer;\r\n\r\n  constructor(public readonly column: Column, private ctx: IRankingHeaderContext, document: Document) {\r\n    this.node = document.createElement('article');\r\n    this.node.classList.add('lu-side-panel-entry');\r\n    this.node.dataset.colId = column.id;\r\n    this.node.dataset.type = column.desc.type;\r\n\r\n    this.summary = ctx.summaryRenderer(column, true);\r\n\r\n    this.column.on([`${NumberColumn.EVENT_FILTER_CHANGED}.panel`, `${Column.EVENT_DIRTY_HEADER}.panel`], () => {\r\n      this.update();\r\n    });\r\n    this.init();\r\n    this.update();\r\n  }\r\n\r\n  private init() {\r\n    this.node.innerHTML = `\r\n      <header><div class=\"lu-label\"></div><div class=\"lu-toolbar\"></div></header>${this.summary.template}`;\r\n    createShortcutMenuItems(<HTMLElement>this.node.querySelector('.lu-toolbar'), 0, this.column, this.ctx, false);\r\n    dragAbleColumn(<HTMLElement>this.node.querySelector('header'), this.column, this.ctx);\r\n\r\n    const summary = <HTMLElement>this.node.lastElementChild!;\r\n    summary.classList.add('lu-summary');\r\n    summary.dataset.renderer = this.column.getSummaryRenderer();\r\n    summary.dataset.interactive = '';\r\n  }\r\n\r\n  update(ctx: IRankingHeaderContext = this.ctx) {\r\n    this.ctx = ctx;\r\n    updateHeader(this.node, this.column);\r\n    this.summary.update(<HTMLElement>this.node.querySelector('.lu-summary')!, ctx.statsOf(<any>this.column));\r\n  }\r\n\r\n  destroy() {\r\n    this.column.on([`${NumberColumn.EVENT_FILTER_CHANGED}.panel`, `${Column.EVENT_DIRTY_HEADER}.panel`], null);\r\n    this.node.remove();\r\n  }\r\n}\r\n","import Ranking from '../../model/Ranking';\r\nimport ADialog, {IDialogContext} from './ADialog';\r\n\r\n/** @internal */\r\nexport default class RenameRankingDialog extends ADialog {\r\n\r\n  private readonly before: string;\r\n\r\n  constructor(private readonly ranking: Ranking, dialog: IDialogContext) {\r\n    super(dialog, {\r\n      fullDialog: true\r\n    });\r\n    this.before = ranking.getLabel();\r\n  }\r\n\r\n  protected build(node: HTMLElement) {\r\n    node.classList.add('lu-rename-dialog');\r\n    node.insertAdjacentHTML('beforeend', `\r\n      <input type=\"text\" value=\"${this.ranking.getLabel()}\" required autofocus placeholder=\"name\">`);\r\n  }\r\n\r\n  protected reset() {\r\n    this.findInput('input[type=\"text\"]').value = this.before;\r\n    this.ranking.setLabel(this.before);\r\n  }\r\n\r\n  protected submit() {\r\n    const newValue = this.findInput('input[type=\"text\"]').value;\r\n    this.ranking.setLabel(newValue);\r\n    return true;\r\n  }\r\n}\r\n","import Ranking from '../../model/Ranking';\r\nimport {IRankingHeaderContext} from '../interfaces';\r\nimport {dialogContext} from '../toolbar';\r\nimport ADialog, {IDialogContext} from './ADialog';\r\nimport RenameRankingDialog from './RenameRankingDialog';\r\n\r\n/** @internal */\r\nexport default class MoreRankingOptionsDialog extends ADialog {\r\n\r\n  constructor(private readonly ranking: Ranking, dialog: IDialogContext, private readonly ctx: IRankingHeaderContext) {\r\n    super(dialog);\r\n  }\r\n\r\n  private addIcon(node: HTMLElement, title: string, onClick: (evt: MouseEvent)=>void) {\r\n    node.insertAdjacentHTML('beforeend', `<i title=\"${title}\" class=\"lu-action\"><span>${title}</span> </i>`);\r\n    const i = <HTMLElement>node.lastElementChild;\r\n    i.onclick = (evt) => {\r\n      evt.stopPropagation();\r\n      onClick(evt);\r\n    };\r\n  }\r\n\r\n  protected build(node: HTMLElement) {\r\n    node.classList.add('lu-more-options');\r\n    this.addIcon(node, 'Rename', (evt) => {\r\n      const dialog = new RenameRankingDialog(this.ranking, dialogContext(this.ctx, this.level + 1, <any>evt));\r\n      dialog.open();\r\n    });\r\n    this.addIcon(node, 'Remove', () => {\r\n      this.destroy();\r\n      this.ctx.provider.removeRanking(this.ranking);\r\n    });\r\n  }\r\n}\r\n","import {suffix} from '../../internal/AEventDispatcher';\r\nimport {isSupportType} from '../../model';\r\nimport Ranking from '../../model/Ranking';\r\nimport {IRankingHeaderContext} from '../interfaces';\r\nimport Hierarchy from './Hierarchy';\r\nimport {ISidePanelOptions} from './SidePanel';\r\nimport SidePanelEntryVis from './SidePanelEntryVis';\r\nimport {dialogContext} from '../toolbar';\r\nimport MoreRankingOptionsDialog from '../dialogs/MoreRankingOptionsDialog';\r\n\r\n\r\nexport default class SidePanelRanking {\r\n\r\n  readonly header: HTMLElement;\r\n  readonly dropdown: HTMLElement;\r\n  readonly node: HTMLElement;\r\n  private readonly hierarchy: Hierarchy | null;\r\n  private readonly entries = new Map<string, SidePanelEntryVis>();\r\n\r\n  constructor(public readonly ranking: Ranking, private ctx: IRankingHeaderContext, document: Document, private readonly options: Readonly<ISidePanelOptions>) {\r\n    this.node = document.createElement('section');\r\n    this.header = document.createElement('div');\r\n    this.dropdown = document.createElement('div');\r\n\r\n    this.dropdown.innerHTML = this.header.innerHTML = `<span>${ranking.getLabel()}</span><i class=\"lu-action\" title=\"More &hellip;\"><span aria-hidden=\"true\">More &hellip;\"></span></i>`;\r\n    (<HTMLElement>this.header.lastElementChild!).onclick = (<HTMLElement>this.dropdown.lastElementChild!).onclick = (evt) => {\r\n      evt.stopPropagation();\r\n      const dialog = new MoreRankingOptionsDialog(ranking, dialogContext(ctx, 1, <any>evt), ctx);\r\n      dialog.open();\r\n    };\r\n\r\n    this.hierarchy = this.options.hierarchy ? new Hierarchy(ctx, document) : null;\r\n\r\n    this.init();\r\n  }\r\n\r\n  private init() {\r\n    this.node.innerHTML = `\r\n      <div><main></main></div>\r\n    `;\r\n    if (this.hierarchy) {\r\n      this.node.insertBefore(this.hierarchy.node, this.node.firstChild);\r\n    }\r\n\r\n    if (this.hierarchy) {\r\n      this.ranking.on(suffix('.panel', Ranking.EVENT_GROUP_CRITERIA_CHANGED, Ranking.EVENT_SORT_CRITERIA_CHANGED, Ranking.EVENT_GROUP_SORT_CRITERIA_CHANGED), () => {\r\n        this.updateHierarchy();\r\n      });\r\n    }\r\n    this.ranking.on(suffix('.panel', Ranking.EVENT_ADD_COLUMN, Ranking.EVENT_REMOVE_COLUMN, Ranking.EVENT_MOVE_COLUMN), () => {\r\n      this.updateList();\r\n      this.updateHierarchy();\r\n    });\r\n    this.ranking.on(suffix('.panel', Ranking.EVENT_LABEL_CHANGED), () => {\r\n      this.dropdown.firstElementChild!.textContent = this.header.firstElementChild!.textContent = this.ranking.getLabel();\r\n    });\r\n  }\r\n\r\n  get active() {\r\n    return this.node.classList.contains('lu-active');\r\n  }\r\n\r\n  set active(value: boolean) {\r\n    this.node.classList.toggle('lu-active', value);\r\n    this.header.classList.toggle('lu-active', value);\r\n    this.dropdown.classList.toggle('lu-active', value);\r\n    if (value) {\r\n      return;\r\n    }\r\n    this.updateList();\r\n    this.updateHierarchy();\r\n  }\r\n\r\n  update(ctx: IRankingHeaderContext) {\r\n    this.ctx = ctx;\r\n    this.updateList();\r\n    this.updateHierarchy();\r\n  }\r\n\r\n  private updateHierarchy() {\r\n    if (!this.hierarchy || !this.active) {\r\n      return;\r\n    }\r\n    this.hierarchy.update(this.ranking);\r\n  }\r\n\r\n  private updateList() {\r\n    if (!this.active) {\r\n      return;\r\n    }\r\n    const node = this.node.querySelector('main')!;\r\n    const columns = this.ranking.flatColumns.filter((d) => !isSupportType(d));\r\n\r\n    if (columns.length === 0) {\r\n      node.innerHTML = '';\r\n      this.entries.forEach((d) => d.destroy());\r\n      this.entries.clear();\r\n      return;\r\n    }\r\n\r\n    node.innerHTML = ``;\r\n\r\n    const copy = new Map(this.entries);\r\n    this.entries.clear();\r\n\r\n    columns.forEach((col) => {\r\n      const existing = copy.get(col.id);\r\n      if (existing) {\r\n        existing.update(this.ctx);\r\n        node.appendChild(existing.node);\r\n        this.entries.set(col.id, existing);\r\n        copy.delete(col.id);\r\n        return;\r\n      }\r\n\r\n      console.assert(node.ownerDocument != null);\r\n      const entry = new SidePanelEntryVis(col, this.ctx, node.ownerDocument!);\r\n      node.appendChild(entry.node);\r\n      this.entries.set(col.id, entry);\r\n    });\r\n\r\n    copy.forEach((d) => d.destroy());\r\n  }\r\n\r\n  destroy() {\r\n    this.header.remove();\r\n    this.node.remove();\r\n    this.ranking.on(suffix('.panel', Ranking.EVENT_GROUP_CRITERIA_CHANGED, Ranking.EVENT_SORT_CRITERIA_CHANGED, Ranking.EVENT_GROUP_SORT_CRITERIA_CHANGED, Ranking.EVENT_ADD_COLUMN, Ranking.EVENT_MOVE_COLUMN, Ranking.EVENT_REMOVE_COLUMN, Ranking.EVENT_LABEL_CHANGED), null);\r\n\r\n    this.entries.forEach((d) => d.destroy());\r\n    this.entries.clear();\r\n  }\r\n}\r\n","import ADialog, {IDialogContext} from './ADialog';\r\n\r\n/** @internal */\r\nexport default class ChooseRankingDialog extends ADialog {\r\n\r\n  constructor(private readonly items: HTMLElement[], dialog: IDialogContext) {\r\n    super(dialog);\r\n  }\r\n\r\n\r\n  protected build(node: HTMLElement) {\r\n    node.classList.add('lu-more-options', 'lu-choose-options');\r\n    for (const item of this.items) {\r\n      node.appendChild(item);\r\n    }\r\n  }\r\n}\r\n","import {suffix} from '../../internal/AEventDispatcher';\r\nimport {\r\n  createImpositionDesc,\r\n  createNestedDesc,\r\n  createReduceDesc,\r\n  createScriptDesc,\r\n  createStackDesc,\r\n  createRankDesc,\r\n  createGroupDesc,\r\n  createAggregateDesc,\r\n  createSelectionDesc,\r\n  IColumnDesc\r\n} from '../../model';\r\nimport {categoryOfDesc, IColumnCategory} from '../../model/annotations';\r\nimport Ranking from '../../model/Ranking';\r\nimport DataProvider, {IDataProvider} from '../../provider/ADataProvider';\r\nimport {IRankingHeaderContext} from '../interfaces';\r\nimport SearchBox, {IGroupSearchItem, ISearchBoxOptions} from './SearchBox';\r\nimport SidePanelRanking from './SidePanelRanking';\r\nimport {dialogContext} from '../toolbar';\r\nimport ChooseRankingDialog from '../dialogs/ChooseRankingDialog';\r\n\r\n\r\ninterface IColumnWrapper {\r\n  desc: IColumnDesc;\r\n  category: IColumnCategory;\r\n  id: string;\r\n  text: string;\r\n}\r\n\r\nfunction isWrapper(item: IColumnWrapper | IGroupSearchItem<IColumnWrapper>): item is IColumnWrapper {\r\n  return (<IColumnWrapper>item).desc != null;\r\n}\r\n\r\nexport interface ISidePanelOptions extends Partial<ISearchBoxOptions<IColumnWrapper>> {\r\n  additionalDescs: IColumnDesc[];\r\n  chooser: boolean;\r\n  hierarchy: boolean;\r\n  collapseable: boolean | 'collapsed';\r\n}\r\n\r\nexport default class SidePanel {\r\n\r\n  private readonly options: ISidePanelOptions = {\r\n    additionalDescs: [\r\n      createStackDesc('Weighted Sum'),\r\n      createScriptDesc('Scripted Formula'),\r\n      createNestedDesc('Nested'),\r\n      createReduceDesc(),\r\n      createImpositionDesc(),\r\n      createRankDesc(),\r\n      createSelectionDesc(),\r\n      createGroupDesc(),\r\n      createAggregateDesc(),\r\n    ],\r\n    chooser: true,\r\n    hierarchy: true,\r\n    placeholder: 'Add Column...',\r\n    formatItem: (item: IColumnWrapper | IGroupSearchItem<IColumnWrapper>, node: HTMLElement) => {\r\n      const w: IColumnWrapper = isWrapper(item) ? item : (<IColumnWrapper>item.children[0]);\r\n      node.dataset.typeCat = w.category.name;\r\n      if (isWrapper(item)) {\r\n        node.dataset.type = w.desc.type;\r\n      }\r\n      if (node.parentElement) {\r\n        node.parentElement.classList.add('lu-feature-model');\r\n        node.parentElement.classList.toggle('lu-feature-advanced', w.category.featureLevel === 'advanced');\r\n        node.parentElement.classList.toggle('lu-feature-basic', w.category.featureLevel === 'basic');\r\n      }\r\n      return item.text;\r\n    },\r\n    collapseable: true\r\n  };\r\n\r\n  readonly node: HTMLElement;\r\n  private readonly search: SearchBox<IColumnWrapper> | null;\r\n  private chooser: HTMLElement | null = null;\r\n  private readonly descs: IColumnWrapper[] = [];\r\n  private data: IDataProvider;\r\n  private readonly rankings: SidePanelRanking[] = [];\r\n\r\n  constructor(private ctx: IRankingHeaderContext, document: Document, options: Partial<ISidePanelOptions> = {}) {\r\n    Object.assign(this.options, options);\r\n\r\n    this.node = document.createElement('aside');\r\n    this.node.classList.add('lu-side-panel');\r\n\r\n    this.search = this.options.chooser ? new SearchBox<IColumnWrapper>(this.options) : null;\r\n\r\n    this.data = ctx.provider;\r\n    this.init();\r\n    this.update(ctx);\r\n  }\r\n\r\n  private init() {\r\n    this.node.innerHTML = `\r\n      <aside class=\"lu-stats\"></aside>\r\n      <header>\r\n        <i class=\"lu-action\" title=\"Choose &hellip;\"><span aria-hidden=\"true\">Choose &hellip;</span></i>\r\n      </header>\r\n      <main></main>\r\n    `;\r\n\r\n    {\r\n      const choose = <HTMLElement>this.node.querySelector('header > i');\r\n      choose.onclick = (evt) => {\r\n        evt.stopPropagation();\r\n        const dialog = new ChooseRankingDialog(this.rankings.map((d) => d.dropdown), dialogContext(this.ctx, 1, <any>evt));\r\n        dialog.open();\r\n      };\r\n    }\r\n\r\n    if (this.options.collapseable) {\r\n      this.node.insertAdjacentHTML('beforeend', `<div class=\"lu-collapser\" title=\"Collapse Panel\"></div>`);\r\n      const last = <HTMLElement>this.node.lastElementChild;\r\n      last.onclick = () => this.collapsed = !this.collapsed;\r\n      this.collapsed = this.options.collapseable === 'collapsed';\r\n    }\r\n    this.initChooser();\r\n    this.changeDataStorage(null, this.data);\r\n  }\r\n\r\n  private initChooser() {\r\n    if (!this.search) {\r\n      return;\r\n    }\r\n    console.assert(this.node.ownerDocument != null);\r\n    this.chooser = this.node.ownerDocument!.createElement('header');\r\n    this.chooser.innerHTML = '<form></form>';\r\n    this.chooser.firstElementChild!.appendChild(this.search.node);\r\n    this.search.on(SearchBox.EVENT_SELECT, (panel: IColumnWrapper) => {\r\n      const col = this.data.create(panel.desc);\r\n      if (!col) {\r\n        return;\r\n      }\r\n      const a = this.active;\r\n      if (a) {\r\n        a.ranking.push(col);\r\n      }\r\n    });\r\n  }\r\n\r\n  private get active() {\r\n    return this.rankings.find((d) => d.active);\r\n  }\r\n\r\n  private changeDataStorage(old: IDataProvider | null, data: IDataProvider) {\r\n    if (old) {\r\n      old.on(suffix('.panel', DataProvider.EVENT_ADD_RANKING, DataProvider.EVENT_REMOVE_RANKING,\r\n        DataProvider.EVENT_ADD_DESC, DataProvider.EVENT_CLEAR_DESC, DataProvider.EVENT_ORDER_CHANGED, DataProvider.EVENT_SELECTION_CHANGED), null);\r\n    }\r\n    this.data = data;\r\n\r\n    const wrapDesc = (desc: IColumnDesc) => ({\r\n        desc,\r\n        category: categoryOfDesc(desc, data.columnTypes),\r\n        id: `${desc.type}@${desc.label}`,\r\n        text: desc.label\r\n      });\r\n    this.descs.splice(0, this.descs.length, ...data.getColumns().concat(this.options.additionalDescs).map(wrapDesc));\r\n\r\n    data.on(`${DataProvider.EVENT_ADD_DESC}.panel`, (desc) => {\r\n      this.descs.push(wrapDesc(desc));\r\n      this.updateChooser();\r\n    });\r\n\r\n    data.on(`${DataProvider.EVENT_CLEAR_DESC}.panel`, () => {\r\n      this.descs.splice(0, this.descs.length);\r\n      this.updateChooser();\r\n    });\r\n\r\n    data.on(suffix('.panel', DataProvider.EVENT_SELECTION_CHANGED, DataProvider.EVENT_ORDER_CHANGED), () => {\r\n      this.updateStats();\r\n    });\r\n\r\n    data.on(suffix('.panel', DataProvider.EVENT_ADD_RANKING), (ranking: Ranking, index: number) => {\r\n      this.createEntry(ranking, index);\r\n      this.makeActive(index);\r\n    });\r\n\r\n    data.on(suffix('.panel', DataProvider.EVENT_REMOVE_RANKING), (_: Ranking, index: number) => {\r\n      if (index < 0) {\r\n        // remove all\r\n        this.rankings.splice(0, this.rankings.length).forEach((d) => d.destroy());\r\n        this.node.querySelector('header')!.dataset.count = '0';\r\n        this.makeActive(-1);\r\n        return;\r\n      }\r\n      const r = this.rankings.splice(index, 1)[0];\r\n      this.node.querySelector('header')!.dataset.count = String(this.rankings.length);\r\n      r.destroy();\r\n      if (r.active) {\r\n        this.makeActive(this.rankings.length === 0 ? -1 : Math.max(index - 1, 0));\r\n      }\r\n    });\r\n\r\n    this.rankings.splice(0, this.rankings.length).forEach((d) => d.destroy());\r\n    data.getRankings().forEach((d, i) => {\r\n      this.createEntry(d, i);\r\n    });\r\n    if (this.rankings.length > 0) {\r\n      this.makeActive(0);\r\n    }\r\n\r\n    this.updateStats();\r\n  }\r\n\r\n  private createEntry(ranking: Ranking, index: number) {\r\n    console.assert(this.node.ownerDocument != null);\r\n    const entry = new SidePanelRanking(ranking, this.ctx, this.node.ownerDocument!, this.options);\r\n\r\n    const header = this.node.querySelector('header')!;\r\n    const main = this.node.querySelector('main')!;\r\n\r\n    header.insertBefore(entry.header, header.children[index + 1]); // for the action\r\n    header.dataset.count = String(this.rankings.length + 1);\r\n\r\n    entry.header.onclick = (evt) => {\r\n      evt.preventDefault();\r\n      evt.stopPropagation();\r\n      this.makeActive(this.rankings.indexOf(entry));\r\n    };\r\n    entry.dropdown.onclick = entry.header.onclick = (evt) => {\r\n      evt.preventDefault();\r\n      evt.stopPropagation();\r\n      this.ctx.dialogManager.removeAboveLevel(0);\r\n      this.makeActive(this.rankings.indexOf(entry));\r\n    };\r\n\r\n    main.insertBefore(entry.node, main.children[index]);\r\n\r\n    this.rankings.splice(index, 0, entry);\r\n  }\r\n\r\n  get collapsed() {\r\n    return this.node.classList.contains('lu-collapsed');\r\n  }\r\n\r\n  set collapsed(value: boolean) {\r\n    this.node.classList.toggle('lu-collapsed', value);\r\n    if (value) {\r\n      return;\r\n    }\r\n    this.updateChooser();\r\n    this.updateStats();\r\n    this.updateRanking();\r\n  }\r\n\r\n  private makeActive(index: number) {\r\n    this.rankings.forEach((d, i) => d.active = index === i);\r\n\r\n    const active = this.active;\r\n    if (active && this.chooser) {\r\n      active.node.insertAdjacentElement('afterbegin', this.chooser);\r\n      // scroll to body\r\n      const parent = <HTMLElement>this.node.closest('.lu')!;\r\n      const body = parent ? parent.querySelector(`article[data-ranking=\"${active.ranking.id}\"]`) : null;\r\n      if (body) {\r\n        body.scrollIntoView();\r\n      }\r\n    }\r\n    this.updateRanking();\r\n  }\r\n\r\n  private updateRanking() {\r\n    const active = this.active;\r\n    if (active && !this.collapsed) {\r\n      active.update(this.ctx);\r\n    }\r\n  }\r\n\r\n  update(ctx: IRankingHeaderContext) {\r\n    const bak = this.data;\r\n    this.ctx = ctx;\r\n    if (ctx.provider !== bak) {\r\n      this.changeDataStorage(bak, ctx.provider);\r\n    }\r\n    this.updateChooser();\r\n    this.updateStats();\r\n\r\n    const active = this.active;\r\n    if (active) {\r\n      active.update(ctx);\r\n    }\r\n  }\r\n\r\n  private updateStats() {\r\n    if (this.collapsed) {\r\n      return;\r\n    }\r\n    const stats = <HTMLElement>this.node.querySelector('aside.lu-stats');\r\n    const s = this.data.getSelection();\r\n    const r = this.data.getFirstRanking();\r\n    const visible = r ? r.getGroups().reduce((a, b) => a + b.order.length, 0) : 0;\r\n    stats.innerHTML = `Showing <strong>${visible}</strong> of ${this.data.getTotalNumberOfRows()} items${s.length > 0 ? `; <span>${s.length} selected</span>` : ''}`;\r\n  }\r\n\r\n  destroy() {\r\n    this.node.remove();\r\n    if (!this.data) {\r\n      return;\r\n    }\r\n    this.rankings.forEach((d) => d.destroy());\r\n    this.rankings.length = 0;\r\n    this.data.on(suffix('.panel', DataProvider.EVENT_ADD_RANKING, DataProvider.EVENT_REMOVE_RANKING,\r\n      DataProvider.EVENT_ADD_DESC), null);\r\n  }\r\n\r\n  private static groupByType(entries: IColumnWrapper[]): { text: string, children: IColumnWrapper[] }[] {\r\n    const map = new Map<IColumnCategory, IColumnWrapper[]>();\r\n    entries.forEach((entry) => {\r\n      if (!map.has(entry.category)) {\r\n        map.set(entry.category, [entry]);\r\n      } else {\r\n        map.get(entry.category)!.push(entry);\r\n      }\r\n    });\r\n    return Array.from(map).map(([key, value]) => {\r\n      return {\r\n        text: key.label,\r\n        order: key.order,\r\n        children: value.sort((a, b) => a.text.localeCompare(b.text))\r\n      };\r\n    }).sort((a, b) => a.order - b.order);\r\n  }\r\n\r\n  private updateChooser() {\r\n    if (!this.search || this.collapsed) {\r\n      return;\r\n    }\r\n    this.search.data = SidePanel.groupByType(this.descs);\r\n  }\r\n}\r\n","import {IExceptionContext, range, ITableSection} from 'lineupengine';\r\nimport {IDataRow, IGroup, IGroupData, IGroupItem, isGroup} from '../model';\r\nimport {SLOPEGRAPH_WIDTH} from '../styles';\r\nimport {IRankingHeaderContextContainer} from './interfaces';\r\n\r\ninterface ISlope {\r\n  isSelected(selection: {has(dataIndex: number): boolean}): boolean;\r\n\r\n  update(path: SVGPathElement, width: number): void;\r\n\r\n  readonly dataIndices: number[];\r\n}\r\n\r\nclass ItemSlope implements ISlope {\r\n  constructor(private readonly left: number, private readonly right: number, public readonly dataIndices: number[]) {\r\n\r\n  }\r\n\r\n  isSelected(selection: {has(dataIndex: number): boolean}) {\r\n    return this.dataIndices.length === 1 ? selection.has(this.dataIndices[0]) : this.dataIndices.some((s) => selection.has(s));\r\n  }\r\n\r\n  update(path: SVGPathElement, width: number) {\r\n    path.setAttribute('data-i', String(this.dataIndices[0]));\r\n    path.setAttribute('class', 'lu-slope');\r\n    path.setAttribute('d', `M0,${this.left}L${width},${this.right}`);\r\n  }\r\n}\r\n\r\nclass GroupSlope implements ISlope {\r\n  constructor(private readonly left: [number, number], private readonly right: [number, number], public readonly dataIndices: number[]) {\r\n\r\n  }\r\n\r\n  isSelected(selection: {has(dataIndex: number): boolean}) {\r\n    return this.dataIndices.some((s) => selection.has(s));\r\n  }\r\n\r\n  update(path: SVGPathElement, width: number) {\r\n    path.setAttribute('class', 'lu-group-slope');\r\n    path.setAttribute('d', `M0,${this.left[0]}L${width},${this.right[0]}L${width},${this.right[1]}L0,${this.left[1]}Z`);\r\n  }\r\n}\r\n\r\ninterface IPos {\r\n  start: number;\r\n  heightPerRow: number;\r\n  rows: number[]; // data indices\r\n  offset: number;\r\n  ref: number[];\r\n  group: IGroup;\r\n}\r\n\r\nexport enum EMode {\r\n  ITEM = 'item',\r\n  BAND = 'band'\r\n}\r\n\r\nexport interface ISlopeGraphOptions {\r\n  mode: EMode;\r\n}\r\n\r\nexport default class SlopeGraph implements ITableSection {\r\n  readonly node: SVGSVGElement;\r\n\r\n  private leftSlopes: ISlope[][] = [];\r\n  // rendered row to one ore multiple slopes\r\n  private rightSlopes: ISlope[][] = [];\r\n  private readonly pool: SVGPathElement[] = [];\r\n\r\n  private scrollListener: ((act: { top: number, height: number}) => void) | null = null;\r\n\r\n  readonly width = SLOPEGRAPH_WIDTH;\r\n  readonly height = 0;\r\n\r\n  private current: {\r\n    left: (IGroupItem | IGroupData)[];\r\n    leftContext: IExceptionContext;\r\n    right: (IGroupItem | IGroupData)[];\r\n    rightContext: IExceptionContext;\r\n  } | null = null;\r\n  private _mode: EMode = EMode.ITEM;\r\n\r\n  constructor(public readonly header: HTMLElement, public readonly body: HTMLElement, public readonly id: string, private readonly ctx: IRankingHeaderContextContainer, options: Partial<ISlopeGraphOptions> = {}) {\r\n    console.assert(header.ownerDocument != null);\r\n    this.node = header.ownerDocument!.createElementNS('http://www.w3.org/2000/svg', 'svg');\r\n    this.node.innerHTML = `<g transform=\"translate(0,0)\"></g>`;\r\n    header.classList.add('lu-slopegraph-header');\r\n    this._mode = options.mode === EMode.BAND ? EMode.BAND : EMode.ITEM;\r\n    this.initHeader(header);\r\n    body.classList.add('lu-slopegraph');\r\n    this.body.style.height = `1px`;\r\n    body.appendChild(this.node);\r\n  }\r\n\r\n  init() {\r\n    this.hide(); // hide by default\r\n\r\n    const scroller = <any>this.body.parentElement!;\r\n\r\n    //sync scrolling of header and body\r\n    // use internals from lineup engine\r\n    const scroll = (<any>scroller).__le_scroller__;\r\n    let old: { top: number, height: number} = scroll.asInfo();\r\n    scroll.push('animation', this.scrollListener = (act: { top: number, height: number}) => {\r\n      if (Math.abs(old.top - act.top) < 5) {\r\n        return;\r\n      }\r\n      old = act;\r\n      this.onScrolledVertically(act.top, act.height);\r\n    });\r\n  }\r\n\r\n  private initHeader(header: HTMLElement) {\r\n    header.innerHTML = `<i title=\"Item\" class=\"${this._mode === EMode.ITEM ? 'active' : ''}\"><span aria-hidden=\"true\">Item</span></i>\r\n        <i title=\"Band\" class=\"${this._mode === EMode.BAND ? 'active' : ''}\"><span aria-hidden=\"true\">Band</span></i>`;\r\n\r\n    const icons = <HTMLElement[]>Array.from(header.children);\r\n    icons.forEach((n: HTMLElement, i) => {\r\n      n.onclick = (evt) => {\r\n        evt.preventDefault();\r\n        evt.stopPropagation();\r\n        if (n.classList.contains('active')) {\r\n          return;\r\n        }\r\n        this.mode = i === 0 ? EMode.ITEM : EMode.BAND;\r\n        icons.forEach((d, j) => d.classList.toggle('active', j === i));\r\n      };\r\n    });\r\n  }\r\n\r\n  get mode() {\r\n    return this._mode;\r\n  }\r\n\r\n  set mode(value: EMode) {\r\n    if (value === this._mode) {\r\n      return;\r\n    }\r\n    this._mode = value;\r\n    if (this.current) {\r\n      this.rebuild(this.current.left, this.current.leftContext, this.current.right, this.current.rightContext);\r\n    }\r\n  }\r\n\r\n  get hidden() {\r\n    return this.header.classList.contains('loading');\r\n  }\r\n\r\n  set hidden(value: boolean) {\r\n    this.header.classList.toggle('loading', value);\r\n    this.body.classList.toggle('loading', value);\r\n  }\r\n\r\n  hide() {\r\n    this.hidden = true;\r\n  }\r\n\r\n  show() {\r\n    const was = this.hidden;\r\n    this.hidden = false;\r\n    if (was) {\r\n      this.revalidate();\r\n    }\r\n  }\r\n\r\n  destroy() {\r\n    this.header.remove();\r\n    if (this.scrollListener) {\r\n      //sync scrolling of header and body\r\n      // use internals from lineup engine\r\n      const scroll = (<any>this.body.parentElement!).__le_scroller__;\r\n      scroll.remove(this.scrollListener);\r\n    }\r\n    this.body.remove();\r\n  }\r\n\r\n  rebuild(left: (IGroupItem | IGroupData)[], leftContext: IExceptionContext, right: (IGroupItem | IGroupData)[], rightContext: IExceptionContext) {\r\n    this.current = {left, leftContext, right, rightContext};\r\n\r\n    const lookup: Map<number, IPos> = this.prepareRightSlopes(right, rightContext);\r\n    this.computeSlopes(left, leftContext, lookup);\r\n\r\n    this.revalidate();\r\n  }\r\n\r\n  private computeSlopes(left: (IGroupItem | IGroupData)[], leftContext: IExceptionContext, lookup: Map<number, IPos>) {\r\n    const mode = this.mode;\r\n    const fakeGroups = new Map<IGroup, ISlope[]>();\r\n\r\n    const createFakeGroup = (first: number, group: IGroup) => {\r\n      let count = 0;\r\n      let height = 0;\r\n      const rows: IDataRow[] = [];\r\n      // find all items in this group, assuming that they are in order\r\n      for (let i = first; i < left.length; ++i) {\r\n        const item = left[i];\r\n        if (isGroup(item) || (<IGroupItem>item).group !== group) {\r\n          break;\r\n        }\r\n        count++;\r\n        height += (leftContext.exceptionsLookup.get(i) || leftContext.defaultRowHeight);\r\n        rows.push(item);\r\n      }\r\n\r\n      const padded = height - leftContext.padding(first + count - 1);\r\n\r\n      const gr = <IGroupData>Object.assign({\r\n        rows\r\n      }, group);\r\n\r\n      return {gr, padded, height};\r\n    };\r\n\r\n    let acc = 0;\r\n    this.leftSlopes = left.map((r, i) => {\r\n\r\n      let height = (leftContext.exceptionsLookup.get(i) || leftContext.defaultRowHeight);\r\n      let padded = height - 0; //leftContext.padding(i);\r\n      const slopes = <ISlope[]>[];\r\n      const start = acc;\r\n\r\n      // shift by item height\r\n      acc += height;\r\n\r\n      let offset = 0;\r\n\r\n      const push = (s: ISlope, right: IPos, common = 1, heightPerRow = 0) => {\r\n        // store slope in both\r\n        slopes.push(s);\r\n        right.ref.forEach((r) => this.rightSlopes[r].push(s));\r\n\r\n        // update the offset of myself and of the right side\r\n        right.offset += common * right.heightPerRow;\r\n        offset += common * heightPerRow;\r\n      };\r\n\r\n      let gr: IGroupData;\r\n\r\n      if (isGroup(r)) {\r\n        gr = r;\r\n      } else {\r\n        const item = (<IGroupItem>r);\r\n        const dataIndex = item.i;\r\n        const right = lookup.get(dataIndex);\r\n\r\n        if (!right) { // no match\r\n          return slopes;\r\n        }\r\n        if (mode === EMode.ITEM) {\r\n          const s = new ItemSlope(start + padded / 2, right.start + right.offset + right.heightPerRow / 2, [dataIndex]);\r\n          push(s, right);\r\n          return slopes;\r\n        }\r\n\r\n        if (fakeGroups.has(item.group)) {\r\n          // already handled by the first one, take the fake slopes\r\n          return fakeGroups.get(item.group)!;\r\n        }\r\n\r\n        const fakeGroup = createFakeGroup(i, item.group);\r\n        gr = fakeGroup.gr;\r\n        height = fakeGroup.height;\r\n        padded = fakeGroup.padded;\r\n        fakeGroups.set(item.group, slopes);\r\n      }\r\n\r\n      // free group items to share\r\n      const free = new Set(gr.rows.map((d) => d.i));\r\n\r\n      const heightPerRow = padded / gr.rows.length;\r\n\r\n      gr.rows.forEach((d) => {\r\n        if (!free.has(d.i)) {\r\n          return; // already handled\r\n        }\r\n        free.delete(d.i);\r\n        const right = lookup.get(d.i);\r\n        if (!right) {\r\n          return; // no matching\r\n        }\r\n        // find all of this group\r\n        const intersection = right.rows.filter((r) => free.delete(r));\r\n        intersection.push(d.i); //self\r\n\r\n        const common = intersection.length;\r\n        let s: ISlope;\r\n        if (common === 1) {\r\n          s = new ItemSlope(start + offset + heightPerRow / 2, right.start + right.offset + right.heightPerRow / 2, [d.i]);\r\n        } else if (mode === EMode.ITEM) {\r\n          // fake item\r\n          s = new ItemSlope(start + offset + heightPerRow * common / 2, right.start + right.offset + right.heightPerRow * common / 2, intersection);\r\n        } else {\r\n          s = new GroupSlope([start + offset, start + offset + heightPerRow * common], [right.start + right.offset, right.start + right.offset + right.heightPerRow * common], intersection);\r\n        }\r\n        push(s, right, common, heightPerRow);\r\n      });\r\n      return slopes;\r\n    });\r\n  }\r\n\r\n  private prepareRightSlopes(right: (IGroupItem | IGroupData)[], rightContext: IExceptionContext) {\r\n    const lookup = new Map<number, IPos>();\r\n    const mode = this.mode;\r\n\r\n    const fakeGroups = new Map<IGroup, IPos>();\r\n    let acc = 0;\r\n\r\n    this.rightSlopes = right.map((r, i) => {\r\n      const height = (rightContext.exceptionsLookup.get(i) || rightContext.defaultRowHeight);\r\n      const padded = height - 0; //rightContext.padding(i);\r\n      const start = acc;\r\n      acc += height;\r\n      const slopes = <ISlope[]>[];\r\n\r\n      const base = {\r\n        start,\r\n        offset: 0,\r\n        ref: [i]\r\n      };\r\n      if (isGroup(r)) {\r\n        const p = Object.assign(base, {\r\n          rows: r.rows.map((d) => d.i),\r\n          heightPerRow: padded / r.rows.length,\r\n          group: r\r\n        });\r\n\r\n        r.rows.forEach((ri) => lookup.set(ri.i, p));\r\n        return slopes;\r\n      }\r\n      // item\r\n      const item = (<IGroupItem>r);\r\n      const dataIndex = r.i;\r\n\r\n      let p = Object.assign(base, {\r\n        rows: [dataIndex],\r\n        heightPerRow: padded,\r\n        group: item.group\r\n      });\r\n\r\n      if (mode === EMode.ITEM) {\r\n        lookup.set(dataIndex, p);\r\n        return slopes;\r\n      }\r\n      // forced band mode\r\n      // merge with the 'ueber' band\r\n      if (!fakeGroups.has(item.group)) {\r\n        p.heightPerRow = height; // include padding\r\n        // TODO just support uniform item height\r\n        fakeGroups.set(item.group, p);\r\n      } else { // reuse old\r\n        p = fakeGroups.get(item.group)!;\r\n        p.rows.push(dataIndex);\r\n        p.ref.push(i);\r\n      }\r\n      lookup.set(dataIndex, p);\r\n      return slopes;\r\n    });\r\n\r\n    return lookup;\r\n  }\r\n\r\n  private revalidate() {\r\n    if (!this.current || this.hidden) {\r\n      return;\r\n    }\r\n    const p = this.body.parentElement!;\r\n    this.onScrolledVertically(p.scrollTop, p.clientHeight);\r\n  }\r\n\r\n\r\n  highlight(dataIndex: number) {\r\n    const old = this.body.querySelector(`[data-i].le-highlighted`);\r\n    if (old) {\r\n      old.classList.remove('le-highlighted');\r\n    }\r\n    if (dataIndex < 0) {\r\n      return;\r\n    }\r\n    const item = this.body.querySelector(`[data-i=\"${dataIndex}\"]`);\r\n    if (item) {\r\n      item.classList.add('le-highlighted');\r\n    }\r\n    return item != null;\r\n  }\r\n\r\n  private onScrolledVertically(scrollTop: number, clientHeight: number) {\r\n    if (!this.current) {\r\n      return;\r\n    }\r\n\r\n    // which lines are currently shown\r\n    const {leftContext, rightContext} = this.current;\r\n    const left = range(scrollTop, clientHeight, leftContext.defaultRowHeight, leftContext.exceptions, leftContext.numberOfRows);\r\n    const right = range(scrollTop, clientHeight, rightContext.defaultRowHeight, rightContext.exceptions, rightContext.numberOfRows);\r\n\r\n    const start = Math.min(left.firstRowPos, right.firstRowPos);\r\n    const end = Math.max(left.endPos, right.endPos);\r\n\r\n    // move to right position\r\n    this.body.style.transform = `translate(0, ${start.toFixed(0)}px)`;\r\n    this.body.style.height = `${(end - start).toFixed(0)}px`;\r\n    (this.node.firstElementChild!).setAttribute('transform', `translate(0,-${start.toFixed(0)})`);\r\n\r\n    this.choose(left.first, left.last, right.first, right.last);\r\n  }\r\n\r\n  private choose(leftVisibleFirst: number, leftVisibleLast: number, rightVisibleFirst: number, rightVisibleLast: number) {\r\n    // assume no separate scrolling\r\n\r\n    const slopes = new Set<ISlope>();\r\n    for (let i = leftVisibleFirst; i <= leftVisibleLast; ++i) {\r\n      this.leftSlopes[i].forEach((s) => slopes.add(s));\r\n    }\r\n    for (let i = rightVisibleFirst; i <= rightVisibleLast; ++i) {\r\n      this.rightSlopes[i].forEach((s) => slopes.add(s));\r\n    }\r\n    this.render(slopes);\r\n  }\r\n\r\n  private render(slopes: Set<ISlope>) {\r\n    const g = <SVGGElement>this.node.firstElementChild!;\r\n    const width = g.ownerSVGElement!.getBoundingClientRect()!.width;\r\n    const paths = this.matchLength(slopes, g);\r\n\r\n    const p = this.ctx.provider;\r\n    const selectionLookup = {has: (dataIndex: number) => p.isSelected(dataIndex)};\r\n\r\n    // update paths\r\n    let i = 0;\r\n    slopes.forEach((s) => {\r\n      const p = paths[i++]; // since a set\r\n      s.update(p, width);\r\n      (<any>p).__data__ = s; // data binding\r\n      const selected = s.isSelected(selectionLookup);\r\n      p.classList.toggle('lu-selected', selected);\r\n      if (selected) {\r\n        g.appendChild(p); // to put it on top\r\n      }\r\n    });\r\n  }\r\n\r\n  private matchLength(slopes: Set<ISlope>, g: SVGGElement) {\r\n    const paths = <SVGPathElement[]>Array.from(g.children);\r\n    for (let i = slopes.size; i < paths.length; ++i) {\r\n      const elem = paths[i];\r\n      this.pool.push(elem);\r\n      elem.remove();\r\n    }\r\n\r\n    for (let i = paths.length; i < slopes.size; ++i) {\r\n      const elem = this.pool.pop();\r\n      if (elem) {\r\n        g.appendChild(elem);\r\n        paths.push(elem);\r\n      } else {\r\n        console.assert(g.ownerDocument != null);\r\n        const path = g.ownerDocument!.createElementNS('http://www.w3.org/2000/svg', 'path');\r\n        path.onclick = (evt) => {\r\n          // d3 style\r\n          const s: ISlope = (<any>path).__data__;\r\n          const p = this.ctx.provider;\r\n          const ids = s.dataIndices;\r\n          if (evt.ctrlKey) {\r\n            ids.forEach((id) => p.toggleSelection(id, true));\r\n          } else {\r\n            // either unset or set depending on the first state\r\n            const isSelected = p.isSelected(ids[0]!);\r\n            p.setSelection(isSelected ? [] : ids);\r\n          }\r\n        };\r\n        g.appendChild(path);\r\n        paths.push(path);\r\n      }\r\n    }\r\n    return paths;\r\n  }\r\n\r\n  updateSelection(selectedDataIndices: Set<number>) {\r\n    const g = this.node.firstElementChild!;\r\n    const paths = <SVGPathElement[]>Array.from(g.children);\r\n\r\n    paths.forEach((p) => {\r\n      const s: ISlope = (<any>p).__data__;\r\n      const selected = s.isSelected(selectedDataIndices);\r\n      p.classList.toggle('lu-selected', selected);\r\n      if (selected) {\r\n        g.appendChild(p); // to put it on top\r\n      }\r\n    });\r\n  }\r\n}\r\n","// Computes the decimal coefficient and exponent of the specified number x with\n// significant digits p, where x is positive and p is in [1, 21] or undefined.\n// For example, formatDecimal(1.23) returns [\"123\", 0].\nexport default function(x, p) {\n  if ((i = (x = p ? x.toExponential(p - 1) : x.toExponential()).indexOf(\"e\")) < 0) return null; // NaN, Infinity\n  var i, coefficient = x.slice(0, i);\n\n  // The string returned by toExponential either has the form \\d\\.\\d+e[-+]\\d+\n  // (e.g., 1.2e+3) or the form \\de[-+]\\d+ (e.g., 1e+3).\n  return [\n    coefficient.length > 1 ? coefficient[0] + coefficient.slice(2) : coefficient,\n    +x.slice(i + 1)\n  ];\n}\n","\r\nexport interface IDragHandleOptions {\r\n  container: HTMLElement|SVGElement;\r\n  filter(evt: MouseEvent): boolean;\r\n  onStart(handle: HTMLElement|SVGElement, x: number, delta: number, evt: MouseEvent): void;\r\n  onDrag(handle: HTMLElement|SVGElement, x: number, delta: number, evt: MouseEvent): void;\r\n  onEnd(handle: HTMLElement|SVGElement, x: number, delta: number, evt: MouseEvent): void;\r\n  minDelta: number;\r\n}\r\n\r\n/**\r\n * allow to change the width of a column using dragging the handle\r\n * @internal\r\n */\r\nexport function dragHandle(handle: HTMLElement|SVGElement, options: Partial<IDragHandleOptions> = {}) {\r\n  const o: Readonly<IDragHandleOptions> = Object.assign({\r\n    container: handle.parentElement!,\r\n    filter: () => true,\r\n    onStart: () => undefined,\r\n    onDrag: () => undefined,\r\n    onEnd: () => undefined,\r\n    minDelta: 2\r\n  }, options);\r\n\r\n  const toContainerRelative = (x: number, elem: HTMLElement|SVGElement) => {\r\n    const rect = elem.getBoundingClientRect();\r\n    return x - rect.left - elem.clientLeft;\r\n  };\r\n\r\n  let start = 0;\r\n  let last = 0;\r\n  let handleShift = 0;\r\n  const mouseMove = (evt: MouseEvent) => {\r\n    if (!o.filter(evt)) {\r\n      return;\r\n    }\r\n    evt.stopPropagation();\r\n    evt.preventDefault();\r\n    const end = toContainerRelative(evt.clientX, o.container) - handleShift;\r\n    if (Math.abs(last - end) < o.minDelta) {\r\n      //ignore\r\n      return;\r\n    }\r\n    last = end;\r\n    o.onDrag(handle, end, last - end, evt);\r\n  };\r\n\r\n  const mouseUp = (evt: MouseEvent) => {\r\n    if (!o.filter(evt)) {\r\n      return;\r\n    }\r\n    evt.stopPropagation();\r\n    evt.preventDefault();\r\n    const end = toContainerRelative(evt.clientX, o.container) - handleShift;\r\n    o.container.removeEventListener('mousemove', <any>mouseMove);\r\n    o.container.removeEventListener('mouseup', <any>mouseUp);\r\n    o.container.removeEventListener('mouseleave', <any>mouseUp);\r\n\r\n    if (Math.abs(start - end) < 2) {\r\n      //ignore\r\n      return;\r\n    }\r\n    o.onEnd(handle, end, start - end, evt);\r\n  };\r\n  handle.onmousedown = (evt) => {\r\n    if (!o.filter(evt)) {\r\n      return;\r\n    }\r\n    evt.stopPropagation();\r\n    evt.preventDefault();\r\n    handleShift = toContainerRelative(evt.clientX, handle);\r\n    start = last = toContainerRelative(evt.clientX, o.container) - handleShift;\r\n    o.container.addEventListener('mousemove', <any>mouseMove);\r\n    o.container.addEventListener('mouseup', <any>mouseUp);\r\n    o.container.addEventListener('mouseleave', <any>mouseUp);\r\n    o.onStart(handle, start, 0, evt);\r\n  };\r\n}\r\n","import {IDataRow} from './interfaces';\r\nimport MultiLevelCompositeColumn from './MultiLevelCompositeColumn';\r\n\r\n/**\r\n * factory for creating a description creating a mean column\r\n * @param label\r\n * @returns {{type: string, label: string}}\r\n */\r\nexport function createNestedDesc(label: string = 'Nested') {\r\n  return {type: 'nested', label};\r\n}\r\n\r\n/**\r\n * a nested column is a composite column where the sorting order is determined by the nested ordering of the children\r\n * i.e., sort by the first child if equal sort by the second child,...\r\n */\r\nexport default class NestedColumn extends MultiLevelCompositeColumn {\r\n\r\n  compare(a: IDataRow, b: IDataRow) {\r\n    const c = this.children;\r\n    for (const ci of c) {\r\n      const ciResult = ci.compare(a, b);\r\n      if (ciResult !== 0) {\r\n        return ciResult;\r\n      }\r\n    }\r\n    return 0;\r\n  }\r\n\r\n  getLabel(row: IDataRow) {\r\n    return this.children.map((d) => d.getLabel(row)).join(';');\r\n  }\r\n\r\n  getValue(row: IDataRow) {\r\n    return this.children.map((d) => d.getValue(row)).join(';');\r\n  }\r\n}\r\n","import Column, {widthChanged, labelChanged, metaDataChanged, dirty, dirtyHeader, dirtyValues, rendererTypeChanged, groupRendererChanged, summaryRendererChanged, visibilityChanged} from './Column';\r\nimport {IDataRow} from './interfaces';\r\nimport StringColumn, {filterChanged, groupingChanged} from './StringColumn';\r\nimport {IEventListener} from '../internal/AEventDispatcher';\r\nimport ValueColumn, {dataLoaded} from './ValueColumn';\r\n\r\n\r\n/**\r\n * emitted when the value of a row changes\r\n * @asMemberOf AnnotateColumn\r\n * @event\r\n */\r\nexport declare function valueChanged(dataIndex: number, previous: string, current: string): void;\r\n\r\n/**\r\n * a string column in which the values can be edited locally\r\n */\r\nexport default class AnnotateColumn extends StringColumn {\r\n  static readonly EVENT_VALUE_CHANGED = 'valueChanged';\r\n\r\n  private readonly annotations = new Map<number, string>();\r\n\r\n  protected createEventList() {\r\n    return super.createEventList().concat([AnnotateColumn.EVENT_VALUE_CHANGED]);\r\n  }\r\n\r\n  on(type: typeof AnnotateColumn.EVENT_VALUE_CHANGED, listener: typeof valueChanged | null): this;\r\n  on(type: typeof StringColumn.EVENT_FILTER_CHANGED, listener: typeof filterChanged | null): this;\r\n  on(type: typeof StringColumn.EVENT_GROUPING_CHANGED, listener: typeof groupingChanged | null): this;\r\n  on(type: typeof ValueColumn.EVENT_DATA_LOADED, listener: typeof dataLoaded | null): this;\r\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\r\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\r\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\r\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\r\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\r\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\r\n  on(type: string | string[], listener: IEventListener | null): this {\r\n    return super.on(<any>type, listener);\r\n  }\r\n\r\n  getValue(row: IDataRow) {\r\n    if (this.annotations.has(row.i)) {\r\n      return this.annotations.get(row.i)!;\r\n    }\r\n    return super.getValue(row);\r\n  }\r\n\r\n  dump(toDescRef: (desc: any) => any): any {\r\n    const r = super.dump(toDescRef);\r\n    r.annotations = {};\r\n    this.annotations.forEach((v, k) => {\r\n      r.annotations[k] = v;\r\n    });\r\n    return r;\r\n  }\r\n\r\n  restore(dump: any, factory: (dump: any) => Column | null) {\r\n    super.restore(dump, factory);\r\n    if (!dump.annotations) {\r\n      return;\r\n    }\r\n    Object.keys(dump.annotations).forEach((k) => {\r\n      this.annotations.set(Number(k), dump.annotations[k]);\r\n    });\r\n  }\r\n\r\n  setValue(row: IDataRow, value: string) {\r\n    const old = this.getValue(row);\r\n    if (old === value) {\r\n      return true;\r\n    }\r\n    if (value === '' || value == null) {\r\n      this.annotations.delete(row.i);\r\n    } else {\r\n      this.annotations.set(row.i, value);\r\n    }\r\n    this.fire([AnnotateColumn.EVENT_VALUE_CHANGED, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY], row.i, old, value);\r\n    return true;\r\n  }\r\n}\r\n","const TYPE_OBJECT = '[object Object]';\r\n\r\n//credits to https://github.com/vladmiller/dextend/blob/master/lib/dextend.js\r\n/**\r\n * @internal\r\n * @param args\r\n * @returns {any}\r\n */\r\nexport default function merge(...args: any[]) {\r\n  let result = null;\r\n\r\n  for (const toMerge of args) {\r\n    const keys = Object.keys(toMerge);\r\n\r\n    if (result == null) {\r\n      result = toMerge;\r\n      continue;\r\n    }\r\n\r\n    for (const keyName of keys) {\r\n      const value = toMerge[keyName];\r\n\r\n      //merge just POJOs\r\n      if (Object.prototype.toString.call(value) === TYPE_OBJECT && (Object.getPrototypeOf(value) === Object.prototype)) { //pojo\r\n        if (result[keyName] === undefined) {\r\n          result[keyName] = {};\r\n        }\r\n        result[keyName] = merge(result[keyName], value);\r\n      } else if (Array.isArray(value)) {\r\n        if (result[keyName] === undefined) {\r\n          result[keyName] = [];\r\n        }\r\n        result[keyName] = value.concat(result[keyName]);\r\n      } else {\r\n        result[keyName] = value;\r\n      }\r\n    }\r\n  }\r\n\r\n  return result;\r\n}\r\n","export default function(x) {\n  return function() {\n    return x;\n  };\n}\n","import {IDataRow, IGroup} from '../model';\r\nimport Column from '../model/Column';\r\nimport SelectionColumn from '../model/SelectionColumn';\r\nimport {default as IRenderContext, ICellRendererFactory, ICellRenderer, IGroupCellRenderer, ISummaryRenderer} from './interfaces';\r\nimport {noop} from './utils';\r\nimport {IDataProvider} from '../provider/ADataProvider';\r\n\r\nexport default class SelectionRenderer implements ICellRendererFactory {\r\n  readonly title: string = 'Default';\r\n\r\n  canRender(col: Column): boolean {\r\n    return col instanceof SelectionColumn;\r\n  }\r\n\r\n  create(col: SelectionColumn, ctx: IRenderContext): ICellRenderer {\r\n    return {\r\n      template: `<div></div>`,\r\n      update: (n: HTMLElement, d: IDataRow, i: number) => {\r\n        n.onclick = function (event) {\r\n          event.preventDefault();\r\n          event.stopPropagation();\r\n          if (event.shiftKey) {\r\n            const ranking = col.findMyRanker()!.id;\r\n            if (rangeSelection(ctx.provider, ranking, d.i, i, event.ctrlKey)) {\r\n              return;\r\n            }\r\n          }\r\n\r\n          col.toggleValue(d);\r\n        };\r\n      },\r\n      render: noop\r\n    };\r\n  }\r\n\r\n  createGroup(col: SelectionColumn): IGroupCellRenderer {\r\n    return {\r\n      template: `<div></div>`,\r\n      update: (n: HTMLElement, _group: IGroup, rows: IDataRow[]) => {\r\n        const selected = rows.reduce((act, r) => col.getValue(r) ? act + 1 : act, 0);\r\n        const all = selected >= rows.length / 2;\r\n        if (all) {\r\n          n.classList.add('lu-group-selected');\r\n        } else {\r\n          n.classList.remove('lu-group-selected');\r\n        }\r\n        n.onclick = function (event) {\r\n          event.preventDefault();\r\n          event.stopPropagation();\r\n          const value = n.classList.toggle('lu-group-selected');\r\n          col.setValues(rows, value);\r\n        };\r\n      }\r\n    };\r\n  }\r\n\r\n  createSummary(col: SelectionColumn, context: IRenderContext): ISummaryRenderer {\r\n    return {\r\n      template: `<div title=\"(Un)Select All\" data-icon=\"unchecked\"></div>`,\r\n      update: (node: HTMLElement) => {\r\n        node.onclick = (evt) => {\r\n          evt.stopPropagation();\r\n          const icon = node.dataset.icon;\r\n          if (icon === 'unchecked') {\r\n            context.provider.selectAllOf(col.findMyRanker()!);\r\n            node.dataset.icon = 'checked';\r\n          } else {\r\n            context.provider.setSelection([]);\r\n            node.dataset.icon = 'unchecked';\r\n          }\r\n        };\r\n      }\r\n    };\r\n  }\r\n}\r\n\r\nexport function rangeSelection(provider: IDataProvider, rankingId: string, dataIndex: number, relIndex: number, ctrlKey: boolean) {\r\n  const ranking = provider.getRankings().find((d) => d.id === rankingId);\r\n  if (!ranking) { // no known reference\r\n    return false;\r\n  }\r\n  const selection = provider.getSelection();\r\n  if (selection.length === 0 || selection.includes(dataIndex)) {\r\n    return false; // no other or deselect\r\n  }\r\n  const order = ranking.getOrder();\r\n  const lookup = new Map(ranking.getOrder().map((d, i) => <[number, number]>[d, i]));\r\n  const distances = selection.map((d) => {\r\n    const index = (lookup.has(d) ? lookup.get(d)! : Infinity);\r\n    return {s: d, index, distance: Math.abs(relIndex - index)};\r\n  });\r\n  const nearest = distances.sort((a, b) => a.distance - b.distance)[0]!;\r\n  if (!isFinite(nearest.distance)) {\r\n    return false; // all outside\r\n  }\r\n  if (!ctrlKey) {\r\n    selection.splice(0, selection.length);\r\n    selection.push(nearest.s);\r\n  }\r\n  if (nearest.index < relIndex) {\r\n    for(let i = nearest.index + 1; i <= relIndex; ++i) {\r\n      selection.push(order[i]);\r\n    }\r\n  } else {\r\n    for(let i = relIndex; i <= nearest.index; ++i) {\r\n      selection.push(order[i]);\r\n    }\r\n  }\r\n  provider.setSelection(selection);\r\n  return true;\r\n}\r\n","import {detect} from 'detect-browser';\r\n\r\nexport const SUPPORTED_FIREFOX_VERSION = 57;\r\nexport const SUPPORTED_CHROME_VERSION = 64;\r\nexport const SUPPORTED_EDGE_VERSION = 16;\r\n\r\n/**\r\n * @internal\r\n */\r\nexport function getUnsupportedBrowserError() {\r\n  const info = detect();\r\n  if (!info) {\r\n    return 'browser cannot be detected';\r\n  }\r\n  const prefix = `unsupported browser detected:`;\r\n  switch(info.name) {\r\n    case 'firefox':\r\n      const fVersion = parseInt(info.version.slice(0, info.version.indexOf('.')), 10);\r\n      if(fVersion <= SUPPORTED_FIREFOX_VERSION && fVersion !== 52) { // ESR\r\n        return `${prefix} Firefox ${info.version} (&lt; ${SUPPORTED_FIREFOX_VERSION})`;\r\n      }\r\n      return null;\r\n    case 'edge':\r\n      const eVersion = parseInt(info.version.slice(0, info.version.indexOf('.')), 10);\r\n      if(eVersion <= SUPPORTED_EDGE_VERSION) {\r\n        return `${prefix} Edge ${info.version} (&lt; ${SUPPORTED_EDGE_VERSION})`;\r\n      }\r\n      return null;\r\n    case 'chrome':\r\n      const cVersion = parseInt(info.version.slice(0, info.version.indexOf('.')), 10);\r\n      if(cVersion <= SUPPORTED_CHROME_VERSION) {\r\n        return `${prefix} Chrome ${info.version} (&lt; ${SUPPORTED_CHROME_VERSION})`;\r\n      }\r\n      return null;\r\n    case 'ie':\r\n      return `${prefix} Internet Explorer`;\r\n  }\r\n  console.warn('unknown browser detected', info, 'assuming fine...');\r\n  return null;\r\n}\r\n/**\r\n * checks whether the current browser is compatible with lineupjs\r\n * @return boolean\r\n */\r\nexport function isBrowserSupported() {\r\n  return getUnsupportedBrowserError() == null;\r\n}\r\n\r\n","import {ILineUpLike} from '../interfaces';\r\nimport AEventDispatcher from '../internal/AEventDispatcher';\r\nimport Column from '../model/Column';\r\nimport DataProvider from '../provider/ADataProvider';\r\nimport {IEventListener} from '../internal/AEventDispatcher';\r\nimport {getUnsupportedBrowserError, SUPPORTED_FIREFOX_VERSION, SUPPORTED_CHROME_VERSION, SUPPORTED_EDGE_VERSION} from '../browser';\r\n\r\n/**\r\n * emitted when the highlight changes\r\n * @asMemberOf ALineUp\r\n * @param dataIndex the highlghted data index or -1 for none\r\n * @event\r\n */\r\nexport declare function highlightChanged(dataIndex: number): void;\r\n\r\n/**\r\n * emitted when the selection changes\r\n * @asMemberOf ALineUp\r\n * @param dataIndices the selected data indices\r\n * @event\r\n */\r\nexport declare function selectionChanged(dataIndices: number[]): void;\r\n\r\nexport abstract class ALineUp extends AEventDispatcher implements ILineUpLike {\r\n  static readonly EVENT_SELECTION_CHANGED = DataProvider.EVENT_SELECTION_CHANGED;\r\n  static readonly EVENT_HIGHLIGHT_CHANGED = 'highlightChanged';\r\n\r\n  private highlightListeners = 0;\r\n\r\n  public readonly isBrowserSupported: boolean;\r\n\r\n  constructor(public readonly node: HTMLElement, public data: DataProvider, ignoreIncompatibleBrowser: boolean) {\r\n    super();\r\n\r\n    const error = getUnsupportedBrowserError();\r\n    this.isBrowserSupported = ignoreIncompatibleBrowser || !error;\r\n\r\n    if (!this.isBrowserSupported) {\r\n      this.node.classList.add('lu-unsupported-browser');\r\n      this.node.innerHTML = `<span>${error}</span>\r\n      <div class=\"lu-unsupported-browser-hint\">\r\n        <a href=\"https://www.mozilla.org/en-US/firefox/\" rel=\"noopener\" target=\"_blank\" data-browser=\"firefox\" data-version=\"${SUPPORTED_FIREFOX_VERSION}\"></a>\r\n        <a href=\"https://www.google.com/chrome/index.html\" rel=\"noopener\" target=\"_blank\" data-browser=\"chrome\" data-version=\"${SUPPORTED_CHROME_VERSION}\" title=\"best support\"></a>\r\n        <a href=\"https://www.microsoft.com/en-us/windows/microsoft-edge\" rel=\"noopener\" target=\"_blank\" data-browser=\"edge\" data-version=\"${SUPPORTED_EDGE_VERSION}\"></a>\r\n      </div><span>use the <code>ignoreUnsupportedBrowser=true</code> option to ignore this error at your own risk</span>`;\r\n    }\r\n\r\n    this.forward(this.data, `${DataProvider.EVENT_SELECTION_CHANGED}.main`);\r\n  }\r\n\r\n  protected createEventList() {\r\n    return super.createEventList().concat([ALineUp.EVENT_HIGHLIGHT_CHANGED, ALineUp.EVENT_SELECTION_CHANGED]);\r\n  }\r\n\r\n  on(type: typeof ALineUp.EVENT_HIGHLIGHT_CHANGED, listener: typeof highlightChanged | null): this;\r\n  on(type: typeof ALineUp.EVENT_SELECTION_CHANGED, listener: typeof selectionChanged | null): this;\r\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\r\n  on(type: string | string[], listener: IEventListener | null): this {\r\n    return super.on(type, listener);\r\n  }\r\n\r\n  destroy() {\r\n    // just clear since we hand in the node itself\r\n    this.node.innerHTML = '';\r\n  }\r\n\r\n  dump() {\r\n    return this.data.dump();\r\n  }\r\n\r\n  abstract update(): void;\r\n\r\n  setDataProvider(data: DataProvider, dump?: any) {\r\n    if (this.data) {\r\n      this.unforward(this.data, `${DataProvider.EVENT_SELECTION_CHANGED}.taggle`);\r\n    }\r\n    this.data = data;\r\n    if (dump) {\r\n      this.data.restore(dump);\r\n    }\r\n    this.forward(this.data, `${DataProvider.EVENT_SELECTION_CHANGED}.taggle`);\r\n  }\r\n\r\n  getSelection() {\r\n    return this.data.getSelection();\r\n  }\r\n\r\n  setSelection(dataIndices: number[]) {\r\n    this.data.setSelection(dataIndices);\r\n  }\r\n\r\n  /**\r\n   * sorts LineUp by he given column\r\n   * @param column callback function finding the column to sort\r\n   * @param ascending\r\n   * @returns {boolean}\r\n   */\r\n  sortBy(column: string | ((col: Column) => boolean), ascending = false) {\r\n    const col = this.data.find(column);\r\n    if (col) {\r\n      col.sortByMe(ascending);\r\n    }\r\n    return col != null;\r\n  }\r\n\r\n  abstract setHighlight(dataIndex: number, scrollIntoView: boolean): boolean;\r\n\r\n  abstract getHighlight(): number;\r\n\r\n  protected listenersChanged(type: string, enabled: boolean) {\r\n    super.listenersChanged(type, enabled);\r\n    if (!type.startsWith(ALineUp.EVENT_HIGHLIGHT_CHANGED)) {\r\n      return;\r\n    }\r\n    if (enabled) {\r\n      this.highlightListeners += 1;\r\n      if (this.highlightListeners === 1) { // first\r\n        this.enableHighlightListening(true);\r\n      }\r\n    } else {\r\n      this.highlightListeners -= 1;\r\n      if (this.highlightListeners === 0) { // last\r\n        this.enableHighlightListening(false);\r\n      }\r\n    }\r\n  }\r\n\r\n  protected enableHighlightListening(_enable: boolean) {\r\n    // hook\r\n  }\r\n}\r\n\r\nexport default ALineUp;\r\n","export {default as Taggle, ITaggleOptions, TaggleRenderer, IRuleInstance, IRule, spaceFillingRule} from './taggle';\r\nexport {default as EngineRenderer} from './EngineRenderer';\r\nexport {default as EngineRanking, IEngineRankingContext, IEngineRankingOptions} from './EngineRanking';\r\nexport {default as SlopeGraph, EMode} from './SlopeGraph';\r\nexport * from './dialogs';\r\nexport * from './panel';\r\nexport * from './toolbar';\r\nexport * from './interfaces';\r\nexport {default as LineUp, ILineUpOptions} from './LineUp';\r\n","import Column, {IColumnDesc, IDataRow} from '../model';\r\nimport {defaultGroup, IOrderedGroup} from '../model/Group';\r\nimport Ranking from '../model/Ranking';\r\nimport ACommonDataProvider from './ACommonDataProvider';\r\nimport {IDataProviderOptions, IStatsBuilder} from './ADataProvider';\r\n\r\n/**\r\n * interface what the server side has to provide\r\n */\r\nexport interface IServerData {\r\n  /**\r\n   * sort the dataset by the given description\r\n   * @param ranking\r\n   */\r\n  sort(ranking: Ranking): Promise<number[]>;\r\n\r\n  /**\r\n   * returns a slice of the data array identified by a list of indices\r\n   * @param indices\r\n   */\r\n  view(indices: number[]): Promise<any[]>;\r\n\r\n  /**\r\n   * returns a sample of the values for a given column\r\n   * @param column\r\n   */\r\n  mappingSample(column: any): Promise<number[]>;\r\n\r\n  /**\r\n   * return the matching indices matching the given arguments\r\n   * @param search\r\n   * @param column\r\n   */\r\n  search(search: string | RegExp, column: any): Promise<number[]>;\r\n\r\n  stats(indices: number[]): IStatsBuilder;\r\n}\r\n\r\n\r\nexport interface IRemoteDataProviderOptions {\r\n  /**\r\n   * maximal cache size (unused at the moment)\r\n   */\r\n  maxCacheSize: number;\r\n}\r\n\r\n/**\r\n * a remote implementation of the data provider\r\n */\r\nexport default class RemoteDataProvider extends ACommonDataProvider {\r\n  private readonly options: IRemoteDataProviderOptions = {\r\n    maxCacheSize: 1000\r\n  };\r\n\r\n  private readonly cache = new Map<number, Promise<IDataRow>>();\r\n\r\n\r\n  constructor(private server: IServerData, columns: IColumnDesc[] = [], options: Partial<IRemoteDataProviderOptions & IDataProviderOptions> = {}) {\r\n    super(columns, options);\r\n    Object.assign(this.options, options);\r\n  }\r\n\r\n  getTotalNumberOfRows() {\r\n    // TODO not correct\r\n    return this.cache.size;\r\n  }\r\n\r\n  sortImpl(ranking: Ranking): Promise<IOrderedGroup[]> {\r\n    //use the server side to sort\r\n    return this.server.sort(ranking).then((order) => [Object.assign({order}, defaultGroup)]);\r\n  }\r\n\r\n  private loadFromServer(indices: number[]) {\r\n    return this.server.view(indices).then((view) => {\r\n      //enhance with the data index\r\n      return view.map((v, i) => {\r\n        const dataIndex = indices[i];\r\n        return {v, dataIndex};\r\n      });\r\n    });\r\n  }\r\n\r\n  view(indices: number[]): Promise<any[]> {\r\n    if (indices.length === 0) {\r\n      return Promise.resolve([]);\r\n    }\r\n    const base = this.fetch([indices])[0];\r\n    return Promise.all(base).then((rows) => rows.map((d) => d.v));\r\n  }\r\n\r\n\r\n  private computeMissing(orders: number[][]): number[] {\r\n    const union = new Set<number>();\r\n    const unionAdd = union.add.bind(union);\r\n    orders.forEach((order) => order.forEach(unionAdd));\r\n\r\n    // removed cached\r\n    this.cache.forEach((_v, k) => union.delete(k));\r\n\r\n    if ((this.cache.size + union.size) > this.options.maxCacheSize) {\r\n      // clean up cache\r\n    }\r\n    // const maxLength = Math.max(...orders.map((o) => o.length));\r\n    return Array.from(union);\r\n  }\r\n\r\n  private loadInCache(missing: number[]) {\r\n    if (missing.length === 0) {\r\n      return;\r\n    }\r\n    // load data and map to rows;\r\n    const v = this.loadFromServer(missing);\r\n    missing.forEach((_m, i) => {\r\n      const dataIndex = missing[i];\r\n      this.cache.set(dataIndex, v.then((loaded) => ({v: loaded[i], i: dataIndex})));\r\n    });\r\n  }\r\n\r\n  fetch(orders: number[][]): Promise<IDataRow>[][] {\r\n    const toLoad = this.computeMissing(orders);\r\n    this.loadInCache(toLoad);\r\n\r\n    return orders.map((order) =>\r\n      order.map((i) => this.cache.get(i)!));\r\n  }\r\n\r\n\r\n  mappingSample(col: Column): Promise<number[]> {\r\n    return this.server.mappingSample((<any>col.desc).column);\r\n  }\r\n\r\n  searchAndJump(search: string | RegExp, col: Column) {\r\n    this.server.search(search, (<any>col.desc).column).then((indices) => {\r\n      this.jumpToNearest(indices);\r\n    });\r\n  }\r\n\r\n  stats(indices: number[]) {\r\n    return this.server.stats(indices);\r\n  }\r\n}\r\n","export {default as DataProvider, IStatsBuilder, IDataProviderOptions, IDataProvider, IExportOptions} from './ADataProvider';\r\nexport {default as LocalDataProvider} from './LocalDataProvider';\r\nexport {default as RemoteDataProvider} from './RemoteDataProvider';\r\nexport * from './LocalDataProvider';\r\nexport * from './RemoteDataProvider';\r\nexport * from './utils';\r\n","import {similar} from '../internal/math';\r\nimport {toolbar} from './annotations';\r\nimport Column, {IColumnDesc, IFlatColumn, widthChanged, labelChanged, metaDataChanged, dirty, dirtyHeader, dirtyValues, rendererTypeChanged, groupRendererChanged, summaryRendererChanged, visibilityChanged} from './Column';\r\nimport CompositeColumn, {IMultiLevelColumn, isMultiLevelColumn, addColumn, filterChanged, moveColumn, removeColumn} from './CompositeColumn';\r\nimport {IDataRow} from './interfaces';\r\nimport {isNumberColumn} from './INumberColumn';\r\nimport StackColumn from './StackColumn';\r\nimport {IEventListener} from '../internal/AEventDispatcher';\r\n\r\n\r\n/**\r\n * emitted when the collapse property changes\r\n * @asMemberOf MultiLevelCompositeColumn\r\n * @event\r\n */\r\nexport declare function collapseChanged(previous: boolean, current: boolean): void;\r\n\r\n/**\r\n * emitted when the ratios between the children changes\r\n * @asMemberOf MultiLevelCompositeColumn\r\n * @event\r\n */\r\nexport declare function nestedChildRatio(previous: number, current: number): void;\r\n\r\n\r\n@toolbar('collapse')\r\nexport default class MultiLevelCompositeColumn extends CompositeColumn implements IMultiLevelColumn {\r\n  static readonly EVENT_COLLAPSE_CHANGED = StackColumn.EVENT_COLLAPSE_CHANGED;\r\n  static readonly EVENT_MULTI_LEVEL_CHANGED = StackColumn.EVENT_MULTI_LEVEL_CHANGED;\r\n\r\n  private readonly adaptChange: (old: number, newValue: number) => void;\r\n\r\n  /**\r\n   * whether this stack column is collapsed i.e. just looks like an ordinary number column\r\n   * @type {boolean}\r\n   * @private\r\n   */\r\n  private collapsed = false;\r\n\r\n  constructor(id: string, desc: Readonly<IColumnDesc>) {\r\n    super(id, desc);\r\n    const that = this;\r\n    this.adaptChange = function (old, newValue) {\r\n      that.adaptWidthChange(old, newValue);\r\n    };\r\n  }\r\n\r\n  protected createEventList() {\r\n    return super.createEventList().concat([MultiLevelCompositeColumn.EVENT_COLLAPSE_CHANGED, MultiLevelCompositeColumn.EVENT_MULTI_LEVEL_CHANGED]);\r\n  }\r\n\r\n  on(type: typeof MultiLevelCompositeColumn.EVENT_COLLAPSE_CHANGED, listener: typeof collapseChanged | null): this;\r\n  on(type: typeof MultiLevelCompositeColumn.EVENT_MULTI_LEVEL_CHANGED, listener: typeof nestedChildRatio | null): this;\r\n  on(type: typeof CompositeColumn.EVENT_FILTER_CHANGED, listener: typeof filterChanged | null): this;\r\n  on(type: typeof CompositeColumn.EVENT_ADD_COLUMN, listener: typeof addColumn | null): this;\r\n  on(type: typeof CompositeColumn.EVENT_MOVE_COLUMN, listener: typeof moveColumn | null): this;\r\n  on(type: typeof CompositeColumn.EVENT_REMOVE_COLUMN, listener: typeof removeColumn | null): this;\r\n  on(type: typeof Column.EVENT_WIDTH_CHANGED, listener: typeof widthChanged | null): this;\r\n  on(type: typeof Column.EVENT_LABEL_CHANGED, listener: typeof labelChanged | null): this;\r\n  on(type: typeof Column.EVENT_METADATA_CHANGED, listener: typeof metaDataChanged | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY, listener: typeof dirty | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_HEADER, listener: typeof dirtyHeader | null): this;\r\n  on(type: typeof Column.EVENT_DIRTY_VALUES, listener: typeof dirtyValues | null): this;\r\n  on(type: typeof Column.EVENT_RENDERER_TYPE_CHANGED, listener: typeof rendererTypeChanged | null): this;\r\n  on(type: typeof Column.EVENT_GROUP_RENDERER_TYPE_CHANGED, listener: typeof groupRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_SUMMARY_RENDERER_TYPE_CHANGED, listener: typeof summaryRendererChanged | null): this;\r\n  on(type: typeof Column.EVENT_VISIBILITY_CHANGED, listener: typeof visibilityChanged | null): this;\r\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\r\n  on(type: string | string[], listener: IEventListener | null): this {\r\n    return super.on(type, listener);\r\n  }\r\n\r\n  setCollapsed(value: boolean) {\r\n    if (this.collapsed === value) {\r\n      return;\r\n    }\r\n    this.fire([StackColumn.EVENT_COLLAPSE_CHANGED, Column.EVENT_DIRTY_HEADER, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY], this.collapsed, this.collapsed = value);\r\n  }\r\n\r\n  getCollapsed() {\r\n    return this.collapsed;\r\n  }\r\n\r\n  dump(toDescRef: (desc: any) => any) {\r\n    const r = super.dump(toDescRef);\r\n    r.collapsed = this.collapsed;\r\n    return r;\r\n  }\r\n\r\n  restore(dump: any, factory: (dump: any) => Column | null) {\r\n    this.collapsed = dump.collapsed === true;\r\n    super.restore(dump, factory);\r\n  }\r\n\r\n  flatten(r: IFlatColumn[], offset: number, levelsToGo = 0, padding = 0) {\r\n    return StackColumn.prototype.flatten.call(this, r, offset, levelsToGo, padding);\r\n  }\r\n\r\n  /**\r\n   * inserts a column at a the given position\r\n   * @param col\r\n   * @param index\r\n   */\r\n  insert(col: Column, index: number) {\r\n    col.on(`${Column.EVENT_WIDTH_CHANGED}.stack`, this.adaptChange);\r\n    //increase my width\r\n    super.setWidth(this.length === 0 ? col.getWidth() : (this.getWidth() + col.getWidth()));\r\n\r\n    return super.insert(col, index);\r\n  }\r\n\r\n  /**\r\n   * adapts weights according to an own width change\r\n   * @param oldValue\r\n   * @param newValue\r\n   */\r\n  private adaptWidthChange(oldValue: number, newValue: number) {\r\n    if (similar(oldValue, newValue, 0.5)) {\r\n      return;\r\n    }\r\n    const act = this.getWidth();\r\n    const next = act + (newValue - oldValue);\r\n    this.fire([MultiLevelCompositeColumn.EVENT_MULTI_LEVEL_CHANGED, Column.EVENT_DIRTY_HEADER, Column.EVENT_DIRTY], act, next);\r\n    super.setWidth(next);\r\n  }\r\n\r\n  removeImpl(child: Column, index: number) {\r\n    child.on(`${Column.EVENT_WIDTH_CHANGED}.stack`, null);\r\n    super.setWidth(this.length === 0 ? 100 : this.getWidth() - child.getWidth());\r\n    return super.removeImpl(child, index);\r\n  }\r\n\r\n  setWidth(value: number) {\r\n    const act = this.getWidth();\r\n    const factor = value / act;\r\n    this._children.forEach((child) => {\r\n      //disable since we change it\r\n      child.setWidthImpl(child.getWidth() * factor);\r\n    });\r\n    if (!similar(act, value, 0.5)) {\r\n      this.fire([MultiLevelCompositeColumn.EVENT_MULTI_LEVEL_CHANGED, Column.EVENT_DIRTY_HEADER, Column.EVENT_DIRTY], act, value);\r\n    }\r\n    super.setWidth(value);\r\n  }\r\n\r\n  getRenderer() {\r\n    if (this.getCollapsed()) {\r\n      return MultiLevelCompositeColumn.EVENT_COLLAPSE_CHANGED;\r\n    }\r\n    return super.getRenderer();\r\n  }\r\n\r\n  isMissing(row: IDataRow) {\r\n    if (this.getCollapsed()) {\r\n      return this._children.some((c) => (isNumberColumn(c) || isMultiLevelColumn(c)) && c.isMissing(row));\r\n    }\r\n    return false;\r\n  }\r\n\r\n  getExportValue(row: IDataRow, format: 'text' | 'json'): any {\r\n    if (format === 'json') {\r\n      return {\r\n        children: this.children.map((d) => d.getExportValue(row, format))\r\n      };\r\n    }\r\n    return super.getExportValue(row, format);\r\n  }\r\n}\r\n","/**\r\n * a set that preserves the insertion order\r\n */\r\nexport default class OrderedSet<T> implements Iterable<T> {\r\n  readonly [Symbol.toStringTag] = Symbol('OrderedSet');\r\n  private readonly set = new Set<T>();\r\n  private readonly list = <T[]>[];\r\n\r\n  constructor(values: T[] = []) {\r\n    this.addAll(values);\r\n  }\r\n\r\n  get size() {\r\n    return this.set.size;\r\n  }\r\n\r\n  clear() {\r\n    this.set.clear();\r\n    this.list.splice(0, this.list.length);\r\n  }\r\n\r\n  addAll(values: T[]) {\r\n    values.forEach((v) => this.add(v));\r\n    return this;\r\n  }\r\n\r\n  add(value: T) {\r\n    if (this.set.has(value)) {\r\n      return this;\r\n    }\r\n    this.set.add(value);\r\n    this.list.push(value);\r\n    return this;\r\n  }\r\n\r\n  has(value: T) {\r\n    return this.set.has(value);\r\n  }\r\n\r\n  delete(value: T) {\r\n    const r = this.set.delete(value);\r\n    if (!r) {\r\n      return false;\r\n    }\r\n    const index = this.list.indexOf(value);\r\n    console.assert(index >= 0);\r\n    this.list.splice(index, 1);\r\n    return true;\r\n  }\r\n\r\n  deleteAll(values: T[]) {\r\n    return values.reduce((acc, act) => this.delete(act) && acc, true);\r\n  }\r\n\r\n  forEach(callbackfn: (value: T, value2: T, set: Set<T>) => void, thisArg?: any) {\r\n    this.list.forEach(function (this: any, v: T) {\r\n      callbackfn.call(this, v, v, <any>this);\r\n    }, thisArg);\r\n  }\r\n\r\n  [Symbol.iterator]() {\r\n    return this.list[Symbol.iterator]();\r\n  }\r\n}\r\n","import {createAggregateDesc, createRankDesc, createSelectionDesc, IColumnDesc, IDataRow, isSupportType} from '../model';\r\nimport {IOrderedGroup} from '../model/Group';\r\nimport Ranking from '../model/Ranking';\r\nimport ADataProvider, {IDataProviderOptions} from './ADataProvider';\r\nimport {resolveValue} from '../internal/accessor';\r\n\r\n\r\nfunction isComplexAccessor(column: any) {\r\n  // something like a.b or a[4]\r\n  return typeof column === 'string' && (column.indexOf('.') >= 0 || column.indexOf('[') >= 0);\r\n}\r\n\r\nfunction resolveComplex(column: string, row: any) {\r\n  return resolveValue(row, column);\r\n}\r\n\r\nfunction rowGetter(row: IDataRow, _id: string, desc: any) {\r\n  const column = desc.column;\r\n  if (isComplexAccessor(column)) {\r\n    return resolveComplex(<string>column, row.v);\r\n  }\r\n  return row.v[column];\r\n}\r\n\r\n/**\r\n * common base implementation of a DataProvider with a fixed list of column descriptions\r\n */\r\nabstract class ACommonDataProvider extends ADataProvider {\r\n\r\n  private rankingIndex = 0;\r\n\r\n  /**\r\n   * the local ranking orders\r\n   */\r\n  private readonly ranks = new Map<string, IOrderedGroup[]>();\r\n\r\n  constructor(private columns: IColumnDesc[] = [], options: Partial<IDataProviderOptions> = {}) {\r\n    super(options);\r\n    //generate the accessor\r\n    columns.forEach((d: any) => {\r\n      d.accessor = d.accessor || rowGetter;\r\n      d.label = d.label || d.column;\r\n    });\r\n  }\r\n\r\n  protected rankAccessor(row: IDataRow, _id: string, _desc: IColumnDesc, ranking: Ranking) {\r\n    const groups = this.ranks.get(ranking.id) || [];\r\n    let acc = 0;\r\n    for (const group of groups) {\r\n      const rank = group.order.indexOf(row.i);\r\n      if (rank >= 0) {\r\n        return acc + rank + 1; // starting with 1\r\n      }\r\n      acc += group.order.length;\r\n    }\r\n    return -1;\r\n  }\r\n\r\n  /**\r\n   * returns the maximal number of nested/hierarchical sorting criteria\r\n   * @return {number}\r\n   */\r\n  protected getMaxNestedSortingCriteria() {\r\n    return 1;\r\n  }\r\n\r\n  protected getMaxGroupColumns() {\r\n    return 1;\r\n  }\r\n\r\n  cloneRanking(existing?: Ranking) {\r\n    const id = this.nextRankingId();\r\n    const clone = new Ranking(id, this.getMaxNestedSortingCriteria(), this.getMaxGroupColumns());\r\n\r\n    if (existing) { //copy the ranking of the other one\r\n      //copy the ranking\r\n      this.ranks.set(id, this.ranks.get(existing.id)!);\r\n      //TODO better cloning\r\n      existing.children.forEach((child) => {\r\n        this.push(clone, child.desc);\r\n      });\r\n    }\r\n\r\n    return clone;\r\n  }\r\n\r\n  cleanUpRanking(ranking: Ranking) {\r\n    //delete all stored information\r\n    this.ranks.delete(ranking.id);\r\n  }\r\n\r\n  sort(ranking: Ranking): Promise<IOrderedGroup[]> | IOrderedGroup[] {\r\n    //use the server side to sort\r\n    const r = this.sortImpl(ranking);\r\n    if (Array.isArray(r)) {\r\n      //store the result\r\n      this.ranks.set(ranking.id, r);\r\n      return r;\r\n    }\r\n    return r.then((r) => {\r\n      this.ranks.set(ranking.id, r);\r\n      return r;\r\n    });\r\n  }\r\n\r\n  protected abstract sortImpl(ranking: Ranking): Promise<IOrderedGroup[]> | IOrderedGroup[];\r\n\r\n  /**\r\n   * adds another column description to this data provider\r\n   * @param column\r\n   */\r\n  pushDesc(column: IColumnDesc) {\r\n    const d: any = column;\r\n    d.accessor = d.accessor || rowGetter;\r\n    d.label = column.label || d.column;\r\n    this.columns.push(column);\r\n    this.fire(ADataProvider.EVENT_ADD_DESC, d);\r\n  }\r\n\r\n  clearColumns() {\r\n    this.clearRankings();\r\n    this.columns.splice(0, this.columns.length);\r\n    this.fire(ADataProvider.EVENT_CLEAR_DESC);\r\n  }\r\n\r\n  getColumns(): IColumnDesc[] {\r\n    return this.columns.slice();\r\n  }\r\n\r\n  findDesc(ref: string) {\r\n    return this.columns.filter((c) => (<any>c).column === ref)[0];\r\n  }\r\n\r\n  /**\r\n   * identify by the tuple type@columnname\r\n   * @param desc\r\n   * @returns {string}\r\n   */\r\n  toDescRef(desc: any): any {\r\n    return typeof desc.column !== 'undefined' ? `${desc.type}@${desc.column}` : desc;\r\n  }\r\n\r\n  /**\r\n   * generates a default ranking by using all column descriptions ones\r\n   */\r\n  deriveDefault(addSupportType: boolean = true) {\r\n    const r = this.pushRanking();\r\n    if (addSupportType) {\r\n      if (this.getMaxGroupColumns() > 0) {\r\n        r.push(this.create(createAggregateDesc())!);\r\n      }\r\n      r.push(this.create(createRankDesc())!);\r\n      if (this.multiSelections) {\r\n        r.push(this.create(createSelectionDesc())!);\r\n      }\r\n    }\r\n    this.getColumns().forEach((col) => {\r\n      const c = this.create(col);\r\n      if (!c || isSupportType(c)) {\r\n        return;\r\n      }\r\n      r.push(c);\r\n    });\r\n    return r;\r\n  }\r\n\r\n  fromDescRef(descRef: any): any {\r\n    if (typeof (descRef) === 'string') {\r\n      return this.columns.find((d: any) => `${d.type}@${d.column}` === descRef);\r\n    }\r\n    const existing = this.columns.find((d) => descRef.column === (<any>d).column && descRef.label === d.label && descRef.type === d.type);\r\n    if (existing) {\r\n      return existing;\r\n    }\r\n    return descRef;\r\n  }\r\n\r\n  restore(dump: any) {\r\n    super.restore(dump);\r\n    this.rankingIndex = 1 + Math.max(...this.getRankings().map((r) => +r.id.substring(4)));\r\n  }\r\n\r\n  nextRankingId() {\r\n    return `rank${this.rankingIndex++}`;\r\n  }\r\n}\r\n\r\nexport default ACommonDataProvider;\r\n","import {defaultOptions} from '../../config';\r\nimport {ITaggleOptions} from '../../interfaces';\r\nimport merge from '../../internal/merge';\r\nimport DataProvider from '../../provider/ADataProvider';\r\nimport {ALineUp} from '../ALineUp';\r\nimport SidePanel from '../panel/SidePanel';\r\nimport spaceFillingRule from './spaceFillingRule';\r\nimport TaggleRenderer from './TaggleRenderer';\r\n\r\nexport {ITaggleOptions} from '../../interfaces';\r\n\r\nexport default class Taggle extends ALineUp {\r\n  private readonly spaceFilling: HTMLElement | null;\r\n  private readonly renderer: TaggleRenderer | null;\r\n  private readonly panel: SidePanel | null;\r\n\r\n  private readonly options = defaultOptions();\r\n\r\n\r\n  constructor(node: HTMLElement, data: DataProvider, options: Partial<ITaggleOptions> = {}) {\r\n    super(node, data, options && options.ignoreUnsupportedBrowser === true);\r\n    merge(this.options, options, {\r\n      violationChanged: (_rule: any, violation?: string) => this.setViolation(violation)\r\n    });\r\n\r\n    if (!this.isBrowserSupported) {\r\n      this.spaceFilling = null;\r\n      this.renderer = null;\r\n      this.panel = null;\r\n      return;\r\n    }\r\n\r\n    this.node.classList.add('lu-taggle', 'lu');\r\n\r\n    this.renderer = new TaggleRenderer(data, this.node, this.options);\r\n    console.assert(this.node.ownerDocument != null);\r\n    this.panel = new SidePanel(this.renderer.ctx, this.node.ownerDocument!, {\r\n      collapseable: this.options.sidePanelCollapsed ? 'collapsed' : true,\r\n      hierarchy: this.options.hierarchyIndicator && this.options.flags.advancedRankingFeatures\r\n    });\r\n    this.renderer.pushUpdateAble((ctx) => this.panel!.update(ctx));\r\n    this.node.insertBefore(this.panel.node, this.node.firstChild);\r\n    {\r\n      this.panel.node.insertAdjacentHTML('afterbegin', `<div class=\"lu-rule-button-chooser lu-feature-advanced lu-feature-ui\"><label>\r\n            <input type=\"checkbox\">\r\n            <span>Overview</span>\r\n            <div></div>\r\n          </label></div>`);\r\n      const spaceFilling = spaceFillingRule(this.options);\r\n      this.spaceFilling = <HTMLElement>this.node.querySelector('.lu-rule-button-chooser')!;\r\n      const input = <HTMLInputElement>this.spaceFilling.querySelector('input');\r\n      input.onchange = () => {\r\n        const selected = this.spaceFilling!.classList.toggle('chosen');\r\n        self.setTimeout(() => this.renderer!.switchRule(selected ? spaceFilling : null));\r\n      };\r\n      if (this.options.overviewMode) {\r\n        input.checked = true;\r\n        this.spaceFilling.classList.toggle('chosen');\r\n        this.renderer.switchRule(spaceFilling);\r\n      }\r\n    }\r\n    this.forward(this.renderer, `${ALineUp.EVENT_HIGHLIGHT_CHANGED}.main`);\r\n  }\r\n\r\n  private setViolation(violation?: string) {\r\n    violation = violation || '';\r\n    if (this.spaceFilling) {\r\n      this.spaceFilling.classList.toggle('violated', Boolean(violation));\r\n      this.spaceFilling.lastElementChild!.innerHTML = violation.replace(/\\n/g, '<br>');\r\n    }\r\n  }\r\n\r\n  destroy() {\r\n    this.node.classList.remove('lu-taggle', 'lu');\r\n    if (this.renderer) {\r\n      this.renderer.destroy();\r\n    }\r\n    if (this.panel) {\r\n      this.panel.destroy();\r\n    }\r\n    super.destroy();\r\n  }\r\n\r\n  update() {\r\n    if (this.renderer) {\r\n      this.renderer.update();\r\n    }\r\n  }\r\n\r\n  setHighlight(dataIndex: number, scrollIntoView: boolean = true) {\r\n    return this.renderer != null && this.renderer.setHighlight(dataIndex, scrollIntoView);\r\n  }\r\n\r\n  getHighlight() {\r\n    return this.renderer ? this.renderer.getHighlight() : -1;\r\n  }\r\n\r\n  protected enableHighlightListening(enable: boolean) {\r\n    if (this.renderer) {\r\n      this.renderer.enableHighlightListening(enable);\r\n    }\r\n  }\r\n\r\n  setDataProvider(data: DataProvider, dump?: any) {\r\n    super.setDataProvider(data, dump);\r\n    if (!this.renderer) {\r\n      return;\r\n    }\r\n    this.renderer.setDataProvider(data);\r\n    this.update();\r\n    this.panel!.update(this.renderer.ctx);\r\n  }\r\n}\r\n","'use strict';\n\nvar isArray = Array.isArray;\nvar keyList = Object.keys;\nvar hasProp = Object.prototype.hasOwnProperty;\n\nmodule.exports = function equal(a, b) {\n  if (a === b) return true;\n\n  if (a && b && typeof a == 'object' && typeof b == 'object') {\n    var arrA = isArray(a)\n      , arrB = isArray(b)\n      , i\n      , length\n      , key;\n\n    if (arrA && arrB) {\n      length = a.length;\n      if (length != b.length) return false;\n      for (i = length; i-- !== 0;)\n        if (!equal(a[i], b[i])) return false;\n      return true;\n    }\n\n    if (arrA != arrB) return false;\n\n    var dateA = a instanceof Date\n      , dateB = b instanceof Date;\n    if (dateA != dateB) return false;\n    if (dateA && dateB) return a.getTime() == b.getTime();\n\n    var regexpA = a instanceof RegExp\n      , regexpB = b instanceof RegExp;\n    if (regexpA != regexpB) return false;\n    if (regexpA && regexpB) return a.toString() == b.toString();\n\n    var keys = keyList(a);\n    length = keys.length;\n\n    if (length !== keyList(b).length)\n      return false;\n\n    for (i = length; i-- !== 0;)\n      if (!hasProp.call(b, keys[i])) return false;\n\n    for (i = length; i-- !== 0;) {\n      key = keys[i];\n      if (!equal(a[key], b[key])) return false;\n    }\n\n    return true;\n  }\n\n  return a!==a && b!==b;\n};\n","import {ILineUpOptions} from '../../interfaces';\r\nimport AEventDispatcher, {IEventListener} from '../../internal/AEventDispatcher';\r\nimport debounce from '../../internal/debounce';\r\nimport {IGroupData, IGroupItem, isGroup} from '../../model';\r\nimport Ranking from '../../model/Ranking';\r\nimport DataProvider from '../../provider/ADataProvider';\r\nimport {IRenderContext} from '../../renderer';\r\nimport {IEngineRankingContext} from '../EngineRanking';\r\nimport EngineRenderer from '../EngineRenderer';\r\nimport {IRankingHeaderContext, IRankingHeaderContextContainer} from '../interfaces';\r\nimport {IRule} from './interfaces';\r\n\r\n/**\r\n * emitted when the highlight changes\r\n * @asMemberOf TaggleRenderer\r\n * @param dataIndex the highlghted data index or -1 for none\r\n * @event\r\n */\r\nexport declare function highlightChanged(dataIndex: number): void;\r\n\r\nexport interface ITaggleOptions {\r\n  violationChanged(rule: IRule, violation: string): void;\r\n\r\n  rowPadding: number;\r\n}\r\n\r\nexport default class TaggleRenderer extends AEventDispatcher {\r\n  static readonly EVENT_HIGHLIGHT_CHANGED = EngineRenderer.EVENT_HIGHLIGHT_CHANGED;\r\n\r\n  private isDynamicLeafHeight: boolean = false;\r\n\r\n  private rule: IRule | null = null;\r\n  private levelOfDetail: ((rowIndex: number) => 'high' | 'low') | null = null;\r\n  private readonly resizeListener = () => debounce(() => this.update(), 100);\r\n  private readonly renderer: EngineRenderer;\r\n\r\n  private readonly options: Readonly<ITaggleOptions> = {\r\n    violationChanged: () => undefined,\r\n    rowPadding: 2\r\n  };\r\n\r\n  constructor(public data: DataProvider, parent: HTMLElement, options: (Partial<ITaggleOptions> & Readonly<ILineUpOptions>)) {\r\n    super();\r\n\r\n\r\n    this.renderer = new EngineRenderer(data, parent, Object.assign({}, options, {\r\n      dynamicHeight: (data: (IGroupData | IGroupItem)[], ranking: Ranking) => {\r\n        const r = this.dynamicHeight(data);\r\n        if (r) {\r\n          return r;\r\n        }\r\n        return options.dynamicHeight ? options.dynamicHeight(data, ranking) : null;\r\n      },\r\n      levelOfDetail: (rowIndex: number) => this.levelOfDetail ? this.levelOfDetail(rowIndex) : 'high'\r\n    }));\r\n\r\n    //\r\n    this.renderer.style.addRule('taggle_lod_rule', `\r\n      #${this.renderer.idPrefix} [data-lod=low][data-agg=detail]:hover {\r\n        /* show regular height for hovered rows in low + medium LOD */\r\n        height: ${options.rowHeight}px !important;\r\n      }\r\n    `);\r\n\r\n\r\n    this.data.on(`${DataProvider.EVENT_SELECTION_CHANGED}.rule`, () => {\r\n      if (this.isDynamicLeafHeight) {\r\n        this.update();\r\n      }\r\n    });\r\n    this.forward(this.renderer, `${TaggleRenderer.EVENT_HIGHLIGHT_CHANGED}.main`);\r\n\r\n    window.addEventListener('resize', this.resizeListener, {\r\n      passive: true\r\n    });\r\n  }\r\n\r\n  get ctx(): IRankingHeaderContextContainer & IRenderContext & IEngineRankingContext {\r\n    return this.renderer.ctx;\r\n  }\r\n\r\n  pushUpdateAble(updateAble: (ctx: IRankingHeaderContext) => void) {\r\n    this.renderer.pushUpdateAble(updateAble);\r\n  }\r\n\r\n  private dynamicHeight(data: (IGroupData | IGroupItem)[]) {\r\n    if (!this.rule) {\r\n      this.levelOfDetail = null;\r\n      return null;\r\n    }\r\n\r\n    const availableHeight = this.renderer ? this.renderer.node.querySelector('main')!.clientHeight : 100;\r\n    const instance = this.rule.apply(data, availableHeight, new Set(this.data.getSelection()));\r\n    this.isDynamicLeafHeight = typeof instance.item === 'function';\r\n\r\n    this.options.violationChanged(this.rule, instance.violation || '');\r\n\r\n    const height = (item: IGroupItem | IGroupData) => {\r\n      if (isGroup(item)) {\r\n        return typeof instance.group === 'number' ? instance.group : instance.group(item);\r\n      }\r\n      return typeof instance.item === 'number' ? instance.item : instance.item(item);\r\n    };\r\n\r\n    this.levelOfDetail = (rowIndex: number) => {\r\n      const item = data[rowIndex];\r\n      return this.rule ? this.rule.levelOfDetail(item, height(item)) : 'high';\r\n    };\r\n\r\n    // padding is always 0 since included in height\r\n    // const padding = (item: IGroupData | IGroupItem | null) => {\r\n    //   if (!item) {\r\n    //     item = data[0];\r\n    //   }\r\n    //   const lod = this.rule ? this.rule.levelOfDetail(item, height(item)) : 'high';\r\n    //   return lod === 'high' ? 0 : 0; // always 0 since\r\n    // };\r\n\r\n    return {\r\n      defaultHeight: typeof instance.item === 'number' ? instance.item : NaN,\r\n      height,\r\n      padding: 0\r\n    };\r\n  }\r\n\r\n  protected createEventList() {\r\n    return super.createEventList().concat([TaggleRenderer.EVENT_HIGHLIGHT_CHANGED]);\r\n  }\r\n\r\n  on(type: typeof TaggleRenderer.EVENT_HIGHLIGHT_CHANGED, listener: typeof highlightChanged | null): this;\r\n  on(type: string | string[], listener: IEventListener | null): this; // required for correct typings in *.d.ts\r\n  on(type: string | string[], listener: IEventListener | null): this {\r\n    return super.on(type, listener);\r\n  }\r\n\r\n\r\n  zoomOut() {\r\n    this.renderer.zoomOut();\r\n  }\r\n\r\n  zoomIn() {\r\n    this.renderer.zoomIn();\r\n  }\r\n\r\n  switchRule(rule: IRule | null) {\r\n    if (this.rule === rule) {\r\n      return;\r\n    }\r\n    this.rule = rule;\r\n    this.update();\r\n  }\r\n\r\n  destroy() {\r\n    this.renderer.destroy();\r\n    window.removeEventListener('resize', this.resizeListener);\r\n  }\r\n\r\n  update() {\r\n    this.renderer.update();\r\n  }\r\n\r\n  setDataProvider(data: DataProvider) {\r\n    if (this.data) {\r\n      this.data.on(`${DataProvider.EVENT_SELECTION_CHANGED}.rule`, null);\r\n    }\r\n    this.data = data;\r\n    this.data.on(`${DataProvider.EVENT_SELECTION_CHANGED}.rule`, () => {\r\n      if (this.isDynamicLeafHeight) {\r\n        this.update();\r\n      }\r\n    });\r\n    this.renderer.setDataProvider(data);\r\n    this.update();\r\n  }\r\n\r\n  setHighlight(dataIndex: number, scrollIntoView: boolean) {\r\n    return this.renderer.setHighlight(dataIndex, scrollIntoView);\r\n  }\r\n\r\n  getHighlight() {\r\n    return this.renderer.getHighlight();\r\n  }\r\n\r\n  enableHighlightListening(enable: boolean) {\r\n    this.renderer.enableHighlightListening(enable);\r\n  }\r\n}\r\n","import {IGroupData, IGroupItem, isGroup} from '../../model';\r\nimport {IRule} from './interfaces';\r\n\r\nexport default function spaceFillingRule(config: { groupHeight: number, rowHeight: number, groupPadding: number }) {\r\n  function levelOfDetail(item: IGroupData | IGroupItem, height: number): 'high' | 'low' {\r\n    const group = isGroup(item);\r\n    const maxHeight = group ? config.groupHeight : config.rowHeight;\r\n    if (height >= maxHeight * 0.9) {\r\n      return 'high';\r\n    }\r\n    return 'low';\r\n  }\r\n\r\n  function itemHeight(data: (IGroupData | IGroupItem)[], availableHeight: number, selection: Set<number>) {\r\n    const visibleHeight = availableHeight - config.rowHeight - 5; // some padding for hover\r\n    const items = <IGroupItem[]>data.filter((d) => !isGroup(d));\r\n    const groups = data.length - items.length;\r\n    const lastItems = items.reduce((a, d) => a + (d.meta === 'last' || d.meta === 'first last' ? 1 : 0), 0);\r\n    const selected = items.reduce((a, d) => a + (selection.has(d.i) ? 1 : 0), 0);\r\n    const unselected = items.length - selected;\r\n    const groupSeparators = groups + lastItems;\r\n\r\n    if (unselected <= 0) {\r\n      // doesn't matter since all are selected anyhow\r\n      return {height: config.rowHeight, violation: ''};\r\n    }\r\n    const available = visibleHeight - groups * config.groupHeight - groupSeparators * config.groupPadding - selected * config.rowHeight;\r\n\r\n    const height = available / unselected;\r\n    if (height < 1) {\r\n      return {\r\n        height: 1,\r\n        violation: `Not possible to fit all rows on the screen. Set filters or aggregate groups to make it fit again.`\r\n      };\r\n    }\r\n    // clamp to max height\r\n    if (height > config.rowHeight) {\r\n      return {\r\n        height: config.rowHeight,\r\n        violation: ``\r\n      };\r\n    }\r\n    return {height, violation: ''};\r\n  }\r\n\r\n  return <IRule>{\r\n    apply: (data: (IGroupData | IGroupItem)[], availableHeight: number, selection: Set<number>) => {\r\n\r\n      const {violation, height} = itemHeight(data, availableHeight, selection);\r\n\r\n      const item = (item: IGroupItem) => {\r\n        if (selection.has(item.i)) {\r\n          return config.rowHeight;\r\n        }\r\n        return height;\r\n      };\r\n      return {item, group: config.groupHeight, violation};\r\n    },\r\n    levelOfDetail\r\n  };\r\n}\r\n","// [[fill]align][sign][symbol][0][width][,][.precision][~][type]\nvar re = /^(?:(.)?([<>=^]))?([+\\-( ])?([$#])?(0)?(\\d+)?(,)?(\\.\\d+)?(~)?([a-z%])?$/i;\n\nexport default function formatSpecifier(specifier) {\n  if (!(match = re.exec(specifier))) throw new Error(\"invalid format: \" + specifier);\n  var match;\n  return new FormatSpecifier({\n    fill: match[1],\n    align: match[2],\n    sign: match[3],\n    symbol: match[4],\n    zero: match[5],\n    width: match[6],\n    comma: match[7],\n    precision: match[8] && match[8].slice(1),\n    trim: match[9],\n    type: match[10]\n  });\n}\n\nformatSpecifier.prototype = FormatSpecifier.prototype; // instanceof\n\nexport function FormatSpecifier(specifier) {\n  this.fill = specifier.fill === undefined ? \" \" : specifier.fill + \"\";\n  this.align = specifier.align === undefined ? \">\" : specifier.align + \"\";\n  this.sign = specifier.sign === undefined ? \"-\" : specifier.sign + \"\";\n  this.symbol = specifier.symbol === undefined ? \"\" : specifier.symbol + \"\";\n  this.zero = !!specifier.zero;\n  this.width = specifier.width === undefined ? undefined : +specifier.width;\n  this.comma = !!specifier.comma;\n  this.precision = specifier.precision === undefined ? undefined : +specifier.precision;\n  this.trim = !!specifier.trim;\n  this.type = specifier.type === undefined ? \"\" : specifier.type + \"\";\n}\n\nFormatSpecifier.prototype.toString = function() {\n  return this.fill\n      + this.align\n      + this.sign\n      + this.symbol\n      + (this.zero ? \"0\" : \"\")\n      + (this.width === undefined ? \"\" : Math.max(1, this.width | 0))\n      + (this.comma ? \",\" : \"\")\n      + (this.precision === undefined ? \"\" : \".\" + Math.max(0, this.precision | 0))\n      + (this.trim ? \"~\" : \"\")\n      + this.type;\n};\n","export function basis(t1, v0, v1, v2, v3) {\n  var t2 = t1 * t1, t3 = t2 * t1;\n  return ((1 - 3 * t1 + 3 * t2 - t3) * v0\n      + (4 - 6 * t2 + 3 * t3) * v1\n      + (1 + 3 * t1 + 3 * t2 - 3 * t3) * v2\n      + t3 * v3) / 6;\n}\n\nexport default function(values) {\n  var n = values.length - 1;\n  return function(t) {\n    var i = t <= 0 ? (t = 0) : t >= 1 ? (t = 1, n - 1) : Math.floor(t * n),\n        v1 = values[i],\n        v2 = values[i + 1],\n        v0 = i > 0 ? values[i - 1] : 2 * v1 - v2,\n        v3 = i < n - 1 ? values[i + 2] : 2 * v2 - v1;\n    return basis((t - i / n) * n, v0, v1, v2, v3);\n  };\n}\n","import {rgb as colorRgb} from \"d3-color\";\nimport basis from \"./basis.js\";\nimport basisClosed from \"./basisClosed.js\";\nimport nogamma, {gamma} from \"./color.js\";\n\nexport default (function rgbGamma(y) {\n  var color = gamma(y);\n\n  function rgb(start, end) {\n    var r = color((start = colorRgb(start)).r, (end = colorRgb(end)).r),\n        g = color(start.g, end.g),\n        b = color(start.b, end.b),\n        opacity = nogamma(start.opacity, end.opacity);\n    return function(t) {\n      start.r = r(t);\n      start.g = g(t);\n      start.b = b(t);\n      start.opacity = opacity(t);\n      return start + \"\";\n    };\n  }\n\n  rgb.gamma = rgbGamma;\n\n  return rgb;\n})(1);\n\nfunction rgbSpline(spline) {\n  return function(colors) {\n    var n = colors.length,\n        r = new Array(n),\n        g = new Array(n),\n        b = new Array(n),\n        i, color;\n    for (i = 0; i < n; ++i) {\n      color = colorRgb(colors[i]);\n      r[i] = color.r || 0;\n      g[i] = color.g || 0;\n      b[i] = color.b || 0;\n    }\n    r = spline(r);\n    g = spline(g);\n    b = spline(b);\n    color.opacity = 1;\n    return function(t) {\n      color.r = r(t);\n      color.g = g(t);\n      color.b = b(t);\n      return color + \"\";\n    };\n  };\n}\n\nexport var rgbBasis = rgbSpline(basis);\nexport var rgbBasisClosed = rgbSpline(basisClosed);\n","import {basis} from \"./basis.js\";\n\nexport default function(values) {\n  var n = values.length;\n  return function(t) {\n    var i = Math.floor(((t %= 1) < 0 ? ++t : t) * n),\n        v0 = values[(i + n - 1) % n],\n        v1 = values[i % n],\n        v2 = values[(i + 1) % n],\n        v3 = values[(i + 2) % n];\n    return basis((t - i / n) * n, v0, v1, v2, v3);\n  };\n}\n","import interval from \"./interval.js\";\nimport {durationDay, durationMinute} from \"./duration.js\";\n\nvar day = interval(function(date) {\n  date.setHours(0, 0, 0, 0);\n}, function(date, step) {\n  date.setDate(date.getDate() + step);\n}, function(start, end) {\n  return (end - start - (end.getTimezoneOffset() - start.getTimezoneOffset()) * durationMinute) / durationDay;\n}, function(date) {\n  return date.getDate() - 1;\n});\n\nexport default day;\nexport var days = day.range;\n","export {IDialogOptions, default as ADialog, IDialogContext} from './ADialog';\r\n","export {default as SidePanel, ISidePanelOptions} from './SidePanel';\r\nexport {default as SearchBox, IGroupSearchItem, IItem, ISearchBoxOptions} from './SearchBox';\r\n","import {IArrayDesc, IColumnDesc} from '../../model';\r\n\r\nexport default class ColumnBuilder<T extends IColumnDesc = IColumnDesc> {\r\n  protected readonly desc: T;\r\n\r\n  constructor(type: string, column: string) {\r\n    this.desc = <any>{column, type, label: column ? column[0].toUpperCase() + column.slice(1): type};\r\n  }\r\n\r\n  /**\r\n   * column label\r\n   */\r\n  label(label: string) {\r\n    this.desc.label = label;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * column description\r\n   */\r\n  description(description: string) {\r\n    this.desc.description = description;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * sets the frozen state of this column, i.e is sticky to the left side when scrolling horizontally\r\n   */\r\n  frozen() {\r\n    this.desc.frozen = true;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * specify the renderer to used for this column\r\n   * @param {string} renderer within a cell\r\n   * @param {string} groupRenderer within an aggregated cell\r\n   * @param {string} summaryRenderer within the summary in the header and side panel\r\n   */\r\n  renderer(renderer?: string, groupRenderer?: string, summaryRenderer?: string) {\r\n    if (renderer) {\r\n      this.desc.renderer = renderer;\r\n    }\r\n    if (groupRenderer) {\r\n      this.desc.groupRenderer = groupRenderer;\r\n    }\r\n    if (summaryRenderer) {\r\n      this.desc.summaryRenderer = summaryRenderer;\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * specify a custom additional attribute for the description\r\n   * @param {string} key the property key\r\n   * @param value its value\r\n   */\r\n  custom(key: string, value: any) {\r\n    (<any>this.desc)[key] = value;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * sets the default width of the column\r\n   */\r\n  width(width: number) {\r\n    this.desc.width = width;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * sets the column color in case of numerical columns\r\n   * @deprecated use colorMapping in the number case instead\r\n   */\r\n  color(_color: string) {\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * converts the column type to be an array type, supports only base types: boolean, categorical, date, number, and string\r\n   * @param {string[] | number} labels labels to use for each array item or the expected length of an value\r\n   */\r\n  asArray(labels?: string[] | number) {\r\n    console.assert(['boolean', 'categorical', 'date', 'number', 'string', 'link'].includes(this.desc.type!));\r\n    this.desc.type += 's';\r\n    const a = <IArrayDesc>this.desc;\r\n    if (Array.isArray(labels)) {\r\n      a.labels = labels;\r\n      a.dataLength = labels.length;\r\n    } else if (typeof labels === 'number') {\r\n      a.dataLength = labels;\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * converts the column type to be a map type, supports only base types: categorical, date, number, and string\r\n   */\r\n  asMap() {\r\n    console.assert(['categorical', 'date', 'number', 'string', 'link'].includes(this.desc.type!));\r\n    this.desc.type += 'Map';\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * build the column description\r\n   */\r\n  build(_data: any[]): T {\r\n    return <any>this.desc;\r\n  }\r\n}\r\n\r\n/**\r\n * build a column of a given type\r\n * @param {string} type column type\r\n * @param {string} column column which contains the associated data\r\n * @returns {ColumnBuilder<IColumnDesc>}\r\n */\r\nexport function buildColumn(type: string, column: string) {\r\n  return new ColumnBuilder(type, column);\r\n}\r\n","import {IDynamicHeight, ITaggleOptions} from '../interfaces';\r\nimport {IGroupData, IGroupItem} from '../model';\r\nimport Ranking from '../model/Ranking';\r\nimport {ICellRendererFactory} from '../renderer';\r\nimport {IToolbarAction, IToolbarDialogAddon} from '../ui';\r\n\r\n/**\r\n * builder for LineUp/Taggle instance\r\n */\r\nexport default class LineUpBuilder {\r\n  protected readonly options: Partial<ITaggleOptions> = {\r\n    renderers: {},\r\n    toolbar: {},\r\n    flags: {}\r\n  };\r\n\r\n  /**\r\n   * option to enable/disable animated transitions\r\n   * @default true\r\n   */\r\n  animated(enable: boolean) {\r\n    this.options.animated = enable;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * option to rotate labels on demand in narrow columns\r\n   * @param rotation rotation in degrees\r\n   * @default 0 - disabled\r\n   */\r\n  labelRotation(rotation: number) {\r\n    this.options.labelRotation = rotation;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * option to enable/disable the side panel\r\n   * @param {boolean} enable enable flag\r\n   * @param {boolean} collapsed whether collapsed by default\r\n   */\r\n  sidePanel(enable: boolean, collapsed: boolean = false) {\r\n    this.options.sidePanel = enable;\r\n    this.options.sidePanelCollapsed = collapsed;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * show the sorting and grouping hierarchy indicator in the side panel\r\n   * @param {boolean} enable enable flag\r\n   */\r\n  hierarchyIndicator(enable: boolean) {\r\n    this.options.hierarchyIndicator = enable;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * option to specify the default slope graph mode\r\n   * @default 'item'\r\n   */\r\n  defaultSlopeGraphMode(mode: 'item' | 'band') {\r\n    this.options.defaultSlopeGraphMode = mode;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * option to enable/disable showing a summary (histogram, ...) in the header\r\n   * @default true\r\n   */\r\n  summaryHeader(enable: boolean) {\r\n    this.options.summaryHeader = enable;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * option to enforce that the whole row is shown upon hover without overflow hidden\r\n   * @default false\r\n   */\r\n  expandLineOnHover(enable: boolean) {\r\n    this.options.expandLineOnHover = enable;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * option to enable overview mode by default, just valid when building a Taggle instance\r\n   * @returns {this}\r\n   */\r\n  overviewMode() {\r\n    this.options.overviewMode = true;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * option to ignore unsupported browser check - at own risk\r\n   * @returns {this}\r\n   */\r\n  ignoreUnsupportedBrowser() {\r\n    this.options.ignoreUnsupportedBrowser = true;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * register a new renderer factory function\r\n   * @param id the rederer id\r\n   * @param factory factory class implementing the renderer\r\n   */\r\n  registerRenderer(id: string, factory: ICellRendererFactory) {\r\n    this.options.renderers![id] = factory;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * register another toolbar action which can be used within a model class\r\n   * @param id toolbar id\r\n   * @param action\r\n   */\r\n  registerToolbarAction(id: string, action: IToolbarAction) {\r\n    this.options.toolbar![id] = action;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * register another toolbar action which can be sued within a model class\r\n   * @param id  dialog id\r\n   * @param addon addon description\r\n   */\r\n  registerToolbarDialogAddon(id: string, addon: IToolbarDialogAddon) {\r\n    this.options.toolbar![id] = addon;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * height and padding of a row\r\n   * @default 18 and 2\r\n   */\r\n  rowHeight(rowHeight: number, rowPadding: number) {\r\n    this.options.rowHeight = rowHeight;\r\n    this.options.rowPadding = rowPadding;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * height and padding of an aggregated group in pixel\r\n   * @default 40 and 5\r\n   */\r\n  groupRowHeight(groupHeight: number, groupPadding: number) {\r\n    this.options.groupHeight = groupHeight;\r\n    this.options.groupPadding = groupPadding;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * custom function to compute the height of a row (group or item)\r\n   * @param {(data: (IGroupItem | IGroupData)[], ranking: Ranking) => (IDynamicHeight | null)} callback\r\n   */\r\n  dynamicHeight(callback: (data: (IGroupItem | IGroupData)[], ranking: Ranking) => (IDynamicHeight | null)) {\r\n    this.options.dynamicHeight = callback;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * disables advanced ranking features (sort by, group by, sorting hierarchy, ...)\r\n   */\r\n  disableAdvancedRankingFeatures() {\r\n    this.options.flags!.advancedRankingFeatures = false;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * disables advanced model features (add combine column, data mapping, edit pattern, ...)\r\n   */\r\n  disableAdvancedModelFeatures() {\r\n    this.options.flags!.advancedModelFeatures = false;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * disables advanced ui features (change visualization, color mapping)\r\n   */\r\n  disableAdvancedUIFeatures() {\r\n    this.options.flags!.advancedUIFeatures = false;\r\n    return this;\r\n  }\r\n}\r\n","import {\r\n  createAggregateDesc, createGroupDesc, createImpositionBoxPlotDesc, createImpositionDesc, createImpositionsDesc,\r\n  createNestedDesc, createRankDesc, createReduceDesc, createScriptDesc, createSelectionDesc, createStackDesc,\r\n  EAdvancedSortMethod, IColumnDesc, ISortCriteria\r\n} from '../model';\r\nimport Column from '../model/Column';\r\nimport CompositeColumn from '../model/CompositeColumn';\r\nimport Ranking from '../model/Ranking';\r\nimport ReduceColumn from '../model/ReduceColumn';\r\nimport ScriptColumn from '../model/ScriptColumn';\r\nimport StackColumn from '../model/StackColumn';\r\nimport ADataProvider from '../provider/ADataProvider';\r\n\r\nexport interface IImposeColumnBuilder {\r\n  type: 'impose';\r\n  column: string;\r\n  label?: string;\r\n  categoricalColumn: string;\r\n}\r\n\r\nexport interface INestedBuilder {\r\n  type: 'nested';\r\n  label?: string;\r\n  columns: string[];\r\n}\r\n\r\nexport interface IWeightedSumBuilder {\r\n  type: 'weightedSum';\r\n  columns: string[];\r\n  label?: string;\r\n  weights: number[];\r\n}\r\n\r\nexport interface IReduceBuilder {\r\n  type: 'min' | 'max' | 'mean' | 'median';\r\n  columns: string[];\r\n  label?: string;\r\n}\r\n\r\nexport interface IScriptedBuilder {\r\n  type: 'script';\r\n  code: string;\r\n  columns: string[];\r\n  label?: string;\r\n}\r\n\r\n/**\r\n * builder for a ranking\r\n */\r\nexport default class RankingBuilder {\r\n  private static readonly ALL_MAGIC_FLAG = '*';\r\n\r\n  private readonly columns: (string | { desc: IColumnDesc | ((data: ADataProvider) => IColumnDesc), columns: string[], post?: (col: Column) => void })[] = [];\r\n  private readonly sort: { column: string, asc: boolean }[] = [];\r\n  private readonly groups: string[] = [];\r\n\r\n  /**\r\n   * specify another sorting criteria\r\n   * @param {string} column the column name optionally with encoded sorting separated by colon, e.g. a:desc\r\n   * @param {boolean | \"asc\" | \"desc\"} asc ascending or descending order\r\n   */\r\n  sortBy(column: string, asc: boolean | 'asc' | 'desc' = true) {\r\n    if (column.includes(':')) {\r\n      // encoded sorting order\r\n      const index = column.indexOf(':');\r\n      asc = <'asc' | 'desc'>column.slice(index + 1);\r\n      column = column.slice(0, index);\r\n    }\r\n    this.sort.push({column, asc: asc === true || String(asc)[0] === 'a'});\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * specify grouping criteria\r\n   * @returns {this}\r\n   */\r\n  groupBy(...columns: string[]) {\r\n    this.groups.push(...columns);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * add another column to this ranking, identified by column name or label. magic names are used for special columns:\r\n   * <ul>\r\n   *     <li>'*' = all columns</li>\r\n   *     <li>'_*' = all support columns</li>\r\n   *     <li>'_aggregate' = aggregate column</li>\r\n   *     <li>'_selection' = selection column</li>\r\n   *     <li>'_group' = group column</li>\r\n   *     <li>'_rank' = rank column</li>\r\n   * </ul>\r\n   * In addition build objects for combined columns are supported.\r\n   * @param {string | IImposeColumnBuilder | INestedBuilder | IWeightedSumBuilder | IReduceBuilder | IScriptedBuilder} column\r\n   */\r\n  column(column: string | IImposeColumnBuilder | INestedBuilder | IWeightedSumBuilder | IReduceBuilder | IScriptedBuilder) {\r\n    if (typeof column === 'string') {\r\n      switch (column) {\r\n        case '_aggregate':\r\n          return this.aggregate();\r\n        case '_selection':\r\n          return this.selection();\r\n        case '_group':\r\n          return this.group();\r\n        case '_rank':\r\n          return this.rank();\r\n        case '_*':\r\n          return this.supportTypes();\r\n        case '*':\r\n          return this.allColumns();\r\n      }\r\n      this.columns.push(column);\r\n      return this;\r\n    }\r\n    const label = column.label || null;\r\n    // builder ish\r\n    switch (column.type) {\r\n      case 'impose':\r\n        return this.impose(label, column.column, column.categoricalColumn);\r\n      case 'min':\r\n      case 'max':\r\n      case 'median':\r\n      case 'mean':\r\n        console.assert(column.columns.length >= 2);\r\n        return this.reduce(label, <any>column.type, column.columns[0], column.columns[1], ...column.columns.slice(2));\r\n      case 'nested':\r\n        console.assert(column.columns.length >= 1);\r\n        return this.nested(label, column.columns[0], ... column.columns.slice(1));\r\n      case 'script':\r\n        console.assert(column.columns.length >= 2);\r\n        return this.scripted(label, column.code, column.columns[0], column.columns[1], ...column.columns.slice(2));\r\n      case 'weightedSum':\r\n        console.assert(column.columns.length >= 2);\r\n        console.assert(column.columns.length === column.weights.length);\r\n        const mixed: (string | number)[] = [];\r\n        column.columns.slice(2).forEach((c, i) => {\r\n          mixed.push(c);\r\n          mixed.push(column.weights[i + 2]);\r\n        });\r\n        return this.weightedSum(label, column.columns[0], column.weights[0], column.columns[1], column.weights[1], ...mixed);\r\n    }\r\n    console.error('invalid column type: ', column);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * add an imposed column (numerical column colored by categorical column) to this ranking\r\n   * @param {string | null} label optional label\r\n   * @param {string} numberColumn numerical column reference\r\n   * @param {string} categoricalColumn categorical column reference\r\n   */\r\n  impose(label: string | null, numberColumn: string, categoricalColumn: string) {\r\n    this.columns.push({\r\n      desc: (data) => {\r\n        const base = data.getColumns().find((d) => d.label === numberColumn || (<any>d).column === numberColumn);\r\n        switch (base ? base.type : '') {\r\n          case 'boxplot':\r\n            return createImpositionBoxPlotDesc(label ? label : undefined);\r\n          case 'numbers':\r\n            return createImpositionsDesc(label ? label : undefined);\r\n          default:\r\n            return createImpositionDesc(label ? label : undefined);\r\n        }\r\n      },\r\n      columns: [numberColumn, categoricalColumn]\r\n    });\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * add a nested / group composite column\r\n   * @param {string | null} label optional label\r\n   * @param {string} column first element of the group enforcing not empty ones\r\n   * @param {string} columns additional columns\r\n   */\r\n  nested(label: string | null, column: string, ...columns: string[]) {\r\n    this.columns.push({\r\n      desc: createNestedDesc(label ? label : undefined),\r\n      columns: [column].concat(columns)\r\n    });\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * add a weighted sum / stack column\r\n   * @param {string | null} label optional label\r\n   * @param {string} numberColumn1 the first numerical column\r\n   * @param {number} weight1 its weight (0..1)\r\n   * @param {string} numberColumn2 the second numerical column\r\n   * @param {number} weight2 its weight (0..1)\r\n   * @param {string | number} numberColumnAndWeights alternating column weight references\r\n   */\r\n  weightedSum(label: string | null, numberColumn1: string, weight1: number, numberColumn2: string, weight2: number, ...numberColumnAndWeights: (string | number)[]) {\r\n    const weights = [weight1, weight2].concat(<number[]>numberColumnAndWeights.filter((_, i) => i % 2 === 1));\r\n    this.columns.push({\r\n      desc: createStackDesc(label ? label : undefined),\r\n      columns: [numberColumn1, numberColumn2].concat(<string[]>numberColumnAndWeights.filter((_, i) => i % 2 === 0)),\r\n      post: (col) => {\r\n        (<StackColumn>col).setWeights(weights);\r\n      }\r\n    });\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * add reducing column (min, max, median, mean, ...)\r\n   * @param {string | null} label optional label\r\n   * @param {EAdvancedSortMethod} operation operation to apply (min, max, median, mean, ...)\r\n   * @param {string} numberColumn1 first numerical column\r\n   * @param {string} numberColumn2 second numerical column\r\n   * @param {string} numberColumns additional numerical columns\r\n   */\r\n  reduce(label: string | null, operation: EAdvancedSortMethod, numberColumn1: string, numberColumn2: string, ...numberColumns: string[]) {\r\n    this.columns.push({\r\n      desc: createReduceDesc(label ? label : undefined),\r\n      columns: [numberColumn1, numberColumn2].concat(numberColumns),\r\n      post: (col) => {\r\n        (<ReduceColumn>col).setReduce(operation);\r\n      }\r\n    });\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * add a scripted / formula column\r\n   * @param {string | null} label optional label\r\n   * @param {string} code the JS code see ScriptColumn for details\r\n   * @param {string} numberColumn1 first numerical column\r\n   * @param {string} numberColumn2 second numerical column\r\n   * @param {string} numberColumns additional numerical columns\r\n   */\r\n  scripted(label: string | null, code: string, numberColumn1: string, numberColumn2: string, ...numberColumns: string[]) {\r\n    this.columns.push({\r\n      desc: createScriptDesc(label ? label : undefined),\r\n      columns: [numberColumn1, numberColumn2].concat(numberColumns),\r\n      post: (col) => {\r\n        (<ScriptColumn>col).setScript(code);\r\n      }\r\n    });\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * add a selection column for easier multi selections\r\n   */\r\n  selection() {\r\n    this.columns.push({\r\n      desc: createSelectionDesc(),\r\n      columns: []\r\n    });\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * add a group column to show the current group name\r\n   */\r\n  group() {\r\n    this.columns.push({\r\n      desc: createGroupDesc(),\r\n      columns: []\r\n    });\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * add an aggregate column to this ranking to collapse/expand groups\r\n   */\r\n  aggregate() {\r\n    this.columns.push({\r\n      desc: createAggregateDesc(),\r\n      columns: []\r\n    });\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * add a ranking column\r\n   */\r\n  rank() {\r\n    this.columns.push({\r\n      desc: createRankDesc(),\r\n      columns: []\r\n    });\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * add suporttypes (aggregate, rank, selection) to the ranking\r\n   */\r\n  supportTypes() {\r\n    return this.aggregate().rank().selection();\r\n  }\r\n\r\n  /**\r\n   * add all columns to this ranking\r\n   */\r\n  allColumns() {\r\n    this.columns.push(RankingBuilder.ALL_MAGIC_FLAG);\r\n    return this;\r\n  }\r\n\r\n  build(data: ADataProvider): Ranking {\r\n    const r = data.pushRanking();\r\n    const cols = data.getColumns();\r\n\r\n    const findDesc = (c: string) => cols.find((d) => d.label === c || (<any>d).column === c);\r\n\r\n    const addColumn = (c: string) => {\r\n      const desc = findDesc(c);\r\n      if (desc) {\r\n        return data.push(r, desc) != null;\r\n      }\r\n      console.warn('invalid column: ', c);\r\n      return false;\r\n    };\r\n\r\n    this.columns.forEach((c) => {\r\n      if (c === RankingBuilder.ALL_MAGIC_FLAG) {\r\n        cols.forEach((col) => data.push(r, col));\r\n        return;\r\n      }\r\n      if (typeof c === 'string') {\r\n        addColumn(c);\r\n        return;\r\n      }\r\n      const col = data.create(typeof c.desc === 'function' ? c.desc(data) : c.desc)!;\r\n      r.push(col);\r\n      c.columns.forEach((ci) => {\r\n        const d = findDesc(ci);\r\n        const child = d ? data.create(d) : null;\r\n        if (!child) {\r\n          console.warn('invalid column: ', ci);\r\n          return;\r\n        }\r\n        (<CompositeColumn>col).push(child);\r\n      });\r\n      if (c.post) {\r\n        c.post(col);\r\n      }\r\n    });\r\n\r\n    const children = r.children;\r\n    {\r\n      const groups: Column[] = [];\r\n      this.groups.forEach((column) => {\r\n        const col = children.find((d) => d.desc.label === column || (<any>d).desc.column === column);\r\n        if (col) {\r\n          groups.push(col);\r\n          return;\r\n        }\r\n        const desc = findDesc(column);\r\n        if (desc && data.push(r, desc)) {\r\n          return;\r\n        }\r\n        console.warn('invalid group criteria column: ', column);\r\n      });\r\n      if (groups.length > 0) {\r\n        r.setGroupCriteria(groups);\r\n      }\r\n    }\r\n    {\r\n      const sorts: ISortCriteria[] = [];\r\n      this.sort.forEach(({column, asc}) => {\r\n        const col = children.find((d) => d.desc.label === column || (<any>d).desc.column === column);\r\n        if (col) {\r\n          sorts.push({col, asc});\r\n          return;\r\n        }\r\n        const desc = findDesc(column);\r\n        if (desc && data.push(r, desc)) {\r\n          return;\r\n        }\r\n        console.warn('invalid sort criteria column: ', column);\r\n      });\r\n      if (sorts.length > 0) {\r\n        r.setSortCriteria(sorts);\r\n      }\r\n    }\r\n    return r;\r\n  }\r\n}\r\n\r\n/**\r\n * creates a new instance of a ranking builder\r\n * @returns {RankingBuilder}\r\n */\r\nexport function buildRanking() {\r\n  return new RankingBuilder();\r\n}\r\n","import {IColumnDesc} from '../model';\r\nimport Column from '../model/Column';\r\nimport {deriveColors, deriveColumnDescriptions, IDataProviderOptions, ILocalDataProviderOptions} from '../provider';\r\nimport ADataProvider from '../provider/ADataProvider';\r\nimport LocalDataProvider from '../provider/LocalDataProvider';\r\nimport LineUp from '../ui/LineUp';\r\nimport Taggle from '../ui/taggle/Taggle';\r\nimport ColumnBuilder from './column/ColumnBuilder';\r\nimport LineUpBuilder from './LineUpBuilder';\r\nimport RankingBuilder from './RankingBuilder';\r\n\r\n/**\r\n * builder for a LocalDataProvider along with LineUp configuration options\r\n */\r\nexport default class DataBuilder extends LineUpBuilder {\r\n  private readonly columns: (IColumnDesc | ((data: any[]) => IColumnDesc))[] = [];\r\n  private readonly providerOptions: Partial<ILocalDataProviderOptions & IDataProviderOptions> = {\r\n    columnTypes: {}\r\n  };\r\n\r\n  private readonly rankBuilders: ((data: ADataProvider) => void)[] = [];\r\n  private _deriveColors: boolean = false;\r\n\r\n  constructor(private readonly data: object[]) {\r\n    super();\r\n  }\r\n\r\n  /**\r\n   * allow just a single selection\r\n   */\r\n  singleSelection() {\r\n    this.providerOptions.multiSelection = false;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * filter all rankings by all filters in LineUp\r\n   */\r\n  filterGlobally() {\r\n    this.providerOptions.filterGlobally = true;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * no limits for the number of sorting and grouping criteria\r\n   */\r\n  noCriteriaLimits() {\r\n    this.providerOptions.maxGroupColumns = Infinity;\r\n    this.providerOptions.maxNestedSortingCriteria = Infinity;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * limit the number of sort and grouping criterias i.e the nesting level\r\n   * @param {number} sortingCritera\r\n   * @param {number} groupingCriteria\r\n   * @returns {this}\r\n   */\r\n  limitCriteria(sortingCritera: number, groupingCriteria: number) {\r\n    this.providerOptions.maxGroupColumns = sortingCritera;\r\n    this.providerOptions.maxNestedSortingCriteria = groupingCriteria;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * triggers to derive the column descriptions for the given data\r\n   * @param {string} columns optional enforced order of columns\r\n   */\r\n  deriveColumns(...columns: string[]) {\r\n    this.columns.push(...deriveColumnDescriptions(this.data, {columns}));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * tirggers to assign colors for the given descriptions\r\n   */\r\n  deriveColors() {\r\n    this._deriveColors = true;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * register another column type to this data provider\r\n   * @param {string} type unique type id\r\n   * @param {typeof Column} clazz column class\r\n   */\r\n  registerColumnType(type: string, clazz: typeof Column) {\r\n    this.providerOptions.columnTypes![type] = clazz;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * push another column description to this data provider\r\n   * @param {IColumnDesc | ColumnBuilder} column column description or builder instance\r\n   */\r\n  column(column: IColumnDesc | ColumnBuilder) {\r\n    this.columns.push(column instanceof ColumnBuilder ? column.build.bind(column) : column);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * restores a given ranking dump\r\n   * @param dump dump as created using '.dump()'\r\n   */\r\n  restore(dump: any) {\r\n    this.rankBuilders.push((data) => data.restore(dump));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * add the default ranking (all columns) to this data provider\r\n   * @param {boolean} addSupportTypes add support types, too, default: true\r\n   */\r\n  defaultRanking(addSupportTypes: boolean = true) {\r\n    this.rankBuilders.push((data) => data.deriveDefault(addSupportTypes));\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * add another ranking to this data provider\r\n   * @param {((data: ADataProvider) => void) | RankingBuilder} builder ranking builder\r\n   */\r\n  ranking(builder: ((data: ADataProvider) => void) | RankingBuilder) {\r\n    this.rankBuilders.push(builder instanceof RankingBuilder ? builder.build.bind(builder) : builder);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * builds the data provider itself\r\n   * @returns {LocalDataProvider}\r\n   */\r\n  buildData() {\r\n    const columns = this.columns.map((d) => typeof d === 'function' ? d(this.data) : d);\r\n    if (this._deriveColors) {\r\n      deriveColors(columns);\r\n    }\r\n    const r = new LocalDataProvider(this.data, columns, this.providerOptions);\r\n    if (this.rankBuilders.length === 0) {\r\n      this.defaultRanking();\r\n    }\r\n    this.rankBuilders.forEach((builder) => builder(r));\r\n    return r;\r\n  }\r\n\r\n  /**\r\n   * builds LineUp at the given parent DOM node\r\n   * @param {HTMLElement} node parent DOM node to attach\r\n   * @returns {LineUp}\r\n   */\r\n  build(node: HTMLElement) {\r\n    return new LineUp(node, this.buildData(), this.options);\r\n  }\r\n\r\n  /**\r\n   * builds Taggle at the given parent DOM node\r\n   * @param {HTMLElement} node parent DOM node to attach\r\n   * @returns {Taggle}\r\n   */\r\n  buildTaggle(node: HTMLElement) {\r\n    return new Taggle(node, this.buildData(), this.options);\r\n  }\r\n}\r\n\r\n\r\n/**\r\n * creates a new builder instance for the given data\r\n * @param {object[]} arr data to visualize\r\n * @returns {DataBuilder}\r\n */\r\nexport function builder(arr: object[]) {\r\n  return new DataBuilder(arr);\r\n}\r\n","import {ICategoricalColumnDesc, ICategory} from '../../model';\r\nimport ColumnBuilder from './ColumnBuilder';\r\nimport {cleanCategories} from '../../provider/utils';\r\nimport {resolveValue} from '../../internal/accessor';\r\n\r\nexport default class CategoricalColumnBuilder extends ColumnBuilder<ICategoricalColumnDesc> {\r\n\r\n  constructor(column: string) {\r\n    super('categorical', column);\r\n  }\r\n\r\n  /**\r\n   * converts this type to an ordinal column type, such that categories are mapped to numbers\r\n   */\r\n  asOrdinal() {\r\n    this.desc.type = 'ordinal';\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * specify the categories of this categorical column\r\n   * @param {(string | Partial<ICategory>)[]} categories\r\n   */\r\n  categories(categories: (string | Partial<ICategory>)[]) {\r\n    this.desc.categories = categories;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * define the category to use in case of missing or null values\r\n   * @param {string | Partial<ICategory>} missingCategory\r\n   */\r\n  missingCategory(missingCategory: (string | Partial<ICategory>)) {\r\n    this.desc.missingCategory = missingCategory;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * converts this type to a set column, i.e. multiple unique category in a value\r\n   * @param {string} separator optional separator separating a string value\r\n   */\r\n  asSet(separator?: string) {\r\n    if (separator) {\r\n      (<any>this.desc).separator = separator;\r\n    }\r\n    this.desc.type = 'set';\r\n    return this;\r\n  }\r\n\r\n  private derive(data: any[]) {\r\n    // derive categories\r\n    const categories = new Set<string>();\r\n    const isSet = this.desc.type === 'set';\r\n    const separator = (<any>this.desc).separator || ';';\r\n    const val = (vi: any) => {\r\n      if (typeof vi === 'string' && vi !== '') {\r\n        return vi;\r\n      }\r\n      if (vi != null && typeof vi.value === 'string' && vi.value !== '') {\r\n        return vi.value;\r\n      }\r\n      return null;\r\n    };\r\n    data.forEach((d) => {\r\n      const v = resolveValue(d, (<any>this.desc).column);\r\n      if (Array.isArray(v)) {\r\n        v.forEach((vi) => categories.add(val(vi)));\r\n      } else if (v != null && v !== '') {\r\n        const vs: string[] = isSet ? [v.toString()] : v.toString().split(separator);\r\n        vs.forEach((vi) => categories.add(val(vi)));\r\n      }\r\n    });\r\n    this.categories(cleanCategories(categories));\r\n  }\r\n\r\n  build(data: any[]): ICategoricalColumnDesc {\r\n    if (!this.desc.categories) {\r\n      this.derive(data);\r\n    }\r\n    return super.build(data);\r\n  }\r\n}\r\n\r\n/**\r\n * build a categorical column type\r\n * @param {string} column column which contains the associated data\r\n * @param {(string | Partial<ICategory>)[]} categories optional category definition\r\n * @returns {CategoricalColumnBuilder}\r\n */\r\nexport function buildCategoricalColumn(column: string, categories?: (string | Partial<ICategory>)[]) {\r\n  const r = new CategoricalColumnBuilder(column);\r\n  if (categories) {\r\n    r.categories(categories);\r\n  }\r\n  return r;\r\n}\r\n","import {min, max} from 'd3-array';\r\nimport {EAdvancedSortMethod, ESortMethod, INumberColumnDesc, IMapAbleDesc} from '../../model';\r\nimport ColumnBuilder from './ColumnBuilder';\r\nimport {resolveValue} from '../../internal/accessor';\r\n\r\nexport default class NumberColumnBuilder extends ColumnBuilder<INumberColumnDesc> {\r\n\r\n  constructor(column: string) {\r\n    super('number', column);\r\n  }\r\n\r\n  /**\r\n   * defines the mapping for this number column to normalize the data\r\n   * @param {\"linear\" | \"sqrt\" | \"pow1.1\" | \"pow2\" | \"pow3\"} type mapping type\r\n   * @param {[number , number]} domain input data domain [min, max]\r\n   * @param {[number , number]} range optional output domain [0, 1]\r\n   */\r\n  mapping(type: 'linear' | 'sqrt' | 'pow1.1' | 'pow2' | 'pow3', domain: [number, number], range?: [number, number]) {\r\n    if (type === 'linear') {\r\n      this.desc.domain = domain;\r\n      if (range) {\r\n        this.desc.range = range;\r\n      }\r\n      return;\r\n    }\r\n    this.desc.map = {\r\n      type, domain, range: range || [0, 1]\r\n    };\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * sets the column color in case of numerical columns\r\n   * @deprecated use colorMapping instead\r\n   */\r\n  color(color: string) {\r\n    return this.colorMapping(color);\r\n  }\r\n\r\n  colorMapping(type: string | ((v: number)=>string) | any) {\r\n    (<IMapAbleDesc>this.desc).colorMapping = type;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * defines a script to normalize the data, see ScriptedMappingFunction for details\r\n   * @param {string} code the code to execute\r\n   * @param {[number , number]} domain the input data domain [min, max]\r\n   */\r\n  scripted(code: string, domain: [number, number]) {\r\n    this.desc.map = {domain, code, type: 'script'};\r\n    return this;\r\n  }\r\n\r\n\r\n  /**\r\n   * @inheritDoc\r\n   * @param {string[] | number} labels labels to use for each array item or the expected length of an value\r\n   * @param {EAdvancedSortMethod} sort sorting criteria when sorting by this column\r\n   */\r\n  asArray(labels?: string[] | number, sort?: EAdvancedSortMethod) {\r\n    if (sort) {\r\n      (<any>this.desc).sort = sort;\r\n    }\r\n    return super.asArray(labels);\r\n  }\r\n\r\n  /**\r\n   * @inheritDoc\r\n   * @param {EAdvancedSortMethod} sort sorting criteria when sorting by this column\r\n   */\r\n  asMap(sort?: EAdvancedSortMethod) {\r\n    if (sort) {\r\n      (<any>this.desc).sort = sort;\r\n    }\r\n    return super.asMap();\r\n  }\r\n\r\n  /**\r\n   * converts type to a boxplot column type\r\n   * @param {ESortMethod} sort sorting criteria when sorting by this column\r\n   */\r\n  asBoxPlot(sort?: ESortMethod) {\r\n    if (sort) {\r\n      (<any>this.desc).sort = sort;\r\n    }\r\n    this.desc.type = 'boxplot';\r\n    return this;\r\n  }\r\n\r\n  private derive(data: any[]) {\r\n    const col = (<any>this.desc).column;\r\n\r\n    const asArray = (v: any, extra: string) => {\r\n      const vs: number[] = [];\r\n      (Array.isArray(v) ? v : [v]).forEach((vi) => {\r\n        if (typeof vi === 'number' && !isNaN(vi)) {\r\n          vs.push(vi);\r\n        }\r\n        if (vi != null && typeof vi.value === 'number' && !isNaN(vi.value)) {\r\n          vs.push(vi.value);\r\n        }\r\n        if (vi != null && typeof vi[extra] === 'number' && !isNaN(vi[extra])) {\r\n          vs.push(vi[extra]);\r\n        }\r\n      });\r\n      return vs;\r\n    };\r\n\r\n    const minv = min(data, (d) => {\r\n      const v = resolveValue(d, col);\r\n      const vs: number[] = asArray(v, 'min');\r\n      return vs.length === 0 ? Infinity : min(vs);\r\n    });\r\n    const maxv = max(data, (d) => {\r\n      const v = resolveValue(d, col);\r\n      const vs: number[] = asArray(v, 'max');\r\n      return vs.length === 0 ? -Infinity : max(vs);\r\n    });\r\n    return <[number, number]>[minv, maxv];\r\n  }\r\n\r\n\r\n  build(data: any[]): INumberColumnDesc {\r\n    if (!this.desc.map && !this.desc.domain) {\r\n      // derive domain\r\n      this.mapping('linear', this.derive(data));\r\n    } else {\r\n      const d = this.desc.domain || this.desc.map!.domain;\r\n      if (isNaN(d[0]) || isNaN(d[1])) {\r\n        const ext = this.derive(data);\r\n        if (isNaN(d[0])) {\r\n          d[0] = ext[0];\r\n        }\r\n        if (isNaN(d[1])) {\r\n          d[1] = ext[1];\r\n        }\r\n      }\r\n    }\r\n    return super.build(data);\r\n  }\r\n}\r\n\r\n/**\r\n * builds numerical column builder\r\n * @param {string} column column which contains the associated data\r\n * @param {[number , number]} domain domain (min, max) of this column\r\n * @returns {NumberColumnBuilder}\r\n */\r\nexport function buildNumberColumn(column: string, domain?: [number, number]) {\r\n  const r = new NumberColumnBuilder(column);\r\n  if (domain) {\r\n    r.mapping('linear', domain);\r\n  }\r\n  return r;\r\n}\r\n","import {EAlignment, ILinkColumnDesc} from '../../model';\r\nimport ColumnBuilder from './ColumnBuilder';\r\n\r\nexport default class StringColumnBuilder extends ColumnBuilder<ILinkColumnDesc> {\r\n\r\n  constructor(column: string) {\r\n    super('string', column);\r\n  }\r\n\r\n  /**\r\n   * makes the text editable within a cell and switches to the annotate type\r\n   */\r\n  editable() {\r\n    this.desc.type = 'annotate';\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * changes the alignment of the column\r\n   */\r\n  alignment(align: EAlignment) {\r\n    this.desc.alignment = align;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * allow html text as values\r\n   */\r\n  html() {\r\n    this.desc.escape = false;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * provide a pattern with which the value will be wrapped, use <code>${value}</code> for the current and and <code>${item}</code> for the whole item\r\n   * @param {string} pattern pattern to apply\r\n   * @param {string[]} templates optional templates for patterns to provide in the edit pattern dialog\r\n   */\r\n  pattern(pattern: string, templates?: string[]) {\r\n    this.desc.type = 'link';\r\n    this.desc.pattern = pattern;\r\n    if (templates) {\r\n      this.desc.patternTemplates = templates;\r\n    }\r\n    return this;\r\n  }\r\n}\r\n\r\n/**\r\n * builds a string column builder\r\n * @param {string} column column which contains the associated data\r\n * @returns {StringColumnBuilder}\r\n */\r\nexport function buildStringColumn(column: string) {\r\n  return new StringColumnBuilder(column);\r\n}\r\n","import {IDateColumnDesc} from '../../model';\r\nimport ColumnBuilder from './ColumnBuilder';\r\n\r\nexport default class DateColumnBuilder extends ColumnBuilder<IDateColumnDesc> {\r\n\r\n  constructor(column: string) {\r\n    super('date', column);\r\n  }\r\n\r\n  /**\r\n   * specify the format and parsing d3-time pattern to convert Date to strings and vise versa\r\n   * @param {string} format d3-time-format pattern\r\n   * @param {string} parse optional different parsing pattern\r\n   */\r\n  format(format: string, parse?: string) {\r\n    this.desc.dateFormat = format;\r\n    if (parse) {\r\n      this.desc.dateParse = parse;\r\n    }\r\n    return this;\r\n  }\r\n\r\n}\r\n\r\n/**\r\n * builds a date column builder\r\n * @param {string} column column which contains the associated data\r\n * @returns {DateColumnBuilder}\r\n */\r\nexport function buildDateColumn(column: string) {\r\n  return new DateColumnBuilder(column);\r\n}\r\n","import {IHierarchyColumnDesc, IPartialCategoryNode} from '../../model';\r\nimport ColumnBuilder from './ColumnBuilder';\r\n\r\nexport default class HierarchyColumnBuilder extends ColumnBuilder<IHierarchyColumnDesc> {\r\n\r\n  constructor(column: string) {\r\n    super('hierarchy', column);\r\n  }\r\n\r\n  /**\r\n   * specify the underlying hierarchy of this column\r\n   * @param {IPartialCategoryNode} hierarchy\r\n   * @param {string} hierarchySeparator specify the character to separate levels (default dot)\r\n   */\r\n  hierarchy(hierarchy: IPartialCategoryNode, hierarchySeparator?: string) {\r\n    this.desc.hierarchy = hierarchy;\r\n    if (hierarchySeparator) {\r\n      this.desc.hierarchySeparator = hierarchySeparator;\r\n    }\r\n    return this;\r\n  }\r\n\r\n  build(data: any[]): IHierarchyColumnDesc {\r\n    console.assert(Boolean(this.desc.hierarchy));\r\n    return super.build(data);\r\n  }\r\n}\r\n\r\n/**\r\n * build a hierarchical column builder\r\n * @param {string} column column which contains the associated data\r\n * @param {IPartialCategoryNode} hierarchy\r\n * @returns {HierarchyColumnBuilder}\r\n */\r\nexport function buildHierarchicalColumn(column: string, hierarchy?: IPartialCategoryNode) {\r\n  const r = new HierarchyColumnBuilder(column);\r\n  if (hierarchy) {\r\n    r.hierarchy(hierarchy);\r\n  }\r\n  return r;\r\n}\r\n","import {IActionColumnDesc, IAction, IGroupAction} from '../../model';\r\nimport ColumnBuilder from './ColumnBuilder';\r\n\r\nexport default class ActionsColumnBuilder extends ColumnBuilder<IActionColumnDesc> {\r\n\r\n  constructor() {\r\n    super('actions', '');\r\n  }\r\n\r\n  /**\r\n   * adds another action\r\n   * @param action the action\r\n   */\r\n  action(action: IAction) {\r\n    return this.actions([action]);\r\n  }\r\n\r\n  /**\r\n   * adds multiple actions\r\n   * @param actions list of actions\r\n   */\r\n  actions(actions: IAction[]) {\r\n    if (!this.desc.actions) {\r\n      this.desc.actions = [];\r\n    }\r\n    this.desc.actions!.push(...actions);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * adds another action that is shown in group rows\r\n   * @param action the action\r\n   */\r\n  groupAction(action: IGroupAction) {\r\n    return this.groupActions([action]);\r\n  }\r\n\r\n  /**\r\n   * add multiple group actions that are shown in group rows\r\n   * @param actions list of actions\r\n   */\r\n  groupActions(actions: IGroupAction[]) {\r\n    if (!this.desc.groupActions) {\r\n      this.desc.groupActions = [];\r\n    }\r\n    this.desc.groupActions!.push(...actions);\r\n    return this;\r\n  }\r\n}\r\n\r\n/**\r\n * builds a actions column builder\r\n * @returns {ActionsColumnBuilder}\r\n */\r\nexport function buildActionsColumn() {\r\n  return new ActionsColumnBuilder();\r\n}\r\n","import {extent} from 'd3-array';\r\nimport {\r\n  EAdvancedSortMethod,\r\n  IAction,\r\n  IGroupAction,\r\n  IArrayDesc,\r\n  ICategoricalColumnDesc,\r\n  ICategory,\r\n  IColumnDesc,\r\n  IDateColumnDesc,\r\n  IHierarchyColumnDesc,\r\n  INumberColumnDesc,\r\n  IPartialCategoryNode,\r\n  IActionColumnDesc,\r\n  ILinkColumnDesc\r\n} from '../../model';\r\nimport {resolveValue} from '../../internal/accessor';\r\n\r\nexport interface IBuilderAdapterColumnDescProps extends Partial<IColumnDesc> {\r\n  column: string;\r\n  asMap?: boolean;\r\n  asArray?: string[] | number | boolean;\r\n  custom?: { [key: string]: any };\r\n}\r\n\r\nexport function build<T extends IBuilderAdapterColumnDescProps>(props: T, _data?: any[]): IColumnDesc {\r\n  const {column} = props;\r\n  const desc = <any>{column, type: props.type, label: column ? column[0].toUpperCase() + column.slice(1) : props.type};\r\n\r\n  (<(keyof IBuilderAdapterColumnDescProps)[]>['label', 'description', 'frozen', 'width', 'renderer', 'groupRenderer', 'summaryRenderer', 'visible', 'fixed']).forEach((key) => {\r\n    if (props.hasOwnProperty(key)) {\r\n      desc[key] = props[key];\r\n    }\r\n  });\r\n\r\n  if (props.custom) { // merge custom attributes\r\n    Object.assign(desc, props.custom);\r\n  }\r\n\r\n  if (props.asMap) {\r\n    console.assert(['categorical', 'date', 'number', 'string', 'link'].includes(desc.type!));\r\n    desc.type += 'Map';\r\n  }\r\n\r\n  if (props.asArray != null) {\r\n    console.assert(['boolean', 'categorical', 'date', 'number', 'string', 'link'].includes(desc.type!));\r\n    desc.type += 's';\r\n    const a = <IArrayDesc>desc;\r\n    const labels = props.asArray;\r\n    if (Array.isArray(labels)) {\r\n      a.labels = labels;\r\n      a.dataLength = labels.length;\r\n    } else if (typeof labels === 'number') {\r\n      a.dataLength = labels;\r\n    }\r\n  }\r\n\r\n  return <any>desc;\r\n}\r\n\r\n\r\nexport interface IBuilderAdapterCategoricalColumnDescProps extends IBuilderAdapterColumnDescProps {\r\n  asOrdinal?: boolean;\r\n  categories?: (string | Partial<ICategory>)[];\r\n  missingCategory?: (string | Partial<ICategory>);\r\n  asSet?: boolean | string;\r\n}\r\n\r\nexport function buildCategorical(props: IBuilderAdapterCategoricalColumnDescProps, data: any[]): ICategoricalColumnDesc {\r\n  const desc: any = build({...props, type: 'categorical'});\r\n\r\n  if (props.asOrdinal) {\r\n    desc.type = 'ordinal';\r\n  }\r\n  if (props.missingCategory) {\r\n    desc.missingCategory = props.missingCategory;\r\n  }\r\n  if (props.asSet) {\r\n    if (typeof props.asSet === 'string') {\r\n      (<any>desc).separator = props.asSet;\r\n    }\r\n    desc.type = 'set';\r\n  }\r\n\r\n\r\n  if (!props.categories) {\r\n    // derive categories\r\n    const categories = new Set(data.map((d) => <string>resolveValue(d, (<any>desc).column)));\r\n    desc.categories = Array.from(categories).sort();\r\n  } else {\r\n    desc.categories = props.categories;\r\n  }\r\n  return desc;\r\n}\r\n\r\nexport interface IBuilderAdapterDateColumnDescProps extends IBuilderAdapterColumnDescProps {\r\n  dateFormat?: string;\r\n  dateParse?: string;\r\n}\r\n\r\nexport function buildDate(props: IBuilderAdapterDateColumnDescProps): IDateColumnDesc {\r\n  const desc: any = build({...props, type: 'date'});\r\n\r\n  (<(keyof IBuilderAdapterDateColumnDescProps)[]>['dateFormat', 'dateParse']).forEach((key) => {\r\n    if (props.hasOwnProperty(key)) {\r\n      desc[key] = props[key];\r\n    }\r\n  });\r\n  return desc;\r\n}\r\n\r\nexport interface IBuilderAdapterHierarchyColumnDescProps extends IBuilderAdapterColumnDescProps {\r\n  hierarchy: IPartialCategoryNode;\r\n  hierarchySeparator?: string;\r\n}\r\n\r\nexport function buildHierarchy(props: Partial<IBuilderAdapterHierarchyColumnDescProps>): IHierarchyColumnDesc {\r\n  const desc: any = build({...(<any>props), type: 'hierarchy'});\r\n\r\n  (<(keyof IBuilderAdapterHierarchyColumnDescProps)[]>['hierarchy', 'hierarchySeparator']).forEach((key) => {\r\n    if (props.hasOwnProperty(key)) {\r\n      desc[key] = props[key];\r\n    }\r\n  });\r\n  return desc;\r\n}\r\n\r\nexport interface IBuilderAdapterNumberColumnDescProps extends IBuilderAdapterColumnDescProps {\r\n  domain?: [number, number];\r\n  range?: [number, number];\r\n  mapping?: 'linear' | 'sqrt' | 'pow1.1' | 'pow2' | 'pow3';\r\n  scripted?: string;\r\n  sort?: EAdvancedSortMethod;\r\n  colorMapping?: string;\r\n}\r\n\r\nexport function buildNumber(props: IBuilderAdapterNumberColumnDescProps, data: any[]): INumberColumnDesc {\r\n  const desc: any = build({...props, type: 'number'});\r\n\r\n  const domain = props.domain ? props.domain : <[number, number]>extent(data, (d) => <number>resolveValue(d, (<any>desc).column));\r\n\r\n  if (props.hasOwnProperty('color')) {\r\n    desc.colorMapping = props.color;\r\n  }\r\n  (<(keyof IBuilderAdapterNumberColumnDescProps)[]>['sort', 'colorMapping']).forEach((key) => {\r\n    if (props.hasOwnProperty(key)) {\r\n      desc[key] = props[key];\r\n    }\r\n  });\r\n  if (props.scripted) {\r\n    desc.map = {domain, code: props.scripted, type: 'script'};\r\n  } else if (!props.mapping || props.mapping === 'linear') {\r\n    desc.domain = domain;\r\n    if (props.range) {\r\n      desc.range = props.range;\r\n    }\r\n  } else {\r\n    desc.map = {\r\n      type: props.mapping,\r\n      domain,\r\n      range: props.range || [0, 1]\r\n    };\r\n  }\r\n  return desc;\r\n}\r\n\r\nexport interface IBuilderAdapterStringColumnDescProps extends IBuilderAdapterColumnDescProps {\r\n  editable?: boolean;\r\n  html?: boolean;\r\n  pattern?: string;\r\n  patternTemplates?: string[];\r\n}\r\n\r\nexport function buildString(props: IBuilderAdapterStringColumnDescProps): ILinkColumnDesc {\r\n  const desc: any = build({...props, type: 'string'});\r\n\r\n  (<(keyof IBuilderAdapterStringColumnDescProps)[]>['pattern', 'patternTemplate', 'alignment']).forEach((key) => {\r\n    if (props.hasOwnProperty(key)) {\r\n      desc[key] = props[key];\r\n    }\r\n  });\r\n  if (props.editable) {\r\n    desc.type = 'annotate';\r\n  }\r\n  if (props.pattern) {\r\n    desc.type = 'link';\r\n  }\r\n  if (props.html) {\r\n    desc.escape = false;\r\n  }\r\n  return desc;\r\n}\r\n\r\nexport interface IBuilderAdapterActionsColumnDescProps extends IBuilderAdapterColumnDescProps {\r\n  actions?: IAction[];\r\n  groupActions?: IGroupAction[];\r\n}\r\n\r\nexport function buildActions(props: IBuilderAdapterActionsColumnDescProps): IActionColumnDesc {\r\n  const desc: any = build({...props, type: 'actions'});\r\n\r\n  (<(keyof IBuilderAdapterActionsColumnDescProps)[]>['actions', 'groupActions']).forEach((key) => {\r\n    if (props.hasOwnProperty(key)) {\r\n      desc[key] = props[key];\r\n    }\r\n  });\r\n  return desc;\r\n}\r\n\r\n","import {\r\n  buildRanking as buildRankingImpl,\r\n  IImposeColumnBuilder,\r\n  INestedBuilder,\r\n  IReduceBuilder,\r\n  IScriptedBuilder,\r\n  IWeightedSumBuilder\r\n} from '..';\r\nimport {Ranking} from '../../model';\r\nimport {LocalDataProvider} from '../../provider';\r\n\r\nexport interface IBuilderAdapterRankingProps {\r\n  sortBy?: (string | { column: string, asc: 'asc' | 'desc' | boolean }) | ((string | { column: string, asc: 'asc' | 'desc' | boolean })[]);\r\n  groupBy?: string[] | string;\r\n  columns?: (string | IImposeColumnBuilder | INestedBuilder | IWeightedSumBuilder | IReduceBuilder | IScriptedBuilder)[];\r\n}\r\n\r\n/*\r\n * build the column description\r\n */\r\nexport function buildRanking(props: IBuilderAdapterRankingProps, data: LocalDataProvider): Ranking {\r\n  const r = buildRankingImpl();\r\n\r\n  if (props.sortBy) {\r\n    const s = Array.isArray(props.sortBy) ? props.sortBy : [props.sortBy];\r\n    s.forEach((si) => {\r\n      if (typeof si === 'string') {\r\n        r.sortBy(si);\r\n      } else {\r\n        r.sortBy(si.column, si.asc);\r\n      }\r\n    });\r\n  }\r\n  if (props.groupBy) {\r\n    const s = Array.isArray(props.groupBy) ? props.groupBy : [props.groupBy];\r\n    r.groupBy(...s);\r\n  }\r\n  if (props.columns) {\r\n    props.columns.forEach((c) => r.column(c));\r\n  }\r\n  return r.build(data);\r\n}\r\n\r\nexport function buildGeneric(props: { column: '*' | string }) {\r\n  return props.column;\r\n}\r\n\r\nexport interface IBuilderAdapterImposeColumnProps {\r\n  label?: string;\r\n  column: string;\r\n  categoricalColumn: string;\r\n}\r\n\r\nexport function buildImposeRanking(props: IBuilderAdapterImposeColumnProps) {\r\n  return <any>Object.assign({\r\n    type: 'impose'\r\n  }, props);\r\n}\r\n\r\n\r\nexport interface IBuilderAdapterNestedColumnProps {\r\n  label?: string;\r\n}\r\n\r\nexport function buildNestedRanking(props: IBuilderAdapterNestedColumnProps, children: string[]) {\r\n  const r: INestedBuilder = {\r\n    type: 'nested',\r\n    columns: children\r\n  };\r\n  if (props.label) {\r\n    r.label = props.label;\r\n  }\r\n  return r;\r\n}\r\n\r\nexport interface IBuilderAdapterWeightedSumColumnProps {\r\n  label?: string;\r\n}\r\n\r\nexport function buildWeightedSumRanking(props: IBuilderAdapterWeightedSumColumnProps, children: { column: string, weight: number }[]) {\r\n  const r: IWeightedSumBuilder = {\r\n    type: 'weightedSum',\r\n    columns: children.map((d) => d.column),\r\n    weights: children.map((d) => d.weight)\r\n  };\r\n  if (props.label) {\r\n    r.label = props.label;\r\n  }\r\n  return r;\r\n}\r\n\r\nexport interface IBuilderAdapterReduceColumnProps {\r\n  type: 'min' | 'max' | 'mean' | 'median';\r\n  label?: string;\r\n}\r\n\r\nexport function buildReduceRanking(props: IBuilderAdapterReduceColumnProps, children: string[]) {\r\n  const r: IReduceBuilder = {\r\n    type: props.type,\r\n    columns: children\r\n  };\r\n  if (props.label) {\r\n    r.label = props.label;\r\n  }\r\n  return r;\r\n}\r\n\r\nexport interface IBuilderAdapterScriptColumnProps {\r\n  code: string;\r\n  label?: string;\r\n}\r\n\r\nexport function buildScriptRanking(props: IBuilderAdapterScriptColumnProps, children: string[]) {\r\n  const r: IScriptedBuilder = {\r\n    type: 'script',\r\n    code: props.code,\r\n    columns: children\r\n  };\r\n  if (props.label) {\r\n    r.label = props.label;\r\n  }\r\n  return r;\r\n}\r\n\r\nexport interface IBuilderAdapterSupportColumnProps {\r\n  type: 'rank' | 'selection' | 'group' | 'aggregate' | '*';\r\n}\r\n\r\nexport function buildSupportRanking(props: IBuilderAdapterSupportColumnProps) {\r\n  return `_${props.type}`;\r\n}\r\n\r\nexport function buildAllColumnsRanking() {\r\n  return '*';\r\n}\r\n","export {equal} from '../../internal/utils';\r\n\r\nexport function isTypeInstance(clazz: any, superClass: any) {\r\n  let c = clazz;\r\n  while (c && c !== superClass) {\r\n    c = c.__proto__;\r\n  }\r\n  return c === superClass;\r\n}\r\n\r\nexport function pick<T extends Object>(obj: T, keys: (keyof T)[]): Pick<T, keyof T> {\r\n  const r: Pick<T, keyof T> = <any>{};\r\n  keys.forEach((k) => {\r\n    if (obj.hasOwnProperty(k)) {\r\n      r[k] = obj[k];\r\n    }\r\n  });\r\n  return r;\r\n}\r\n\r\nexport function isSame<T>(current: T, changed: (prop: keyof T) => boolean, props: (keyof T)[]) {\r\n  if (props.every((p) => !changed(p))) {\r\n    return null;\r\n  }\r\n  return pick(current, props);\r\n}\r\n","import {Column, IColumnDesc} from '../../model';\r\nimport {Taggle, LineUp} from '../../ui';\r\nimport {ILineUpOptions, ITaggleOptions} from '../../interfaces';\r\nimport {IBuilderAdapterRankingProps, buildRanking} from './ranking';\r\nimport {pick, isSame, equal} from './utils';\r\nimport {LocalDataProvider, deriveColumnDescriptions, deriveColors} from '../../provider';\r\n\r\n\r\nexport interface IBuilderAdapterDataProps {\r\n  data: any[];\r\n  selection?: number[] | null;\r\n  highlight?: number | null;\r\n\r\n  onSelectionChanged?(selection: number[]): void;\r\n  onHighlightChanged?(highlight: number): void;\r\n\r\n  singleSelection?: boolean;\r\n  filterGlobally?: boolean;\r\n  noCriteriaLimits?: boolean;\r\n  maxGroupColumns?: number;\r\n  maxNestedSortingCriteria?: number;\r\n  columnTypes?: {[type: string]: typeof Column};\r\n\r\n  deriveColumns?: boolean | string[];\r\n  deriveColors?: boolean;\r\n\r\n  restore?: any;\r\n  defaultRanking?: boolean | 'noSupportTypes';\r\n}\r\n\r\n\r\nexport declare type IBuilderAdapterProps = Partial<ITaggleOptions> & IBuilderAdapterDataProps;\r\n\r\nconst providerOptions: (keyof IBuilderAdapterDataProps)[] = ['singleSelection', 'filterGlobally', 'noCriteriaLimits', 'maxGroupColumns', 'maxNestedSortingCriteria', 'columnTypes'];\r\nconst lineupOptions: (keyof IBuilderAdapterProps)[] = ['animated', 'sidePanel', 'sidePanelCollapsed', 'hierarchyIndicator', 'defaultSlopeGraphMode', 'summaryHeader', 'expandLineOnHover', 'overviewMode', 'renderers', 'toolbar', 'rowHeight', 'rowPadding', 'groupHeight', 'groupPadding', 'dynamicHeight', 'labelRotation', 'ignoreUnsupportedBrowser'];\r\n\r\ninterface IRankingContext {\r\n  builders: IBuilderAdapterRankingProps[];\r\n  restore: any;\r\n  derive: boolean;\r\n  supportTypes: boolean;\r\n}\r\n\r\ninterface IColumnContext {\r\n  columns: IColumnDesc[];\r\n  deriveColumns: boolean;\r\n  deriveColumnNames: string[];\r\n  deriveColors: boolean;\r\n}\r\n\r\nexport interface IChangeDetecter {\r\n  (prop: (keyof IBuilderAdapterProps)): boolean;\r\n}\r\n\r\nexport interface IBuilderAdapter {\r\n  props(): Readonly<IBuilderAdapterProps>;\r\n  createInstance(data: LocalDataProvider, options: Partial<ILineUpOptions>): LineUp | Taggle;\r\n  rankingBuilders(): IBuilderAdapterRankingProps[];\r\n  columnDescs(data: any[]): IColumnDesc[];\r\n}\r\n\r\nexport class Adapter {\r\n  private data: LocalDataProvider | null = null;\r\n  private instance: LineUp | Taggle | null = null;\r\n\r\n  private prevRankings: IRankingContext | null = null;\r\n  private prevColumns: IColumnContext | null = null;\r\n  private prevHighlight: number | null = null;\r\n\r\n  private readonly onSelectionChanged = (indices: number[]) => {\r\n    if (this.props.onSelectionChanged && !equal(this.props.selection, indices)) {\r\n      this.props.onSelectionChanged(indices);\r\n    }\r\n  }\r\n\r\n  private readonly onHighlightChanged = (highlight: number) => {\r\n    const prev = this.prevHighlight != null ? this.prevHighlight : -1;\r\n    if (prev === highlight) {\r\n      return;\r\n    }\r\n    this.prevHighlight = highlight;\r\n    if (this.props.onHighlightChanged) {\r\n      this.props.onHighlightChanged(highlight);\r\n    }\r\n  }\r\n\r\n  constructor(private readonly adapter: IBuilderAdapter) {\r\n\r\n  }\r\n\r\n  private get props() {\r\n    return this.adapter.props();\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.data = this.buildProvider();\r\n    this.instance = this.adapter.createInstance(this.data, pick(this.props, lineupOptions));\r\n    this.instance.on(LineUp.EVENT_HIGHLIGHT_CHANGED, this.onHighlightChanged);\r\n  }\r\n\r\n  private resolveColumnDescs(data: any[]): IColumnContext {\r\n    const columns = this.adapter.columnDescs(data);\r\n    const deriveColumns = columns.length === 0 || Boolean(this.props.deriveColumns);\r\n    const deriveColumnNames = Array.isArray(this.props.deriveColumns) ? this.props.deriveColumns : [];\r\n    const deriveColors = Boolean(this.props.deriveColors);\r\n    return {\r\n      columns,\r\n      deriveColors,\r\n      deriveColumns,\r\n      deriveColumnNames\r\n    };\r\n  }\r\n\r\n  private resolveRankings(): IRankingContext {\r\n    const builders = this.adapter.rankingBuilders();\r\n\r\n    return {\r\n      builders,\r\n      restore: this.props.restore,\r\n      derive: (builders.length === 0 && !this.props.restore) || Boolean(this.props.defaultRanking),\r\n      supportTypes: this.props.defaultRanking !== 'noSupportTypes'\r\n    };\r\n  }\r\n\r\n  private buildColumns(data: any[], ctx: IColumnContext) {\r\n    this.prevColumns = ctx;\r\n    const columns = ctx.columns.map((d) => Object.assign({}, d)); // work on copy\r\n    if (ctx.deriveColumns) {\r\n      columns.push(...deriveColumnDescriptions(data, {columns: ctx.deriveColumnNames}));\r\n    }\r\n    if (ctx.deriveColors) {\r\n      deriveColors(columns);\r\n    }\r\n    return columns;\r\n  }\r\n\r\n  private buildRankings(data: LocalDataProvider, rankings: IRankingContext) {\r\n    data.clearRankings();\r\n    this.prevRankings = rankings;\r\n    if (rankings.derive) {\r\n      data.deriveDefault(rankings.supportTypes);\r\n    }\r\n    if (rankings.restore) {\r\n      data.restore(rankings.restore);\r\n    }\r\n    rankings.builders.forEach((b) => buildRanking(b, data!));\r\n  }\r\n\r\n  private buildProvider() {\r\n    const columns = this.buildColumns(this.props.data, this.resolveColumnDescs(this.props.data));\r\n    const data = new LocalDataProvider(this.props.data, columns, pick(this.props, providerOptions));\r\n\r\n    this.buildRankings(data, this.resolveRankings());\r\n\r\n    data.setSelection(this.props.selection || []);\r\n    data.on(LocalDataProvider.EVENT_SELECTION_CHANGED, this.onSelectionChanged);\r\n\r\n    return data;\r\n  }\r\n\r\n  private updateLineUp(changeDetector: IChangeDetecter, providerChanged: boolean) {\r\n    // check lineup instance properties\r\n    const changedLineUpOptions = isSame(this.props, changeDetector, lineupOptions);\r\n    if (!changedLineUpOptions) {\r\n      if (providerChanged) {\r\n        this.instance!.setDataProvider(this.data!);\r\n      }\r\n\r\n      if (providerChanged || (this.props.highlight != null && this.prevHighlight !== this.props.highlight)) {\r\n        this.prevHighlight = this.props.highlight == null ? -1 : this.props.highlight;\r\n        this.instance!.on(LineUp.EVENT_HIGHLIGHT_CHANGED, null);\r\n        this.instance!.setHighlight(this.prevHighlight);\r\n        this.instance!.on(LineUp.EVENT_HIGHLIGHT_CHANGED, this.onHighlightChanged);\r\n        return true;\r\n      }\r\n      return false;\r\n    }\r\n    // recreate lineup\r\n    if (this.instance) {\r\n      this.instance.destroy();\r\n    }\r\n    this.instance = this.adapter.createInstance(this.data!, changedLineUpOptions);\r\n\r\n    this.prevHighlight = this.props.highlight == null ? -1 : this.props.highlight;\r\n    this.instance!.setHighlight(this.prevHighlight);\r\n    this.instance!.on(LineUp.EVENT_HIGHLIGHT_CHANGED, this.onHighlightChanged);\r\n    return true;\r\n  }\r\n\r\n  private updateProvider(changeDetector: IChangeDetecter) {\r\n    const changedProviderOptions = isSame(this.props, changeDetector, providerOptions);\r\n    if (changedProviderOptions || !this.data || changeDetector('data')) {\r\n      // big change start from scratch\r\n      this.data = this.buildProvider();\r\n      return true;\r\n    }\r\n\r\n    const rankings = this.resolveRankings();\r\n    const columns = this.resolveColumnDescs(this.props.data);\r\n    const columnsChanged = !equal(this.prevColumns, columns);\r\n    if (columnsChanged) {\r\n      const descs = this.buildColumns(this.props.data, columns);\r\n      this.data.clearColumns();\r\n      descs.forEach((d) => this.data!.pushDesc(d));\r\n    }\r\n\r\n    if (columnsChanged || !equal(rankings, this.prevRankings)) {\r\n      this.buildRankings(this.data, rankings);\r\n    }\r\n\r\n    this.data.on(LocalDataProvider.EVENT_SELECTION_CHANGED, null);\r\n    this.data.setSelection(this.props.selection || []);\r\n    this.data.on(LocalDataProvider.EVENT_SELECTION_CHANGED, this.onSelectionChanged);\r\n    return false;\r\n  }\r\n\r\n  componentDidUpdate(changeDetector: IChangeDetecter) {\r\n    const providerChanged = this.updateProvider(changeDetector);\r\n    this.updateLineUp(changeDetector, providerChanged);\r\n    // this.instance!.update();\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    if (this.instance) {\r\n      this.instance.destroy();\r\n      this.instance = null;\r\n    }\r\n    this.data = null;\r\n  }\r\n}\r\n","export {\r\n  IBuilderAdapterCategoricalColumnDescProps,\r\n  IBuilderAdapterColumnDescProps,\r\n  IBuilderAdapterDateColumnDescProps,\r\n  IBuilderAdapterHierarchyColumnDescProps,\r\n  IBuilderAdapterNumberColumnDescProps,\r\n  IBuilderAdapterStringColumnDescProps,\r\n  IBuilderAdapterActionsColumnDescProps\r\n} from './column';\r\nexport {IChangeDetecter, IBuilderAdapter, IBuilderAdapterDataProps, IBuilderAdapterProps} from './lineup';\r\nexport {\r\n  IBuilderAdapterImposeColumnProps,\r\n  IBuilderAdapterNestedColumnProps,\r\n  IBuilderAdapterRankingProps,\r\n  IBuilderAdapterReduceColumnProps,\r\n  IBuilderAdapterScriptColumnProps,\r\n  IBuilderAdapterSupportColumnProps,\r\n  IBuilderAdapterWeightedSumColumnProps\r\n} from './ranking';\r\n\r\nimport {build, buildCategorical, buildDate, buildHierarchy, buildNumber, buildString, buildActions} from './column';\r\nimport {Adapter} from './lineup';\r\nimport {\r\n  buildAllColumnsRanking,\r\n  buildGeneric,\r\n  buildImposeRanking,\r\n  buildNestedRanking,\r\n  buildRanking,\r\n  buildReduceRanking,\r\n  buildScriptRanking,\r\n  buildSupportRanking,\r\n  buildWeightedSumRanking\r\n} from './ranking';\r\nimport {equal, isSame, isTypeInstance} from './utils';\r\n\r\nexport const builderAdapter = {\r\n  buildString,\r\n  buildNumber,\r\n  buildHierarchy,\r\n  buildDate,\r\n  buildCategorical,\r\n  buildActions,\r\n  build,\r\n  buildGeneric,\r\n  buildWeightedSumRanking,\r\n  buildSupportRanking,\r\n  buildScriptRanking,\r\n  buildReduceRanking,\r\n  buildRanking,\r\n  buildNestedRanking,\r\n  buildImposeRanking,\r\n  buildAllColumnsRanking,\r\n  equal,\r\n  isSame,\r\n  isTypeInstance,\r\n  Adapter\r\n};\r\n","import LineUp from '../ui/LineUp';\r\nimport Taggle from '../ui/taggle/Taggle';\r\nimport {builder} from './DataBuilder';\r\n\r\nexport * from './DataBuilder';\r\nexport * from './column';\r\nexport * from './RankingBuilder';\r\nexport * from './adapter';\r\n\r\n/**\r\n * build a new Taggle instance in the given node for the given data\r\n * @param {HTMLElement} node DOM node to attach to\r\n * @param {any[]} data data to visualize\r\n * @param {string[]} columns optional enforced column order\r\n * @returns {Taggle}\r\n */\r\nexport function asTaggle(node: HTMLElement, data: any[], ...columns: string[]): Taggle {\r\n  return builder(data)\r\n    .deriveColumns(...columns)\r\n    .deriveColors()\r\n    .defaultRanking()\r\n    .buildTaggle(node);\r\n}\r\n\r\n/**\r\n * build a new LineUp instance in the given node for the given data\r\n * @param {HTMLElement} node DOM node to attach to\r\n * @param {any[]} data data to visualize\r\n * @param {string[]} columns optional enforced column order\r\n * @returns {LineUp}\r\n */\r\nexport function asLineUp(node: HTMLElement, data: any[], ...columns: string[]): LineUp {\r\n  return builder(data)\r\n    .deriveColumns(...columns)\r\n    .deriveColors()\r\n    .defaultRanking()\r\n    .build(node);\r\n}\r\n","/**\n * lodash (Custom Build) <https://lodash.com/>\n * Build: `lodash modularize exports=\"npm\" -o ./`\n * Copyright jQuery Foundation and other contributors <https://jquery.org/>\n * Released under MIT license <https://lodash.com/license>\n * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>\n * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors\n */\n\n/** Used as the `TypeError` message for \"Functions\" methods. */\nvar FUNC_ERROR_TEXT = 'Expected a function';\n\n/** Used to stand-in for `undefined` hash values. */\nvar HASH_UNDEFINED = '__lodash_hash_undefined__';\n\n/** Used as references for various `Number` constants. */\nvar INFINITY = 1 / 0;\n\n/** `Object#toString` result references. */\nvar funcTag = '[object Function]',\n    genTag = '[object GeneratorFunction]',\n    symbolTag = '[object Symbol]';\n\n/** Used to match property names within property paths. */\nvar reIsDeepProp = /\\.|\\[(?:[^[\\]]*|([\"'])(?:(?!\\1)[^\\\\]|\\\\.)*?\\1)\\]/,\n    reIsPlainProp = /^\\w*$/,\n    reLeadingDot = /^\\./,\n    rePropName = /[^.[\\]]+|\\[(?:(-?\\d+(?:\\.\\d+)?)|([\"'])((?:(?!\\2)[^\\\\]|\\\\.)*?)\\2)\\]|(?=(?:\\.|\\[\\])(?:\\.|\\[\\]|$))/g;\n\n/**\n * Used to match `RegExp`\n * [syntax characters](http://ecma-international.org/ecma-262/7.0/#sec-patterns).\n */\nvar reRegExpChar = /[\\\\^$.*+?()[\\]{}|]/g;\n\n/** Used to match backslashes in property paths. */\nvar reEscapeChar = /\\\\(\\\\)?/g;\n\n/** Used to detect host constructors (Safari). */\nvar reIsHostCtor = /^\\[object .+?Constructor\\]$/;\n\n/** Detect free variable `global` from Node.js. */\nvar freeGlobal = typeof global == 'object' && global && global.Object === Object && global;\n\n/** Detect free variable `self`. */\nvar freeSelf = typeof self == 'object' && self && self.Object === Object && self;\n\n/** Used as a reference to the global object. */\nvar root = freeGlobal || freeSelf || Function('return this')();\n\n/**\n * Gets the value at `key` of `object`.\n *\n * @private\n * @param {Object} [object] The object to query.\n * @param {string} key The key of the property to get.\n * @returns {*} Returns the property value.\n */\nfunction getValue(object, key) {\n  return object == null ? undefined : object[key];\n}\n\n/**\n * Checks if `value` is a host object in IE < 9.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a host object, else `false`.\n */\nfunction isHostObject(value) {\n  // Many host objects are `Object` objects that can coerce to strings\n  // despite having improperly defined `toString` methods.\n  var result = false;\n  if (value != null && typeof value.toString != 'function') {\n    try {\n      result = !!(value + '');\n    } catch (e) {}\n  }\n  return result;\n}\n\n/** Used for built-in method references. */\nvar arrayProto = Array.prototype,\n    funcProto = Function.prototype,\n    objectProto = Object.prototype;\n\n/** Used to detect overreaching core-js shims. */\nvar coreJsData = root['__core-js_shared__'];\n\n/** Used to detect methods masquerading as native. */\nvar maskSrcKey = (function() {\n  var uid = /[^.]+$/.exec(coreJsData && coreJsData.keys && coreJsData.keys.IE_PROTO || '');\n  return uid ? ('Symbol(src)_1.' + uid) : '';\n}());\n\n/** Used to resolve the decompiled source of functions. */\nvar funcToString = funcProto.toString;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar objectToString = objectProto.toString;\n\n/** Used to detect if a method is native. */\nvar reIsNative = RegExp('^' +\n  funcToString.call(hasOwnProperty).replace(reRegExpChar, '\\\\$&')\n  .replace(/hasOwnProperty|(function).*?(?=\\\\\\()| for .+?(?=\\\\\\])/g, '$1.*?') + '$'\n);\n\n/** Built-in value references. */\nvar Symbol = root.Symbol,\n    splice = arrayProto.splice;\n\n/* Built-in method references that are verified to be native. */\nvar Map = getNative(root, 'Map'),\n    nativeCreate = getNative(Object, 'create');\n\n/** Used to convert symbols to primitives and strings. */\nvar symbolProto = Symbol ? Symbol.prototype : undefined,\n    symbolToString = symbolProto ? symbolProto.toString : undefined;\n\n/**\n * Creates a hash object.\n *\n * @private\n * @constructor\n * @param {Array} [entries] The key-value pairs to cache.\n */\nfunction Hash(entries) {\n  var index = -1,\n      length = entries ? entries.length : 0;\n\n  this.clear();\n  while (++index < length) {\n    var entry = entries[index];\n    this.set(entry[0], entry[1]);\n  }\n}\n\n/**\n * Removes all key-value entries from the hash.\n *\n * @private\n * @name clear\n * @memberOf Hash\n */\nfunction hashClear() {\n  this.__data__ = nativeCreate ? nativeCreate(null) : {};\n}\n\n/**\n * Removes `key` and its value from the hash.\n *\n * @private\n * @name delete\n * @memberOf Hash\n * @param {Object} hash The hash to modify.\n * @param {string} key The key of the value to remove.\n * @returns {boolean} Returns `true` if the entry was removed, else `false`.\n */\nfunction hashDelete(key) {\n  return this.has(key) && delete this.__data__[key];\n}\n\n/**\n * Gets the hash value for `key`.\n *\n * @private\n * @name get\n * @memberOf Hash\n * @param {string} key The key of the value to get.\n * @returns {*} Returns the entry value.\n */\nfunction hashGet(key) {\n  var data = this.__data__;\n  if (nativeCreate) {\n    var result = data[key];\n    return result === HASH_UNDEFINED ? undefined : result;\n  }\n  return hasOwnProperty.call(data, key) ? data[key] : undefined;\n}\n\n/**\n * Checks if a hash value for `key` exists.\n *\n * @private\n * @name has\n * @memberOf Hash\n * @param {string} key The key of the entry to check.\n * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n */\nfunction hashHas(key) {\n  var data = this.__data__;\n  return nativeCreate ? data[key] !== undefined : hasOwnProperty.call(data, key);\n}\n\n/**\n * Sets the hash `key` to `value`.\n *\n * @private\n * @name set\n * @memberOf Hash\n * @param {string} key The key of the value to set.\n * @param {*} value The value to set.\n * @returns {Object} Returns the hash instance.\n */\nfunction hashSet(key, value) {\n  var data = this.__data__;\n  data[key] = (nativeCreate && value === undefined) ? HASH_UNDEFINED : value;\n  return this;\n}\n\n// Add methods to `Hash`.\nHash.prototype.clear = hashClear;\nHash.prototype['delete'] = hashDelete;\nHash.prototype.get = hashGet;\nHash.prototype.has = hashHas;\nHash.prototype.set = hashSet;\n\n/**\n * Creates an list cache object.\n *\n * @private\n * @constructor\n * @param {Array} [entries] The key-value pairs to cache.\n */\nfunction ListCache(entries) {\n  var index = -1,\n      length = entries ? entries.length : 0;\n\n  this.clear();\n  while (++index < length) {\n    var entry = entries[index];\n    this.set(entry[0], entry[1]);\n  }\n}\n\n/**\n * Removes all key-value entries from the list cache.\n *\n * @private\n * @name clear\n * @memberOf ListCache\n */\nfunction listCacheClear() {\n  this.__data__ = [];\n}\n\n/**\n * Removes `key` and its value from the list cache.\n *\n * @private\n * @name delete\n * @memberOf ListCache\n * @param {string} key The key of the value to remove.\n * @returns {boolean} Returns `true` if the entry was removed, else `false`.\n */\nfunction listCacheDelete(key) {\n  var data = this.__data__,\n      index = assocIndexOf(data, key);\n\n  if (index < 0) {\n    return false;\n  }\n  var lastIndex = data.length - 1;\n  if (index == lastIndex) {\n    data.pop();\n  } else {\n    splice.call(data, index, 1);\n  }\n  return true;\n}\n\n/**\n * Gets the list cache value for `key`.\n *\n * @private\n * @name get\n * @memberOf ListCache\n * @param {string} key The key of the value to get.\n * @returns {*} Returns the entry value.\n */\nfunction listCacheGet(key) {\n  var data = this.__data__,\n      index = assocIndexOf(data, key);\n\n  return index < 0 ? undefined : data[index][1];\n}\n\n/**\n * Checks if a list cache value for `key` exists.\n *\n * @private\n * @name has\n * @memberOf ListCache\n * @param {string} key The key of the entry to check.\n * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n */\nfunction listCacheHas(key) {\n  return assocIndexOf(this.__data__, key) > -1;\n}\n\n/**\n * Sets the list cache `key` to `value`.\n *\n * @private\n * @name set\n * @memberOf ListCache\n * @param {string} key The key of the value to set.\n * @param {*} value The value to set.\n * @returns {Object} Returns the list cache instance.\n */\nfunction listCacheSet(key, value) {\n  var data = this.__data__,\n      index = assocIndexOf(data, key);\n\n  if (index < 0) {\n    data.push([key, value]);\n  } else {\n    data[index][1] = value;\n  }\n  return this;\n}\n\n// Add methods to `ListCache`.\nListCache.prototype.clear = listCacheClear;\nListCache.prototype['delete'] = listCacheDelete;\nListCache.prototype.get = listCacheGet;\nListCache.prototype.has = listCacheHas;\nListCache.prototype.set = listCacheSet;\n\n/**\n * Creates a map cache object to store key-value pairs.\n *\n * @private\n * @constructor\n * @param {Array} [entries] The key-value pairs to cache.\n */\nfunction MapCache(entries) {\n  var index = -1,\n      length = entries ? entries.length : 0;\n\n  this.clear();\n  while (++index < length) {\n    var entry = entries[index];\n    this.set(entry[0], entry[1]);\n  }\n}\n\n/**\n * Removes all key-value entries from the map.\n *\n * @private\n * @name clear\n * @memberOf MapCache\n */\nfunction mapCacheClear() {\n  this.__data__ = {\n    'hash': new Hash,\n    'map': new (Map || ListCache),\n    'string': new Hash\n  };\n}\n\n/**\n * Removes `key` and its value from the map.\n *\n * @private\n * @name delete\n * @memberOf MapCache\n * @param {string} key The key of the value to remove.\n * @returns {boolean} Returns `true` if the entry was removed, else `false`.\n */\nfunction mapCacheDelete(key) {\n  return getMapData(this, key)['delete'](key);\n}\n\n/**\n * Gets the map value for `key`.\n *\n * @private\n * @name get\n * @memberOf MapCache\n * @param {string} key The key of the value to get.\n * @returns {*} Returns the entry value.\n */\nfunction mapCacheGet(key) {\n  return getMapData(this, key).get(key);\n}\n\n/**\n * Checks if a map value for `key` exists.\n *\n * @private\n * @name has\n * @memberOf MapCache\n * @param {string} key The key of the entry to check.\n * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n */\nfunction mapCacheHas(key) {\n  return getMapData(this, key).has(key);\n}\n\n/**\n * Sets the map `key` to `value`.\n *\n * @private\n * @name set\n * @memberOf MapCache\n * @param {string} key The key of the value to set.\n * @param {*} value The value to set.\n * @returns {Object} Returns the map cache instance.\n */\nfunction mapCacheSet(key, value) {\n  getMapData(this, key).set(key, value);\n  return this;\n}\n\n// Add methods to `MapCache`.\nMapCache.prototype.clear = mapCacheClear;\nMapCache.prototype['delete'] = mapCacheDelete;\nMapCache.prototype.get = mapCacheGet;\nMapCache.prototype.has = mapCacheHas;\nMapCache.prototype.set = mapCacheSet;\n\n/**\n * Gets the index at which the `key` is found in `array` of key-value pairs.\n *\n * @private\n * @param {Array} array The array to inspect.\n * @param {*} key The key to search for.\n * @returns {number} Returns the index of the matched value, else `-1`.\n */\nfunction assocIndexOf(array, key) {\n  var length = array.length;\n  while (length--) {\n    if (eq(array[length][0], key)) {\n      return length;\n    }\n  }\n  return -1;\n}\n\n/**\n * The base implementation of `_.get` without support for default values.\n *\n * @private\n * @param {Object} object The object to query.\n * @param {Array|string} path The path of the property to get.\n * @returns {*} Returns the resolved value.\n */\nfunction baseGet(object, path) {\n  path = isKey(path, object) ? [path] : castPath(path);\n\n  var index = 0,\n      length = path.length;\n\n  while (object != null && index < length) {\n    object = object[toKey(path[index++])];\n  }\n  return (index && index == length) ? object : undefined;\n}\n\n/**\n * The base implementation of `_.isNative` without bad shim checks.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a native function,\n *  else `false`.\n */\nfunction baseIsNative(value) {\n  if (!isObject(value) || isMasked(value)) {\n    return false;\n  }\n  var pattern = (isFunction(value) || isHostObject(value)) ? reIsNative : reIsHostCtor;\n  return pattern.test(toSource(value));\n}\n\n/**\n * The base implementation of `_.toString` which doesn't convert nullish\n * values to empty strings.\n *\n * @private\n * @param {*} value The value to process.\n * @returns {string} Returns the string.\n */\nfunction baseToString(value) {\n  // Exit early for strings to avoid a performance hit in some environments.\n  if (typeof value == 'string') {\n    return value;\n  }\n  if (isSymbol(value)) {\n    return symbolToString ? symbolToString.call(value) : '';\n  }\n  var result = (value + '');\n  return (result == '0' && (1 / value) == -INFINITY) ? '-0' : result;\n}\n\n/**\n * Casts `value` to a path array if it's not one.\n *\n * @private\n * @param {*} value The value to inspect.\n * @returns {Array} Returns the cast property path array.\n */\nfunction castPath(value) {\n  return isArray(value) ? value : stringToPath(value);\n}\n\n/**\n * Gets the data for `map`.\n *\n * @private\n * @param {Object} map The map to query.\n * @param {string} key The reference key.\n * @returns {*} Returns the map data.\n */\nfunction getMapData(map, key) {\n  var data = map.__data__;\n  return isKeyable(key)\n    ? data[typeof key == 'string' ? 'string' : 'hash']\n    : data.map;\n}\n\n/**\n * Gets the native function at `key` of `object`.\n *\n * @private\n * @param {Object} object The object to query.\n * @param {string} key The key of the method to get.\n * @returns {*} Returns the function if it's native, else `undefined`.\n */\nfunction getNative(object, key) {\n  var value = getValue(object, key);\n  return baseIsNative(value) ? value : undefined;\n}\n\n/**\n * Checks if `value` is a property name and not a property path.\n *\n * @private\n * @param {*} value The value to check.\n * @param {Object} [object] The object to query keys on.\n * @returns {boolean} Returns `true` if `value` is a property name, else `false`.\n */\nfunction isKey(value, object) {\n  if (isArray(value)) {\n    return false;\n  }\n  var type = typeof value;\n  if (type == 'number' || type == 'symbol' || type == 'boolean' ||\n      value == null || isSymbol(value)) {\n    return true;\n  }\n  return reIsPlainProp.test(value) || !reIsDeepProp.test(value) ||\n    (object != null && value in Object(object));\n}\n\n/**\n * Checks if `value` is suitable for use as unique object key.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is suitable, else `false`.\n */\nfunction isKeyable(value) {\n  var type = typeof value;\n  return (type == 'string' || type == 'number' || type == 'symbol' || type == 'boolean')\n    ? (value !== '__proto__')\n    : (value === null);\n}\n\n/**\n * Checks if `func` has its source masked.\n *\n * @private\n * @param {Function} func The function to check.\n * @returns {boolean} Returns `true` if `func` is masked, else `false`.\n */\nfunction isMasked(func) {\n  return !!maskSrcKey && (maskSrcKey in func);\n}\n\n/**\n * Converts `string` to a property path array.\n *\n * @private\n * @param {string} string The string to convert.\n * @returns {Array} Returns the property path array.\n */\nvar stringToPath = memoize(function(string) {\n  string = toString(string);\n\n  var result = [];\n  if (reLeadingDot.test(string)) {\n    result.push('');\n  }\n  string.replace(rePropName, function(match, number, quote, string) {\n    result.push(quote ? string.replace(reEscapeChar, '$1') : (number || match));\n  });\n  return result;\n});\n\n/**\n * Converts `value` to a string key if it's not a string or symbol.\n *\n * @private\n * @param {*} value The value to inspect.\n * @returns {string|symbol} Returns the key.\n */\nfunction toKey(value) {\n  if (typeof value == 'string' || isSymbol(value)) {\n    return value;\n  }\n  var result = (value + '');\n  return (result == '0' && (1 / value) == -INFINITY) ? '-0' : result;\n}\n\n/**\n * Converts `func` to its source code.\n *\n * @private\n * @param {Function} func The function to process.\n * @returns {string} Returns the source code.\n */\nfunction toSource(func) {\n  if (func != null) {\n    try {\n      return funcToString.call(func);\n    } catch (e) {}\n    try {\n      return (func + '');\n    } catch (e) {}\n  }\n  return '';\n}\n\n/**\n * Creates a function that memoizes the result of `func`. If `resolver` is\n * provided, it determines the cache key for storing the result based on the\n * arguments provided to the memoized function. By default, the first argument\n * provided to the memoized function is used as the map cache key. The `func`\n * is invoked with the `this` binding of the memoized function.\n *\n * **Note:** The cache is exposed as the `cache` property on the memoized\n * function. Its creation may be customized by replacing the `_.memoize.Cache`\n * constructor with one whose instances implement the\n * [`Map`](http://ecma-international.org/ecma-262/7.0/#sec-properties-of-the-map-prototype-object)\n * method interface of `delete`, `get`, `has`, and `set`.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Function\n * @param {Function} func The function to have its output memoized.\n * @param {Function} [resolver] The function to resolve the cache key.\n * @returns {Function} Returns the new memoized function.\n * @example\n *\n * var object = { 'a': 1, 'b': 2 };\n * var other = { 'c': 3, 'd': 4 };\n *\n * var values = _.memoize(_.values);\n * values(object);\n * // => [1, 2]\n *\n * values(other);\n * // => [3, 4]\n *\n * object.a = 2;\n * values(object);\n * // => [1, 2]\n *\n * // Modify the result cache.\n * values.cache.set(object, ['a', 'b']);\n * values(object);\n * // => ['a', 'b']\n *\n * // Replace `_.memoize.Cache`.\n * _.memoize.Cache = WeakMap;\n */\nfunction memoize(func, resolver) {\n  if (typeof func != 'function' || (resolver && typeof resolver != 'function')) {\n    throw new TypeError(FUNC_ERROR_TEXT);\n  }\n  var memoized = function() {\n    var args = arguments,\n        key = resolver ? resolver.apply(this, args) : args[0],\n        cache = memoized.cache;\n\n    if (cache.has(key)) {\n      return cache.get(key);\n    }\n    var result = func.apply(this, args);\n    memoized.cache = cache.set(key, result);\n    return result;\n  };\n  memoized.cache = new (memoize.Cache || MapCache);\n  return memoized;\n}\n\n// Assign cache to `_.memoize`.\nmemoize.Cache = MapCache;\n\n/**\n * Performs a\n * [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)\n * comparison between two values to determine if they are equivalent.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to compare.\n * @param {*} other The other value to compare.\n * @returns {boolean} Returns `true` if the values are equivalent, else `false`.\n * @example\n *\n * var object = { 'a': 1 };\n * var other = { 'a': 1 };\n *\n * _.eq(object, object);\n * // => true\n *\n * _.eq(object, other);\n * // => false\n *\n * _.eq('a', 'a');\n * // => true\n *\n * _.eq('a', Object('a'));\n * // => false\n *\n * _.eq(NaN, NaN);\n * // => true\n */\nfunction eq(value, other) {\n  return value === other || (value !== value && other !== other);\n}\n\n/**\n * Checks if `value` is classified as an `Array` object.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an array, else `false`.\n * @example\n *\n * _.isArray([1, 2, 3]);\n * // => true\n *\n * _.isArray(document.body.children);\n * // => false\n *\n * _.isArray('abc');\n * // => false\n *\n * _.isArray(_.noop);\n * // => false\n */\nvar isArray = Array.isArray;\n\n/**\n * Checks if `value` is classified as a `Function` object.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a function, else `false`.\n * @example\n *\n * _.isFunction(_);\n * // => true\n *\n * _.isFunction(/abc/);\n * // => false\n */\nfunction isFunction(value) {\n  // The use of `Object#toString` avoids issues with the `typeof` operator\n  // in Safari 8-9 which returns 'object' for typed array and other constructors.\n  var tag = isObject(value) ? objectToString.call(value) : '';\n  return tag == funcTag || tag == genTag;\n}\n\n/**\n * Checks if `value` is the\n * [language type](http://www.ecma-international.org/ecma-262/7.0/#sec-ecmascript-language-types)\n * of `Object`. (e.g. arrays, functions, objects, regexes, `new Number(0)`, and `new String('')`)\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an object, else `false`.\n * @example\n *\n * _.isObject({});\n * // => true\n *\n * _.isObject([1, 2, 3]);\n * // => true\n *\n * _.isObject(_.noop);\n * // => true\n *\n * _.isObject(null);\n * // => false\n */\nfunction isObject(value) {\n  var type = typeof value;\n  return !!value && (type == 'object' || type == 'function');\n}\n\n/**\n * Checks if `value` is object-like. A value is object-like if it's not `null`\n * and has a `typeof` result of \"object\".\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is object-like, else `false`.\n * @example\n *\n * _.isObjectLike({});\n * // => true\n *\n * _.isObjectLike([1, 2, 3]);\n * // => true\n *\n * _.isObjectLike(_.noop);\n * // => false\n *\n * _.isObjectLike(null);\n * // => false\n */\nfunction isObjectLike(value) {\n  return !!value && typeof value == 'object';\n}\n\n/**\n * Checks if `value` is classified as a `Symbol` primitive or object.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a symbol, else `false`.\n * @example\n *\n * _.isSymbol(Symbol.iterator);\n * // => true\n *\n * _.isSymbol('abc');\n * // => false\n */\nfunction isSymbol(value) {\n  return typeof value == 'symbol' ||\n    (isObjectLike(value) && objectToString.call(value) == symbolTag);\n}\n\n/**\n * Converts `value` to a string. An empty string is returned for `null`\n * and `undefined` values. The sign of `-0` is preserved.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to process.\n * @returns {string} Returns the string.\n * @example\n *\n * _.toString(null);\n * // => ''\n *\n * _.toString(-0);\n * // => '-0'\n *\n * _.toString([1, 2, 3]);\n * // => '1,2,3'\n */\nfunction toString(value) {\n  return value == null ? '' : baseToString(value);\n}\n\n/**\n * Gets the value at `path` of `object`. If the resolved value is\n * `undefined`, the `defaultValue` is returned in its place.\n *\n * @static\n * @memberOf _\n * @since 3.7.0\n * @category Object\n * @param {Object} object The object to query.\n * @param {Array|string} path The path of the property to get.\n * @param {*} [defaultValue] The value returned for `undefined` resolved values.\n * @returns {*} Returns the resolved value.\n * @example\n *\n * var object = { 'a': [{ 'b': { 'c': 3 } }] };\n *\n * _.get(object, 'a[0].b.c');\n * // => 3\n *\n * _.get(object, ['a', '0', 'b', 'c']);\n * // => 3\n *\n * _.get(object, 'a.b.c', 'default');\n * // => 'default'\n */\nfunction get(object, path, defaultValue) {\n  var result = object == null ? undefined : baseGet(object, path);\n  return result === undefined ? defaultValue : result;\n}\n\nmodule.exports = get;\n","\"use strict\";\nvar __spreadArrays = (this && this.__spreadArrays) || function () {\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n            r[k] = a[j];\n    return r;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar BrowserInfo = /** @class */ (function () {\n    function BrowserInfo(name, version, os) {\n        this.name = name;\n        this.version = version;\n        this.os = os;\n    }\n    return BrowserInfo;\n}());\nexports.BrowserInfo = BrowserInfo;\nvar NodeInfo = /** @class */ (function () {\n    function NodeInfo(version) {\n        this.version = version;\n        this.name = 'node';\n        this.os = process.platform;\n    }\n    return NodeInfo;\n}());\nexports.NodeInfo = NodeInfo;\nvar BotInfo = /** @class */ (function () {\n    function BotInfo() {\n        this.bot = true; // NOTE: deprecated test name instead\n        this.name = 'bot';\n        this.version = null;\n        this.os = null;\n    }\n    return BotInfo;\n}());\nexports.BotInfo = BotInfo;\n// tslint:disable-next-line:max-line-length\nvar SEARCHBOX_UA_REGEX = /alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/;\nvar SEARCHBOT_OS_REGEX = /(nuhk)|(Googlebot)|(Yammybot)|(Openbot)|(Slurp)|(MSNBot)|(Ask Jeeves\\/Teoma)|(ia_archiver)/;\nvar REQUIRED_VERSION_PARTS = 3;\nvar userAgentRules = [\n    ['aol', /AOLShield\\/([0-9\\._]+)/],\n    ['edge', /Edge\\/([0-9\\._]+)/],\n    ['edge-ios', /EdgiOS\\/([0-9\\._]+)/],\n    ['yandexbrowser', /YaBrowser\\/([0-9\\._]+)/],\n    ['vivaldi', /Vivaldi\\/([0-9\\.]+)/],\n    ['kakaotalk', /KAKAOTALK\\s([0-9\\.]+)/],\n    ['samsung', /SamsungBrowser\\/([0-9\\.]+)/],\n    ['silk', /\\bSilk\\/([0-9._-]+)\\b/],\n    ['miui', /MiuiBrowser\\/([0-9\\.]+)$/],\n    ['beaker', /BeakerBrowser\\/([0-9\\.]+)/],\n    ['edge-chromium', /Edg\\/([0-9\\.]+)/],\n    [\n        'chromium-webview',\n        /(?!Chrom.*OPR)wv\\).*Chrom(?:e|ium)\\/([0-9\\.]+)(:?\\s|$)/,\n    ],\n    ['chrome', /(?!Chrom.*OPR)Chrom(?:e|ium)\\/([0-9\\.]+)(:?\\s|$)/],\n    ['phantomjs', /PhantomJS\\/([0-9\\.]+)(:?\\s|$)/],\n    ['crios', /CriOS\\/([0-9\\.]+)(:?\\s|$)/],\n    ['firefox', /Firefox\\/([0-9\\.]+)(?:\\s|$)/],\n    ['fxios', /FxiOS\\/([0-9\\.]+)/],\n    ['opera-mini', /Opera Mini.*Version\\/([0-9\\.]+)/],\n    ['opera', /Opera\\/([0-9\\.]+)(?:\\s|$)/],\n    ['opera', /OPR\\/([0-9\\.]+)(:?\\s|$)/],\n    ['ie', /Trident\\/7\\.0.*rv\\:([0-9\\.]+).*\\).*Gecko$/],\n    ['ie', /MSIE\\s([0-9\\.]+);.*Trident\\/[4-7].0/],\n    ['ie', /MSIE\\s(7\\.0)/],\n    ['bb10', /BB10;\\sTouch.*Version\\/([0-9\\.]+)/],\n    ['android', /Android\\s([0-9\\.]+)/],\n    ['ios', /Version\\/([0-9\\._]+).*Mobile.*Safari.*/],\n    ['safari', /Version\\/([0-9\\._]+).*Safari/],\n    ['facebook', /FBAV\\/([0-9\\.]+)/],\n    ['instagram', /Instagram\\s([0-9\\.]+)/],\n    ['ios-webview', /AppleWebKit\\/([0-9\\.]+).*Mobile/],\n    ['ios-webview', /AppleWebKit\\/([0-9\\.]+).*Gecko\\)$/],\n    ['searchbot', SEARCHBOX_UA_REGEX],\n];\nvar operatingSystemRules = [\n    ['iOS', /iP(hone|od|ad)/],\n    ['Android OS', /Android/],\n    ['BlackBerry OS', /BlackBerry|BB10/],\n    ['Windows Mobile', /IEMobile/],\n    ['Amazon OS', /Kindle/],\n    ['Windows 3.11', /Win16/],\n    ['Windows 95', /(Windows 95)|(Win95)|(Windows_95)/],\n    ['Windows 98', /(Windows 98)|(Win98)/],\n    ['Windows 2000', /(Windows NT 5.0)|(Windows 2000)/],\n    ['Windows XP', /(Windows NT 5.1)|(Windows XP)/],\n    ['Windows Server 2003', /(Windows NT 5.2)/],\n    ['Windows Vista', /(Windows NT 6.0)/],\n    ['Windows 7', /(Windows NT 6.1)/],\n    ['Windows 8', /(Windows NT 6.2)/],\n    ['Windows 8.1', /(Windows NT 6.3)/],\n    ['Windows 10', /(Windows NT 10.0)/],\n    ['Windows ME', /Windows ME/],\n    ['Open BSD', /OpenBSD/],\n    ['Sun OS', /SunOS/],\n    ['Chrome OS', /CrOS/],\n    ['Linux', /(Linux)|(X11)/],\n    ['Mac OS', /(Mac_PowerPC)|(Macintosh)/],\n    ['QNX', /QNX/],\n    ['BeOS', /BeOS/],\n    ['OS/2', /OS\\/2/],\n    ['Search Bot', SEARCHBOT_OS_REGEX],\n];\nfunction detect(userAgent) {\n    if (!!userAgent) {\n        return parseUserAgent(userAgent);\n    }\n    if (typeof navigator !== 'undefined') {\n        return parseUserAgent(navigator.userAgent);\n    }\n    return getNodeVersion();\n}\nexports.detect = detect;\nfunction parseUserAgent(ua) {\n    // opted for using reduce here rather than Array#first with a regex.test call\n    // this is primarily because using the reduce we only perform the regex\n    // execution once rather than once for the test and for the exec again below\n    // probably something that needs to be benchmarked though\n    var matchedRule = ua !== '' &&\n        userAgentRules.reduce(function (matched, _a) {\n            var browser = _a[0], regex = _a[1];\n            if (matched) {\n                return matched;\n            }\n            var uaMatch = regex.exec(ua);\n            return !!uaMatch && [browser, uaMatch];\n        }, false);\n    if (!matchedRule) {\n        return null;\n    }\n    var name = matchedRule[0], match = matchedRule[1];\n    if (name === 'searchbot') {\n        return new BotInfo();\n    }\n    var versionParts = match[1] && match[1].split(/[._]/).slice(0, 3);\n    if (versionParts) {\n        if (versionParts.length < REQUIRED_VERSION_PARTS) {\n            versionParts = __spreadArrays(versionParts, createVersionParts(REQUIRED_VERSION_PARTS - versionParts.length));\n        }\n    }\n    else {\n        versionParts = [];\n    }\n    return new BrowserInfo(name, versionParts.join('.'), detectOS(ua));\n}\nexports.parseUserAgent = parseUserAgent;\nfunction detectOS(ua) {\n    for (var ii = 0, count = operatingSystemRules.length; ii < count; ii++) {\n        var _a = operatingSystemRules[ii], os = _a[0], regex = _a[1];\n        var match = regex.test(ua);\n        if (match) {\n            return os;\n        }\n    }\n    return null;\n}\nexports.detectOS = detectOS;\nfunction getNodeVersion() {\n    var isNode = typeof process !== 'undefined' && process.version;\n    return isNode ? new NodeInfo(process.version.slice(1)) : null;\n}\nexports.getNodeVersion = getNodeVersion;\nfunction createVersionParts(count) {\n    var output = [];\n    for (var ii = 0; ii < count; ii++) {\n        output.push('0');\n    }\n    return output;\n}\n","/**\r\n * main module of LineUp.js containing the main class and exposes all other modules\r\n */\r\n\r\nimport './style.scss';\r\nimport {IColumnDesc} from './model';\r\nimport {ILocalDataProviderOptions} from './provider';\r\nimport ADataProvider from './provider/ADataProvider';\r\nimport LocalDataProvider from './provider/LocalDataProvider';\r\nimport LineUp, {ILineUpOptions} from './ui/LineUp';\r\nimport Taggle, {ITaggleOptions} from './ui/taggle';\r\n\r\nexport * from './provider';\r\nexport * from './renderer';\r\nexport * from './model';\r\nexport * from './builder';\r\nexport * from './ui';\r\nexport * from './interfaces';\r\nexport * from './config';\r\nexport {default} from './ui/LineUp';\r\nexport {IBoxPlotData, IAdvancedBoxPlotData, IStatistics, ICategoricalBin, ICategoricalStatistics, INumberBin} from './internal/math';\r\n\r\n\r\ndeclare const __VERSION__: string;\r\ndeclare const __BUILD_ID__: string;\r\ndeclare const __LICENSE__: string;\r\n/**\r\n * LineUp version\r\n * @type {string}\r\n */\r\nexport const version = __VERSION__;\r\n/**\r\n * LineUp unique build id\r\n * @type {string}\r\n */\r\nexport const buildId = __BUILD_ID__;\r\n/**\r\n * LineUp license type\r\n * @type {string}\r\n */\r\nexport const license = __LICENSE__;\r\n\r\n\r\nexport function createLocalDataProvider(data: any[], columns: IColumnDesc[], options: Partial<ILocalDataProviderOptions> = {}) {\r\n  return new LocalDataProvider(data, columns, options);\r\n}\r\n\r\n/**\r\n *\r\n * @param container the html element lineup should be built in\r\n * @param data {ADataProvider} the data providier\r\n * @param config {Partial<ILineUpOptions>} lineup configuration overrides\r\n * @returns {LineUp} the created lineup instance\r\n */\r\nexport function createLineUp(container: HTMLElement, data: ADataProvider, config: Partial<ILineUpOptions> = {}) {\r\n  return new LineUp(container, data, config);\r\n}\r\n\r\nexport function createTaggle(container: HTMLElement, data: ADataProvider, config: Partial<ITaggleOptions> = {}) {\r\n  return new Taggle(container, data, config);\r\n}\r\n","/*! *****************************************************************************\nCopyright (C) Microsoft. All rights reserved.\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\nthis file except in compliance with the License. You may obtain a copy of the\nLicense at http://www.apache.org/licenses/LICENSE-2.0\n\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\nMERCHANTABLITY OR NON-INFRINGEMENT.\n\nSee the Apache Version 2.0 License for specific language governing permissions\nand limitations under the License.\n***************************************************************************** */\nvar Reflect;\n(function (Reflect) {\n    // Metadata Proposal\n    // https://rbuckton.github.io/reflect-metadata/\n    (function (factory) {\n        var root = typeof global === \"object\" ? global :\n            typeof self === \"object\" ? self :\n                typeof this === \"object\" ? this :\n                    Function(\"return this;\")();\n        var exporter = makeExporter(Reflect);\n        if (typeof root.Reflect === \"undefined\") {\n            root.Reflect = Reflect;\n        }\n        else {\n            exporter = makeExporter(root.Reflect, exporter);\n        }\n        factory(exporter);\n        function makeExporter(target, previous) {\n            return function (key, value) {\n                if (typeof target[key] !== \"function\") {\n                    Object.defineProperty(target, key, { configurable: true, writable: true, value: value });\n                }\n                if (previous)\n                    previous(key, value);\n            };\n        }\n    })(function (exporter) {\n        var hasOwn = Object.prototype.hasOwnProperty;\n        // feature test for Symbol support\n        var supportsSymbol = typeof Symbol === \"function\";\n        var toPrimitiveSymbol = supportsSymbol && typeof Symbol.toPrimitive !== \"undefined\" ? Symbol.toPrimitive : \"@@toPrimitive\";\n        var iteratorSymbol = supportsSymbol && typeof Symbol.iterator !== \"undefined\" ? Symbol.iterator : \"@@iterator\";\n        var supportsCreate = typeof Object.create === \"function\"; // feature test for Object.create support\n        var supportsProto = { __proto__: [] } instanceof Array; // feature test for __proto__ support\n        var downLevel = !supportsCreate && !supportsProto;\n        var HashMap = {\n            // create an object in dictionary mode (a.k.a. \"slow\" mode in v8)\n            create: supportsCreate\n                ? function () { return MakeDictionary(Object.create(null)); }\n                : supportsProto\n                    ? function () { return MakeDictionary({ __proto__: null }); }\n                    : function () { return MakeDictionary({}); },\n            has: downLevel\n                ? function (map, key) { return hasOwn.call(map, key); }\n                : function (map, key) { return key in map; },\n            get: downLevel\n                ? function (map, key) { return hasOwn.call(map, key) ? map[key] : undefined; }\n                : function (map, key) { return map[key]; },\n        };\n        // Load global or shim versions of Map, Set, and WeakMap\n        var functionPrototype = Object.getPrototypeOf(Function);\n        var usePolyfill = typeof process === \"object\" && process.env && process.env[\"REFLECT_METADATA_USE_MAP_POLYFILL\"] === \"true\";\n        var _Map = !usePolyfill && typeof Map === \"function\" && typeof Map.prototype.entries === \"function\" ? Map : CreateMapPolyfill();\n        var _Set = !usePolyfill && typeof Set === \"function\" && typeof Set.prototype.entries === \"function\" ? Set : CreateSetPolyfill();\n        var _WeakMap = !usePolyfill && typeof WeakMap === \"function\" ? WeakMap : CreateWeakMapPolyfill();\n        // [[Metadata]] internal slot\n        // https://rbuckton.github.io/reflect-metadata/#ordinary-object-internal-methods-and-internal-slots\n        var Metadata = new _WeakMap();\n        /**\n         * Applies a set of decorators to a property of a target object.\n         * @param decorators An array of decorators.\n         * @param target The target object.\n         * @param propertyKey (Optional) The property key to decorate.\n         * @param attributes (Optional) The property descriptor for the target key.\n         * @remarks Decorators are applied in reverse order.\n         * @example\n         *\n         *     class Example {\n         *         // property declarations are not part of ES6, though they are valid in TypeScript:\n         *         // static staticProperty;\n         *         // property;\n         *\n         *         constructor(p) { }\n         *         static staticMethod(p) { }\n         *         method(p) { }\n         *     }\n         *\n         *     // constructor\n         *     Example = Reflect.decorate(decoratorsArray, Example);\n         *\n         *     // property (on constructor)\n         *     Reflect.decorate(decoratorsArray, Example, \"staticProperty\");\n         *\n         *     // property (on prototype)\n         *     Reflect.decorate(decoratorsArray, Example.prototype, \"property\");\n         *\n         *     // method (on constructor)\n         *     Object.defineProperty(Example, \"staticMethod\",\n         *         Reflect.decorate(decoratorsArray, Example, \"staticMethod\",\n         *             Object.getOwnPropertyDescriptor(Example, \"staticMethod\")));\n         *\n         *     // method (on prototype)\n         *     Object.defineProperty(Example.prototype, \"method\",\n         *         Reflect.decorate(decoratorsArray, Example.prototype, \"method\",\n         *             Object.getOwnPropertyDescriptor(Example.prototype, \"method\")));\n         *\n         */\n        function decorate(decorators, target, propertyKey, attributes) {\n            if (!IsUndefined(propertyKey)) {\n                if (!IsArray(decorators))\n                    throw new TypeError();\n                if (!IsObject(target))\n                    throw new TypeError();\n                if (!IsObject(attributes) && !IsUndefined(attributes) && !IsNull(attributes))\n                    throw new TypeError();\n                if (IsNull(attributes))\n                    attributes = undefined;\n                propertyKey = ToPropertyKey(propertyKey);\n                return DecorateProperty(decorators, target, propertyKey, attributes);\n            }\n            else {\n                if (!IsArray(decorators))\n                    throw new TypeError();\n                if (!IsConstructor(target))\n                    throw new TypeError();\n                return DecorateConstructor(decorators, target);\n            }\n        }\n        exporter(\"decorate\", decorate);\n        // 4.1.2 Reflect.metadata(metadataKey, metadataValue)\n        // https://rbuckton.github.io/reflect-metadata/#reflect.metadata\n        /**\n         * A default metadata decorator factory that can be used on a class, class member, or parameter.\n         * @param metadataKey The key for the metadata entry.\n         * @param metadataValue The value for the metadata entry.\n         * @returns A decorator function.\n         * @remarks\n         * If `metadataKey` is already defined for the target and target key, the\n         * metadataValue for that key will be overwritten.\n         * @example\n         *\n         *     // constructor\n         *     @Reflect.metadata(key, value)\n         *     class Example {\n         *     }\n         *\n         *     // property (on constructor, TypeScript only)\n         *     class Example {\n         *         @Reflect.metadata(key, value)\n         *         static staticProperty;\n         *     }\n         *\n         *     // property (on prototype, TypeScript only)\n         *     class Example {\n         *         @Reflect.metadata(key, value)\n         *         property;\n         *     }\n         *\n         *     // method (on constructor)\n         *     class Example {\n         *         @Reflect.metadata(key, value)\n         *         static staticMethod() { }\n         *     }\n         *\n         *     // method (on prototype)\n         *     class Example {\n         *         @Reflect.metadata(key, value)\n         *         method() { }\n         *     }\n         *\n         */\n        function metadata(metadataKey, metadataValue) {\n            function decorator(target, propertyKey) {\n                if (!IsObject(target))\n                    throw new TypeError();\n                if (!IsUndefined(propertyKey) && !IsPropertyKey(propertyKey))\n                    throw new TypeError();\n                OrdinaryDefineOwnMetadata(metadataKey, metadataValue, target, propertyKey);\n            }\n            return decorator;\n        }\n        exporter(\"metadata\", metadata);\n        /**\n         * Define a unique metadata entry on the target.\n         * @param metadataKey A key used to store and retrieve metadata.\n         * @param metadataValue A value that contains attached metadata.\n         * @param target The target object on which to define metadata.\n         * @param propertyKey (Optional) The property key for the target.\n         * @example\n         *\n         *     class Example {\n         *         // property declarations are not part of ES6, though they are valid in TypeScript:\n         *         // static staticProperty;\n         *         // property;\n         *\n         *         constructor(p) { }\n         *         static staticMethod(p) { }\n         *         method(p) { }\n         *     }\n         *\n         *     // constructor\n         *     Reflect.defineMetadata(\"custom:annotation\", options, Example);\n         *\n         *     // property (on constructor)\n         *     Reflect.defineMetadata(\"custom:annotation\", options, Example, \"staticProperty\");\n         *\n         *     // property (on prototype)\n         *     Reflect.defineMetadata(\"custom:annotation\", options, Example.prototype, \"property\");\n         *\n         *     // method (on constructor)\n         *     Reflect.defineMetadata(\"custom:annotation\", options, Example, \"staticMethod\");\n         *\n         *     // method (on prototype)\n         *     Reflect.defineMetadata(\"custom:annotation\", options, Example.prototype, \"method\");\n         *\n         *     // decorator factory as metadata-producing annotation.\n         *     function MyAnnotation(options): Decorator {\n         *         return (target, key?) => Reflect.defineMetadata(\"custom:annotation\", options, target, key);\n         *     }\n         *\n         */\n        function defineMetadata(metadataKey, metadataValue, target, propertyKey) {\n            if (!IsObject(target))\n                throw new TypeError();\n            if (!IsUndefined(propertyKey))\n                propertyKey = ToPropertyKey(propertyKey);\n            return OrdinaryDefineOwnMetadata(metadataKey, metadataValue, target, propertyKey);\n        }\n        exporter(\"defineMetadata\", defineMetadata);\n        /**\n         * Gets a value indicating whether the target object or its prototype chain has the provided metadata key defined.\n         * @param metadataKey A key used to store and retrieve metadata.\n         * @param target The target object on which the metadata is defined.\n         * @param propertyKey (Optional) The property key for the target.\n         * @returns `true` if the metadata key was defined on the target object or its prototype chain; otherwise, `false`.\n         * @example\n         *\n         *     class Example {\n         *         // property declarations are not part of ES6, though they are valid in TypeScript:\n         *         // static staticProperty;\n         *         // property;\n         *\n         *         constructor(p) { }\n         *         static staticMethod(p) { }\n         *         method(p) { }\n         *     }\n         *\n         *     // constructor\n         *     result = Reflect.hasMetadata(\"custom:annotation\", Example);\n         *\n         *     // property (on constructor)\n         *     result = Reflect.hasMetadata(\"custom:annotation\", Example, \"staticProperty\");\n         *\n         *     // property (on prototype)\n         *     result = Reflect.hasMetadata(\"custom:annotation\", Example.prototype, \"property\");\n         *\n         *     // method (on constructor)\n         *     result = Reflect.hasMetadata(\"custom:annotation\", Example, \"staticMethod\");\n         *\n         *     // method (on prototype)\n         *     result = Reflect.hasMetadata(\"custom:annotation\", Example.prototype, \"method\");\n         *\n         */\n        function hasMetadata(metadataKey, target, propertyKey) {\n            if (!IsObject(target))\n                throw new TypeError();\n            if (!IsUndefined(propertyKey))\n                propertyKey = ToPropertyKey(propertyKey);\n            return OrdinaryHasMetadata(metadataKey, target, propertyKey);\n        }\n        exporter(\"hasMetadata\", hasMetadata);\n        /**\n         * Gets a value indicating whether the target object has the provided metadata key defined.\n         * @param metadataKey A key used to store and retrieve metadata.\n         * @param target The target object on which the metadata is defined.\n         * @param propertyKey (Optional) The property key for the target.\n         * @returns `true` if the metadata key was defined on the target object; otherwise, `false`.\n         * @example\n         *\n         *     class Example {\n         *         // property declarations are not part of ES6, though they are valid in TypeScript:\n         *         // static staticProperty;\n         *         // property;\n         *\n         *         constructor(p) { }\n         *         static staticMethod(p) { }\n         *         method(p) { }\n         *     }\n         *\n         *     // constructor\n         *     result = Reflect.hasOwnMetadata(\"custom:annotation\", Example);\n         *\n         *     // property (on constructor)\n         *     result = Reflect.hasOwnMetadata(\"custom:annotation\", Example, \"staticProperty\");\n         *\n         *     // property (on prototype)\n         *     result = Reflect.hasOwnMetadata(\"custom:annotation\", Example.prototype, \"property\");\n         *\n         *     // method (on constructor)\n         *     result = Reflect.hasOwnMetadata(\"custom:annotation\", Example, \"staticMethod\");\n         *\n         *     // method (on prototype)\n         *     result = Reflect.hasOwnMetadata(\"custom:annotation\", Example.prototype, \"method\");\n         *\n         */\n        function hasOwnMetadata(metadataKey, target, propertyKey) {\n            if (!IsObject(target))\n                throw new TypeError();\n            if (!IsUndefined(propertyKey))\n                propertyKey = ToPropertyKey(propertyKey);\n            return OrdinaryHasOwnMetadata(metadataKey, target, propertyKey);\n        }\n        exporter(\"hasOwnMetadata\", hasOwnMetadata);\n        /**\n         * Gets the metadata value for the provided metadata key on the target object or its prototype chain.\n         * @param metadataKey A key used to store and retrieve metadata.\n         * @param target The target object on which the metadata is defined.\n         * @param propertyKey (Optional) The property key for the target.\n         * @returns The metadata value for the metadata key if found; otherwise, `undefined`.\n         * @example\n         *\n         *     class Example {\n         *         // property declarations are not part of ES6, though they are valid in TypeScript:\n         *         // static staticProperty;\n         *         // property;\n         *\n         *         constructor(p) { }\n         *         static staticMethod(p) { }\n         *         method(p) { }\n         *     }\n         *\n         *     // constructor\n         *     result = Reflect.getMetadata(\"custom:annotation\", Example);\n         *\n         *     // property (on constructor)\n         *     result = Reflect.getMetadata(\"custom:annotation\", Example, \"staticProperty\");\n         *\n         *     // property (on prototype)\n         *     result = Reflect.getMetadata(\"custom:annotation\", Example.prototype, \"property\");\n         *\n         *     // method (on constructor)\n         *     result = Reflect.getMetadata(\"custom:annotation\", Example, \"staticMethod\");\n         *\n         *     // method (on prototype)\n         *     result = Reflect.getMetadata(\"custom:annotation\", Example.prototype, \"method\");\n         *\n         */\n        function getMetadata(metadataKey, target, propertyKey) {\n            if (!IsObject(target))\n                throw new TypeError();\n            if (!IsUndefined(propertyKey))\n                propertyKey = ToPropertyKey(propertyKey);\n            return OrdinaryGetMetadata(metadataKey, target, propertyKey);\n        }\n        exporter(\"getMetadata\", getMetadata);\n        /**\n         * Gets the metadata value for the provided metadata key on the target object.\n         * @param metadataKey A key used to store and retrieve metadata.\n         * @param target The target object on which the metadata is defined.\n         * @param propertyKey (Optional) The property key for the target.\n         * @returns The metadata value for the metadata key if found; otherwise, `undefined`.\n         * @example\n         *\n         *     class Example {\n         *         // property declarations are not part of ES6, though they are valid in TypeScript:\n         *         // static staticProperty;\n         *         // property;\n         *\n         *         constructor(p) { }\n         *         static staticMethod(p) { }\n         *         method(p) { }\n         *     }\n         *\n         *     // constructor\n         *     result = Reflect.getOwnMetadata(\"custom:annotation\", Example);\n         *\n         *     // property (on constructor)\n         *     result = Reflect.getOwnMetadata(\"custom:annotation\", Example, \"staticProperty\");\n         *\n         *     // property (on prototype)\n         *     result = Reflect.getOwnMetadata(\"custom:annotation\", Example.prototype, \"property\");\n         *\n         *     // method (on constructor)\n         *     result = Reflect.getOwnMetadata(\"custom:annotation\", Example, \"staticMethod\");\n         *\n         *     // method (on prototype)\n         *     result = Reflect.getOwnMetadata(\"custom:annotation\", Example.prototype, \"method\");\n         *\n         */\n        function getOwnMetadata(metadataKey, target, propertyKey) {\n            if (!IsObject(target))\n                throw new TypeError();\n            if (!IsUndefined(propertyKey))\n                propertyKey = ToPropertyKey(propertyKey);\n            return OrdinaryGetOwnMetadata(metadataKey, target, propertyKey);\n        }\n        exporter(\"getOwnMetadata\", getOwnMetadata);\n        /**\n         * Gets the metadata keys defined on the target object or its prototype chain.\n         * @param target The target object on which the metadata is defined.\n         * @param propertyKey (Optional) The property key for the target.\n         * @returns An array of unique metadata keys.\n         * @example\n         *\n         *     class Example {\n         *         // property declarations are not part of ES6, though they are valid in TypeScript:\n         *         // static staticProperty;\n         *         // property;\n         *\n         *         constructor(p) { }\n         *         static staticMethod(p) { }\n         *         method(p) { }\n         *     }\n         *\n         *     // constructor\n         *     result = Reflect.getMetadataKeys(Example);\n         *\n         *     // property (on constructor)\n         *     result = Reflect.getMetadataKeys(Example, \"staticProperty\");\n         *\n         *     // property (on prototype)\n         *     result = Reflect.getMetadataKeys(Example.prototype, \"property\");\n         *\n         *     // method (on constructor)\n         *     result = Reflect.getMetadataKeys(Example, \"staticMethod\");\n         *\n         *     // method (on prototype)\n         *     result = Reflect.getMetadataKeys(Example.prototype, \"method\");\n         *\n         */\n        function getMetadataKeys(target, propertyKey) {\n            if (!IsObject(target))\n                throw new TypeError();\n            if (!IsUndefined(propertyKey))\n                propertyKey = ToPropertyKey(propertyKey);\n            return OrdinaryMetadataKeys(target, propertyKey);\n        }\n        exporter(\"getMetadataKeys\", getMetadataKeys);\n        /**\n         * Gets the unique metadata keys defined on the target object.\n         * @param target The target object on which the metadata is defined.\n         * @param propertyKey (Optional) The property key for the target.\n         * @returns An array of unique metadata keys.\n         * @example\n         *\n         *     class Example {\n         *         // property declarations are not part of ES6, though they are valid in TypeScript:\n         *         // static staticProperty;\n         *         // property;\n         *\n         *         constructor(p) { }\n         *         static staticMethod(p) { }\n         *         method(p) { }\n         *     }\n         *\n         *     // constructor\n         *     result = Reflect.getOwnMetadataKeys(Example);\n         *\n         *     // property (on constructor)\n         *     result = Reflect.getOwnMetadataKeys(Example, \"staticProperty\");\n         *\n         *     // property (on prototype)\n         *     result = Reflect.getOwnMetadataKeys(Example.prototype, \"property\");\n         *\n         *     // method (on constructor)\n         *     result = Reflect.getOwnMetadataKeys(Example, \"staticMethod\");\n         *\n         *     // method (on prototype)\n         *     result = Reflect.getOwnMetadataKeys(Example.prototype, \"method\");\n         *\n         */\n        function getOwnMetadataKeys(target, propertyKey) {\n            if (!IsObject(target))\n                throw new TypeError();\n            if (!IsUndefined(propertyKey))\n                propertyKey = ToPropertyKey(propertyKey);\n            return OrdinaryOwnMetadataKeys(target, propertyKey);\n        }\n        exporter(\"getOwnMetadataKeys\", getOwnMetadataKeys);\n        /**\n         * Deletes the metadata entry from the target object with the provided key.\n         * @param metadataKey A key used to store and retrieve metadata.\n         * @param target The target object on which the metadata is defined.\n         * @param propertyKey (Optional) The property key for the target.\n         * @returns `true` if the metadata entry was found and deleted; otherwise, false.\n         * @example\n         *\n         *     class Example {\n         *         // property declarations are not part of ES6, though they are valid in TypeScript:\n         *         // static staticProperty;\n         *         // property;\n         *\n         *         constructor(p) { }\n         *         static staticMethod(p) { }\n         *         method(p) { }\n         *     }\n         *\n         *     // constructor\n         *     result = Reflect.deleteMetadata(\"custom:annotation\", Example);\n         *\n         *     // property (on constructor)\n         *     result = Reflect.deleteMetadata(\"custom:annotation\", Example, \"staticProperty\");\n         *\n         *     // property (on prototype)\n         *     result = Reflect.deleteMetadata(\"custom:annotation\", Example.prototype, \"property\");\n         *\n         *     // method (on constructor)\n         *     result = Reflect.deleteMetadata(\"custom:annotation\", Example, \"staticMethod\");\n         *\n         *     // method (on prototype)\n         *     result = Reflect.deleteMetadata(\"custom:annotation\", Example.prototype, \"method\");\n         *\n         */\n        function deleteMetadata(metadataKey, target, propertyKey) {\n            if (!IsObject(target))\n                throw new TypeError();\n            if (!IsUndefined(propertyKey))\n                propertyKey = ToPropertyKey(propertyKey);\n            var metadataMap = GetOrCreateMetadataMap(target, propertyKey, /*Create*/ false);\n            if (IsUndefined(metadataMap))\n                return false;\n            if (!metadataMap.delete(metadataKey))\n                return false;\n            if (metadataMap.size > 0)\n                return true;\n            var targetMetadata = Metadata.get(target);\n            targetMetadata.delete(propertyKey);\n            if (targetMetadata.size > 0)\n                return true;\n            Metadata.delete(target);\n            return true;\n        }\n        exporter(\"deleteMetadata\", deleteMetadata);\n        function DecorateConstructor(decorators, target) {\n            for (var i = decorators.length - 1; i >= 0; --i) {\n                var decorator = decorators[i];\n                var decorated = decorator(target);\n                if (!IsUndefined(decorated) && !IsNull(decorated)) {\n                    if (!IsConstructor(decorated))\n                        throw new TypeError();\n                    target = decorated;\n                }\n            }\n            return target;\n        }\n        function DecorateProperty(decorators, target, propertyKey, descriptor) {\n            for (var i = decorators.length - 1; i >= 0; --i) {\n                var decorator = decorators[i];\n                var decorated = decorator(target, propertyKey, descriptor);\n                if (!IsUndefined(decorated) && !IsNull(decorated)) {\n                    if (!IsObject(decorated))\n                        throw new TypeError();\n                    descriptor = decorated;\n                }\n            }\n            return descriptor;\n        }\n        function GetOrCreateMetadataMap(O, P, Create) {\n            var targetMetadata = Metadata.get(O);\n            if (IsUndefined(targetMetadata)) {\n                if (!Create)\n                    return undefined;\n                targetMetadata = new _Map();\n                Metadata.set(O, targetMetadata);\n            }\n            var metadataMap = targetMetadata.get(P);\n            if (IsUndefined(metadataMap)) {\n                if (!Create)\n                    return undefined;\n                metadataMap = new _Map();\n                targetMetadata.set(P, metadataMap);\n            }\n            return metadataMap;\n        }\n        // 3.1.1.1 OrdinaryHasMetadata(MetadataKey, O, P)\n        // https://rbuckton.github.io/reflect-metadata/#ordinaryhasmetadata\n        function OrdinaryHasMetadata(MetadataKey, O, P) {\n            var hasOwn = OrdinaryHasOwnMetadata(MetadataKey, O, P);\n            if (hasOwn)\n                return true;\n            var parent = OrdinaryGetPrototypeOf(O);\n            if (!IsNull(parent))\n                return OrdinaryHasMetadata(MetadataKey, parent, P);\n            return false;\n        }\n        // 3.1.2.1 OrdinaryHasOwnMetadata(MetadataKey, O, P)\n        // https://rbuckton.github.io/reflect-metadata/#ordinaryhasownmetadata\n        function OrdinaryHasOwnMetadata(MetadataKey, O, P) {\n            var metadataMap = GetOrCreateMetadataMap(O, P, /*Create*/ false);\n            if (IsUndefined(metadataMap))\n                return false;\n            return ToBoolean(metadataMap.has(MetadataKey));\n        }\n        // 3.1.3.1 OrdinaryGetMetadata(MetadataKey, O, P)\n        // https://rbuckton.github.io/reflect-metadata/#ordinarygetmetadata\n        function OrdinaryGetMetadata(MetadataKey, O, P) {\n            var hasOwn = OrdinaryHasOwnMetadata(MetadataKey, O, P);\n            if (hasOwn)\n                return OrdinaryGetOwnMetadata(MetadataKey, O, P);\n            var parent = OrdinaryGetPrototypeOf(O);\n            if (!IsNull(parent))\n                return OrdinaryGetMetadata(MetadataKey, parent, P);\n            return undefined;\n        }\n        // 3.1.4.1 OrdinaryGetOwnMetadata(MetadataKey, O, P)\n        // https://rbuckton.github.io/reflect-metadata/#ordinarygetownmetadata\n        function OrdinaryGetOwnMetadata(MetadataKey, O, P) {\n            var metadataMap = GetOrCreateMetadataMap(O, P, /*Create*/ false);\n            if (IsUndefined(metadataMap))\n                return undefined;\n            return metadataMap.get(MetadataKey);\n        }\n        // 3.1.5.1 OrdinaryDefineOwnMetadata(MetadataKey, MetadataValue, O, P)\n        // https://rbuckton.github.io/reflect-metadata/#ordinarydefineownmetadata\n        function OrdinaryDefineOwnMetadata(MetadataKey, MetadataValue, O, P) {\n            var metadataMap = GetOrCreateMetadataMap(O, P, /*Create*/ true);\n            metadataMap.set(MetadataKey, MetadataValue);\n        }\n        // 3.1.6.1 OrdinaryMetadataKeys(O, P)\n        // https://rbuckton.github.io/reflect-metadata/#ordinarymetadatakeys\n        function OrdinaryMetadataKeys(O, P) {\n            var ownKeys = OrdinaryOwnMetadataKeys(O, P);\n            var parent = OrdinaryGetPrototypeOf(O);\n            if (parent === null)\n                return ownKeys;\n            var parentKeys = OrdinaryMetadataKeys(parent, P);\n            if (parentKeys.length <= 0)\n                return ownKeys;\n            if (ownKeys.length <= 0)\n                return parentKeys;\n            var set = new _Set();\n            var keys = [];\n            for (var _i = 0, ownKeys_1 = ownKeys; _i < ownKeys_1.length; _i++) {\n                var key = ownKeys_1[_i];\n                var hasKey = set.has(key);\n                if (!hasKey) {\n                    set.add(key);\n                    keys.push(key);\n                }\n            }\n            for (var _a = 0, parentKeys_1 = parentKeys; _a < parentKeys_1.length; _a++) {\n                var key = parentKeys_1[_a];\n                var hasKey = set.has(key);\n                if (!hasKey) {\n                    set.add(key);\n                    keys.push(key);\n                }\n            }\n            return keys;\n        }\n        // 3.1.7.1 OrdinaryOwnMetadataKeys(O, P)\n        // https://rbuckton.github.io/reflect-metadata/#ordinaryownmetadatakeys\n        function OrdinaryOwnMetadataKeys(O, P) {\n            var keys = [];\n            var metadataMap = GetOrCreateMetadataMap(O, P, /*Create*/ false);\n            if (IsUndefined(metadataMap))\n                return keys;\n            var keysObj = metadataMap.keys();\n            var iterator = GetIterator(keysObj);\n            var k = 0;\n            while (true) {\n                var next = IteratorStep(iterator);\n                if (!next) {\n                    keys.length = k;\n                    return keys;\n                }\n                var nextValue = IteratorValue(next);\n                try {\n                    keys[k] = nextValue;\n                }\n                catch (e) {\n                    try {\n                        IteratorClose(iterator);\n                    }\n                    finally {\n                        throw e;\n                    }\n                }\n                k++;\n            }\n        }\n        // 6 ECMAScript Data Typ0es and Values\n        // https://tc39.github.io/ecma262/#sec-ecmascript-data-types-and-values\n        function Type(x) {\n            if (x === null)\n                return 1 /* Null */;\n            switch (typeof x) {\n                case \"undefined\": return 0 /* Undefined */;\n                case \"boolean\": return 2 /* Boolean */;\n                case \"string\": return 3 /* String */;\n                case \"symbol\": return 4 /* Symbol */;\n                case \"number\": return 5 /* Number */;\n                case \"object\": return x === null ? 1 /* Null */ : 6 /* Object */;\n                default: return 6 /* Object */;\n            }\n        }\n        // 6.1.1 The Undefined Type\n        // https://tc39.github.io/ecma262/#sec-ecmascript-language-types-undefined-type\n        function IsUndefined(x) {\n            return x === undefined;\n        }\n        // 6.1.2 The Null Type\n        // https://tc39.github.io/ecma262/#sec-ecmascript-language-types-null-type\n        function IsNull(x) {\n            return x === null;\n        }\n        // 6.1.5 The Symbol Type\n        // https://tc39.github.io/ecma262/#sec-ecmascript-language-types-symbol-type\n        function IsSymbol(x) {\n            return typeof x === \"symbol\";\n        }\n        // 6.1.7 The Object Type\n        // https://tc39.github.io/ecma262/#sec-object-type\n        function IsObject(x) {\n            return typeof x === \"object\" ? x !== null : typeof x === \"function\";\n        }\n        // 7.1 Type Conversion\n        // https://tc39.github.io/ecma262/#sec-type-conversion\n        // 7.1.1 ToPrimitive(input [, PreferredType])\n        // https://tc39.github.io/ecma262/#sec-toprimitive\n        function ToPrimitive(input, PreferredType) {\n            switch (Type(input)) {\n                case 0 /* Undefined */: return input;\n                case 1 /* Null */: return input;\n                case 2 /* Boolean */: return input;\n                case 3 /* String */: return input;\n                case 4 /* Symbol */: return input;\n                case 5 /* Number */: return input;\n            }\n            var hint = PreferredType === 3 /* String */ ? \"string\" : PreferredType === 5 /* Number */ ? \"number\" : \"default\";\n            var exoticToPrim = GetMethod(input, toPrimitiveSymbol);\n            if (exoticToPrim !== undefined) {\n                var result = exoticToPrim.call(input, hint);\n                if (IsObject(result))\n                    throw new TypeError();\n                return result;\n            }\n            return OrdinaryToPrimitive(input, hint === \"default\" ? \"number\" : hint);\n        }\n        // 7.1.1.1 OrdinaryToPrimitive(O, hint)\n        // https://tc39.github.io/ecma262/#sec-ordinarytoprimitive\n        function OrdinaryToPrimitive(O, hint) {\n            if (hint === \"string\") {\n                var toString_1 = O.toString;\n                if (IsCallable(toString_1)) {\n                    var result = toString_1.call(O);\n                    if (!IsObject(result))\n                        return result;\n                }\n                var valueOf = O.valueOf;\n                if (IsCallable(valueOf)) {\n                    var result = valueOf.call(O);\n                    if (!IsObject(result))\n                        return result;\n                }\n            }\n            else {\n                var valueOf = O.valueOf;\n                if (IsCallable(valueOf)) {\n                    var result = valueOf.call(O);\n                    if (!IsObject(result))\n                        return result;\n                }\n                var toString_2 = O.toString;\n                if (IsCallable(toString_2)) {\n                    var result = toString_2.call(O);\n                    if (!IsObject(result))\n                        return result;\n                }\n            }\n            throw new TypeError();\n        }\n        // 7.1.2 ToBoolean(argument)\n        // https://tc39.github.io/ecma262/2016/#sec-toboolean\n        function ToBoolean(argument) {\n            return !!argument;\n        }\n        // 7.1.12 ToString(argument)\n        // https://tc39.github.io/ecma262/#sec-tostring\n        function ToString(argument) {\n            return \"\" + argument;\n        }\n        // 7.1.14 ToPropertyKey(argument)\n        // https://tc39.github.io/ecma262/#sec-topropertykey\n        function ToPropertyKey(argument) {\n            var key = ToPrimitive(argument, 3 /* String */);\n            if (IsSymbol(key))\n                return key;\n            return ToString(key);\n        }\n        // 7.2 Testing and Comparison Operations\n        // https://tc39.github.io/ecma262/#sec-testing-and-comparison-operations\n        // 7.2.2 IsArray(argument)\n        // https://tc39.github.io/ecma262/#sec-isarray\n        function IsArray(argument) {\n            return Array.isArray\n                ? Array.isArray(argument)\n                : argument instanceof Object\n                    ? argument instanceof Array\n                    : Object.prototype.toString.call(argument) === \"[object Array]\";\n        }\n        // 7.2.3 IsCallable(argument)\n        // https://tc39.github.io/ecma262/#sec-iscallable\n        function IsCallable(argument) {\n            // NOTE: This is an approximation as we cannot check for [[Call]] internal method.\n            return typeof argument === \"function\";\n        }\n        // 7.2.4 IsConstructor(argument)\n        // https://tc39.github.io/ecma262/#sec-isconstructor\n        function IsConstructor(argument) {\n            // NOTE: This is an approximation as we cannot check for [[Construct]] internal method.\n            return typeof argument === \"function\";\n        }\n        // 7.2.7 IsPropertyKey(argument)\n        // https://tc39.github.io/ecma262/#sec-ispropertykey\n        function IsPropertyKey(argument) {\n            switch (Type(argument)) {\n                case 3 /* String */: return true;\n                case 4 /* Symbol */: return true;\n                default: return false;\n            }\n        }\n        // 7.3 Operations on Objects\n        // https://tc39.github.io/ecma262/#sec-operations-on-objects\n        // 7.3.9 GetMethod(V, P)\n        // https://tc39.github.io/ecma262/#sec-getmethod\n        function GetMethod(V, P) {\n            var func = V[P];\n            if (func === undefined || func === null)\n                return undefined;\n            if (!IsCallable(func))\n                throw new TypeError();\n            return func;\n        }\n        // 7.4 Operations on Iterator Objects\n        // https://tc39.github.io/ecma262/#sec-operations-on-iterator-objects\n        function GetIterator(obj) {\n            var method = GetMethod(obj, iteratorSymbol);\n            if (!IsCallable(method))\n                throw new TypeError(); // from Call\n            var iterator = method.call(obj);\n            if (!IsObject(iterator))\n                throw new TypeError();\n            return iterator;\n        }\n        // 7.4.4 IteratorValue(iterResult)\n        // https://tc39.github.io/ecma262/2016/#sec-iteratorvalue\n        function IteratorValue(iterResult) {\n            return iterResult.value;\n        }\n        // 7.4.5 IteratorStep(iterator)\n        // https://tc39.github.io/ecma262/#sec-iteratorstep\n        function IteratorStep(iterator) {\n            var result = iterator.next();\n            return result.done ? false : result;\n        }\n        // 7.4.6 IteratorClose(iterator, completion)\n        // https://tc39.github.io/ecma262/#sec-iteratorclose\n        function IteratorClose(iterator) {\n            var f = iterator[\"return\"];\n            if (f)\n                f.call(iterator);\n        }\n        // 9.1 Ordinary Object Internal Methods and Internal Slots\n        // https://tc39.github.io/ecma262/#sec-ordinary-object-internal-methods-and-internal-slots\n        // 9.1.1.1 OrdinaryGetPrototypeOf(O)\n        // https://tc39.github.io/ecma262/#sec-ordinarygetprototypeof\n        function OrdinaryGetPrototypeOf(O) {\n            var proto = Object.getPrototypeOf(O);\n            if (typeof O !== \"function\" || O === functionPrototype)\n                return proto;\n            // TypeScript doesn't set __proto__ in ES5, as it's non-standard.\n            // Try to determine the superclass constructor. Compatible implementations\n            // must either set __proto__ on a subclass constructor to the superclass constructor,\n            // or ensure each class has a valid `constructor` property on its prototype that\n            // points back to the constructor.\n            // If this is not the same as Function.[[Prototype]], then this is definately inherited.\n            // This is the case when in ES6 or when using __proto__ in a compatible browser.\n            if (proto !== functionPrototype)\n                return proto;\n            // If the super prototype is Object.prototype, null, or undefined, then we cannot determine the heritage.\n            var prototype = O.prototype;\n            var prototypeProto = prototype && Object.getPrototypeOf(prototype);\n            if (prototypeProto == null || prototypeProto === Object.prototype)\n                return proto;\n            // If the constructor was not a function, then we cannot determine the heritage.\n            var constructor = prototypeProto.constructor;\n            if (typeof constructor !== \"function\")\n                return proto;\n            // If we have some kind of self-reference, then we cannot determine the heritage.\n            if (constructor === O)\n                return proto;\n            // we have a pretty good guess at the heritage.\n            return constructor;\n        }\n        // naive Map shim\n        function CreateMapPolyfill() {\n            var cacheSentinel = {};\n            var arraySentinel = [];\n            var MapIterator = /** @class */ (function () {\n                function MapIterator(keys, values, selector) {\n                    this._index = 0;\n                    this._keys = keys;\n                    this._values = values;\n                    this._selector = selector;\n                }\n                MapIterator.prototype[\"@@iterator\"] = function () { return this; };\n                MapIterator.prototype[iteratorSymbol] = function () { return this; };\n                MapIterator.prototype.next = function () {\n                    var index = this._index;\n                    if (index >= 0 && index < this._keys.length) {\n                        var result = this._selector(this._keys[index], this._values[index]);\n                        if (index + 1 >= this._keys.length) {\n                            this._index = -1;\n                            this._keys = arraySentinel;\n                            this._values = arraySentinel;\n                        }\n                        else {\n                            this._index++;\n                        }\n                        return { value: result, done: false };\n                    }\n                    return { value: undefined, done: true };\n                };\n                MapIterator.prototype.throw = function (error) {\n                    if (this._index >= 0) {\n                        this._index = -1;\n                        this._keys = arraySentinel;\n                        this._values = arraySentinel;\n                    }\n                    throw error;\n                };\n                MapIterator.prototype.return = function (value) {\n                    if (this._index >= 0) {\n                        this._index = -1;\n                        this._keys = arraySentinel;\n                        this._values = arraySentinel;\n                    }\n                    return { value: value, done: true };\n                };\n                return MapIterator;\n            }());\n            return /** @class */ (function () {\n                function Map() {\n                    this._keys = [];\n                    this._values = [];\n                    this._cacheKey = cacheSentinel;\n                    this._cacheIndex = -2;\n                }\n                Object.defineProperty(Map.prototype, \"size\", {\n                    get: function () { return this._keys.length; },\n                    enumerable: true,\n                    configurable: true\n                });\n                Map.prototype.has = function (key) { return this._find(key, /*insert*/ false) >= 0; };\n                Map.prototype.get = function (key) {\n                    var index = this._find(key, /*insert*/ false);\n                    return index >= 0 ? this._values[index] : undefined;\n                };\n                Map.prototype.set = function (key, value) {\n                    var index = this._find(key, /*insert*/ true);\n                    this._values[index] = value;\n                    return this;\n                };\n                Map.prototype.delete = function (key) {\n                    var index = this._find(key, /*insert*/ false);\n                    if (index >= 0) {\n                        var size = this._keys.length;\n                        for (var i = index + 1; i < size; i++) {\n                            this._keys[i - 1] = this._keys[i];\n                            this._values[i - 1] = this._values[i];\n                        }\n                        this._keys.length--;\n                        this._values.length--;\n                        if (key === this._cacheKey) {\n                            this._cacheKey = cacheSentinel;\n                            this._cacheIndex = -2;\n                        }\n                        return true;\n                    }\n                    return false;\n                };\n                Map.prototype.clear = function () {\n                    this._keys.length = 0;\n                    this._values.length = 0;\n                    this._cacheKey = cacheSentinel;\n                    this._cacheIndex = -2;\n                };\n                Map.prototype.keys = function () { return new MapIterator(this._keys, this._values, getKey); };\n                Map.prototype.values = function () { return new MapIterator(this._keys, this._values, getValue); };\n                Map.prototype.entries = function () { return new MapIterator(this._keys, this._values, getEntry); };\n                Map.prototype[\"@@iterator\"] = function () { return this.entries(); };\n                Map.prototype[iteratorSymbol] = function () { return this.entries(); };\n                Map.prototype._find = function (key, insert) {\n                    if (this._cacheKey !== key) {\n                        this._cacheIndex = this._keys.indexOf(this._cacheKey = key);\n                    }\n                    if (this._cacheIndex < 0 && insert) {\n                        this._cacheIndex = this._keys.length;\n                        this._keys.push(key);\n                        this._values.push(undefined);\n                    }\n                    return this._cacheIndex;\n                };\n                return Map;\n            }());\n            function getKey(key, _) {\n                return key;\n            }\n            function getValue(_, value) {\n                return value;\n            }\n            function getEntry(key, value) {\n                return [key, value];\n            }\n        }\n        // naive Set shim\n        function CreateSetPolyfill() {\n            return /** @class */ (function () {\n                function Set() {\n                    this._map = new _Map();\n                }\n                Object.defineProperty(Set.prototype, \"size\", {\n                    get: function () { return this._map.size; },\n                    enumerable: true,\n                    configurable: true\n                });\n                Set.prototype.has = function (value) { return this._map.has(value); };\n                Set.prototype.add = function (value) { return this._map.set(value, value), this; };\n                Set.prototype.delete = function (value) { return this._map.delete(value); };\n                Set.prototype.clear = function () { this._map.clear(); };\n                Set.prototype.keys = function () { return this._map.keys(); };\n                Set.prototype.values = function () { return this._map.values(); };\n                Set.prototype.entries = function () { return this._map.entries(); };\n                Set.prototype[\"@@iterator\"] = function () { return this.keys(); };\n                Set.prototype[iteratorSymbol] = function () { return this.keys(); };\n                return Set;\n            }());\n        }\n        // naive WeakMap shim\n        function CreateWeakMapPolyfill() {\n            var UUID_SIZE = 16;\n            var keys = HashMap.create();\n            var rootKey = CreateUniqueKey();\n            return /** @class */ (function () {\n                function WeakMap() {\n                    this._key = CreateUniqueKey();\n                }\n                WeakMap.prototype.has = function (target) {\n                    var table = GetOrCreateWeakMapTable(target, /*create*/ false);\n                    return table !== undefined ? HashMap.has(table, this._key) : false;\n                };\n                WeakMap.prototype.get = function (target) {\n                    var table = GetOrCreateWeakMapTable(target, /*create*/ false);\n                    return table !== undefined ? HashMap.get(table, this._key) : undefined;\n                };\n                WeakMap.prototype.set = function (target, value) {\n                    var table = GetOrCreateWeakMapTable(target, /*create*/ true);\n                    table[this._key] = value;\n                    return this;\n                };\n                WeakMap.prototype.delete = function (target) {\n                    var table = GetOrCreateWeakMapTable(target, /*create*/ false);\n                    return table !== undefined ? delete table[this._key] : false;\n                };\n                WeakMap.prototype.clear = function () {\n                    // NOTE: not a real clear, just makes the previous data unreachable\n                    this._key = CreateUniqueKey();\n                };\n                return WeakMap;\n            }());\n            function CreateUniqueKey() {\n                var key;\n                do\n                    key = \"@@WeakMap@@\" + CreateUUID();\n                while (HashMap.has(keys, key));\n                keys[key] = true;\n                return key;\n            }\n            function GetOrCreateWeakMapTable(target, create) {\n                if (!hasOwn.call(target, rootKey)) {\n                    if (!create)\n                        return undefined;\n                    Object.defineProperty(target, rootKey, { value: HashMap.create() });\n                }\n                return target[rootKey];\n            }\n            function FillRandomBytes(buffer, size) {\n                for (var i = 0; i < size; ++i)\n                    buffer[i] = Math.random() * 0xff | 0;\n                return buffer;\n            }\n            function GenRandomBytes(size) {\n                if (typeof Uint8Array === \"function\") {\n                    if (typeof crypto !== \"undefined\")\n                        return crypto.getRandomValues(new Uint8Array(size));\n                    if (typeof msCrypto !== \"undefined\")\n                        return msCrypto.getRandomValues(new Uint8Array(size));\n                    return FillRandomBytes(new Uint8Array(size), size);\n                }\n                return FillRandomBytes(new Array(size), size);\n            }\n            function CreateUUID() {\n                var data = GenRandomBytes(UUID_SIZE);\n                // mark as random - RFC 4122  4.4\n                data[6] = data[6] & 0x4f | 0x40;\n                data[8] = data[8] & 0xbf | 0x80;\n                var result = \"\";\n                for (var offset = 0; offset < UUID_SIZE; ++offset) {\n                    var byte = data[offset];\n                    if (offset === 4 || offset === 6 || offset === 8)\n                        result += \"-\";\n                    if (byte < 16)\n                        result += \"0\";\n                    result += byte.toString(16).toLowerCase();\n                }\n                return result;\n            }\n        }\n        // uses a heuristic used by v8 and chakra to force an object into dictionary mode.\n        function MakeDictionary(obj) {\n            obj.__ = undefined;\n            delete obj.__;\n            return obj;\n        }\n    });\n})(Reflect || (Reflect = {}));\n","import interval from \"./interval.js\";\nimport {durationMinute, durationWeek} from \"./duration.js\";\n\nfunction weekday(i) {\n  return interval(function(date) {\n    date.setDate(date.getDate() - (date.getDay() + 7 - i) % 7);\n    date.setHours(0, 0, 0, 0);\n  }, function(date, step) {\n    date.setDate(date.getDate() + step * 7);\n  }, function(start, end) {\n    return (end - start - (end.getTimezoneOffset() - start.getTimezoneOffset()) * durationMinute) / durationWeek;\n  });\n}\n\nexport var sunday = weekday(0);\nexport var monday = weekday(1);\nexport var tuesday = weekday(2);\nexport var wednesday = weekday(3);\nexport var thursday = weekday(4);\nexport var friday = weekday(5);\nexport var saturday = weekday(6);\n\nexport var sundays = sunday.range;\nexport var mondays = monday.range;\nexport var tuesdays = tuesday.range;\nexport var wednesdays = wednesday.range;\nexport var thursdays = thursday.range;\nexport var fridays = friday.range;\nexport var saturdays = saturday.range;\n","import interval from \"./interval.js\";\n\nvar month = interval(function(date) {\n  date.setDate(1);\n  date.setHours(0, 0, 0, 0);\n}, function(date, step) {\n  date.setMonth(date.getMonth() + step);\n}, function(start, end) {\n  return end.getMonth() - start.getMonth() + (end.getFullYear() - start.getFullYear()) * 12;\n}, function(date) {\n  return date.getMonth();\n});\n\nexport default month;\nexport var months = month.range;\n","import interval from \"./interval.js\";\nimport {durationHour, durationMinute, durationSecond} from \"./duration.js\";\n\nvar hour = interval(function(date) {\n  date.setTime(date - date.getMilliseconds() - date.getSeconds() * durationSecond - date.getMinutes() * durationMinute);\n}, function(date, step) {\n  date.setTime(+date + step * durationHour);\n}, function(start, end) {\n  return (end - start) / durationHour;\n}, function(date) {\n  return date.getHours();\n});\n\nexport default hour;\nexport var hours = hour.range;\n","import interval from \"./interval.js\";\nimport {durationMinute, durationSecond} from \"./duration.js\";\n\nvar minute = interval(function(date) {\n  date.setTime(date - date.getMilliseconds() - date.getSeconds() * durationSecond);\n}, function(date, step) {\n  date.setTime(+date + step * durationMinute);\n}, function(start, end) {\n  return (end - start) / durationMinute;\n}, function(date) {\n  return date.getMinutes();\n});\n\nexport default minute;\nexport var minutes = minute.range;\n","import interval from \"./interval.js\";\nimport {durationSecond} from \"./duration.js\";\n\nvar second = interval(function(date) {\n  date.setTime(date - date.getMilliseconds());\n}, function(date, step) {\n  date.setTime(+date + step * durationSecond);\n}, function(start, end) {\n  return (end - start) / durationSecond;\n}, function(date) {\n  return date.getUTCSeconds();\n});\n\nexport default second;\nexport var seconds = second.range;\n","import interval from \"./interval.js\";\nimport {durationWeek} from \"./duration.js\";\n\nfunction utcWeekday(i) {\n  return interval(function(date) {\n    date.setUTCDate(date.getUTCDate() - (date.getUTCDay() + 7 - i) % 7);\n    date.setUTCHours(0, 0, 0, 0);\n  }, function(date, step) {\n    date.setUTCDate(date.getUTCDate() + step * 7);\n  }, function(start, end) {\n    return (end - start) / durationWeek;\n  });\n}\n\nexport var utcSunday = utcWeekday(0);\nexport var utcMonday = utcWeekday(1);\nexport var utcTuesday = utcWeekday(2);\nexport var utcWednesday = utcWeekday(3);\nexport var utcThursday = utcWeekday(4);\nexport var utcFriday = utcWeekday(5);\nexport var utcSaturday = utcWeekday(6);\n\nexport var utcSundays = utcSunday.range;\nexport var utcMondays = utcMonday.range;\nexport var utcTuesdays = utcTuesday.range;\nexport var utcWednesdays = utcWednesday.range;\nexport var utcThursdays = utcThursday.range;\nexport var utcFridays = utcFriday.range;\nexport var utcSaturdays = utcSaturday.range;\n","import interval from \"./interval.js\";\nimport {durationDay} from \"./duration.js\";\n\nvar utcDay = interval(function(date) {\n  date.setUTCHours(0, 0, 0, 0);\n}, function(date, step) {\n  date.setUTCDate(date.getUTCDate() + step);\n}, function(start, end) {\n  return (end - start) / durationDay;\n}, function(date) {\n  return date.getUTCDate() - 1;\n});\n\nexport default utcDay;\nexport var utcDays = utcDay.range;\n","import interval from \"./interval.js\";\n\nvar year = interval(function(date) {\n  date.setMonth(0, 1);\n  date.setHours(0, 0, 0, 0);\n}, function(date, step) {\n  date.setFullYear(date.getFullYear() + step);\n}, function(start, end) {\n  return end.getFullYear() - start.getFullYear();\n}, function(date) {\n  return date.getFullYear();\n});\n\n// An optimized implementation for this simple case.\nyear.every = function(k) {\n  return !isFinite(k = Math.floor(k)) || !(k > 0) ? null : interval(function(date) {\n    date.setFullYear(Math.floor(date.getFullYear() / k) * k);\n    date.setMonth(0, 1);\n    date.setHours(0, 0, 0, 0);\n  }, function(date, step) {\n    date.setFullYear(date.getFullYear() + step * k);\n  });\n};\n\nexport default year;\nexport var years = year.range;\n","import interval from \"./interval.js\";\n\nvar utcYear = interval(function(date) {\n  date.setUTCMonth(0, 1);\n  date.setUTCHours(0, 0, 0, 0);\n}, function(date, step) {\n  date.setUTCFullYear(date.getUTCFullYear() + step);\n}, function(start, end) {\n  return end.getUTCFullYear() - start.getUTCFullYear();\n}, function(date) {\n  return date.getUTCFullYear();\n});\n\n// An optimized implementation for this simple case.\nutcYear.every = function(k) {\n  return !isFinite(k = Math.floor(k)) || !(k > 0) ? null : interval(function(date) {\n    date.setUTCFullYear(Math.floor(date.getUTCFullYear() / k) * k);\n    date.setUTCMonth(0, 1);\n    date.setUTCHours(0, 0, 0, 0);\n  }, function(date, step) {\n    date.setUTCFullYear(date.getUTCFullYear() + step * k);\n  });\n};\n\nexport default utcYear;\nexport var utcYears = utcYear.range;\n","export default \"// removed by extract-text-webpack-plugin\""],"sourceRoot":""}